(function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i})({1:[function(e,t,n){var r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t){if(u.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("jquery");o=e("three");e("./vendor/TrackballControls");s=e("./GameObject");t.exports=i=function(e){function t(e){var t;this.distance=(t=e!=null?e.distance:void 0)!=null?t:5}a(t,e);t.prototype.start=function(){this.graphics().camera().position.set(0,0,this.distance);this.graphics().camera().lookAt(new o.Vector3(0,0,0));return this.graphics().divPromise().then(function(e){return function(t){e.controls=new o.TrackballControls(e.graphics().camera(),t);e.controls.target.set(0,0,0);return r(window).resize(e.controls.handleResize())}}(this)).done()};t.prototype.step=function(){if(this.controls!=null){return this.controls.update()}};return t}(s)},{"./GameObject":5,"./vendor/TrackballControls":36,jquery:43,three:45}],2:[function(e,t,n){(function(n){var r,i,s;i=e("fs");s=e("three");t.exports=r=function(){function e(e){this._geometry=e;this._material=new s.ShaderMaterial({uniforms:{},attributes:{},vertexShader:n("dmFyeWluZyB2ZWM0IG12UG9zaXRpb247DQoNCi8qDQpUaHJlZS5qcyBnaXZlcyB1cyB0aGVzZToNCnBvc2l0aW9uDQpjb2xvcg0KbW9kZWxWaWV3TWF0cml4DQpwcm9qZWN0aW9uTWF0cml4DQoqLw0KDQp2b2lkIG1haW4oKQ0Kew0KCW12UG9zaXRpb24gPQ0KCQltb2RlbFZpZXdNYXRyaXggKiB2ZWM0KHBvc2l0aW9uLCAxLjApOw0KDQoJZ2xfUG9zaXRpb24gPQ0KCQlwcm9qZWN0aW9uTWF0cml4ICogbXZQb3NpdGlvbjsNCn0NCg==","base64"),fragmentShader:n("I2V4dGVuc2lvbiBPRVNfdGV4dHVyZV9mbG9hdCA6IGVuYWJsZQ0KDQp2YXJ5aW5nIHZlYzQgbXZQb3NpdGlvbjsNCg0Kdm9pZCBtYWluKCkNCnsNCglnbF9GcmFnQ29sb3IgPQ0KCQl2ZWM0KG12UG9zaXRpb24ueHl6LCAxKTsNCn0NCg==","base64"),depthWrite:true});this.mesh=new s.Mesh(this._geometry,this._material)}return e}()}).call(this,e("buffer").Buffer)},{buffer:39,fs:38,three:45}],3:[function(e,t,n){var r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t){if(u.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("jquery");o=e("three");s=e("./GameObject");t.exports=i=function(e){function t(e){this._selectorText=e;this._frameNumber=0;this._currentFrameRate=0;this._clock=new o.Clock(true);this._clock.getDelta()}a(t,e);t.prototype.step=function(e){var t,n;n=30;this._frameNumber+=1;if(this._frameNumber%n===0){t=this._clock.getDelta();this._currentFrameRate=n/t;return r(this._selectorText).text(Math.round(this._currentFrameRate))}};return t}(s)},{"./GameObject":5,jquery:43,three:45}],4:[function(e,t,n){var r,i,s,o,u,a,f,l,c;a=e("q");l=e("three");c=e("./check").type;s=e("./Graphics");i=e("./GameObject");f=e("./meta").read;o=e("./Physics");u=e("./Resources");t.exports=r=function(){function e(){this._graphics=new s;this._resources=new u(this.allResources());this._readyToPlay=a.defer();this._resources.promise().then(function(e){return function(){return e.restart()}}(this)).done()}f(e,"graphics","physics","resources");e.prototype.allResources=function(){return{models:[],textures:[]}};e.prototype.addObject=function(e){c(e,i);this._gameObjects.push(e);e.registerGame(this);return e.start()};e.prototype.bindToDiv=function(e){this.container=e;return this._readyToPlay.promise.then(function(t){return function(){t._graphics.bindToDiv(e);return t._graphics.draw()}}(this)).done()};e.prototype.restart=function(){var e,t,n,r;this._graphics.restart();this._physics=new o;this._gameObjects=[];this.addObject(this._graphics);this.addObject(this._physics);r=this.initialObjects();for(t=0,n=r.length;t<n;t++){e=r[t];this.addObject(e)}this.otherSetup();this._clock=new l.Clock(true);this.paused=true;this._readyToPlay.resolve();if(this.container!=null){return requestAnimationFrame(function(e){return function(){return e._graphics.draw()}}(this))}};e.prototype.initialObjects=function(){return[]};e.prototype.otherSetup=function(){return null};e.prototype.play=function(){return this._readyToPlay.promise.then(function(e){return function(){e._paused=false;e._clock.getDelta();return e.gameLoop()}}(this)).done()};e.prototype.pause=function(){return this._paused=true};e.prototype.gameLoop=function(){var e,t,n,r,i,s;if(!this._paused){requestAnimationFrame(function(e){return function(){return e.gameLoop()}}(this));try{e=this._clock.getDelta();s=this._gameObjects;for(r=0,i=s.length;r<i;r++){n=s[r];n.step(e)}this._gameObjects=this._gameObjects.filter(function(e){if(e.dead()){e.finish();return false}else{return true}});return this._graphics.draw()}catch(o){t=o;this.pause();throw t}}};return e}()},{"./GameObject":5,"./Graphics":6,"./Physics":9,"./Resources":10,"./check":16,"./meta":27,q:44,three:45}],5:[function(e,t,n){var r,i;i=e("./meta").read;t.exports=r=function(){function e(){}e.prototype.step=function(e){return null};e.prototype.registerGame=function(e){return this._game=e};i(e,"game");e.prototype.graphics=function(){return this.game().graphics()};e.prototype.physics=function(){return this.game().physics()};e.prototype.resources=function(){return this.game().resources()};e.prototype.emit=function(e){this.game().addObject(e);return e};e.prototype.die=function(){return this._dead=true};e.prototype.dead=function(){return this._dead!=null};e.prototype.start=function(){return null};e.prototype.finish=function(){return null};return e}()},{"./meta":27}],6:[function(e,t,n){var r,i,s,o,u,a,f={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var n in t){if(f.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};o=e("q");a=e("three");s=e("./check").check;u=e("./meta").read;r=e("./GameObject");t.exports=i=function(e){function t(){var e;try{this.renderer=new a.WebGLRenderer({alpha:true,preserveDrawingBuffer:true})}catch(t){e=t;alert("Could not initialize WebGL!");throw e}this._strokeMeshes=[];this._divDefer=o.defer()}l(t,e);u(t,"camera","depthTexture","scene","strokeMeshes","width","height");t.prototype.imageDataURL=function(){return this.renderer.domElement.toDataURL()};t.prototype.size=function(){return Math.min(this._width,this._height)};t.prototype.divPromise=function(){return this._divDefer.promise};t.prototype.bindToDiv=function(e){this._width=e.width();this._height=e.height();this.renderer.setSize(this._width,this._height);this.resetAspect();e.append(this.renderer.domElement);return this._divDefer.resolve(e.get(0))};t.prototype.resetAspect=function(){var e;s(this._width!=null);this._camera.aspect=this._width/this._height;this._camera.updateProjectionMatrix();e={magFilter:a.NearestFilter,minFilter:a.NearestFilter,wrapS:a.ClampToEdgeWrapping,wrapT:a.ClampToEdgeWrapping,type:a.FloatType};return this._depthTexture=new a.WebGLRenderTarget(this._width,this._height,e)};t.prototype.restart=function(){this._scene=new a.Scene;this.setupLights();this._camera=new a.PerspectiveCamera(75,1,.1,1e3);if(this._width!=null){this.resetAspect()}return this._scene.add(this._camera)};t.prototype.setAmbient=function(e){return this._ambientLight.color.copy(e)};t.prototype.setupLights=function(){this._ambientLight=new a.AmbientLight(0);this._scene.add(this._ambientLight);this.addLight({color:16777215,intensity:.01,pos:new a.Vector3(-1,0,0)});this.addLight({color:16777215,intensity:.01,pos:new a.Vector3(1,0,0)});this.addLight({color:16777215,intensity:.01,pos:new a.Vector3(0,-1,0)});this.addLight({color:16777215,intensity:.01,pos:new a.Vector3(0,1,0)});this.addLight({color:16777215,intensity:.01,pos:new a.Vector3(0,0,-1)});return this.addLight({color:16777215,intensity:.01,pos:new a.Vector3(0,0,1)})};t.prototype.addLight=function(e){var t,n,r,i;t=e.color;n=e.intensity;i=e.pos;r=new a.DirectionalLight(t,n);r.position.copy(i);return this._scene.add(r)};t.prototype.setOriginalMeshesVisibility=function(e){var t,n,r,i,s;i=this._strokeMeshes;s=[];for(n=0,r=i.length;n<r;n++){t=i[n];s.push(t.setOriginalMeshVisibility(e))}return s};t.prototype.setDepthMeshesVisibility=function(e){var t,n,r,i,s;i=this._strokeMeshes;s=[];for(n=0,r=i.length;n<r;n++){t=i[n];s.push(t.setDepthMeshVisibility(e))}return s};t.prototype.setStrokeMeshesVisibility=function(e){var t,n,r,i,s;i=this._strokeMeshes;s=[];for(n=0,r=i.length;n<r;n++){t=i[n];s.push(t.setStrokeMeshVisibility(e))}return s};t.prototype.draw=function(){this.setOriginalMeshesVisibility(false);this.setDepthMeshesVisibility(true);this.setStrokeMeshesVisibility(false);this.renderer.render(this._scene,this._camera,this._depthTexture,true);this.setOriginalMeshesVisibility(true);this.setDepthMeshesVisibility(false);this.setStrokeMeshesVisibility(true);return this.renderer.render(this._scene,this._camera)};return t}(r)},{"./GameObject":5,"./check":16,"./meta":27,q:44,three:45}],7:[function(e,t,n){var r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t){if(o.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};s=e("three");r=e("./GameObject");t.exports=i=function(e){function t(e){var t,n,r,i,o,u,a,f;if(e==null){e={}}t=(o=e.direction)!=null?o:new s.Vector3(1,0,0);n=(u=e.hue)!=null?u:0;i=(a=e.sat)!=null?a:0;r=(f=e.lum)!=null?f:0;this._light=new s.DirectionalLight(16777215,1);this.setDirection(t);this.setColor(n,i,r)}u(t,e);t.prototype.start=function(){return this.graphics().scene().add(this._light)};t.prototype.finish=function(){return this.graphics().scene().remove(this._light)};t.prototype.setDirection=function(e){this._light.position.copy(e);return this._light.position.negate()};t.prototype.setColor=function(e,t,n){this._light.color.setHSL(e,t,.5);return this._light.intensity=n};return t}(r)},{"./GameObject":5,three:45}],8:[function(e,t,n){var r,i,s,o,u,a,f={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var n in t){if(f.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("jquery");a=e("three");i=e("./GameObject");u=e("./StrokeMeshLayer");o=e("./StrokeMesh");t.exports=s=function(e){function t(e){this.opts=e}l(t,e);t.prototype.start=function(){var e,t,n,i,s,u,f,l,c,h,p;e=(f=this.opts.center)!=null?f:fail();u=(l=this.opts.velocity)!=null?l:new a.Vector3(0,0,0);i=this.opts.model!=null?this.opts.model:this.opts.modelName!=null?this.resources().geometry(this.opts.modelName):fail();t=(c=this.opts.mass)!=null?c:0;n=(h=this.opts.materialName)!=null?h:fail();s=(p=this.opts.strokeMeshOptions)!=null?p:fail();this.mesh=o.of(r.extend(s,{geometry:i}));this.mesh.addToGraphics(this.graphics());this.body=this.physics().addBody({gameObject:this,threeObject:this.mesh.threeObject(),originalGeometry:this.mesh.getOriginalMesh().geometry,mass:t,center:e,velocity:u,materialName:n});if(this.opts.init!=null){return this.opts.init.call(this)}};t.prototype.finish=function(){this.physics().removeBody(this.body);return this.mesh.removeFromGraphics(this.graphics())};t.prototype.listenForCollide=function(e){return this.body.addEventListener("collide",function(t){return e(t["with"].gameObject)})};t.prototype.quaternion=function(){return this.body.quaternion};return t}(i)},{"./GameObject":5,"./StrokeMesh":13,"./StrokeMeshLayer":14,jquery:43,three:45}],9:[function(e,t,n){var r,i,s,o,u,a,f={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var n in t){if(f.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};s=e("cannon");a=e("./check"),o=a.check,u=a.type;r=e("./GameObject");t.exports=i=function(e){function t(){this.world=new s.World;this.world.broadphase=new s.NaiveBroadphase;this.world.solver.iterations=7;this.world.solver.tolerance=.1;this.world.allowSleep=true;this.secondsPerUpdate=1/30;this._materials={}}l(t,e);t.prototype.material=function(e){var t;return(t=this._materials)[e]!=null?t[e]:t[e]=new s.Material};t.prototype.addMaterialContact=function(e,t,n,r){return this.world.addContactMaterial(new s.ContactMaterial(this.material(e),this.material(t),n,r))};t.prototype.step=function(e){var t,n,r,i,s,o,u,a;r=1;e=Math.min(e,this.secondsPerUpdate);this.world.step(this.secondsPerUpdate*r);u=this.world.bodies;a=[];for(s=0,o=u.length;s<o;s++){t=u[s];t.threeObject.position.copy(t.position);i=t.threeObject.quaternion;n=t.quaternion;i.x=n.x;i.y=n.y;i.z=n.z;a.push(i.w=n.w)}return a};t.prototype.setGravity=function(e){return this.world.gravity.set(e.x,e.y,e.z)};t.prototype.addBody=function(e){var t,n,r,i,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;a=(g=e.materialName)!=null?g:fail();u=(y=e.mass)!=null?y:0;i=(b=e.gameObject)!=null?b:fail();v=(w=e.threeObject)!=null?w:fail();p=(E=e.originalGeometry)!=null?E:fail();r=(S=e.center)!=null?S:fail();m=(x=e.velocity)!=null?x:fail();n="box";d=function(){var e;switch(n){case"box":p.computeBoundingBox();e=p.boundingBox,c=e.min,f=e.max;h=new s.Vec3(c.x,c.y,c.z);l=new s.Vec3(f.x,f.y,f.z);o=new s.Vec3;l.vsub(h,o);o.mult(.5,o);return new s.Box(o);default:return fail()}}();t=new s.RigidBody(u,d,this.material(a));t.position.set(r.x,r.y,r.z);t.velocity.set(m.x,m.y,m.z);t.gameObject=i;t.threeObject=v;this.world.add(t);return t};t.prototype.removeBody=function(e){return this.world.remove(e)};return t}(r)},{"./GameObject":5,"./check":16,cannon:37}],10:[function(e,t,n){var r,i,s,o,u,a;o=e("q");a=e("three");i=e("./check").fail;u=e("./meta").read;s=function(e,t,n){var r;if(e[t]!=null){return e[t]}else{r="["+Object.keys(e).join(", ")+"]";return i("No "+n+" is named "+t+". Did you mean one of "+r+"?")}};t.exports=r=function(){function e(e){var t,n,r,i;this._textures={};this._geometries={};t=new a.JSONLoader;r=new a.TextureLoader;n=e.models.map(function(e){return function(n){var r;r=o.defer();t.load("/assets/projects/painterly-rendering/model/"+n+".js",function(t,i){e._geometries[n]=t;return r.resolve()});return r.promise}}(this));i=e.textures.map(function(e){return function(t){var n;n=o.defer();e._textures[t]=a.ImageUtils.loadTexture("/assets/projects/painterly-rendering/texture/"+t+".png",null,function(){return n.resolve()});return n.promise}}(this));this._promise=o.all(n.concat(i))}u(e,"promise");e.prototype.geometry=function(e){return s(this._geometries,e,"geometry")};e.prototype.texture=function(e){return s(this._textures,e,"texture")};return e}()},{"./check":16,"./meta":27,q:44,three:45}],11:[function(e,t,n){var r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t){if(o.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("jquery");i=e("./GameObject");t.exports=s=function(e){function t(e){this._buttonSelector=e}u(t,e);t.prototype.start=function(){return r("document").ready(function(e){return function(){return r(e._buttonSelector).bind("click",function(){var t;t=e.graphics().imageDataURL();return window.open(t,"toDataURL() image","width="+e.graphics().width()+", height="+e.graphics().height())})}}(this))};return t}(i)},{"./GameObject":5,jquery:43}],12:[function(e,t,n){var r,i,s,o,u,a={}.hasOwnProperty,f=function(e,t){function r(){this.constructor=e}for(var n in t){if(a.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("./GameObject");o=e("./StrokeMeshLayer");s=e("./StrokeMesh");u=e("./meta").read;t.exports=i=function(e){function t(e,t){this.center=e;this._mesh=s.of(t)}f(t,e);t.prototype.start=function(){t.__super__.start.call(this);this._mesh.setPosition(this.center);return this._mesh.addToGraphics(this.graphics())};t.prototype.finish=function(){t.__super__.finish.call(this);return this._mesh.removeFromGraphics(this.graphics())};u(t,"mesh");return t}(r)},{"./GameObject":5,"./StrokeMesh":13,"./StrokeMeshLayer":14,"./meta":27}],13:[function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v={}.hasOwnProperty,m=function(e,t){function r(){this.constructor=e}for(var n in t){if(v.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("jquery");h=e("three");d=e("./check"),a=d.check,p=d.type;s=e("./GameObject");l=e("./meta").read;u=e("./StrokeMeshLayer");i=e("./DepthBufferMesh");f=e("./fattenGeometry");c=function(e,t){var n;n=e.indexOf(t);return e.splice(n,1)};t.exports=o=function(e){function t(e,t,n){var r;this._strokeLayers=n;this._depthMesh=new i(f(e,.1));r=f(e,t);this._originalMesh=new h.Mesh(r,new h.MeshBasicMaterial({color:0,side:h.BackSide}));this._threeObject=new h.Object3D}m(t,e);t.of=function(e){var n,i,s,o,a;p(e.geometry,h.Geometry);o=new h.Mesh(e.geometry,new h.MeshBasicMaterial);s=function(){var t,n,s,o;s=e.layers;o=[];for(t=0,n=s.length;t<n;t++){i=s[t];o.push(u.of(r.extend(e,i)))}return o}();n=(a=e.borderSize)!=null?a:0;return new t(e.geometry,n,s)};l(t,"threeObject");t.prototype.addToGraphics=function(e){var t,n,r,i;e.strokeMeshes().push(this);this._strokeMeshLayersParent=new h.Object3D;i=this._strokeLayers;for(n=0,r=i.length;n<r;n++){t=i[n];t.setupUsingGraphics(e);t.addToParent(this._strokeMeshLayersParent)}if(this.originalPosition!=null){this._threeObject.position.copy(this.originalPosition)}this._threeObject.add(this._originalMesh);this._threeObject.add(this._depthMesh.mesh);this._threeObject.add(this._strokeMeshLayersParent);return e.scene().add(this._threeObject)};t.prototype.removeFromGraphics=function(e){c(e.strokeMeshes(),this);return e.scene().remove(this._threeObject)};t.prototype.setOriginalMeshVisibility=function(e){this._originalMesh.visible=e;return this._originalMesh.traverse(function(t){return t.visible=e})};t.prototype.setDepthMeshVisibility=function(e){return this._depthMesh.mesh.visible=e};t.prototype.setStrokeMeshVisibility=function(e){this._strokeMeshLayersParent.visible=e;return this._strokeMeshLayersParent.traverse(function(t){return t.visible=e})};t.prototype.getOriginalMesh=function(){return this._originalMesh};t.prototype.setPosition=function(e){return this._threeObject.position.copy(e)};return t}(s)},{"./DepthBufferMesh":2,"./GameObject":5,"./StrokeMeshLayer":14,"./check":16,"./fattenGeometry":17,"./meta":27,jquery:43,three:45}],14:[function(e,t,n){(function(n){var r,i,s,o,u,a,f,l,c,h,p;o=e("fs");r=e("jquery");c=e("three");p=e("./check"),s=p.check,h=p.type;a=e("./meshVerticesNormalsUVs");l=e("./meta").read;u=function(e,t,n){if(e[t]!=null){return e[t]}else if(n!=null){return n()}else{throw new Error("Must specify "+t)}};f=function(e,t){var n,r,i,s,o,a,f,l;r=u(t,"hue");o=u(t,"sat");i=u(t,"lum");n=function(e){var t,n;if(Object(e)instanceof Number){return e}else{n=e[0],t=e[1];h(n,Number,t,Number);return Math.random()*(t-n)+n}};s=function(){return(new c.Color).setHSL(n(r),n(o),n(i))};l=[];for(a=f=0;0<=e?f<e:f>e;a=0<=e?++f:--f){l.push(s())}return l};t.exports=i=function(){function e(e){var t,i,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E,S,x,T;h=e.nStrokes,w=e.strokeSize,T=e.vertices,p=e.normals,x=e.uvs,f=e.hasUVs,i=e.colors,E=e.strokeTexture,d=e.objectTexture,a=e.enableRotation,o=e.curveFactor,u=e.depthEpsilon,g=e.specularMin,v=e.specularFadeIn,m=e.specularIntensity,y=e.specularPower;s(T.length===h,"must have nStrokes vertices");s(p.length===h,"must have nStrokes normals");s(i.length===h,"must have nStrokes colors");this._strokeSize=w;S={strokeTexture:{type:"t",value:E},objectTexture:{type:"t",value:d},useObjectTexture:{type:"i",value:f&&d!=null},strokeSize:{type:"f",value:0},enableRotation:{type:"i",value:a},curveFactor:{type:"f",value:o},depthEpsilon:{type:"f",value:.6},depthTexture:{type:"t",value:null},specularIntensity:{type:"f",value:m},specularPower:{type:"f",value:y},specularMin:{type:"f",value:g},specularFadeIn:{type:"f",value:v}};r.extend(S,c.UniformsLib.lights);t={strokeVertexNormal:{type:"v3",value:p},strokeUV:{type:"v2",value:x}};l=new c.ShaderMaterial({uniforms:S,attributes:t,vertexShader:n("YXR0cmlidXRlIHZlYzMgc3Ryb2tlVmVydGV4Tm9ybWFsOw0KYXR0cmlidXRlIHZlYzIgc3Ryb2tlVVY7DQoNCnVuaWZvcm0gc2FtcGxlcjJEIGRlcHRoVGV4dHVyZTsNCnVuaWZvcm0gc2FtcGxlcjJEIG9iamVjdFRleHR1cmU7DQoNCnVuaWZvcm0gZmxvYXQgc3Ryb2tlU2l6ZTsNCnVuaWZvcm0gZmxvYXQgc3BlY3VsYXJNaW47DQp1bmlmb3JtIGZsb2F0IHNwZWN1bGFyRmFkZUluOw0KdW5pZm9ybSBmbG9hdCBzcGVjdWxhckludGVuc2l0eTsNCnVuaWZvcm0gZmxvYXQgc3BlY3VsYXJQb3dlcjsNCnVuaWZvcm0gaW50IGVuYWJsZVJvdGF0aW9uOw0KdW5pZm9ybSBpbnQgdXNlT2JqZWN0VGV4dHVyZTsNCi8vIHVuaWZvcm0gZmxvYXQgbGlnaHRHcmFkaWVudEZhY3RvcjsNCnVuaWZvcm0gZmxvYXQgY3VydmVGYWN0b3I7DQp1bmlmb3JtIGZsb2F0IGRlcHRoRXBzaWxvbjsNCg0KdW5pZm9ybSB2ZWMzIGFtYmllbnRMaWdodENvbG9yOw0KI2lmIE1BWF9ESVJfTElHSFRTID4gMA0KdW5pZm9ybSB2ZWMzIGRpcmVjdGlvbmFsTGlnaHREaXJlY3Rpb25bTUFYX0RJUl9MSUdIVFNdOw0KdW5pZm9ybSB2ZWMzIGRpcmVjdGlvbmFsTGlnaHRDb2xvcltNQVhfRElSX0xJR0hUU107DQojZW5kaWYNCg0KLyoNClRocmVlLmpzIGFsc28gZ2l2ZXMgdXMgdGhlc2U6DQpwb3NpdGlvbg0KY29sb3INCm1vZGVsVmlld01hdHJpeA0KcHJvamVjdGlvbk1hdHJpeA0KKi8NCg0KdmFyeWluZyB2ZWM0IHN0cm9rZVNoYWRlZENvbG9yOw0KdmFyeWluZyB2ZWMyIHN0cm9rZU9yaWVudGF0aW9uOw0KdmFyeWluZyBmbG9hdCBjdXJ2ZUFtb3VudDsNCg0KDQp2ZWMzIGdldENvbG9yKCkNCnsNCglyZXR1cm4gKHVzZU9iamVjdFRleHR1cmUgPT0gMSkgPyB0ZXh0dXJlMkQob2JqZWN0VGV4dHVyZSwgc3Ryb2tlVVYpLnJnYiA6IGNvbG9yOw0KfQ0KDQovKg0KSG93IG11Y2ggd2Ugd2VpZ2h0IGEgY29sb3IncyBpbXBvcnRhbmNlLg0KVGhpcyBkb2Vzbid0IG5lY2Vzc2FyaWx5IGhhdmUgdG8gZXF1YWxseSB2YWx1ZSByLCBnLCBhbmQgYi4NCiovDQpmbG9hdCBjb2xvckFtb3VudCh2ZWMzIGNvbG9yKQ0Kew0KCXJldHVybiBjb2xvci5yICsgY29sb3IuZyArIGNvbG9yLmI7DQp9DQoNCi8qDQpIb3cgbXVjaCBsaWdodCBhbSBJIHJlY2lldmluZyBpZiBJIGZhY2UgaW4gdGhlIGRpcmVjdGlvbiBgbU5vcm1hbGA/DQoqLw0Kdm9pZCBjYWxjTGlnaHQodmVjMyBtUG9zaXRpb24sIHZlYzMgbU5vcm1hbCwgb3V0IHZlYzMgZGlmZnVzZVRvdGFsLCBvdXQgdmVjMyBzcGVjdWxhclRvdGFsKQ0Kew0KCXZlYzMgZGlyVG9DYW1lcmEgPQ0KCQlub3JtYWxpemUoY2FtZXJhUG9zaXRpb24gLSBtUG9zaXRpb24pOw0KCWRpZmZ1c2VUb3RhbCA9DQoJCWFtYmllbnRMaWdodENvbG9yOw0KCXNwZWN1bGFyVG90YWwgPQ0KCQl2ZWMzKDAsIDAsIDApOw0KDQoJI2lmIE1BWF9ESVJfTElHSFRTID4gMA0KCWZvcihpbnQgaSA9IDA7IGkgPCBNQVhfRElSX0xJR0hUUzsgaSsrKQ0KCXsNCgkJdmVjMyBsaWdodENvbG9yID0NCgkJCWRpcmVjdGlvbmFsTGlnaHRDb2xvcltpXTsNCgkJdmVjMyBkaXJUb0xpZ2h0ID0NCgkJCS1kaXJlY3Rpb25hbExpZ2h0RGlyZWN0aW9uW2ldOw0KCQl2ZWMzIHBob25nRGlmZnVzZSA9DQoJCQlsaWdodENvbG9yICogbWF4KDAuMCwgZG90KGRpclRvTGlnaHQsIG1Ob3JtYWwpKTsNCg0KCQlkaWZmdXNlVG90YWwgKz0gcGhvbmdEaWZmdXNlOw0KDQoJCXZlYzMgcmVmbGVjdGVkRGlyID0NCgkJCW5vcm1hbGl6ZShyZWZsZWN0KC1kaXJUb0xpZ2h0LCBtTm9ybWFsKSk7DQoJCWZsb2F0IHBob25nU3BlY3VsYXIgPQ0KCQkJcG93KG1heCgwLjAsIGRvdChyZWZsZWN0ZWREaXIsIGRpclRvQ2FtZXJhKSksIHNwZWN1bGFyUG93ZXIpOw0KDQoJCXNwZWN1bGFyVG90YWwgKz0NCgkJCWxpZ2h0Q29sb3IgKiBwaG9uZ1NwZWN1bGFyOw0KCX0NCgkjZW5kaWYNCg0KCXNwZWN1bGFyVG90YWwgKj0gc3BlY3VsYXJJbnRlbnNpdHk7DQp9DQoNCi8qDQpUaGlzIGNvdWxkIGJlIGZhc3RlciBpZiB3ZSBvbmx5IGNhbGN1bGF0ZWQgaW50ZW5zaXRpZXMgdGhlIHdob2xlIHdheSB0aHJvdWdoLi4uDQoqLw0KZmxvYXQgY2FsY0xpZ2h0QW1vdW50KHZlYzMgbVBvc2l0aW9uLCB2ZWMzIG1Ob3JtYWwpDQp7DQoJdmVjMyBkaWZmdXNlVG90YWwsIHNwZWN1bGFyVG90YWw7DQoJY2FsY0xpZ2h0KG1Qb3NpdGlvbiwgbU5vcm1hbCwgZGlmZnVzZVRvdGFsLCBzcGVjdWxhclRvdGFsKTsNCg0KCXJldHVybiBjb2xvckFtb3VudChkaWZmdXNlVG90YWwgKyBzcGVjdWxhclRvdGFsKTsvL2NvbG9yQW1vdW50KGNvbG9yICogKGRpZmZ1c2VUb3RhbCArIHNwZWN1bGFyVG90YWwpKTsNCn0NCg0KZmxvYXQgbGVuZ3RoMih2ZWMyIHYpDQp7DQoJcmV0dXJuIGRvdCh2LCB2KTsNCn0NCg0KZmxvYXQgbGVuZ3RoMih2ZWMzIHYpDQp7DQoJcmV0dXJuIGRvdCh2LCB2KTsNCn0NCg0KZmxvYXQgc3F1YXJlKGZsb2F0IGEpDQp7DQoJcmV0dXJuIGEgKiBhOw0KfQ0KDQoNCmZsb2F0IGdldExpZ2h0RGlmZmVyZW50aWFsKA0KCXZlYzMgb2xkTVBvcywNCgl2ZWMzIHJheURpckFkanVzdCwNCglmbG9hdCBsaWdodEFtb3VudCwNCgl2ZWMzIG9sZE1Ob3JtYWwpDQp7DQoJLyoNCglBcHByb3hpbWF0ZSB0aGlzIGFyZWEgYXMgYSBzcGhlcmUuDQoJRGlzY292ZXIgdGhlIHJheSB0aGUgY2FtZXJhIGZpcmVkIHRvIGdldCBoZXJlLg0KCUFsdGVyIGl0IGJ5IGBkaXJBZGp1c3RgLg0KCUNhbGN1bGF0ZSB0aGUgbmV3IHNwaGVyZSBjb2xsaXNpb24gdGhlcmUuDQoJVGhlbiBuZXcgbm9ybWFsIGFuZCBwb3NpdGlvbiBjYW4gYmUgY2FsY3VsYXRlZC4NCglUaGVuIGNhbGN1bGF0ZSB0aGUgbmV3IGxpZ2h0IGF0IHRoYXQgbm9ybWFsIGFuZCBwb3NpdGlvbiwNCglhbmQgcmV0dXJuIHRoZSBkaWZmZXJlbmNlLg0KCSovDQoNCglmbG9hdCBjdXJ2YXR1cmVSYWRpdXMgPQ0KCQkvLyBUT0RPOiBBdHRyaWJ1dGUNCgkJMi4wOw0KCXZlYzMgbUN1cnZlQ2VudGVyID0NCgkJb2xkTVBvcyAtIG9sZE1Ob3JtYWwgKiBjdXJ2YXR1cmVSYWRpdXM7DQoNCgl2ZWMzIG9sZFJheURpciA9DQoJCW5vcm1hbGl6ZShvbGRNUG9zIC0gY2FtZXJhUG9zaXRpb24pOw0KDQoJdmVjMyBuZXdSYXlEaXIgPQ0KCQlvbGRSYXlEaXIgKyByYXlEaXJBZGp1c3Q7DQoNCgkvKg0KCVNvbHZlIHRoZSByYXkgZXF1YXRpb24uDQoJYSAqIHReMiArIGIgKiB0ICsgYyA9IDANCgkqLw0KCWZsb2F0IGEgPQ0KCQlsZW5ndGgyKG5ld1JheURpcik7DQoJZmxvYXQgYiA9DQoJCTIuMCAqIGRvdChuZXdSYXlEaXIsIGNhbWVyYVBvc2l0aW9uIC0gbUN1cnZlQ2VudGVyKTsNCglmbG9hdCBjID0NCgkJbGVuZ3RoMihjYW1lcmFQb3NpdGlvbiAtIG1DdXJ2ZUNlbnRlcikgLSBzcXVhcmUoY3VydmF0dXJlUmFkaXVzKTsNCglmbG9hdCBkZXQgPQ0KCQlzcXVhcmUoYikgLSA0LjAgKiBhICogYzsNCgkvLyBXaGVuIGN1cnZhdHVyZSBpcyBoaWdoIGVub3VnaCwgd2Ugd2lsbCBzdXJlbHkgaGl0IHRoZSBzcGhlcmUNCgkvLyBhbmQgY2FuIGlnbm9yZSB0aGUgY2FzZSB3aGVyZSBkZXQgd291bGQgYmUgbmVnYXRpdmUuDQoJZmxvYXQgc3FydERldCA9DQoJCXNxcnQoZGV0KTsNCglmbG9hdCBhMiA9DQoJCTIuMCAqIGE7DQoJZmxvYXQgdCA9DQoJCS8vIFdlIHdhbnQgdGhlIGZpcnN0IGB0YCwgc28gc3VidHJhY3Qgc3FydERldC4NCgkJKC1iIC0gc3FydERldCkgLyBhMjsNCg0KCXZlYzMgbmV3UG9zID0NCgkJY2FtZXJhUG9zaXRpb24gKyBuZXdSYXlEaXIgKiB0Ow0KCXZlYzMgbmV3Tm9ybSA9DQoJCW5vcm1hbGl6ZShuZXdQb3MgLSBtQ3VydmVDZW50ZXIpOw0KDQoJcmV0dXJuIGNhbGNMaWdodEFtb3VudChuZXdQb3MsIG5ld05vcm0pIC0gbGlnaHRBbW91bnQ7DQp9DQoNCmZsb2F0IFBpID0NCgkzLjE0MTU5MjY1MzU4OTc5MzIzODQ2MjY0MzM4MzI3OTUwMjg4NDE5NzE2OTM5OTM3NTEwNTgyMDk3NDk0NDsNCg0KZmxvYXQgY29zRWFzZShmbG9hdCB4KQ0Kew0KCXJldHVybiAtMC41ICogY29zKFBpICogeCkgKyAwLjU7DQp9DQoNCmZsb2F0IHNoaWZ0VG9SaWdodChmbG9hdCB4KQ0Kew0KCXJldHVybiBtYXgoMC4wLCB4ICogMi4wIC0gMS4wKTsNCn0NCg0KLyoNCk1ha2VzIHggc3RpY2sgY2xvc2VyIHRvIDEuDQoqLw0KZmxvYXQgcXVhZHJhdGljRWFzZShmbG9hdCB4KQ0Kew0KCXJldHVybiAxLjAgLSBzcXVhcmUoMS4wIC0geCk7DQp9DQoNCmZsb2F0IHF1YXJ0aWNFYXNlKGZsb2F0IHgpDQp7DQoJcmV0dXJuIDEuMCAtIHNxdWFyZShzcXVhcmUoeCAtIDEuMCkpOw0KfQ0KDQovKg0KUmV0dXJuZWQgdmFsdWUgaGFzIGxlbmd0aCBpbiByYW5nZSBbMC4uMV0uDQoqLw0KdmVjMiBnZXRHcmFkaWVudCgNCgl2ZWMzIG1Qb3NpdGlvbiwNCgl2ZWMzIG12UG9zaXRpb24sDQoJdmVjMyBtTm9ybWFsLA0KCXZlYzMgbXZOb3JtYWwsDQoJZmxvYXQgbGlnaHRBbW91bnQpDQp7DQoJZmxvYXQgbGlnaHRHcmFkaWVudEZhY3RvciA9DQoJCTIuMDsNCg0KCS8vIENhbWVyYSAnZ3JhZGllbnQnDQoJdmVjNCBwcm9qZWN0ZWROb3JtYWwgPQ0KCQlub3JtYWxpemUocHJvamVjdGlvbk1hdHJpeCAqIHZlYzQobXZOb3JtYWwsIDApKTsNCg0KCXZlYzIgY2FtZXJhR3JhZGllbnQgPQ0KCQktcHJvamVjdGVkTm9ybWFsLnh5Ow0KDQoNCgl2ZWMzIGNhbWVyYVJpZ2h0ID0NCgkJbm9ybWFsaXplKHZlYzModmlld01hdHJpeFswXS54LCB2aWV3TWF0cml4WzFdLngsIHZpZXdNYXRyaXhbMl0ueCkpOw0KCXZlYzMgY2FtZXJhVXAgPQ0KCQlub3JtYWxpemUodmVjMyh2aWV3TWF0cml4WzBdLnksIHZpZXdNYXRyaXhbMV0ueSwgdmlld01hdHJpeFsyXS55KSk7DQoNCgkvLyBMaWdodCBncmFkaWVudA0KCWZsb2F0IGVwc2lsb24gPQ0KCQkwLjAxOw0KCWZsb2F0IGRsZHggPQ0KCQlnZXRMaWdodERpZmZlcmVudGlhbChtUG9zaXRpb24sIGNhbWVyYVJpZ2h0ICogZXBzaWxvbiwgbGlnaHRBbW91bnQsIG1Ob3JtYWwpOw0KCWZsb2F0IGRsZHkgPQ0KCQlnZXRMaWdodERpZmZlcmVudGlhbChtUG9zaXRpb24sIGNhbWVyYVVwICogZXBzaWxvbiwgbGlnaHRBbW91bnQsIG1Ob3JtYWwpOw0KCXZlYzIgbGlnaHRHcmFkaWVudCA9DQoJCXZlYzIoZGxkeCwgZGxkeSk7DQoNCglmbG9hdCBjYW1lcmFQYXJ0ID0NCgkJbGVuZ3RoKGNhbWVyYUdyYWRpZW50KTsNCglmbG9hdCBsaWdodFBhcnQgPQ0KCQltaW4obGlnaHRHcmFkaWVudEZhY3RvciAqIGxlbmd0aChsaWdodEdyYWRpZW50KSwgc3F1YXJlKDEuMCAtIGNhbWVyYVBhcnQpKTsNCg0KCWNhbWVyYUdyYWRpZW50ID0NCgkJbm9ybWFsaXplKGNhbWVyYUdyYWRpZW50KTsNCglsaWdodEdyYWRpZW50ID0NCgkJbm9ybWFsaXplKGxpZ2h0R3JhZGllbnQpOw0KDQoJLyoNCgkvLyBWaXN1YWxpemUgdGhlIHJlbGF0aXZlIGdyYWRpZW50IGNvbnRyaWJ1dGlvbnMuDQoJc3Ryb2tlU2hhZGVkQ29sb3IgPQ0KCQl2ZWM0KDEsIDAsIDAsIDEpICogbGlnaHRQYXJ0ICsgdmVjNCgwLCAxLCAwLCAxKSAqIGNhbWVyYVBhcnQ7DQoJKi8NCg0KCXJldHVybiBjYW1lcmFQYXJ0ICogY2FtZXJhR3JhZGllbnQgKyBsaWdodFBhcnQgKiBsaWdodEdyYWRpZW50Ow0KfQ0KDQovKg0KRW5zdXJlcyB0aGF0IHRoaXMgdmVydGV4IGlzIG5vdCByZW5kZXJlZC4NCiovDQp2b2lkIGRpc2NhcmRWZXJ0ZXgoKQ0Kew0KCWdsX1BvaW50U2l6ZSA9DQoJCTAuMDsNCglnbF9Qb3NpdGlvbiA9DQoJCXZlYzQoLTEwMCwgLTEwMCwgLTEwMCwgMSk7DQp9DQoNCmZsb2F0IHNhbXBsZURlcHRoKHZlYzQgZ2xQb3NpdGlvbikNCnsNCgl2ZWMyIHNjcmVlblNwYWNlID0NCgkJLy8gQ29udmVydCB0byBub3JtYWxpemVkIChbMCwgMV1eMikgY29vcmRpbmF0ZXMuDQoJCSh2ZWMyKDEsIDEpICsgZ2xQb3NpdGlvbi54eSAvIGdsUG9zaXRpb24udykgLyAyLjA7DQoJcmV0dXJuDQoJCXRleHR1cmUyRChkZXB0aFRleHR1cmUsIHNjcmVlblNwYWNlKS56Ow0KfQ0KDQovKg0KMSB3aGVuIHogaXMgcGVyZmVjdC4NCjAgd2hlbiB6IGlzIGp1c3QgYmFyZWx5IGdvb2QgZW5vdWdoIChzdHJva2VaRGlmZmVyZW5jZSA9IHN0cm9rZVpFcHNpbG9uKS4NCk5lZ2F0aXZlIHdoZW4gd2Ugc2hvdWxkbid0IGFwcGVhciBhdCBhbGwuDQoqLw0KZmxvYXQgZ2V0WlF1YWxpdHkodmVjMyBtdlBvc2l0aW9uLCB2ZWM0IGdsUG9zaXRpb24pDQp7DQoJZmxvYXQgZGVwdGhUZXh0dXJlWiA9DQoJCXNhbXBsZURlcHRoKGdsUG9zaXRpb24pOw0KCWZsb2F0IHN0cm9rZVpEaWZmZXJlbmNlID0NCgkJYWJzKG12UG9zaXRpb24ueiAtIGRlcHRoVGV4dHVyZVopOw0KDQoJcmV0dXJuIDEuMCAtIChzdHJva2VaRGlmZmVyZW5jZSAvIGRlcHRoRXBzaWxvbik7DQp9DQoNCnZvaWQgbWFpbigpDQp7DQoJdmVjNCBtUG9zaXRpb24gPQ0KCQltb2RlbE1hdHJpeCAqIHZlYzQocG9zaXRpb24sIDEuMCk7DQoJdmVjNCBtdlBvc2l0aW9uID0NCgkJbW9kZWxWaWV3TWF0cml4ICogdmVjNChwb3NpdGlvbiwgMS4wKTsNCglnbF9Qb3NpdGlvbiA9DQoJCXByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uOw0KCWZsb2F0IHpRdWFsaXR5ID0NCgkJZ2V0WlF1YWxpdHkodmVjMyhtdlBvc2l0aW9uKSwgZ2xfUG9zaXRpb24pOw0KDQoJaWYgKHpRdWFsaXR5IDw9IDAuMCkNCgl7DQoJCWRpc2NhcmRWZXJ0ZXgoKTsNCgkJcmV0dXJuOw0KCX0NCg0KCXZlYzMgbU5vcm1hbCA9DQoJCS8vIFVzZSAwLjAgc28gdGhlcmUncyBubyB0cmFuc2xhdGlvbi4NCgkJbm9ybWFsaXplKHZlYzMobW9kZWxNYXRyaXggKiB2ZWM0KHN0cm9rZVZlcnRleE5vcm1hbCwgMC4wKSkpOw0KCXZlYzMgbXZOb3JtYWwgPQ0KCQlub3JtYWxpemUodmVjMyhtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KHN0cm9rZVZlcnRleE5vcm1hbCwgMC4wKSkpOw0KDQoJdmVjMyBkaWZmdXNlVG90YWwsIHNwZWN1bGFyVG90YWw7DQoJY2FsY0xpZ2h0KHZlYzMobVBvc2l0aW9uKSwgbU5vcm1hbCwgZGlmZnVzZVRvdGFsLCBzcGVjdWxhclRvdGFsKTsNCg0KCWZsb2F0IHNwZWN1bGFyVG90YWxBbW91bnQgPQ0KCQljb2xvckFtb3VudChzcGVjdWxhclRvdGFsKTsNCg0KCXZlYzMgbGl0Q29sb3IgPQ0KCQlnZXRDb2xvcigpICogKGRpZmZ1c2VUb3RhbCArIHNwZWN1bGFyVG90YWwpOw0KDQoJaWYgKHNwZWN1bGFyVG90YWxBbW91bnQgPCBzcGVjdWxhck1pbikNCgl7DQoJCWRpc2NhcmRWZXJ0ZXgoKTsNCgkJcmV0dXJuOw0KCX0NCg0KCWZsb2F0IHNwZWN1bGFyQW1vdW50VG9BbHBoYSA9DQoJCShzcGVjdWxhckZhZGVJbiA9PSAwLjApID8NCgkJCTEuMA0KCQk6DQoJCQltaW4oMS4wLCAoc3BlY3VsYXJUb3RhbEFtb3VudCAtIHNwZWN1bGFyTWluKSAvIHNwZWN1bGFyRmFkZUluKTsNCg0KCWZsb2F0IHpRdWFsaXR5QWxwaGEgPQ0KCQkvLyAnTWFyZ2luYWwnIHN0cm9rZXMganVzdCBjb21pbmcgYXJvdW5kIHRoZSBlZGdlIG9mIGFuIG9iamVjdCBhcmUgcGFydGx5IHRyYW5zcGFyZW50Lg0KCQltaW4oelF1YWxpdHksIDEuMCk7DQoNCglmbG9hdCBhbHBoYSA9DQoJCXNwZWN1bGFyQW1vdW50VG9BbHBoYSAqIHpRdWFsaXR5QWxwaGE7DQoNCgkvKg0KCWlmICh1c2VPYmplY3RUZXh0dXJlID09IDEpIHsNCgkJc3Ryb2tlU2hhZGVkQ29sb3IgPQ0KCQkJdmVjNChsaXRDb2xvciwgYWxwaGEpICsgdGV4dHVyZTJEKG9iamVjdFRleHR1cmUsIHN0cm9rZVVWKTsNCgl9IGVsc2Ugew0KCQlzdHJva2VTaGFkZWRDb2xvciA9DQoJCQl2ZWM0KGxpdENvbG9yLCBhbHBoYSk7DQoJfQ0KCSovDQoJc3Ryb2tlU2hhZGVkQ29sb3IgPQ0KCQl2ZWM0KGxpdENvbG9yLCBhbHBoYSk7DQoNCglmbG9hdCBzaHJpbmtJbkRpc3RhbmNlID0NCgkJMS4wIC8gZ2xfUG9zaXRpb24uejsNCglnbF9Qb2ludFNpemUgPQ0KCQlzaHJpbmtJbkRpc3RhbmNlICogc3Ryb2tlU2l6ZTsNCg0KCXZlYzIgZ3JhZGllbnQgPQ0KCQlnZXRHcmFkaWVudCgNCgkJCXZlYzMobVBvc2l0aW9uKSwgdmVjMyhtdlBvc2l0aW9uKSwNCgkJCW1Ob3JtYWwsIG12Tm9ybWFsLA0KCQkJY29sb3JBbW91bnQoZGlmZnVzZVRvdGFsICsgc3BlY3VsYXJUb3RhbCkpOw0KDQoJc3Ryb2tlT3JpZW50YXRpb24gPQ0KCQkoZW5hYmxlUm90YXRpb24gPT0gMSkgPw0KCQkJbm9ybWFsaXplKHZlYzIoLWdyYWRpZW50LnksIGdyYWRpZW50LngpKQ0KCQk6DQoJCQl2ZWMyKDEuMCwgMC4wKTsNCg0KCWlmIChsZW5ndGgoc3Ryb2tlT3JpZW50YXRpb24pIDwgMC45OSkNCgl7DQoJCXN0cm9rZVNoYWRlZENvbG9yID0gdmVjNCgxLCAwLCAwLCAxKTsNCgkJc3Ryb2tlT3JpZW50YXRpb24gPSB2ZWMyKDEsIDApOw0KCX0NCg0KCWN1cnZlQW1vdW50ID0NCgkJbGVuZ3RoKGdyYWRpZW50KSAqIGN1cnZlRmFjdG9yOw0KfQ0K","base64"),fragmentShader:n("I2V4dGVuc2lvbiBPRVNfdGV4dHVyZV9mbG9hdCA6IGVuYWJsZQ0KDQp1bmlmb3JtIHNhbXBsZXIyRCBzdHJva2VUZXh0dXJlOw0KDQp1bmlmb3JtIHNhbXBsZXIyRCBkZXB0aFRleHR1cmU7DQoNCnZhcnlpbmcgdmVjNCBzdHJva2VTaGFkZWRDb2xvcjsNCnZhcnlpbmcgdmVjMiBzdHJva2VPcmllbnRhdGlvbjsNCnZhcnlpbmcgZmxvYXQgY3VydmVBbW91bnQ7DQoNCnZlYzIgcm90YXRlMkQodmVjMiBwb2ludCwgdmVjMiBvcmlnaW4sIHZlYzIgb3JpZW50YXRpb24pDQp7DQoJdmVjMiByZWwgPQ0KCQlwb2ludCAtIG9yaWdpbjsNCglmbG9hdCBrb3MgPQ0KCQlvcmllbnRhdGlvbi54Ow0KCWZsb2F0IHppbiA9DQoJCW9yaWVudGF0aW9uLnk7DQoJdmVjMiByb3RhdGVkID0NCgkJdmVjMihrb3MgKiByZWwueCAtIHppbiAqIHJlbC55LCB6aW4gKiByZWwueCArIGtvcyAqIHJlbC55KTsNCg0KCXJldHVybiByb3RhdGVkICsgb3JpZ2luOw0KfQ0KDQpmbG9hdCBzcXVhcmUoZmxvYXQgYSkNCnsNCglyZXR1cm4gYSAqIGE7DQp9DQoNCnZlYzQgY2xpcHBlZFNhbXBsZShzYW1wbGVyMkQgdGV4dHVyZSwgdmVjMiBzYW1wbGVBdCkNCnsNCglpZiAoc2FtcGxlQXQueCA8PSAwLjAgfHwgc2FtcGxlQXQueCA+PSAxLjAgfHwgc2FtcGxlQXQueSA8PSAwLjAgfHwgc2FtcGxlQXQueSA+PSAxLjApDQoJCXJldHVybiB2ZWM0KDAsIDAsIDAsIDApOw0KCWVsc2UNCgkJcmV0dXJuIHRleHR1cmUyRCh0ZXh0dXJlLCBzYW1wbGVBdCk7DQp9DQoNCi8qDQpMZWF2ZXMgbWlkZGxlIGFsb25lLiBEcm9wcyBlbmRzIGJ5IGBjdXJ2ZUFtb3VudGAgbGlrZSBhIHBhcmFib2xhLg0KKi8NCnZlYzIgZGlzdG9ydCh2ZWMyIHRleHR1cmVDb29yZGluYXRlKQ0Kew0KCWZsb2F0IHggPQ0KCQl0ZXh0dXJlQ29vcmRpbmF0ZS54Ow0KDQoJZmxvYXQgeSA9DQoJCS8vIEZvciBzb21lIHJlYXNvbiwgdGhpcyBsZWFkcyB0byBzYW1wbGluZyBhcnRpZmFjdHMuDQoJCS8vIGN1cnZlQW1vdW50ICogc3F1YXJlKHggLSAwLjUpOw0KCQljdXJ2ZUFtb3VudCAqIChzcXVhcmUoeCkgLSB4ICsgMC4yNSk7DQoNCglyZXR1cm4gdmVjMih4LCB0ZXh0dXJlQ29vcmRpbmF0ZS55IC0geSk7DQp9DQoNCg0Kdm9pZCBtYWluKCkNCnsNCglnbF9GcmFnQ29sb3IgPSBzdHJva2VTaGFkZWRDb2xvcjsNCg0KCXZlYzIgcm90YXRlZCA9DQoJCXJvdGF0ZTJEKGdsX1BvaW50Q29vcmQsIHZlYzIoMC41LCAwLjUpLCBzdHJva2VPcmllbnRhdGlvbik7DQoJdmVjMiBkaXN0b3J0ZWQgPQ0KCQlkaXN0b3J0KHJvdGF0ZWQpOw0KCXZlYzQgdGV4dHVyZUNvbG9yID0NCgkJY2xpcHBlZFNhbXBsZShzdHJva2VUZXh0dXJlLCBkaXN0b3J0ZWQpOw0KCWZsb2F0IHRleHR1cmVBbHBoYSA9DQoJCXRleHR1cmVDb2xvci5yOyAvLyA9IGcgPSBiDQoJZ2xfRnJhZ0NvbG9yLmEgKj0gdGV4dHVyZUFscGhhOw0KfQ0K","base64"),transparent:true,depthWrite:false,vertexColors:true,lights:true});b=new c.Geometry;b.vertices=T;b.computeBoundingBox();b.computeBoundingSphere();this._strokeSystem=new c.ParticleSystem(b,l);this.setColors(i)}e.of=function(t){var n,r,i,s,o,l,h,p,d,v,m;r=u(t,"geometry");i={};i.nStrokes=u(t,"nStrokes");i.strokeSize=u(t,"strokeSize");i.strokeTexture=u(t,"strokeTexture");i.enableRotation=(s=t.enableRotation)!=null?s:1;i.curveFactor=(o=t.curveFactor)!=null?o:1;i.depthEpsilon=(l=t.depthEpsilon)!=null?l:1;i.objectTexture=u(t,"objectTexture",function(){return null});n=u(t,"colors");i.colors=function(){switch(n.type){case"rainbow":return f(t.nStrokes,{hue:[0,1],sat:1,lum:.5});case"randomHSL":return f(t.nStrokes,n);default:return fail()}}();h=a(new c.Mesh(r),i.nStrokes),i.vertices=h[0],i.normals=h[1],i.uvs=h[2],i.hasUVs=h[3];i.specularIntensity=(p=t.specularIntensity)!=null?p:4;i.specularPower=(d=t.specularPower)!=null?d:4;i.specularMin=(v=t.specularMin)!=null?v:0;i.specularFadeIn=(m=t.specularFadeIn)!=null?m:0;return new e(i)};l(e,"strokeSystem");e.prototype.nStrokes=function(){return this._strokeSystem.geometry.vertices.length};e.prototype.setupUsingGraphics=function(e){return e.divPromise().then(function(t){return function(){t.setUniform("depthTexture",e.depthTexture());return t.setUniform("strokeSize",t._strokeSize*e.size())}}(this)).done()};e.prototype.addToParent=function(e){return e.add(this._strokeSystem)};e.prototype.setUniform=function(e,t){return this._strokeSystem.material.uniforms[e].value=t};e.prototype.setColors=function(e){this._strokeSystem.geometry.colors=e;return this._strokeSystem.geometry.colorsNeedUpdate=true};return e}()}).call(this,e("buffer").Buffer)},{"./check":16,"./meshVerticesNormalsUVs":26,"./meta":27,buffer:39,fs:38,jquery:43,three:45}],15:[function(e,t,n){var r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t){if(o.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};s=e("three");r=e("./GameObject");t.exports=i=function(e){function t(e,t){var n;this.center=e;n=new s.MeshBasicMaterial({map:t.texture});this._mesh=new s.Mesh(t.geometry,n)}u(t,e);t.prototype.start=function(){t.__super__.start.call(this);return this.graphics().scene().add(this._mesh)};t.prototype.finish=function(){t.__super__.finish.call(this);return this._mesh.removeFromGraphics(this.graphics())};return t}(r)},{"./GameObject":5,three:45}],16:[function(e,t,n){var r,i=[].slice;r=function(e,r){var i,s,o,u,a;i=0;a=[];while(i<e.length){u=e.slice(i,+(i+1)+1||9e9),o=u[0],s=u[1];i+=2;if(o==null){if(r){n.fail("Does not exist of type "+s.name)}else{continue}}if(!(Object(o)instanceof s)){a.push(t.exports.fail("Expected "+o+" (a "+o.constructor.name+") "+("to be a "+s.name)))}else{a.push(void 0)}}return a};this.abstract=function(){return n.fail("Not implemented")};this.check=function(e,t){if(!e){if(t instanceof Function){t=t()}return n.fail(t!=null?t:"Check failed")}};this.fail=function(e){if(!(e instanceof Error)){e=new Error(e!=null?e:"Fail")}console.trace();throw e};this.type=function(){var e;e=1<=arguments.length?i.call(arguments,0):[];return r(e,true)};this.typeEach=function(e,t){n.type(e,Array);return e.forEach(function(e){return n.type(e,t)})};this.typeExist=function(){return r(arguments,false)}},{}],17:[function(e,t,n){var r,i,s;i=e("three");s=e("./check").type;t.exports=r=function(e,t){var n,r,o,u,a,f,l,c,h,p,d;s(e,i.Geometry,t,Number);r=e.clone();r.computeVertexNormals();a=[];h=r.faces;for(f=0,c=h.length;f<c;f++){n=h[f];p=n.vertexNormals,a[n.a]=p[0],a[n.b]=p[1],a[n.c]=p[2]}for(u=l=0,d=r.vertices.length;0<=d?l<d:l>d;u=0<=d?++l:--l){if(a[u]!=null){o=new i.Vector3;o.copy(a[u]);o.multiplyScalar(t);r.vertices[u].add(o)}}return r}},{"./check":16,three:45}],18:[function(e,t,n){var r,i,s,o,u,a,f,l,c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t){if(c.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};a=e("cannon");l=e("three");i=e("../CameraController");f=e("../check").check;s=e("../FramerateTracker");o=e("../Game");u=e("../PhysicalObject");t.exports=r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}h(t,e);t.prototype.allResources=function(){return{models:[],textures:["stroke1"]}};t.prototype.initialObjects=function(){var e,n,r,o,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L;f=new i({distance:25});h=new s("#frameRateNumber");this.boxSize=50;r=4;C=[];p=new u({center:new l.Vector3(0,-this.boxSize/2,0),model:new l.PlaneGeometry(this.boxSize,this.boxSize),materialName:"wall",strokeMeshOptions:{strokeTexture:this.resources().texture("stroke1"),colors:{type:"randomHSL",hue:[.08,.12],sat:[.4,.8],lum:[.2,.4]},specularIntensity:.2,specularPower:4,layers:[{nStrokes:4e3,strokeSize:1.75},{nStrokes:3e4,strokeSize:.8}]},init:function(){return this.quaternion().setFromAxisAngle(new a.Vec3(1,0,0),-Math.PI/2)}});C.push(p);N=[{center:new l.Vector3(-this.boxSize/2,0,0),rotationAxis:new a.Vec3(0,1,0),rotationAngle:Math.PI/2},{center:new l.Vector3(this.boxSize/2,0,0),rotationAxis:new a.Vec3(0,1,0),rotationAngle:-Math.PI/2},{center:new l.Vector3(0,0,-this.boxSize/2),rotationAxis:new a.Vec3(0,1,0),rotationAngle:0},{center:new l.Vector3(0,0,this.boxSize/2),rotationAxis:new a.Vec3(0,1,0),rotationAngle:Math.PI},{center:new l.Vector3(0,this.boxSize/2,0),rotationAxis:new a.Vec3(1,0,0),rotationAngle:Math.PI/2}];N.forEach(function(e){return function(t){var n,r,i,s;n=t.center,i=t.rotationAxis,r=t.rotationAngle;s=new u({center:n,model:new l.PlaneGeometry(e.boxSize,e.boxSize),materialName:"wall",strokeMeshOptions:{strokeTexture:e.resources().texture("stroke1"),colors:{type:"randomHSL",hue:[.08,.12],sat:[.05,.25],lum:[.2,.4]},specularIntensity:.8,specularPower:4,layers:[{nStrokes:4e3,strokeSize:1.75},{nStrokes:3e4,strokeSize:.8}]},init:function(){return this.quaternion().setFromAxisAngle(i,r)}});return C.push(s)}}(this));d=10;w=.9;n=20;o=[];y=function(e){return function(){return(Math.random()-.5)*e.boxSize*w}}(this);b=function(){return(Math.random()-.5)*2};for(k=L=0;0<=d?L<d:L>d;k=0<=d?++L:--L){v=y();m=y();g=y();c=new l.Vector3(v,m,g);E=b();S=b();x=b();T=new l.Vector3(E,S,x);T.normalize();T.multiplyScalar(Math.random()*n);e=new u({center:c,velocity:T,model:new l.SphereGeometry(r,48,48),materialName:"ball",mass:1,strokeMeshOptions:{strokeTexture:this.resources().texture("stroke1"),colors:{type:"randomHSL",hue:[.05,.25],sat:[.4,.8],lum:[.4,.8]},specularIntensity:1,specularPower:4,layers:[{nStrokes:4e3,strokeSize:.5}]},init:function(){return this.quaternion().setFromAxisAngle(new a.Vec3(1,0,0),-Math.PI/2)}});o.push(e)}return t.__super__.initialObjects.apply(this,arguments).concat([f,h],C,o)};t.prototype.otherSetup=function(){this.graphics().camera().position.set(0,0,this.boxSize/2);this.physics().setGravity(new l.Vector3(0,-9.8,0));this.physics().addMaterialContact("ball","wall",0,1);return this.physics().addMaterialContact("ball","ball",0,1)};return t}(o)},{"../CameraController":1,"../FramerateTracker":3,"../Game":4,"../PhysicalObject":8,"../check":16,cannon:37,three:45}],19:[function(e,t,n){var r,i,s,o,u,a,f,l,c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t){if(c.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};a=e("cannon");l=e("three");i=e("../CameraController");f=e("../check").check;s=e("../FramerateTracker");o=e("../Game");u=e("../PhysicalObject");t.exports=r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}h(t,e);t.prototype.allResources=function(){return{models:["bunny"],textures:["stroke1"]}};t.prototype.initialObjects=function(){var e,n;e=new i({distance:25});n=new s("#frameRateNumber");this.ground=new u({center:new l.Vector3(0,-10,0),model:new l.PlaneGeometry(50,50),materialName:"ground",strokeMeshOptions:{strokeTexture:this.resources().texture("stroke1"),colors:{type:"rainbow"},layers:[{nStrokes:2e3,strokeSize:1.25},{nStrokes:3e4,strokeSize:.2}]},init:function(){return this.quaternion().setFromAxisAngle(new a.Vec3(1,0,0),-Math.PI/2)}});this.bunny=new u({center:new l.Vector3(0,10,0),modelName:"bunny",materialName:"bunny",mass:1,strokeMeshOptions:{strokeTexture:this.resources().texture("stroke1"),colors:{type:"rainbow"},layers:[{nStrokes:1e5,strokeSize:.4}]}});return t.__super__.initialObjects.apply(this,arguments).concat([e,n,this.ground,this.bunny])};t.prototype.otherSetup=function(){this.graphics().camera().position.set(0,20,20);this.physics().setGravity(new l.Vector3(0,-9.8,0));this.physics().addMaterialContact("bunny","ground",0,1);return this.bunny.listenForCollide(function(e){return function(t){console.log("collide!");return f(t===e.ground)}}(this))};return t}(o)},{"../CameraController":1,"../FramerateTracker":3,"../Game":4,"../PhysicalObject":8,"../check":16,cannon:37,three:45}],20:[function(e,t,n){var r,i,s,o,u,a,f,l,c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t){if(c.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};l=e("three");i=e("../CameraController");s=e("../Game");u=e("../SimpleStrokeMeshObject");f=e("../StrokeMeshLayer");a=e("../StrokeMesh");o=e("../Light");t.exports=r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}h(t,e);t.prototype.allResources=function(){return{models:["bunny"],textures:["noise2","stroke2"]}};t.prototype.initialObjects=function(){var e,n,r,s;e=new i({distance:1.9});s=new u(new l.Vector3(0,0,0),{geometry:this.resources().geometry("bunny"),specularAmount:2,specularPow:4,layers:[{nStrokes:2e3,strokeSize:.1,strokeTexture:this.resources().texture("stroke2"),colors:{type:"randomHSL",hue:0,sat:.5,lum:.25}},{nStrokes:3e3,strokeSize:.07,strokeTexture:this.resources().texture("noise2"),colors:{type:"randomHSL",hue:.02,sat:.8,lum:.37}},{nStrokes:5e3,strokeSize:.03,strokeTexture:this.resources().texture("noise2"),colors:{type:"randomHSL",hue:[.03,.15],sat:[.68,.94],lum:.33},specularMin:.95,specularFadeIn:.63}]});n=new o({direction:new l.Vector3(1,1,1),lum:1});r=new o({direction:new l.Vector3(-1,-1,-1),lum:.5});return t.__super__.initialObjects.apply(this,arguments).concat([e,n,r,s])};return t}(s)},{"../CameraController":1,"../Game":4,"../Light":7,"../SimpleStrokeMeshObject":12,"../StrokeMesh":13,"../StrokeMeshLayer":14,three:45}],21:[function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p={}.hasOwnProperty,d=function(e,t){function r(){this.constructor=e}for(var n in t){if(p.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};h=e("three");r=e("../CameraController");i=e("../FramerateTracker");s=e("../Game");f=e("../SimpleStrokeMeshObject");c=e("../StrokeMeshLayer");a=e("../ScreenShooter");l=e("../StrokeMesh");o=e("../Light");t.exports=u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}d(t,e);t.prototype.allResources=function(){return{models:["bunny","teapot"],textures:["arrow","grid","stick","noise2","stroke1","stroke2","stroke3","stroke4","stroke5"]}};t.prototype.initialObjects=function(){var e,n,s,u,l,c,p,d,v,m,g,y;s=new r({distance:20});u=new i("#frameRateNumber");g=new a("#screenShotButton");y=new f(new h.Vector3(0,0,0),{geometry:new h.SphereGeometry(2,32,32),strokeTexture:this.resources().texture("arrow"),layers:[{nStrokes:200,strokeSize:.3,colors:{type:"randomHSL",hue:0,sat:[0,1],lum:.5}}]});m=new f(new h.Vector3(0,0,0),{geometry:new h.SphereGeometry(2,32,32),strokeTexture:this.resources().texture("stroke1"),layers:[{nStrokes:1e3,strokeSize:.5,colors:{type:"randomHSL",hue:.5,sat:[.25,.75],lum:.4}},{nStrokes:1250,strokeSize:.3,specularMin:0,specularFadeIn:.6,colors:{type:"randomHSL",hue:.6,sat:[.5,.75],lum:.45}},{nStrokes:1500,strokeSize:.15,specularMin:.6,specularFadeIn:.4,colors:{type:"randomHSL",hue:.65,sat:[.5,1],lum:.5}}]});l=new f(new h.Vector3(0,0,0),{geometry:new h.TorusKnotGeometry(10,3,100,16),colors:{type:"randomHSL",hue:.75,sat:[0,.5],lum:[0,.5]},layers:[{nStrokes:2e4,strokeSize:1,strokeTexture:this.resources().texture("stroke1")}]});n=new f(new h.Vector3(0,0,0),{geometry:this.resources().geometry("bunny"),borderSize:.33,specularAmount:2,specularPow:4,layers:[{nStrokes:1400,strokeSize:.8,strokeTexture:this.resources().texture("stroke1"),colors:{type:"randomHSL",hue:[.14,.18],sat:[.1,.7],lum:.4},specularAmount:0},{nStrokes:1800,strokeSize:.6,strokeTexture:this.resources().texture("stroke4"),specularMin:0,specularFadeIn:.25,colors:{type:"randomHSL",hue:[.18,.28],sat:[.6,1.2],lum:[.2,.3]}},{nStrokes:4800,strokeSize:.2,strokeTexture:this.resources().texture("stroke5"),specularMin:.7,specularFadeIn:1,colors:{type:"randomHSL",hue:[.18,.28],sat:[.5,1],lum:[.25,.5]}}]});e=new f(new h.Vector3(0,-1.5,0),{geometry:this.resources().geometry("teapot"),borderSize:.2,specularAmount:2,specularPow:4,strokeSize:.2,strokeTexture:this.resources().texture("grid"),layers:[{nStrokes:1600,colors:{type:"randomHSL",hue:0,sat:.5,lum:[0,1]}},{nStrokes:800,colors:{type:"randomHSL",hue:.65,sat:.5,lum:[0,1]}}]});v=new f(new h.Vector3(0,0,0),{geometry:this.resources().geometry("bunny"),specularAmount:2,specularPow:4,layers:[{nStrokes:2e3,strokeSize:.1,strokeTexture:this.resources().texture("stroke2"),colors:{type:"randomHSL",hue:0,sat:.5,lum:.22}},{nStrokes:3e3,strokeSize:.07,strokeTexture:this.resources().texture("noise2"),colors:{type:"randomHSL",hue:.02,sat:.8,lum:.34}},{nStrokes:5e3,strokeSize:.03,strokeTexture:this.resources().texture("noise2"),colors:{type:"randomHSL",hue:[.03,.15],sat:[.68,.94],lum:.33},specularMin:.95,specularFadeIn:.63}]});d=new f(new h.Vector3(0,0,0),{geometry:new h.SphereGeometry(2,32,32),borderSize:.35,specularAmount:2,specularPow:4,layers:[{nStrokes:400,strokeSize:.8,strokeTexture:this.resources().texture("stroke1"),colors:{type:"randomHSL",hue:0,sat:[.5,1],lum:.25}},{nStrokes:800,strokeSize:.4,strokeTexture:this.resources().texture("grid"),colors:{type:"randomHSL",hue:.95,sat:[.25,.75],lum:.25},specularFadeIn:1.51},{nStrokes:1600,strokeSize:.2,strokeTexture:this.resources().texture("stick"),colors:{type:"randomHSL",hue:[-.22,.36],sat:[.6,1],lum:.25},specularFadeIn:4.17}]});c=new o({direction:new h.Vector3(1,1,1),lum:1});p=new o({direction:new h.Vector3(-1,-1,-1),lum:.5});return t.__super__.initialObjects.apply(this,arguments).concat([s,u,g,c,p,v])};return t}(s)},{"../CameraController":1,"../FramerateTracker":3,"../Game":4,"../Light":7,"../ScreenShooter":11,"../SimpleStrokeMeshObject":12,"../StrokeMesh":13,"../StrokeMeshLayer":14,three:45}],22:[function(e,t,n){var r,i,s,o,u,a,f={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var n in t){if(f.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("../CameraController");i=e("../FramerateTracker");s=e("../Game");a=e("../ScreenShooter");o=e("../ui/ParametersController");t.exports=u=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}l(n,t);n.prototype.allResources=function(){return{models:["sphere","bunny","lamp","teapot","quad"],textures:["4colors","scream","raytrace","ice","fire","water","grass","brick","stroke1","stroke2","stroke3","stroke4","stroke5","noise1","noise2","circle","triangle","square","stick","grid"]}};n.prototype.initialObjects=function(){var e,t,s,u;e=new r({distance:2});t=new i("#frameRateNumber");s=new o("parameters");u=new a("#screenShotButton");return n.__super__.initialObjects.apply(this,arguments).concat([e,t,s,u])};n.prototype.otherSetup=function(){var t;t=e("three");this.physics().setGravity(new t.Vector3(0,-9.8,0));this.physics().addMaterialContact("ball","wall",0,1);return this.physics().addMaterialContact("ball","ball",0,1)};return n}(s)},{"../CameraController":1,"../FramerateTracker":3,"../Game":4,"../ScreenShooter":11,"../ui/ParametersController":31,three:45}],23:[function(e,t,n){var r,i,s,o,u,a,f={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var n in t){if(f.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};a=e("three");r=e("../CameraController");i=e("../FramerateTracker");s=e("../Game");o=e("../SimpleStrokeMeshObject");t.exports=u=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}l(t,e);t.prototype.allResources=function(){return{models:[],textures:["arrow"]}};t.prototype.initialObjects=function(){var e,n,s;e=new r;n=new i("#frameRateNumber");s=new o(new a.Vector3(0,0,0),{geometry:new a.SphereGeometry(2,32,32),strokeTexture:this.resources().texture("arrow"),layers:[{nStrokes:200,strokeSize:.3,colors:{type:"randomHSL",hue:0,sat:[0,1],lum:.5}}]});return t.__super__.initialObjects.apply(this,arguments).concat([e,n,s])};return t}(s)},{"../CameraController":1,"../FramerateTracker":3,"../Game":4,"../SimpleStrokeMeshObject":12,three:45}],24:[function(e,t,n){var r,i,s,o,u,a,f,l,c,h={}.hasOwnProperty,p=function(e,t){function r(){this.constructor=e}for(var n in t){if(h.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};c=e("three");r=e("../CameraController");i=e("../FramerateTracker");s=e("../Game");u=e("../ScreenShooter");a=e("../SimpleStrokeMeshObject");l=e("../TexturedObject");o=e("../Light");t.exports=f=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}p(t,e);t.prototype.allResources=function(){return{models:["bunny","quad","sphere"],textures:["stroke1","white","scream","easy_colors","sirius-1-10","sirius-2-17","sirius-2-19","raytracing"]}};t.prototype.initialObjects=function(){var e,n,s,f,h,p,d;e=new r({distance:3});n=new i("#frameRateNumber");p=new u("#screenShotButton");d=new l(new c.Vector3(0,0,0),{geometry:this.resources().geometry("quad"),texture:this.resources().texture("scream")});h=new a(new c.Vector3(0,0,0),{geometry:this.resources().geometry("quad"),objectTexture:this.resources().texture("scream"),colors:{type:"randomHSL",hue:.65,sat:0,lum:1},strokeTexture:this.resources().texture("stroke1"),specularIntensity:2,layers:[{nStrokes:600,strokeSize:.3},{nStrokes:1e3,strokeSize:.2},{nStrokes:3e3,strokeSize:.1}]});s=new o({direction:new c.Vector3(1,1,1),lum:.5});f=new o({direction:new c.Vector3(-1,-1,-1),lum:.5});return t.__super__.initialObjects.apply(this,arguments).concat([e,n,p,s,f,h])};return t}(s)},{"../CameraController":1,"../FramerateTracker":3,"../Game":4,"../Light":7,"../ScreenShooter":11,"../SimpleStrokeMeshObject":12,"../TexturedObject":15,three:45}],25:[function(e,t,n){var r,i,s,o,u,a,f,l,c;r=e("jquery");f=e("./games/TestGame");u=e("./games/MeshGame");s=e("./games/BouncingBunnyGame");i=e("./games/BouncingBallsGame");o=e("./games/BunnyGame");a=e("./games/ParametersGame");l=e("./games/TextureGame");c=new o;r("document").ready(function(){c.bindToDiv(r("#glContainer"));return c.play()})},{"./games/BouncingBallsGame":18,"./games/BouncingBunnyGame":19,"./games/BunnyGame":20,"./games/MeshGame":21,"./games/ParametersGame":22,"./games/TestGame":23,"./games/TextureGame":24,jquery:43}],26:[function(e,t,n){var r,i,s,o,u,a,f,l;u=e("three");l=e("./check"),r=l.check,a=l.type;f=function(e,t){return e.clone().multiplyScalar(t)};o=function(e,t,n){var i,s,o,u,a,f,l;r(e.length===(a=t.length)&&a===n.length);s=function(e,t,n){var r;r=e[t];e[t]=e[n];return e[n]=r};l=[];for(i=u=f=e.length-1;u>=0;i=u+=-1){o=Math.floor(Math.random()*i);s(e,i,o);s(t,i,o);l.push(s(n,i,o))}return l};s=function(e,t,n,r,i,s,o,u,a){var l,c,h,p,d,v;l=1-Math.sqrt(Math.random());c=Math.random()*(1-l);h=1-l-c;d=f(e,l);d.add(f(t,c));d.add(f(n,h));p=f(r,l);p.add(f(i,c));p.add(f(s,h));v=f(o,l);v.add(f(u,c));v.add(f(a,h));return[d,p,v]};t.exports=i=function(e,t){var n,i,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W;a(e,u.Mesh);c=e.geometry;l=function(e){return[c.vertices[e.a],c.vertices[e.b],c.vertices[e.c]]};E=0;j=c.faces;for(D=0,B=j.length;D<B;D++){f=j[D];E+=(F=u.GeometryUtils).triangleArea.apply(F,l(f))}i=t/E;c.computeFaceNormals();c.computeVertexNormals();O=[];b=[];C=[];M=0;h=c.faceVertexUvs!=null&&c.faceVertexUvs[0].length>0;for(p=P=0,I=c.faces.length;0<=I?P<I:P>I;p=0<=I?++P:--P){f=c.faces[p];q=l(f),k=q[0],L=q[1],A=q[2];R=f.vertexNormals,v=R[0],m=R[1],g=R[2];if(h){U=c.faceVertexUvs[0][p],x=U[0],T=U[1],N=U[2]}else{z=[new u.Vector2(0,0),new u.Vector2(0,0),new u.Vector2(0,0)],x=z[0],T=z[1],N=z[2]}n=u.GeometryUtils.triangleArea(k,L,A);M+=n*i;d=Math.round(M);M-=d;for(_=H=0;0<=d?H<d:H>d;_=0<=d?++H:--H){W=s(k,L,A,v,m,g,x,T,N),w=W[0],y=W[1],S=W[2];O.push(w);b.push(y);C.push(S)}}r(O.length===t);o(O,b,C);return[O,b,C,h]}},{"./check":16,three:45}],27:[function(e,t,n){var r,i,s,o=[].slice;s=e("./check"),r=s.type,i=s.typeEach;this.read=function(){var e,t;e=arguments[0],t=2<=arguments.length?o.call(arguments,1):[];r(e,Function);i(t,String);return t.forEach(function(t){return e.prototype[t]=function(){return this["_"+t]}})}},{"./check":16}],28:[function(e,t,n){var r,i,s,o,u,a,f,l,c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t){if(c.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("jquery");i=e("../GameObject");l=e("../meta").read;o=e("./OnOffButton");u=e("./RadioSelector");a=e("./Range");f=e("./RangeRange");t.exports=s=function(e){function t(e,t){var n,i,s,l,c,h,p,d;this._paramsControl=e;c=r("<div class='stroke'/>");c.append(r("<div class='controlTitle' name='stroke'/>").text("Stroke"));this._on=new o({"class":"layerOn",start:t===0});this._nStrokes=new a({name:"Number",min:0,max:15e3,step:1,scaleType:"exponential",start:500*Math.pow(2,t)});this._strokeSize=new a({name:"Size",min:.04,max:.4,scaleType:"exponential",start:.3-.1*t});this._strokeTexture=new u({name:"Texture",options:["stroke1","stroke2","stroke3","stroke4","stroke5","noise1","noise2","circle","triangle","square","stick","grid"],start:"stroke1"});this._objectTexture=new u({name:"Object Texture",options:["none","scream","4colors","raytrace","fire","water","grass","brick"],start:"none"});this._strokeRotCurve=new u({name:"Drawing Method",options:["flat","oriented","curved"],start:"curved"});this._strokeRotCurve.div().addClass("short");this._strokeCurveFactor=new a({name:"Curve",min:0,max:2,scaleType:"exponential",start:1});c.append(r("<div class='rangeGroup'/>").append(this._nStrokes.div(),this._strokeSize.div()));c.append(this._strokeTexture.div());c.append(this._strokeRotCurve.div());c.append(r("<div class='rangeGroup'/>").append(this._strokeCurveFactor.div()));i=r("<div class='hsl'/>");i.append(r("<div class='controlTitle' name='hsl'/>").text("Colors"));i.append(this._objectTexture.div());this._hue=new f({name:"Hue",min:0,max:1});this._sat=new f({name:"Sat",min:0,max:1,startAverage:.5});this._lum=new f({name:"Lum",min:0,max:1,startAverage:.25});i.append(r("<div class='rangeGroup'/>").append(this._hue.div(),this._sat.div(),this._lum.div()));l=r("<div class='specular'/>");l.append(r("<div class='controlTitle' name='specular'/>").text("Specular"));this._specIntense=new a({name:"Amount",min:0,max:10,scaleType:"exponential",start:2});this._specPow=new a({name:"Power",min:0,max:10,scaleType:"exponential",start:4});this._specMin=new a({name:"Min",min:0,max:10,scaleType:"exponential"});this._specFadeIn=new a({name:"Fade In",min:0,max:5,scaleType:"exponential"});l.append(r("<div class='rangeGroup'/>").append(this._specIntense.div(),this._specPow.div(),this._specMin.div(),this._specFadeIn.div()));n=[this._on,this._nStrokes,this._strokeSize,this._strokeTexture,this._objectTexture,this._strokeRotCurve,this._strokeCurveFactor,this._hue,this._sat,this._lum,this._specIntense,this._specPow,this._specMin,this._specFadeIn];for(p=0,d=n.length;p<d;p++){h=n[p];h.change().add(function(e){return function(){return e._paramsControl.regenerate()}}(this))}this._div=r("<div class='layerController'/>");this._div.append(this._on.div(),c,i,l);this._overlay=r("<div class='layerControllerOverlay'/>");this._div.append(this._overlay);s=function(e){return function(){if(e.on()){return e._overlay.hide()}else{return e._overlay.show()}}}(this);this._on.change().add(s);s()}h(t,e);l(t,"div");t.prototype.on=function(){return this._on.get()};t.prototype.opts=function(){return{strokeTexture:this.resources().texture(this._strokeTexture.get()),objectTexture:this._objectTexture.get()!=="none"?this.resources().texture(this._objectTexture.get()):void 0,nStrokes:this._nStrokes.get(),strokeSize:this._strokeSize.get(),enableRotation:this._strokeRotCurve.get()!=="flat",curveFactor:this._strokeRotCurve.get()==="curved"?this._strokeCurveFactor.get():0,colors:{type:"randomHSL",hue:this._hue.get(),sat:this._sat.get(),lum:this._lum.get()},specularIntensity:this._specIntense.get(),specularPower:this._specPow.get(),specularMin:this._specMin.get(),specularFadeIn:this._specFadeIn.get()}};return t}(i)},{"../GameObject":5,"../meta":27,"./OnOffButton":30,"./RadioSelector":32,"./Range":33,"./RangeRange":34,jquery:43}],29:[function(e,t,n){var r,i,s,o,u,a,f,l,c={}.hasOwnProperty,h=function(e,t){function r(){this.constructor=e}for(var n in t){if(c.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("jquery");l=e("three");i=e("../GameObject");s=e("../Light");f=e("../meta").read;u=e("./OnOffButton");a=e("./Range");t.exports=o=function(e){function t(e,t){var n,i,o,f,l,c,h,p;this._paramsControl=e;this._on=new u({"class":"lightOn",start:true});this._lat=new a({name:"Lat",min:-90,max:90,start:t===0?-30:t===1?-12:-50});this._long=new a({name:"Long",min:-180,max:180,start:t===0?0:t===1?-110:115});this._hue=new a({name:"Hue",min:0,max:1});this._sat=new a({name:"Sat",min:0,max:1});this._lum=new a({name:"Lum",min:0,max:5,scaleType:"exponential",start:2});i=[this._lat,this._long,this._hue,this._sat,this._lum];n=r("<div class='rangeGroup'/>");for(f=0,c=i.length;f<c;f++){o=i[f];n.append(o.div())}this._div=r("<div class='lightController'/>");this._div.append(this._on.div(),n);p=i.concat([this._on]);for(l=0,h=p.length;l<h;l++){o=p[l];o.change().add(function(e){return function(){return e.regenerate()}}(this))}this._light=new s}h(t,e);f(t,"div");t.prototype.start=function(){this.regenerate();return this.emit(this._light)};t.prototype.regenerate=function(){var e;this._light.setDirection(this.getDirection());e=this._on.get()?this._lum.get():0;return this._light.setColor(this._hue.get(),this._sat.get(),e)};t.prototype.getDirection=function(){var e,t;e=this._lat.get()*Math.PI/180+Math.PI/2;t=this._long.get()*Math.PI/180;return new l.Vector3(Math.cos(t)*Math.sin(e),Math.sin(t)*Math.sin(e),Math.cos(e))};return t}(i)},{"../GameObject":5,"../Light":7,"../meta":27,"./OnOffButton":30,"./Range":33,jquery:43,three:45}],30:[function(e,t,n){var r,i,s;r=e("jquery");s=e("../meta").read;t.exports=i=function(){function e(e){this._box=r("<input type='checkbox'/>");this._box.attr("checked",e.start);this._change=r.Callbacks();this._box.bind("change",function(e){return function(){return e._change.fire(e.get())}}(this));this._div=r("<div class='onOffDiv'/>");if(e["class"]!=null){this._div.addClass(e["class"])}this._div.append(this._box)}s(e,"change","div");e.prototype.get=function(){return this._box.is(":checked")};return e}()},{"../meta":27,jquery:43}],31:[function(e,t,n){var r,i,s,o,u,a,f,l,c,h={}.hasOwnProperty,p=function(e,t){function r(){this.constructor=e}for(var n in t){if(h.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};r=e("jquery");c=e("three");i=e("../GameObject");l=e("../SimpleStrokeMeshObject");s=e("./LayerController");o=e("./LightController");a=e("./RadioSelector");f=e("./Range");t.exports=u=function(t){function n(e){this._divName=e;null}p(n,t);n.prototype.genBalls=function(t){var n,r,i,s,o,u,a,f,l,h,p,d,v,m,g,y,b,w,E,S,x;n=e("../PhysicalObject");o=e("cannon");this.boxSize=50;s=4;this.walls=[];a=new n({center:new c.Vector3(0,-this.boxSize/2,0),model:new c.PlaneGeometry(this.boxSize,this.boxSize),materialName:"wall",strokeMeshOptions:{strokeTexture:this.resources().texture("stroke1"),colors:{type:"randomHSL",hue:[.08,.12],sat:[.4,.8],lum:[.2,.4]},specularIntensity:.2,specularPower:4,layers:[{nStrokes:4e3,strokeSize:1.75},{nStrokes:3e4,strokeSize:.8}]},init:function(){return this.quaternion().setFromAxisAngle(new o.Vec3(1,0,0),-Math.PI/2)}});this.walls.push(a);E=[{center:new c.Vector3(-this.boxSize/2,0,0),rotationAxis:new o.Vec3(0,1,0),rotationAngle:Math.PI/2},{center:new c.Vector3(this.boxSize/2,0,0),rotationAxis:new o.Vec3(0,1,0),rotationAngle:-Math.PI/2},{center:new c.Vector3(0,0,-this.boxSize/2),rotationAxis:new o.Vec3(0,1,0),rotationAngle:0},{center:new c.Vector3(0,0,this.boxSize/2),rotationAxis:new o.Vec3(0,1,0),rotationAngle:Math.PI},{center:new c.Vector3(0,this.boxSize/2,0),rotationAxis:new o.Vec3(1,0,0),rotationAngle:Math.PI/2}];E.forEach(function(e){return function(t){var r,i,s,o;r=t.center,s=t.rotationAxis,i=t.rotationAngle;o=new n({center:r,model:new c.PlaneGeometry(e.boxSize,e.boxSize),materialName:"wall",strokeMeshOptions:{strokeTexture:e.resources().texture("stroke1"),colors:{type:"randomHSL",hue:[.08,.12],sat:[.05,.25],lum:[.2,.4]},specularIntensity:.8,specularPower:4,layers:[{nStrokes:4e3,strokeSize:1.75},{nStrokes:3e4,strokeSize:.8}]},init:function(){return this.quaternion().setFromAxisAngle(s,i)}});return e.walls.push(o)}}(this));f=10;m=.9;i=20;this.balls=[];d=function(e){return function(){return(Math.random()-.5)*e.boxSize*m}}(this);v=function(){return(Math.random()-.5)*2};for(S=x=0;0<=f?x<f:x>f;S=0<=f?++x:--x){l=d();h=d();p=d();u=new c.Vector3(l,h,p);g=v();y=v();b=v();w=new c.Vector3(g,y,b);w.normalize();w.multiplyScalar(Math.random()*i);r=new n({center:u,velocity:w,model:new c.SphereGeometry(s,48,48),materialName:"ball",mass:1,strokeMeshOptions:t,init:function(){return this.quaternion().setFromAxisAngle(new o.Vec3(1,0,0),-Math.PI/2)}});this.balls.push(r)}return this.walls.concat(this.balls)};n.prototype.start=function(){var e,t,n,i,u,l,h;i=r("<div class='meshOptions'/>");this._geometry=new a({name:"Geometry",options:["sphere","bunny","teapot","quad","bounce"],start:"sphere"});this._geometry.div().addClass("extraLong");this._borderSize=new f({name:"Border",min:0,max:.25,start:.1});this._geometry.change().add(function(e){return function(){return e.regenerate()}}(this));this._borderSize.change().add(function(e){return function(){return e.regenerate()}}(this));i.append(this._geometry.div(),r("<div class='rangeGroup'/>").append(this._borderSize.div()));this._layers=function(){var t,n;n=[];for(e=t=0;t<3;e=++t){n.push(this.emit(new s(this,e)))}return n}.call(this);this._ambient=new f({name:"Ambient",min:0,max:1,start:.2});this._lights=function(){var t,n;n=[];for(e=t=0;t<3;e=++t){n.push(this.emit(new o(this,e)))}return n}.call(this);n=r("<div/>");n.append(r("<div class='rangeGroup'/>").append(this._ambient.div()));this._ambient.change().add(function(e){return function(){var t,n;n=e._ambient.get();t=new c.Color;t.setHSL(0,0,n);return e.graphics().setAmbient(t)}}(this));h=this._lights;for(u=0,l=h.length;u<l;u++){t=h[u];n.append(t.div())}this.regenerate();return r("document").ready(function(e){return function(){var t,s,o,u,a;t=r("#"+e._divName);t.addClass("parametersController");t.empty();t.append(i);t.append(r("<div class='controlTitle' name='layers'/>").text("Layers"));a=e._layers;for(o=0,u=a.length;o<u;o++){s=a[o];t.append(s.div())}t.append(r("<div class='controlTitle' name='lights'/>").text("Lights"));return t.append(n)}}(this))};n.prototype.regenerate=function(){var e,t,n,r,i,s,o,u,a,f,h,p,d,v,m;if(this._obj!=null){this._obj.die()}if(this.walls!=null){d=this.walls;for(o=0,f=d.length;o<f;o++){i=d[o];i.die()}}if(this.balls!=null){v=this.balls;for(u=0,h=v.length;u<h;u++){t=v[u];t.die()}}r={borderSize:this._borderSize.get(),layers:function(){var e,t,r,i;r=this._layers;i=[];for(e=0,t=r.length;e<t;e++){n=r[e];if(n.on()){i.push(n.opts())}}return i}.call(this)};if(this._geometry.get()==="bounce"){s=this.genBalls(r);m=[];for(a=0,p=s.length;a<p;a++){e=s[a];m.push(this.emit(e))}return m}else{r.geometry=this.resources().geometry(this._geometry.get());this._obj=new l(new c.Vector3(0,0,0),r);return this.emit(this._obj)}};return n}(i)},{"../GameObject":5,"../PhysicalObject":8,"../SimpleStrokeMeshObject":12,"./LayerController":28,"./LightController":29,"./RadioSelector":32,"./Range":33,cannon:37,jquery:43,three:45}],32:[function(e,t,n){var r,i,s,o,u=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};r=e("jquery");s=e("../check").check;o=e("../meta").read;t.exports=i=function(){function e(e){var t,n,i,o,a,f,l;e.name;s((f=e.start,u.call(e.options,f)>=0));this._change=r.Callbacks();n=function(e){return function(){return e._change.fire(e.get())}}(this);t=function(){var t,s,u,f;u=e.options;f=[];for(t=0,s=u.length;t<s;t++){i=u[t];o=r("<input/>").attr({type:"radio","class":"button",value:i,name:e.name});a=r("<span class='name'/>").text(i);o.bind("change",n);if(i===e.start){o.attr("checked",true)}f.push(r("<div class='single'/>").append(o,a))}return f}();this._div=r("<form class='radioSelector'/>");this._div.append(r("<div class='controlTitle2'/>").text(e.name));(l=this._div).append.apply(l,t)}o(e,"change","div");e.prototype.get=function(){return this._div.find(":checked").val()};return e}()},{"../check":16,"../meta":27,jquery:43}],33:[function(e,t,n){var r,i,s,o,u,a,f;r=e("jquery");u=e("../meta").read;f=e("./sliderHelp"),s=f.makeSlider,o=f.onSliderChange;a=function(e,t){return Math.round(e/t)*t};t.exports=i=function(){function e(e){var t,n,i,u,a,f,l,c;this._name=e.name;this._scaleType=(u=e.scaleType)!=null?u:"linear";this._min=(a=e.min)!=null?a:0;this._max=(f=e.max)!=null?f:1;this._step=(l=e.step)!=null?l:.01;n=(c=e.start)!=null?c:0;i=(n-this._min)/(this._max-this._min);i=function(){switch(this._scaleType){case"linear":return i;case"exponential":t=2;return Math.log(i*(Math.exp(t)-1)+1)/t;default:return fail()}}.call(this);this._nameDiv=r("<div class='controlName'/>");this._nameDiv.text(this._name);this._slider=s("slider",0,1,i,.001);this._change=r.Callbacks();o(this._slider,function(e){return function(){return e._change.fire(e.get())}}(this));this._readOut=r("<div class='readOut'/>");this._change.add(function(e){return function(){return e._readOut.text(e.get().toString().slice(0,6))}}(this));this._change.fire();this._div=r("<div class='range'/>");this._div.append(this._nameDiv);this._div.append(this._slider);this._div.append(this._readOut)}u(e,"change","div","name");e.prototype.get=function(){var e,t,n;n=parseFloat(this._slider.val());t=function(){switch(this._scaleType){case"linear":return n;case"exponential":e=2;return(Math.exp(n*e)-1)/(Math.exp(e)-1);default:return fail()}}.call(this);t=this._min+t*(this._max-this._min);return a(t,this._step)};e.prototype.set=function(e){this._slider.val(e);return this._change.fire(e)};return e}()},{"../meta":27,"./sliderHelp":35,jquery:43}],34:[function(e,t,n){var r,i,s,o,u,a;r=e("jquery");u=e("../meta").read;a=e("./sliderHelp"),s=a.makeSlider,o=a.onSliderChange;t.exports=i=function(){function e(e){var t;this._name=e.name;this._nameDiv=r("<div class=controlName/>");this._nameDiv.text(this._name);this._average=s("average",e.min,e.max,e.startAverage);this._variance=s("variance",e.min,e.max,e.startVariance);this._readOut=r("<div class=readOut/>");this._change=r.Callbacks();t=function(e){return function(){return e._change.fire(e.get())}}(this);o(this._average,t);o(this._variance,t);this._change.add(function(e){return function(){return e._readOut.text(""+e._average.val()+""+e._variance.val())}}(this));this._change.fire();this._div=r("<div class=rangeRange/>");this._div.append(this._nameDiv,this._average,this._variance,this._readOut)}u(e,"change","div","name");e.prototype.get=function(){var e,t,n,r;e=parseFloat(this._average.val());r=parseFloat(this._variance.val());n=e-r;t=e+r;return[n,t]};return e}()},{"../meta":27,"./sliderHelp":35,jquery:43}],35:[function(e,t,n){var r;r=e("jquery");this.onSliderChange=function(e,t){var n;n=null;return e.bind("change",function(){if(n!=null){clearTimeout(n)}return n=setTimeout(t,100)})};this.makeSlider=function(e,t,n,i,s){var o;if(t==null){t=0}if(n==null){n=1}if(i==null){i=t}if(s==null){s=.01}o=r("<input type='range' class='"+e+"'/>");o.attr("min",t);o.attr("max",n);o.attr("step",s);o.val(i);return o}},{jquery:43}],36:[function(e,t,n){var r=e("three");r.TrackballControls=function(e,t){function w(e){if(n.enabled===false)return;window.removeEventListener("keydown",w);u=o;if(o!==i.NONE){return}else if(e.keyCode===n.keys[i.ROTATE]&&!n.noRotate){o=i.ROTATE}else if(e.keyCode===n.keys[i.ZOOM]&&!n.noZoom){o=i.ZOOM}else if(e.keyCode===n.keys[i.PAN]&&!n.noPan){o=i.PAN}}function E(e){if(n.enabled===false)return;o=u;window.addEventListener("keydown",w,false)}function S(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();if(o===i.NONE){o=e.button}if(o===i.ROTATE&&!n.noRotate){n.getMouseProjectionOnBall(e.pageX,e.pageY,f);l.copy(f)}else if(o===i.ZOOM&&!n.noZoom){n.getMouseOnScreen(e.pageX,e.pageY,c);h.copy(c)}else if(o===i.PAN&&!n.noPan){n.getMouseOnScreen(e.pageX,e.pageY,v);m.copy(v)}document.addEventListener("mousemove",x,false);document.addEventListener("mouseup",T,false);n.dispatchEvent(y)}function x(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();if(o===i.ROTATE&&!n.noRotate){n.getMouseProjectionOnBall(e.pageX,e.pageY,l)}else if(o===i.ZOOM&&!n.noZoom){n.getMouseOnScreen(e.pageX,e.pageY,h)}else if(o===i.PAN&&!n.noPan){n.getMouseOnScreen(e.pageX,e.pageY,m)}}function T(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();o=i.NONE;document.removeEventListener("mousemove",x);document.removeEventListener("mouseup",T);n.dispatchEvent(b)}function N(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();var t=0;if(e.wheelDelta){t=e.wheelDelta/40}else if(e.detail){t=-e.detail/3}c.y+=t*.01;n.dispatchEvent(y);n.dispatchEvent(b)}function C(e){if(n.enabled===false)return;switch(e.touches.length){case 1:o=i.TOUCH_ROTATE;l.copy(n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,f));break;case 2:o=i.TOUCH_ZOOM;var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;d=p=Math.sqrt(t*t+r*r);break;case 3:o=i.TOUCH_PAN;m.copy(n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,v));break;default:o=i.NONE}n.dispatchEvent(y)}function k(e){if(n.enabled===false)return;e.preventDefault();e.stopPropagation();switch(e.touches.length){case 1:n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,l);break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;d=Math.sqrt(t*t+r*r);break;case 3:n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,m);break;default:o=i.NONE}}function L(e){if(n.enabled===false)return;switch(e.touches.length){case 1:f.copy(n.getMouseProjectionOnBall(e.touches[0].pageX,e.touches[0].pageY,l));break;case 2:p=d=0;break;case 3:v.copy(n.getMouseOnScreen(e.touches[0].pageX,e.touches[0].pageY,m));break}o=i.NONE;n.dispatchEvent(b)}var n=this;var i={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.noRoll=false;this.staticMoving=false;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new r.Vector3;var s=new r.Vector3;var o=i.NONE,u=i.NONE,a=new r.Vector3,f=new r.Vector3,l=new r.Vector3,c=new r.Vector2,h=new r.Vector2,p=0,d=0,v=new r.Vector2,m=new r.Vector2;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var g={type:"change"};var y={type:"start"};var b={type:"end"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{this.screen=this.domElement.getBoundingClientRect();var e=this.domElement.ownerDocument.documentElement;this.screen.left+=window.pageXOffset-e.clientLeft;this.screen.top+=window.pageYOffset-e.clientTop}};this.handleEvent=function(e){if(typeof this[e.type]=="function"){this[e.type](e)}};this.getMouseOnScreen=function(e,t,r){return r.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height)};this.getMouseProjectionOnBall=function(){var e=new r.Vector3,t=new r.Vector3;return function(r,i,s){t.set((r-n.screen.width*.5-n.screen.left)/(n.screen.width*.5),(n.screen.height*.5+n.screen.top-i)/(n.screen.height*.5),0);var o=t.length();if(n.noRoll){if(o<Math.SQRT1_2){t.z=Math.sqrt(1-o*o)}else{t.z=.5/o}}else if(o>1){t.normalize()}else{t.z=Math.sqrt(1-o*o)}a.copy(n.object.position).sub(n.target);s.copy(n.object.up).setLength(t.y);s.add(e.copy(n.object.up).cross(a).setLength(t.x));s.add(a.setLength(t.z));return s}}();this.rotateCamera=function(){var e=new r.Vector3,t=new r.Quaternion;return function(){var r=Math.acos(f.dot(l)/f.length()/l.length());if(r){e.crossVectors(f,l).normalize();r*=n.rotateSpeed;t.setFromAxisAngle(e,-r);a.applyQuaternion(t);n.object.up.applyQuaternion(t);l.applyQuaternion(t);if(n.staticMoving){f.copy(l)}else{t.setFromAxisAngle(e,r*(n.dynamicDampingFactor-1));f.applyQuaternion(t)}}}}();this.zoomCamera=function(){if(o===i.TOUCH_ZOOM){var e=p/d;p=d;a.multiplyScalar(e)}else{var e=1+(h.y-c.y)*n.zoomSpeed;if(e!==1&&e>0){a.multiplyScalar(e);if(n.staticMoving){c.copy(h)}else{c.y+=(h.y-c.y)*this.dynamicDampingFactor}}}};this.panCamera=function(){var e=new r.Vector2,t=new r.Vector3,i=new r.Vector3;return function(){e.copy(m).sub(v);if(e.lengthSq()){e.multiplyScalar(a.length()*n.panSpeed);i.copy(a).cross(n.object.up).setLength(e.x);i.add(t.copy(n.object.up).setLength(e.y));n.object.position.add(i);n.target.add(i);if(n.staticMoving){v.copy(m)}else{v.add(e.subVectors(m,v).multiplyScalar(n.dynamicDampingFactor))}}}}();this.checkDistances=function(){if(!n.noZoom||!n.noPan){if(a.lengthSq()>n.maxDistance*n.maxDistance){n.object.position.addVectors(n.target,a.setLength(n.maxDistance))}if(a.lengthSq()<n.minDistance*n.minDistance){n.object.position.addVectors(n.target,a.setLength(n.minDistance))}}};this.update=function(){a.subVectors(n.object.position,n.target);if(!n.noRotate){n.rotateCamera()}if(!n.noZoom){n.zoomCamera()}if(!n.noPan){n.panCamera()}n.object.position.addVectors(n.target,a);n.checkDistances();n.object.lookAt(n.target);if(s.distanceToSquared(n.object.position)>0){n.dispatchEvent(g);s.copy(n.object.position)}};this.reset=function(){o=i.NONE;u=i.NONE;n.target.copy(n.target0);n.object.position.copy(n.position0);n.object.up.copy(n.up0);a.subVectors(n.object.position,n.target);n.object.lookAt(n.target);n.dispatchEvent(g);s.copy(n.object.position)};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",S,false);this.domElement.addEventListener("mousewheel",N,false);this.domElement.addEventListener("DOMMouseScroll",N,false);this.domElement.addEventListener("touchstart",C,false);this.domElement.addEventListener("touchend",L,false);this.domElement.addEventListener("touchmove",k,false);window.addEventListener("keydown",w,false);window.addEventListener("keyup",E,false);this.handleResize()};r.TrackballControls.prototype=Object.create(r.EventDispatcher.prototype)},{three:45}],37:[function(e,t,n){(function(){function S(e){}var e=e||{};if(!this.Int32Array){this.Int32Array=Array;this.Float32Array=Array}e.Broadphase=function(){this.world=null};e.Broadphase.prototype.constructor=e.BroadPhase;e.Broadphase.prototype.collisionPairs=function(e){throw"collisionPairs not implemented for this BroadPhase class!"};e.NaiveBroadphase=function(){this.temp={r:new e.Vec3,normal:new e.Vec3,quat:new e.Quaternion,relpos:new e.Vec3}};e.NaiveBroadphase.prototype=new e.Broadphase;e.NaiveBroadphase.prototype.constructor=e.NaiveBroadphase;e.NaiveBroadphase.prototype.collisionPairs=function(t){var n=[],r=[];var i=t.numObjects(),s=t.bodies;var o=e.Shape.types;var u=o.SPHERE|o.BOX|o.COMPOUND|o.CONVEXPOLYHEDRON,a=o.PLANE,f=e.Body.STATIC|e.Body.KINEMATIC;var l=this.temp;var c=l.r,h=l.normal,p=l.quat,d=l.relpos;for(var v=0;v<i;v++){for(var m=0;m<v;m++){var g=s[v],y=s[m];if(((g.motionstate&f)!==0||g.isSleeping())&&((y.motionstate&f)!==0||y.isSleeping())){continue}var b=g.shape,w=y.shape;if(b&&w){var E=b.type,S=w.type;if(E&u&&S&u){y.position.vsub(g.position,c);if(b.boundingSphereRadiusNeedsUpdate)b.computeBoundingSphereRadius();if(w.boundingSphereRadiusNeedsUpdate)w.computeBoundingSphereRadius();var x=b.boundingSphereRadius+w.boundingSphereRadius;if(c.norm2()<x*x){n.push(g);r.push(y)}}else if(E&u&&S&o.PLANE||S&u&&E&o.PLANE){var T=E===a?v:m,N=E!==a?v:m;s[N].position.vsub(s[T].position,c);h.set(0,0,1);s[T].quaternion.vmult(h,h);if(s[N].shape.boundingSphereRadiusNeedsUpdate)s[N].shape.computeBoundingSphereRadius();var C=c.dot(h)-s[N].shape.boundingSphereRadius;if(C<0){n.push(g);r.push(y)}}}else{if(!b&&!w){}else{var k=b?y:g;var L=b?g:y;var A=L.shape;var O=A.type;if(O&u){if(O===o.SPHERE){k.position.vsub(L.position,d);if(A.radius*A.radius>=d.norm2()){n.push(k);r.push(L)}}else if(O===o.CONVEXPOLYHEDRON||O===o.BOX||O===o.COMPOUND){if(A.boundingSphereRadiusNeedsUpdate)A.computeBoundingSphereRadius();var M=A.boundingSphereRadius;k.position.vsub(L.position,d);if(M*M>=d.norm2()){n.push(k);r.push(L)}}}else if(O===o.PLANE){var _=L;h.set(0,0,1);_.quaternion.vmult(h,h);k.position.vsub(_.position,d);if(h.dot(d)<=0){n.push(k);r.push(L)}}}}}}return[n,r]};e.Ray=function(t,n){function m(e,t,n){n.vsub(e,h);d=h.dot(t);t.mult(d,p);p.vadd(e,p);v=n.distanceTo(p);return v}function k(e,t,n,r){r.vsub(t,h);n.vsub(t,N);e.vsub(t,C);g=h.dot(h);y=h.dot(N);b=h.dot(C);w=N.dot(N);E=N.dot(C);S=1/(g*w-y*y);x=(w*b-y*E)*S;T=(g*E-y*b)*S;return x>=0&&T>=0&&x+T<1}this.origin=t||new e.Vec3;this.direction=n||new e.Vec3;var r=1e-4;this.setPrecision=function(e){r=e};var i=new e.Vec3;var s=new e.Vec3;var o=new e.Vec3;var u=new e.Vec3;var a=new e.Vec3;var f=new e.Vec3;var l=new e.Vec3;var c=new e.Vec3;this.intersectBody=function(t){if(t.shape instanceof e.ConvexPolyhedron){return this.intersectShape(t.shape,t.quaternion,t.position,t)}else if(t.shape instanceof e.Box){return this.intersectShape(t.shape.convexPolyhedronRepresentation,t.quaternion,t.position,t)}else console.warn("Ray intersection is this far only implemented for ConvexPolyhedron and Box shapes.")};this.intersectShape=function(t,n,u,a){var h,p=[];if(t instanceof e.ConvexPolyhedron){var d=m(this.origin,this.direction,u);if(d>t.boundingSphereRadius()){return p}var v,g,y=t.faces,b=t.vertices,w=t.faceNormals;for(fi=0;fi<y.length;fi++){var E=y[fi];var S=w[fi];var x=n;var T=u;b[E[0]].copy(f);x.vmult(f,f);f.vadd(T,f);f.vsub(this.origin,f);x.vmult(S,l);v=this.direction.dot(l);if(Math.abs(v)<r)continue;g=l.dot(f)/v;if(g<0)continue;if(v<0){this.direction.mult(g,c);c.vadd(this.origin,c);b[E[0]].copy(i);x.vmult(i,i);T.vadd(i,i);for(var N=1;N<E.length-1;N++){b[E[N]].copy(s);b[E[N+1]].copy(o);x.vmult(s,s);x.vmult(o,o);T.vadd(s,s);T.vadd(o,o);if(k(c,i,s,o)){h={distance:this.origin.distanceTo(c),point:c.copy(),face:E,body:a};p.push(h);break}}}}}return p};this.intersectBodies=function(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=this.intersectBody(e[n]);Array.prototype.push.apply(t,i)}t.sort(function(e,t){return e.distance-t.distance});return t};var h=new e.Vec3,p=new e.Vec3;var d,v;var g,y,b,w,E,S,x,T;var N=new e.Vec3,C=new e.Vec3};e.Ray.prototype.constructor=e.Ray;e.Mat3=function(e){if(e){this.elements=e}else{this.elements=[0,0,0,0,0,0,0,0,0]}};e.Mat3.prototype.identity=function(){this.elements[0]=1;this.elements[1]=0;this.elements[2]=0;this.elements[3]=0;this.elements[4]=1;this.elements[5]=0;this.elements[6]=0;this.elements[7]=0;this.elements[8]=1};e.Mat3.prototype.setZero=function(){var e=this.elements;e[0]=0;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=0;e[6]=0;e[7]=0;e[8]=0};e.Mat3.prototype.setTrace=function(e){this.elements[0]=e.x;this.elements[4]=e.y;this.elements[8]=e.z};e.Mat3.prototype.vmult=function(t,n){n=n||new e.Vec3;var r=this.elements,i=t.x,s=t.y,o=t.z;n.x=r[0]*i+r[1]*s+r[2]*o;n.y=r[3]*i+r[4]*s+r[5]*o;n.z=r[6]*i+r[7]*s+r[8]*o;return n};e.Mat3.prototype.smult=function(e){for(var t=0;t<this.elements.length;t++){this.elements[t]*=e}};e.Mat3.prototype.mmult=function(t){var n=new e.Mat3;for(var r=0;r<3;r++){for(var i=0;i<3;i++){var s=0;for(var o=0;o<3;o++){s+=t.elements[r+o*3]*this.elements[o+i*3]}n.elements[r+i*3]=s}}return n};e.Mat3.prototype.solve=function(t,n){n=n||new e.Vec3;var r=3;var i=4;var s=[];for(var o=0;o<r*i;o++)s.push(0);var o,u;for(o=0;o<3;o++){for(u=0;u<3;u++){s[o+i*u]=this.elements[o+3*u]}}s[3+4*0]=t.x;s[3+4*1]=t.y;s[3+4*2]=t.z;var a=3,f=a,l;var c=4;var h,p;do{o=f-a;if(s[o+i*o]===0){for(u=o+1;u<f;u++){if(s[o+i*u]!==0){l=c;do{h=c-l;s[h+i*o]+=s[h+i*u]}while(--l);break}}}if(s[o+i*o]!==0){for(u=o+1;u<f;u++){var d=s[o+i*u]/s[o+i*o];l=c;do{h=c-l;s[h+i*u]=h<=o?0:s[h+i*u]-s[h+i*o]*d}while(--l)}}}while(--a);n.z=s[2*i+3]/s[2*i+2];n.y=(s[1*i+3]-s[1*i+2]*n.z)/s[1*i+1];n.x=(s[0*i+3]-s[0*i+2]*n.z-s[0*i+1]*n.y)/s[0*i+0];if(isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===Infinity||n.y===Infinity||n.z===Infinity){throw"Could not solve equation! Got x=["+n.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]"}return n};e.Mat3.prototype.e=function(e,t,n){if(n===undefined){return this.elements[t+3*e]}else{this.elements[t+3*e]=n}};e.Mat3.prototype.copy=function(t){t=t||new e.Mat3;for(var n=0;n<this.elements.length;n++){t.elements[n]=this.elements[n]}return t};e.Mat3.prototype.toString=function(){var e="";var t=",";for(var n=0;n<9;n++){e+=this.elements[n]+t}return e};e.Mat3.prototype.reverse=function(t){t=t||new e.Mat3;var n=3;var r=6;var i=[];for(var s=0;s<n*r;s++)i.push(0);var s,o;for(s=0;s<3;s++){for(o=0;o<3;o++){i[s+r*o]=this.elements[s+3*o]}}i[3+6*0]=1;i[3+6*1]=0;i[3+6*2]=0;i[4+6*0]=0;i[4+6*1]=1;i[4+6*2]=0;i[5+6*0]=0;i[5+6*1]=0;i[5+6*2]=1;var u=3,a=u,f;var l=r;var c;do{s=a-u;if(i[s+r*s]===0){for(o=s+1;o<a;o++){if(i[s+r*o]!==0){f=l;do{c=l-f;i[c+r*s]+=i[c+r*o]}while(--f);break}}}if(i[s+r*s]!==0){for(o=s+1;o<a;o++){var h=i[s+r*o]/i[s+r*s];f=l;do{c=l-f;i[c+r*o]=c<=s?0:i[c+r*o]-i[c+r*s]*h}while(--f)}}}while(--u);s=2;do{o=s-1;do{var h=i[s+r*o]/i[s+r*s];f=r;do{c=r-f;i[c+r*o]=i[c+r*o]-i[c+r*s]*h}while(--f)}while(o--)}while(--s);s=2;do{var h=1/i[s+r*s];f=r;do{c=r-f;i[c+r*s]=i[c+r*s]*h}while(--f)}while(s--);s=2;do{o=2;do{c=i[n+o+r*s];if(isNaN(c)||c===Infinity)throw"Could not reverse! A=["+this.toString()+"]";t.e(s,o,c)}while(o--)}while(s--);return t};var n=0;e.Vec3=function(e,t,r){this.x=e||0;this.y=t||0;this.z=r||0;n++};e.Vec3.prototype.cross=function(t,n){var r=t.x,i=t.y,s=t.z,o=this.x,u=this.y,a=this.z;n=n||new e.Vec3;var f=[this.x,this.y,this.z];var l=[t.x,t.y,t.z];n.x=u*s-a*i;n.y=a*r-o*s;n.z=o*i-u*r;return n};e.Vec3.prototype.set=function(e,t,n){this.x=e;this.y=t;this.z=n;return this};e.Vec3.prototype.vadd=function(t,n){if(n){n.x=t.x+this.x;n.y=t.y+this.y;n.z=t.z+this.z}else{return new e.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}};e.Vec3.prototype.vsub=function(t,n){if(n){n.x=this.x-t.x;n.y=this.y-t.y;n.z=this.z-t.z}else{return new e.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}};e.Vec3.prototype.crossmat=function(){return new e.Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])};e.Vec3.prototype.normalize=function(){var e=this.x,t=this.y,n=this.z;var r=Math.sqrt(e*e+t*t+n*n);if(r>0){var i=1/r;this.x*=i;this.y*=i;this.z*=i}else{this.x=0;this.y=0;this.z=0}return r};e.Vec3.prototype.unit=function(t){t=t||new e.Vec3;var n=this.x,r=this.y,i=this.z;var s=Math.sqrt(n*n+r*r+i*i);if(s>0){s=1/s;t.x=n*s;t.y=r*s;t.z=i*s}else{t.x=1;t.y=0;t.z=0}return t};e.Vec3.prototype.norm=function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)};e.Vec3.prototype.norm2=function(){return this.dot(this)};e.Vec3.prototype.distanceTo=function(e){var t=this.x,n=this.y,r=this.z;var i=e.x,s=e.y,o=e.z;return Math.sqrt((i-t)*(i-t)+(s-n)*(s-n)+(o-r)*(o-r))};e.Vec3.prototype.mult=function(t,n){if(!n)n=new e.Vec3;n.x=t*this.x;n.y=t*this.y;n.z=t*this.z;return n};e.Vec3.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z};e.Vec3.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0};e.Vec3.prototype.negate=function(t){t=t||new e.Vec3;t.x=-this.x;t.y=-this.y;t.z=-this.z;return t};var r=new e.Vec3;var s=new e.Vec3;e.Vec3.prototype.tangents=function(e,t){var n=this.norm();if(n>0){var i=r;var o=1/n;i.set(this.x*o,this.y*o,this.z*o);var u=s;if(Math.abs(i.x)<.9){u.set(1,0,0);i.cross(u,e)}else{u.set(0,1,0);i.cross(u,e)}i.cross(e,t)}else{e.set(1,0,0).normalize();t.set(0,1,0).normalize()}};e.Vec3.prototype.toString=function(){return this.x+","+this.y+","+this.z};e.Vec3.prototype.copy=function(t){t=t||new e.Vec3;t.x=this.x;t.y=this.y;t.z=this.z;return t};e.Vec3.prototype.lerp=function(e,t,n){var r=this.x,i=this.y,s=this.z;n.x=r+(e.x-r)*t;n.y=i+(e.y-i)*t;n.z=s+(e.z-s)*t};e.Vec3.prototype.almostEquals=function(e,t){if(t===undefined)t=1e-6;if(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)return false;return true};e.Vec3.prototype.almostZero=function(e){if(e===undefined)e=1e-6;if(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)return false;return true};e.Quaternion=function(e,t,n,r){this.x=e!=undefined?e:0;this.y=t!=undefined?t:0;this.z=n!=undefined?n:0;this.w=r!=undefined?r:1};e.Quaternion.prototype.set=function(e,t,n,r){this.x=e;this.y=t;this.z=n;this.w=r};e.Quaternion.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};e.Quaternion.prototype.setFromAxisAngle=function(e,t){var n=Math.sin(t*.5);this.x=e.x*n;this.y=e.y*n;this.z=e.z*n;this.w=Math.cos(t*.5)};e.Quaternion.prototype.toAxisAngle=function(t){t=t||new e.Vec3;this.normalize();var n=2*Math.acos(this.w);var r=Math.sqrt(1-this.w*this.w);if(r<.001){t.x=this.x;t.y=this.y;t.z=this.z}else{t.x=this.x/r;t.y=this.y/r;t.z=this.z/r}return[t,n]};e.Quaternion.prototype.setFromVectors=function(e,t){var n=e.cross(t);this.x=n.x;this.y=n.y;this.z=n.z;this.w=Math.sqrt(Math.pow(e.norm(),2)*Math.pow(t.norm(),2))+e.dot(t);this.normalize()};var o=new e.Vec3;var u=new e.Vec3;var a=new e.Vec3;e.Quaternion.prototype.mult=function(t,n){var r=this.w;if(n==undefined)n=new e.Quaternion;o.set(this.x,this.y,this.z);u.set(t.x,t.y,t.z);n.w=r*t.w-o.dot(u);o.cross(u,a);n.x=r*u.x+t.w*o.x+a.x;n.y=r*u.y+t.w*o.y+a.y;n.z=r*u.z+t.w*o.z+a.z;return n};e.Quaternion.prototype.inverse=function(t){var n=this.x,r=this.y,i=this.z,s=this.w;if(t==undefined)t=new e.Quaternion;this.conjugate(t);var o=1/(n*n+r*r+i*i+s*s);t.x*=o;t.y*=o;t.z*=o;t.w*=o;return t};e.Quaternion.prototype.conjugate=function(t){if(t==undefined)t=new e.Quaternion;t.x=-this.x;t.y=-this.y;t.z=-this.z;t.w=this.w;return t};e.Quaternion.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(e===0){this.x=0;this.y=0;this.z=0;this.w=0}else{e=1/e;this.x*=e;this.y*=e;this.z*=e;this.w*=e}};e.Quaternion.prototype.normalizeFast=function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;if(e===0){this.x=0;this.y=0;this.z=0;this.w=0}else{this.x*=e;this.y*=e;this.z*=e;this.w*=e}};e.Quaternion.prototype.vmult=function(t,n){n=n||new e.Vec3;if(this.w==0){n.x=t.x;n.y=t.y;n.z=t.z}else{var r=t.x,i=t.y,s=t.z;var o=this.x,u=this.y,a=this.z,f=this.w;var l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;n.x=l*f+p*-o+c*-a-h*-u;n.y=c*f+p*-u+h*-o-l*-a;n.z=h*f+p*-a+l*-u-c*-o}return n};e.Quaternion.prototype.copy=function(e){e.x=this.x;e.y=this.y;e.z=this.z;e.w=this.w};e.Quaternion.prototype.toEuler=function(e,t){t=t||"YZX";var n,r,i;var s=this.x,o=this.y,u=this.z,a=this.w;switch(t){case"YZX":var f=s*o+u*a;if(f>.499){n=2*Math.atan2(s,a);r=Math.PI/2;i=0}if(f<-.499){n=-2*Math.atan2(s,a);r=-Math.PI/2;i=0}if(isNaN(n)){var l=s*s;var c=o*o;var h=u*u;n=Math.atan2(2*o*a-2*s*u,1-2*c-2*h);r=Math.asin(2*f);i=Math.atan2(2*s*a-2*o*u,1-2*l-2*h)}break;default:throw new Error("Euler order "+t+" not supported yet.");break}e.y=n;e.z=r;e.x=i};e.Shape=function(){this.type=0;this.aabbmin=new e.Vec3;this.aabbmax=new e.Vec3;this.boundingSphereRadius=0;this.boundingSphereRadiusNeedsUpdate=true};e.Shape.prototype.constructor=e.Shape;e.Shape.prototype.computeBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type};e.Shape.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type};e.Shape.prototype.calculateLocalInertia=function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type};e.Shape.prototype.calculateTransformedInertia=function(t,n,r){if(r==undefined)r=new e.Vec3;n.normalize();var i=new e.Vec3;this.calculateLocalInertia(t,i);var s=n.vmult(i);r.x=Math.abs(s.x);r.y=Math.abs(s.y);r.z=Math.abs(s.z);return r};e.Shape.calculateLocalAABB=function(){throw new Error(".calculateLocalAABB is not implemented for this Shape yet!")};e.Shape.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16};e.Body=function(t){e.EventTarget.apply(this);this.type=t;var n=this;this.world=null;this.preStep=null;this.postStep=null;this.vlambda=new e.Vec3};e.Body.DYNAMIC=1;e.Body.STATIC=2;e.Body.KINEMATIC=4;e.Particle=function(t,n){if(typeof t!="number")throw new Error("Argument 1 (mass) must be a number.");if(typeof n!="undefined"&&!(n instanceof e.Material))throw new Error("Argument 3 (material) must be an instance of CANNON.Material.");e.Body.call(this,"particle");var r=this;this.position=new e.Vec3;this.initPosition=new e.Vec3;this.velocity=new e.Vec3;this.initVelocity=new e.Vec3;this.force=new e.Vec3;this.mass=t;this.invMass=t>0?1/t:0;this.material=n;this.linearDamping=.01;this.motionstate=t<=0?e.Body.STATIC:e.Body.DYNAMIC;this.allowSleep=true;this.sleepState=0;this.isAwake=function(){return r.sleepState==0};this.isSleepy=function(){return r.sleepState==1};this.isSleeping=function(){return r.sleepState==2};this.sleepSpeedLimit=.1;this.sleepTimeLimit=1;this.timeLastSleepy=0;this.wakeUp=function(){r.sleepState=0;r.dispatchEvent({type:"wakeup"})};this.sleep=function(){r.sleepState=2};this.sleepTick=function(e){if(r.allowSleep){var t=r.sleepState;var n=r.velocity.norm2();var i=Math.pow(r.sleepSpeedLimit,2);if(t==0&&n<i){r.sleepState=1;r.timeLastSleepy=e;r.dispatchEvent({type:"sleepy"})}else if(t==1&&n>i){r.wakeUp()}else if(t==1&&e-r.timeLastSleepy>r.sleepTimeLimit){r.sleepState=2;r.dispatchEvent({type:"sleep"})}}}};e.RigidBody=function(t,n,r){if(typeof t!="number")throw new Error("Argument 1 (mass) must be a number.");if(typeof r!="undefined"&&!(r instanceof e.Material))throw new Error("Argument 3 (material) must be an instance of CANNON.Material.");e.Particle.call(this,t,r);var i=this;this.tau=new e.Vec3;this.quaternion=new e.Quaternion;this.initQuaternion=new e.Quaternion;this.angularVelocity=new e.Vec3;this.initAngularVelocity=new e.Vec3;this.shape=n;this.inertia=new e.Vec3;n.calculateLocalInertia(t,this.inertia);this.inertiaWorld=new e.Vec3;this.inertia.copy(this.inertiaWorld);this.inertiaWorldAutoUpdate=false;this.invInertia=new e.Vec3(this.inertia.x>0?1/this.inertia.x:0,this.inertia.y>0?1/this.inertia.y:0,this.inertia.z>0?1/this.inertia.z:0);this.invInertiaWorld=new e.Vec3;this.invInertia.copy(this.invInertiaWorld);this.invInertiaWorldAutoUpdate=false;this.angularDamping=.01;this.aabbmin=new e.Vec3;this.aabbmax=new e.Vec3;this.calculateAABB();this.wlambda=new e.Vec3};e.RigidBody.constructor=e.RigidBody;e.RigidBody.prototype.calculateAABB=function(){this.shape.calculateWorldAABB(this.position,this.quaternion,this.aabbmin,this.aabbmax)};e.RigidBody.prototype.applyImpulse=function(t,n,r){r=r||1/60;var i=new e.Vec3,s=new e.Vec3;t.vsub(this.position,i);i.cross(n,s);this.velocity.vadd(n.mult(r),this.velocity);this.angularVelocity.vadd(s.mult(r),this.angularVelocity)};e.Sphere=function(t){e.Shape.call(this);this.radius=t!=undefined?Number(t):1;this.type=e.Shape.types.SPHERE};e.Sphere.prototype=new e.Shape;e.Sphere.prototype.constructor=e.Sphere;e.Sphere.prototype.calculateLocalInertia=function(t,n){n=n||new e.Vec3;var r=2*t*this.radius*this.radius/5;n.x=r;n.y=r;n.z=r;return n};e.Sphere.prototype.volume=function(){return 4*Math.PI*this.radius/3};e.Sphere.prototype.computeBoundingSphereRadius=function(){this.boundingSphereRadiusNeedsUpdate=false;this.boundingSphereRadius=this.radius};e.Sphere.prototype.calculateWorldAABB=function(e,t,n,r){var i=this.radius;var s=["x","y","z"];for(var o=0;o<s.length;o++){var u=s[o];n[u]=e[u]-i;r[u]=e[u]+i}};e.Box=function(t){e.Shape.call(this);this.halfExtents=t;this.type=e.Shape.types.BOX;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation()};e.Box.prototype=new e.Shape;e.Box.prototype.constructor=e.Box;e.Box.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x;var n=this.halfExtents.y;var r=this.halfExtents.z;var i=e.Vec3;var s=new e.ConvexPolyhedron([new i(-t,-n,-r),new i(t,-n,-r),new i(t,n,-r),new i(-t,n,-r),new i(-t,-n,r),new i(t,-n,r),new i(t,n,r),new i(-t,n,r)],[[0,1,2,3],[4,5,6,7],[0,1,5,4],[2,3,7,6],[0,3,7,4],[1,2,6,5]],[new i(0,0,-1),new i(0,0,1),new i(0,-1,0),new i(0,1,0),new i(-1,0,0),new i(1,0,0)]);this.convexPolyhedronRepresentation=s};e.Box.prototype.calculateLocalInertia=function(t,n){n=n||new e.Vec3;var r=this.halfExtents;n.x=1/12*t*(2*r.y*2*r.y+2*r.z*2*r.z);n.y=1/12*t*(2*r.x*2*r.x+2*r.z*2*r.z);n.z=1/12*t*(2*r.y*2*r.y+2*r.x*2*r.x);return n};e.Box.prototype.getSideNormals=function(e,t){var n=e;var r=this.halfExtents;n[0].set(r.x,0,0);n[1].set(0,r.y,0);n[2].set(0,0,r.z);n[3].set(-r.x,0,0);n[4].set(0,-r.y,0);n[5].set(0,0,-r.z);if(t!=undefined){for(var i=0;i<n.length;i++)t.vmult(n[i],n[i])}return n};e.Box.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};e.Box.prototype.computeBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm();this.boundingSphereRadiusNeedsUpdate=false};var f=new e.Vec3;var l=new e.Vec3;e.Box.prototype.forEachWorldCorner=function(e,t,n){var r=this.halfExtents;var i=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(var s=0;s<i.length;s++){f.set(i[s][0],i[s][1],i[s][2]);t.vmult(f,f);e.vadd(f,f);n(f.x,f.y,f.z)}};e.Box.prototype.calculateWorldAABB=function(e,t,n,r){n.set(Infinity,Infinity,Infinity);r.set(-Infinity,-Infinity,-Infinity);this.forEachWorldCorner(e,t,function(e,t,i){if(e>r.x)r.x=e;if(t>r.y)r.y=t;if(i>r.z)r.z=i;if(e<n.x)n.x=e;if(t<n.y)n.y=t;if(i<n.z)n.z=i})};e.Plane=function(){e.Shape.call(this);this.type=e.Shape.types.PLANE};e.Plane.prototype=new e.Shape;e.Plane.prototype.constructor=e.Plane;e.Plane.prototype.calculateLocalInertia=function(t,n){n=n||new e.Vec3;return n};e.Plane.prototype.volume=function(){return Infinity};var c=new e.Vec3(0,0,1);e.Plane.prototype.calculateWorldAABB=function(e,t,n,r){t.vmult(c,c);n.set(Infinity,Infinity,Infinity);var i=["x","y","z"];for(var s=0;s<i.length;s++){var o=i[s];if(c[o]==1)r[o]=e[o];if(c[o]==-1)n[o]=e[o]}};e.Compound=function(){e.Shape.call(this);this.type=e.Shape.types.COMPOUND;this.childShapes=[];this.childOffsets=[];this.childOrientations=[]};e.Compound.prototype=new e.Shape;e.Compound.prototype.constructor=e.Compound;e.Compound.prototype.addChild=function(t,n,r){n=n||new e.Vec3;r=r||new e.Quaternion;this.childShapes.push(t);this.childOffsets.push(n);this.childOrientations.push(r)};e.Compound.prototype.volume=function(){var e=0;for(var t=0;t<this.childShapes.length;t++)e+=this.childShapes[t].volume();return e};var h=new e.Vec3;var p=new e.Vec3;e.Compound.prototype.calculateLocalInertia=function(t,n){n=n||new e.Vec3;var r=this.volume();var i=p;for(var s=0,o=this.childShapes.length;s!==o;s++){var u=this.childShapes[s];var a=this.childOffsets[s];var f=this.childOrientations[s];var l=u.volume()/r*t;u.calculateLocalInertia(l,i);n.vadd(i,n);var c=h;c.set(l*a.x*a.x,l*a.y*a.y,l*a.z*a.z);n.vadd(c,n)}return n};e.Compound.prototype.computeBoundingSphereRadius=function(){var e=0;for(var t=0;t<this.childShapes.length;t++){var n=this.childShapes[t];if(n.boundingSphereRadiusNeedsUpdate)n.computeBoundingSphereRadius();var r=this.childOffsets[t].norm()+n.boundingSphereRadius;if(e<r)e=r}this.boundingSphereRadius=e;this.boundingSphereRadiusNeedsUpdate=false};var d=new e.Vec3;var v=new e.Vec3;var m=new e.Vec3;var g=new e.Quaternion;e.Compound.prototype.calculateWorldAABB=function(e,t,n,r){var i=this.childShapes.length;n.set(Infinity,Infinity,Infinity);r.set(-Infinity,-Infinity,-Infinity);for(var s=0;s<i;s++){this.childOffsets[s].copy(m);t.vmult(m,m);e.vadd(m,m);t.mult(this.childOrientations[s],g);this.childShapes[s].calculateWorldAABB(m,g,v,d);if(v.x<n.x)n.x=v.x;if(v.y<n.y)n.y=v.y;if(v.z<n.z)n.z=v.z;if(d.x>r.x)r.x=d.x;if(d.y>r.y)r.y=d.y;if(d.z>r.z)r.z=d.z}};e.ConvexPolyhedron=function(t,n,r){function g(e,t,n,r,i){var s=e.vertices.length;var o=null;var u=null;var a=e.vertices;for(var f=0;f<s;f++){a[f].copy(m);r.vmult(m,m);m.vadd(n,m);var l=m.dot(t);if(o===null||l>o)o=l;if(u===null||l<u)u=l}if(u>o){var c=u;u=o;o=c}i[0]=o;i[1]=u}function D(e,t){var n=i.faces[e];var r=i.vertices[n[0]];var s=i.vertices[n[1]];var o=i.vertices[n[2]];return j(r,s,o,t)}function P(e,t){var n=i.faces[e];var r=i.faceNormals[e];var s=i.vertices[n[0]];var o=-r.dot(s);return o}function j(e,t,n,r){t.vsub(e,B);n.vsub(t,H);H.cross(B,r);if(!r.isZero()){r.normalize()}}function F(e){var t=i.faces[e],n="";for(var r=0;r<t.length;r++)n+=" ("+i.vertices[t[r]]+")";return n}function I(e,t){return e[0]===t[1]&&e[1]===t[0]}function q(){return(Math.random()-.5)*2*1e-6}var i=this;e.Shape.call(this);this.type=e.Shape.types.CONVEXPOLYHEDRON;this.vertices=t||[];this.faces=n||[];this.faceNormals=r||[];for(var s=0;s<this.faceNormals.length;s++)this.faceNormals[s].normalize();this.uniqueEdges=[];var o=this.vertices.length;for(var u=0;u<o;u++){var a=this.vertices[u];if(!(a instanceof e.Vec3)){throw"Argument 1 must be instance of CANNON.Vec3";return false}this.uniqueEdges.push(a)}for(var s=0;s<this.faces.length;s++){var f=this.faces[s].length;var l=f;for(var c=0;c<l;c++){var h=(c+1)%f;var p=new e.Vec3;this.vertices[this.faces[s][c]].vsub(this.vertices[this.faces[s][h]],p);p.normalize();var d=false;for(var a=0;a<this.uniqueEdges.length;a++){if(this.uniqueEdges[a].almostEquals(p)||this.uniqueEdges[a].almostEquals(p)){d=true;break}}if(!d){this.uniqueEdges.push(p)}if(p){p.face1=s}else{var v;v.m_face0=s;edges.insert(vp,v)}}}var m=new e.Vec3;this.testSepAxis=function(e,t,n,r,i,s){var o=[],u=[],a=this;g(a,e,n,r,o);g(t,e,i,s,u);var f=o[0];var l=o[1];var c=u[0];var h=u[1];if(f<h||c<l){return false}var p=f-h;var d=c-l;depth=p<d?p:d;return depth};var y=new e.Vec3;var b=new e.Vec3;var w=new e.Vec3;var E=new e.Vec3;var S=new e.Vec3;var x=new e.Vec3;this.findSeparatingAxis=function(e,t,n,r,i,s){var o=Infinity;var u=this;var a=0;var f=u.faces.length;for(var l=0;l<f;l++){u.faceNormals[l].copy(y);n.vmult(y,y);var c=u.testSepAxis(y,e,t,n,r,i);if(c===false){return false}if(c<o){o=c;y.copy(s)}}var h=e.faces.length;for(var l=0;l<h;l++){e.faceNormals[l].copy(b);i.vmult(b,b);a++;var c=u.testSepAxis(b,e,t,n,r,i);if(c===false){return false}if(c<o){o=c;b.copy(s)}}var p,d,v,m;var g=0;for(var T=0;T<u.uniqueEdges.length;T++){u.uniqueEdges[T].copy(E);n.vmult(E,E);for(var N=0;N<e.uniqueEdges.length;N++){e.uniqueEdges[N].copy(S);i.vmult(S,S);E.cross(S,x);g++;if(!x.almostZero()){x.normalize();var C=u.testSepAxis(x,e,t,n,r,i);if(C===false){return false}if(C<o){o=C;x.copy(s)}}}}r.vsub(t,w);if(w.dot(s)>0)s.negate(s);return true};var T=new e.Vec3;this.clipAgainstHull=function(t,n,r,i,s,o,u,a,f){if(!(t instanceof e.Vec3))throw new Error("posA must be Vec3");if(!(n instanceof e.Quaternion))throw new Error("quatA must be Quaternion");var l=this;var c=a;var h=-1;var p=-Infinity;for(var d=0;d<r.faces.length;d++){r.faceNormals[d].copy(T);s.vmult(T,T);var v=T.dot(o);if(v>p){p=v;h=d}}var m=[];polyB=r.faces[h];var g=polyB.length;for(var y=0;y<g;y++){var b=r.vertices[polyB[y]];var w=new e.Vec3;b.copy(w);s.vmult(w,w);i.vadd(w,w);m.push(w)}if(h>=0)this.clipFaceAgainstHull(o,t,n,m,u,a,f)};var N=new e.Vec3;var C=new e.Vec3;var k=new e.Vec3;var L=new e.Vec3;var A=new e.Vec3;var O=new e.Vec3;var M=new e.Vec3;var _=new e.Vec3;this.clipFaceAgainstHull=function(t,n,r,i,s,o,u){if(!(t instanceof e.Vec3))throw new Error("sep normal must be vector");if(!(i instanceof Array))throw new Error("world verts must be array");s=Number(s);o=Number(o);var a=this;var f=[];var l=i;var c=f;var h=-1;var p=Infinity;for(var d=0;d<a.faces.length;d++){a.faceNormals[d].copy(N);r.vmult(N,N);var v=N.dot(t);if(v<p){p=v;h=d}}if(h<0){console.log("--- did not find any closest face... ---");return}var m=a.faces[h];m.connectedFaces=[];for(var g=0;g<a.faces.length;g++)for(var y=0;y<a.faces[g].length;y++)if(m.indexOf(a.faces[g][y])!==-1&&g!==h&&m.connectedFaces.indexOf(g)===-1)m.connectedFaces.push(g);var b=l.length;var w=m.length;var E=[];for(var S=0;S<w;S++){var x=a.vertices[m[S]];var T=a.vertices[m[(S+1)%w]];x.vsub(T,C);C.copy(k);r.vmult(k,k);n.vadd(k,k);this.faceNormals[h].copy(L);r.vmult(L,L);n.vadd(L,L);k.cross(L,A);A.negate(A);x.copy(O);r.vmult(O,O);n.vadd(O,O);var D=-O.dot(A);var H;if(true){var B=m.connectedFaces[S];this.faceNormals[B].copy(M);var j=P(B);M.copy(_);r.vmult(_,_);var H=j-_.dot(n)}else{A.copy(_);H=D}this.clipFaceAgainstPlane(l,c,_,H);while(l.length)l.shift();while(c.length)l.push(c.shift())}this.faceNormals[h].copy(M);var j=P(h);M.copy(_);r.vmult(_,_);var H=j-_.dot(n);for(var g=0;g<l.length;g++){var F=_.dot(l[g])+H;if(F<=s){console.log("clamped: depth="+F+" to minDist="+(s+""));F=s}if(F<=o){var I=l[g];if(F<=0){var q={point:I,normal:_,depth:F};u.push(q)}}}};this.clipFaceAgainstPlane=function(t,n,r,i){if(!(r instanceof e.Vec3))throw new Error("planeNormal must be Vec3, "+r+" given");if(!(t instanceof Array))throw new Error("invertices must be Array, "+t+" given");if(!(n instanceof Array))throw new Error("outvertices must be Array, "+n+" given");var s,o;var u=t.length;if(u<2)return n;var a=t[t.length-1];var f=t[0];s=r.dot(a)+i;for(var l=0;l<u;l++){f=t[l];o=r.dot(f)+i;if(s<0){if(o<0){var c=new e.Vec3;f.copy(c);n.push(c)}else{var c=new e.Vec3;a.lerp(f,s/(s-o),c);n.push(c)}}else{if(o<0){var c=new e.Vec3;a.lerp(f,s/(s-o),c);n.push(c);n.push(f)}}a=f;s=o}return n};var i=this;var H=new e.Vec3;var B=new e.Vec3;this.calculateLocalInertia=function(e,t){i.computeAABB();var n=this.aabbmax.x-this.aabbmin.x,r=this.aabbmax.y-this.aabbmin.y,s=this.aabbmax.z-this.aabbmin.z;t.x=1/12*e*(2*r*2*r+2*s*2*s);t.y=1/12*e*(2*n*2*n+2*s*2*s);t.z=1/12*e*(2*r*2*r+2*n*2*n)};var R=new e.Vec3;this.computeAABB=function(){var e=this.vertices.length,t=this.aabbmin,n=this.aabbmax,r=this.vertices;t.set(Infinity,Infinity,Infinity);n.set(-Infinity,-Infinity,-Infinity);for(var i=0;i<e;i++){var s=r[i];if(s.x<t.x)t.x=s.x;else if(s.x>n.x)n.x=s.x;if(s.y<t.y)t.y=s.y;else if(s.y>n.y)n.y=s.y;if(s.z<t.z)t.z=s.z;else if(s.z>n.z)n.z=s.z}}};e.ConvexPolyhedron.prototype=new e.Shape;e.ConvexPolyhedron.prototype.constructor=e.ConvexPolyhedron;e.ConvexPolyhedron.prototype.computeBoundingSphereRadius=function(){var e=0;var t=this.vertices;for(var n=0,r=t.length;n!==r;n++){var i=t[n].norm2();if(i>e)e=i}this.boundingSphereRadius=Math.sqrt(e);this.boundingSphereRadiusNeedsUpdate=false};var y=new e.Vec3;e.ConvexPolyhedron.prototype.calculateWorldAABB=function(e,t,n,r){var i=this.vertices.length,s=this.vertices;var o,u,a,f,l,c;for(var h=0;h<i;h++){s[h].copy(y);t.vmult(y,y);e.vadd(y,y);var p=y;if(p.x<o||o===undefined)o=p.x;else if(p.x>f||f===undefined)f=p.x;if(p.y<u||u===undefined)u=p.y;else if(p.y>l||l===undefined)l=p.y;if(p.z<a||a===undefined)a=p.z;else if(p.z>c||c===undefined)c=p.z}n.set(o,u,a);r.set(f,l,c)};e.ConvexPolyhedron.prototype.volume=function(){if(this.boundingSphereRadiusNeedsUpdate)this.computeBoundingSphereRadius();return 4*Math.PI*this.boundingSphereRadius/3};e.ConvexPolyhedron.prototype.getAveragePointLocal=function(t){t=t||new e.Vec3;var n=this.vertices.length,r=this.vertices;for(var i=0;i<n;i++){t.vadd(r[i],t)}t.mult(1/n,t);return t};e.ConvexPolyhedron.prototype.transformAllPoints=function(e,t){var n=this.vertices.length,r=this.vertices;if(t){for(var i=0;i<n;i++){var s=r[i];t.vmult(s,s)}}if(e){for(var i=0;i<n;i++){var s=r[i];s.vadd(e,s)}}};var b=new e.Vec3;var w=new e.Vec3;var E=new e.Vec3;e.ConvexPolyhedron.prototype.pointIsInside=function(e){var t=this.vertices.length,n=this.vertices,r=this.faces,i=this.faceNormals;var s=null;var o=this.faces.length;var u=b;this.getAveragePointLocal(u);for(var a=0;a<o;a++){var f=this.faces[a].length;var t=i[a];var l=n[r[a][0]];var c=w;e.vsub(l,c);var h=t.dot(c);var p=E;u.vsub(l,p);var d=t.dot(p);if(h<0&&d>0||h>0&&d<0){return false}else{}}return s?1:-1};e.Cylinder=function(t,n,r,i){var s=i,o=[],u=[],a=[],f=[],l=[],c=Math.cos,h=Math.sin;o.push(new e.Vec3(n*c(0),n*h(0),-r*.5));f.push(0);o.push(new e.Vec3(t*c(0),t*h(0),r*.5));l.push(1);for(var p=0;p<s;p++){var d=2*Math.PI/s*(p+1);var v=2*Math.PI/s*(p+.5);if(p<s-1){o.push(new e.Vec3(n*c(d),n*h(d),-r*.5));f.push(2*(p+1));o.push(new e.Vec3(t*c(d),t*h(d),r*.5));l.push(2*(p+1)+1);u.push(new e.Vec3(c(v),h(v),0));a.push([2*p,2*p+1,2*(p+1),2*(p+1)+1])}else{a.push([2*p,2*p+1,0,1]);u.push(new e.Vec3(c(v),h(v),0))}}a.push(l);u.push(new e.Vec3(0,0,1));a.push(f);u.push(new e.Vec3(0,0,-1));this.type=e.Shape.types.CONVEXPOLYHEDRON;e.ConvexPolyhedron.call(this,o,a,u)};e.Cylinder.prototype=new e.ConvexPolyhedron;e.Solver=function(){this.equations=[]};e.Solver.prototype.solve=function(e,t){return 0};e.Solver.prototype.addEquation=function(e){this.equations.push(e)};e.Solver.prototype.removeEquation=function(e){var t=this.equations.indexOf(e);if(t!=-1)this.equations.splice(t,1)};e.Solver.prototype.removeAllEquations=function(){this.equations=[]};e.GSSolver=function(){e.Solver.call(this);this.iterations=10;this.tolerance=0};e.GSSolver.prototype=new e.Solver;e.GSSolver.prototype.solve=function(e,t){var n=this.d,r=this.k,i=0,s=this.iterations,o=this.tolerance*this.tolerance,u=this.a,a=this.b,f=this.equations,l=f.length,c=t.bodies,h=t.bodies.length,p=e;var d=[];var v=[];var m=[];for(var g=0;g!==l;g++){var y=f[g];if(y.spookParamsNeedsUpdate){y.updateSpookParams(p);y.spookParamsNeedsUpdate=false}m.push(0);v.push(y.computeB(p));d.push(1/y.computeC())}var b,w,y,E,S,x,T,N;if(l!==0){var g,C,k=Math.abs;for(g=0;g!==h;g++){var a=c[g],L=a.vlambda,A=a.wlambda;L.set(0,0,0);if(A)A.set(0,0,0)}for(i=0;i!==s;i++){x=0;for(C=0;C!==l;C++){y=f[C];w=v[C];E=d[C];N=m[C];T=y.computeGWlambda(y.eps);S=E*(w-T-y.eps*N);if(N+S<y.minForce){S=y.minForce-N}else if(N+S>y.maxForce){S=y.maxForce-N}m[C]+=S;x+=k(S);y.addToWlambda(S)}if(x*x<o)break}for(g=0;g!==h;g++){var a=c[g],O=a.velocity,M=a.angularVelocity;O.vadd(a.vlambda,O);if(M)M.vadd(a.wlambda,M)}}errorTot=x;return i};e.SplitSolver=function(t){e.Solver.call(this);this.subsolver=t};e.SplitSolver.prototype=new e.Solver;e.SplitSolver.prototype.solve=function(t,n){function m(e){var t=e.length;for(var n=0;n<t;n++){var r=e[n];if(!r.visited&&!(r.body.motionstate&v))return r}return false}function g(e,t){var n=[];n.push(e);e.visited=true;t(e);while(n.length){var r=n.pop();var i;while(i=m(r.children)){i.visited=true;t(i);n.push(i)}}}var r=[],i=n.bodies,s=this.equations,o=s.length,u=i.length,a=this.subsolver;for(var f=0;f<u;f++)r.push({body:i[f],children:[],eqs:[],visited:false});for(var l=0;l<o;l++){var c=s[l],f=i.indexOf(c.bi),h=i.indexOf(c.bj),p=r[f],d=r[h];p.children.push(d);p.eqs.push(c);d.children.push(p);d.eqs.push(c)}var v=e.Body.STATIC;var y,b=0;while(y=m(r)){var w=[],E=[];g(y,function(e){E.push(e.body);for(var t=0;t<e.eqs.length;t++)if(w.indexOf(e.eqs[t])==-1)w.push(e.eqs[t])});for(var f=0;f<w.length;f++)a.addEquation(w[f]);var S=a.solve(t,{bodies:E});a.removeAllEquations();b++}return b};e.EventTarget=function(){var e={};this.addEventListener=function(t,n){if(e[t]==undefined){e[t]=[]}if(e[t].indexOf(n)===-1){e[t].push(n)}};this.dispatchEvent=function(t){for(var n in e[t.type]){e[t.type][n](t)}};this.removeEventListener=function(t,n){var r=e[t].indexOf(n);if(r!==-1){e[t].splice(r,1)}}};e.ObjectPool=function(){this.objects=[];this.type=Object};e.ObjectPool.prototype.release=function(){for(var e in arguments)this.objects.push(arguments[e])};e.ObjectPool.prototype.get=function(){if(this.objects.length===0)return this.constructObject();else return this.objects.pop()};e.ObjectPool.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this ObjectPool subclass yet!")};e.Vec3Pool=function(){e.ObjectPool.call(this);this.type=e.Vec3};e.Vec3Pool.prototype=new e.ObjectPool;e.Vec3Pool.prototype.constructObject=function(){return new e.Vec3};e.Material=function(e){this.name=e;this.id=-1};e.ContactMaterial=function(e,t,n,r){this.id=-1;this.materials=[e,t];this.friction=n!=undefined?Number(n):.3;this.restitution=r!=undefined?Number(r):.3;this.contactEquationStiffness=1e7;this.contactEquationRegularizationTime=3;this.frictionEquationStiffness=1e7;this.frictionEquationRegularizationTime=3};e.World=function(){e.EventTarget.apply(this);this.allowSleep=false;this.contacts=[];this.frictionEquations=[];this.frictionEquationPool=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=false;this.time=0;this.stepnumber=0;this.default_dt=1/60;this.last_dt=this.default_dt;this.nextId=0;this.gravity=new e.Vec3;this.broadphase=null;this.bodies=[];var t=this;this.solver=new e.GSSolver;this.constraints=[];this.contactgen=new e.ContactGenerator;this.collision_matrix=[];this.materials=[];this.contactmaterials=[];this.mats2cmat=[];this.defaultMaterial=new e.Material("default");this.defaultContactMaterial=new e.ContactMaterial(this.defaultMaterial,this.defaultMaterial,.3,0);this.temp={gvec:new e.Vec3,vi:new e.Vec3,vj:new e.Vec3,wi:new e.Vec3,wj:new e.Vec3,t1:new e.Vec3,t2:new e.Vec3,rixn:new e.Vec3,rjxn:new e.Vec3,step_q:new e.Quaternion,step_w:new e.Quaternion,step_wq:new e.Quaternion};this.doProfiling=false;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,nearphase:0}};e.World.prototype.getContactMaterial=function(t,n){if(t instanceof e.Material&&n instanceof e.Material){var r=t.id;var i=n.id;if(r<i){var s=r;r=i;i=s}return this.contactmaterials[this.mats2cmat[r+i*this.materials.length]]}};e.World.prototype.numObjects=function(){return this.bodies.length};e.World.prototype.clearCollisionState=function(e){var t=this.numObjects();var n=e.id;for(var r=0;r<t;r++){var i=r;if(n>i)cm[i+n*t]=0;else cm[n+i*t]=0}};e.World.prototype.collisionMatrixGet=function(e,t,n){var r=this.bodies.length;if(typeof n=="undefined")n=true;if(n&&e<t||!n&&e>t){var i=t;t=e;e=i}return this.collision_matrix[e+t*r]};e.World.prototype.collisionMatrixSet=function(e,t,n,r){var i=this.bodies.length;if(typeof r==="undefined")r=true;if(r&&e<t||!r&&e>t){var s=t;t=e;e=s}this.collision_matrix[e+t*i]=n};e.World.prototype.collisionMatrixTick=function(){var e=this.bodies.length;for(var t=0;t<e;t++){for(var n=0;n<t;n++){var r=this.collisionMatrixGet(t,n,true);this.collisionMatrixSet(t,n,r,false);this.collisionMatrixSet(t,n,0,true)}}};e.World.prototype.add=function(t){var n=this.numObjects();this.bodies.push(t);t.id=this.id();t.world=this;t.position.copy(t.initPosition);t.velocity.copy(t.initVelocity);t.timeLastSleepy=this.time;if(t instanceof e.RigidBody){t.angularVelocity.copy(t.initAngularVelocity);t.quaternion.copy(t.initQuaternion)}for(var r=0;r<2*n+1;r++)this.collision_matrix.push(0)};e.World.prototype.addConstraint=function(e){this.constraints.push(e);e.id=this.id()};e.World.prototype.removeConstraint=function(e){var t=this.constraints.indexOf(e);if(t!=-1)this.constraints.splice(t,1)};e.World.prototype.id=function(){return this.nextId++};e.World.prototype.remove=function(e){e.world=null;var t=this.numObjects();var n=this.bodies;for(var r in n)if(n[r].id==e.id)n.splice(r,1);for(var r=0;r<2*t-1;r++)this.collision_matrix.pop()};e.World.prototype.addMaterial=function(e){if(e.id==-1){var t=this.materials.length;this.materials.push(e);e.id=this.materials.length-1;if(true){for(var n=0;n<2*t+1;n++)this.mats2cmat.push(-1)}else{var r=new Int16Array(this.materials.length*this.materials.length);for(var n=0;n<r.length;n++)r[n]=-1;for(var n=0;n<this.materials.length-1;n++)for(var i=0;i<this.materials.length-1;i++)r[n+this.materials.length*i]=this.mats2cmat[n+(this.materials.length-1)*i];this.mats2cmat=r}}};e.World.prototype.addContactMaterial=function(e){this.addMaterial(e.materials[0]);this.addMaterial(e.materials[1]);if(e.materials[0].id>e.materials[1].id){i=e.materials[0].id;j=e.materials[1].id}else{j=e.materials[0].id;i=e.materials[1].id}this.contactmaterials.push(e);e.id=this.contactmaterials.length-1;this.mats2cmat[i+this.materials.length*j]=e.id};e.World.prototype._now=function(){if(window.performance.webkitNow)return window.performance.webkitNow();else return Date.now()};e.World.prototype.step=function(t){var n=this,r=this,i=this.numObjects(),s=this.bodies,o=this.solver,u=this.gravity,a=this.doProfiling,f=this.profile,l=e.Body.DYNAMIC,c=this._now,h,p=this.collision_matrix,d=this.constraints,v=e.FrictionEquation;if(a)h=c();if(t===undefined){if(this.last_dt)t=this.last_dt;else t=this.default_dt}var m=u.x,g=u.y,y=u.z;for(var b=0;b!==i;b++){var w=s[b];if(w.motionstate&l){var E=w.force,S=w.mass;E.x+=S*m;E.y+=S*g;E.z+=S*y}}if(a)h=c();var x=this.broadphase.collisionPairs(this);var T=x[0];var N=x[1];if(a)f.broadphase=c()-h;this.collisionMatrixTick();if(a)h=c();var C=this.contacts;this.contacts=[];this.contactgen.getContacts(T,N,this,this.contacts,C);if(a)f.nearphase=c()-h;if(a)h=c();var k=this.temp;var L=this.contacts;var A=L.length;this.frictionEquationPool=this.frictionEquationPool.concat(this.frictionEquations);this.frictionEquations=[];for(var O=0;O!==A;O++){var M=L[O];var w=M.bi,_=M.bj;var b=s.indexOf(w),D=s.indexOf(_);var p=this.getContactMaterial(w.material,_.material)||this.defaultContactMaterial;var P=p.friction;var H=p.restitution;var B=k.gvec;B.set(_.position.x+M.rj.x-w.position.x-M.ri.x,_.position.y+M.rj.y-w.position.y-M.ri.y,_.position.z+M.rj.z-w.position.z-M.ri.z);var j=B.dot(M.ni);if(j<0){M.restitution=p.restitution;M.penetration=j;M.stiffness=p.contactEquationStiffness;M.regularizationTime=p.contactEquationRegularizationTime;o.addEquation(M);if(P>0){var F=P*u.norm();var I=w.invMass+_.invMass;if(I!=0)I=1/I;var q=this.frictionEquationPool;var R=q.length?q.pop():new v(w,_,F*I);var U=q.length?q.pop():new v(w,_,F*I);this.frictionEquations.push(R);this.frictionEquations.push(U);R.bi=U.bi=w;R.bj=U.bj=_;R.minForce=U.minForce=-F*I;R.maxForce=U.maxForce=F*I;M.ri.copy(R.ri);M.rj.copy(R.rj);M.ri.copy(U.ri);M.rj.copy(U.rj);M.ni.tangents(R.t,U.t);o.addEquation(R);o.addEquation(U)}this.collisionMatrixSet(b,D,1,true);if(this.collisionMatrixGet(b,D,true)!=this.collisionMatrixGet(b,D,false)){w.dispatchEvent({type:"collide","with":_,contact:M});_.dispatchEvent({type:"collide","with":w,contact:M});w.wakeUp();_.wakeUp()}}}if(a)f.makeContactConstraints=c()-h;var w;if(a)h=c();for(var b=0,z=d.length;b!==z;b++){var M=d[b];M.update();for(var D=0,W=M.equations.length;D!==W;D++){var X=M.equations[D];o.addEquation(X)}}o.solve(t,n);if(a)f.solve=c()-h;o.removeAllEquations();var V=Math.pow;for(var b=0;b!==i;b++){w=s[b];if(w.motionstate&l){var $=V(1-w.linearDamping,t);var J=w.velocity;J.mult($,J);var K=w.angularVelocity;if(K){var Q=V(1-w.angularDamping,t);K.mult(Q,K)}}}r.dispatchEvent({type:"preStep"});for(var b=0;b!==i;b++){var w=s[b];w.preStep&&w.preStep.call(w)}if(a)h=c();var G=k.step_q;var Y=k.step_w;var Z=k.step_wq;var et=n.stepnumber;var tt=e.Body.DYNAMIC|e.Body.KINEMATIC;var nt=et%(this.quatNormalizeSkip+1)===0;var rt=this.quatNormalizeFast;var it=t*.5;for(var b=0;b!==i;b++){var st=s[b],ot=st.force,ut=st.tau;if(st.motionstate&tt){var at=st.velocity,ft=st.angularVelocity,lt=st.position,ct=st.quaternion,ht=st.invMass,pt=st.invInertia;at.x+=ot.x*ht*t;at.y+=ot.y*ht*t;at.z+=ot.z*ht*t;if(st.angularVelocity){ft.x+=ut.x*pt.x*t;ft.y+=ut.y*pt.y*t;ft.z+=ut.z*pt.z*t}if(!st.isSleeping()){lt.x+=at.x*t;lt.y+=at.y*t;lt.z+=at.z*t;if(st.angularVelocity){Y.set(ft.x,ft.y,ft.z,0);Y.mult(ct,Z);ct.x+=it*Z.x;ct.y+=it*Z.y;ct.z+=it*Z.z;ct.w+=it*Z.w;if(nt){if(rt)ct.normalizeFast();else ct.normalize()}}}}st.force.set(0,0,0);if(st.tau)st.tau.set(0,0,0)}if(a)f.integrate=c()-h;this.time+=t;this.stepnumber+=1;r.dispatchEvent({type:"postStep"});for(var b=0;b!==i;b++){var w=s[b];var dt=w.postStep;dt&&dt.call(w)}for(var b=0;b!==i;b++){var st=s[b];if(st.inertiaWorldAutoUpdate)st.quaternion.vmult(st.inertia,st.inertiaWorld);if(st.invInertiaWorldAutoUpdate)st.quaternion.vmult(st.invInertia,st.invInertiaWorld)}if(n.allowSleep){for(var b=0;b!==i;b++){s[b].sleepTick(this.time)}}};e.ContactPoint=function(e,t,n,r,i,s){this.bi=e;this.bj=t;this.n=n;this.t1=i;this.t2=s;this.contactMaterial=r};e.ContactGenerator=function(){function r(n,r){if(t.length){var i=t.pop();i.bi=n;i.bj=r;return i}else return new e.ContactEquation(n,r)}function i(e){var t;t=e.ri;e.ri=e.rj;e.rj=t;e.ni.negate(e.ni);t=e.bi;e.bi=e.bj;e.bj=t}function s(e,t,n,i,s,o,u,a,f){var l=r(a,f);f.position.vsub(i,l.ni);l.ni.normalize();l.ni.copy(l.ri);l.ni.copy(l.rj);l.ri.mult(t.radius,l.ri);l.rj.mult(-n.radius,l.rj);e.push(l)}function a(e,t,n,i,s,a,f,l,c){var h=r(l,c);h.ni.set(0,0,1);f.vmult(h.ni,h.ni);h.ni.negate(h.ni);h.ni.normalize();h.ni.mult(t.radius,h.ri);i.vsub(s,o);h.ni.mult(h.ni.dot(o),u);o.vsub(u,h.rj);if(u.norm2()<=t.radius*t.radius)e.push(h)}function h(e,t,n){var r=null;var i=e.length;for(var s=0;s<i;s++){var o=e[s];var u=f;e[(s+1)%i].vsub(o,u);var a=l;u.cross(t,a);var h=c;n.vsub(o,h);var p=a.dot(h);if(r===null||p>0&&r===true||p<=0&&r===false){if(r===null)r=p>0;continue}else return false}return true}function S(e,t,i,s,o,u,a,f,l){var c=g;s.vsub(o,p);i.getSideNormals(c,a);var h=t.radius;var S=[];var x=false;var T=b;var N=w;var C=E;var k=null;var L=0;var A=0;var O=0;var M=null;for(var _=0,D=c.length;_!==D&&x===false;_++){var P=d;c[_].copy(P);var H=P.norm();P.normalize();var B=p.dot(P);if(B<H+h&&B>0){var j=v;var F=m;c[(_+1)%3].copy(j);c[(_+2)%3].copy(F);var I=j.norm();var q=F.norm();j.normalize();F.normalize();var R=p.dot(j);var U=p.dot(F);if(R<I&&R>-I&&U<q&&U>-q){var z=Math.abs(B-H-h);if(M===null||z<M){M=z;A=R;O=U;k=H;P.copy(T);j.copy(N);F.copy(C);L++}}}}if(L){x=true;var W=r(f,l);T.mult(-h,W.ri);T.copy(W.ni);W.ni.negate(W.ni);T.mult(k,T);N.mult(A,N);T.vadd(N,T);C.mult(O,C);T.vadd(C,W.rj);e.push(W)}var X=n.get();var V=y;for(var $=0;$!==2&&!x;$++){for(var J=0;J!==2&&!x;J++){for(var K=0;K!==2&&!x;K++){X.set(0,0,0);if($)X.vadd(c[0],X);else X.vsub(c[0],X);if(J)X.vadd(c[1],X);else X.vsub(c[1],X);if(K)X.vadd(c[2],X);else X.vsub(c[2],X);o.vadd(X,V);V.vsub(s,V);if(V.norm2()<h*h){x=true;var W=r(f,l);V.copy(W.ri);W.ri.normalize();W.ri.copy(W.ni);W.ri.mult(h,W.ri);X.copy(W.rj);e.push(W)}}}}n.release(X);X=null;var Q=n.get();var G=n.get();var W=n.get();var Y=n.get();var z=n.get();var Z=c.length;for(var $=0;$<Z&&!x;$++){for(var J=0;J<Z&&!x;J++){if($%3!=J%3){c[J].cross(c[$],Q);Q.normalize();c[$].vadd(c[J],G);s.copy(W);W.vsub(G,W);W.vsub(o,W);var et=W.dot(Q);Q.mult(et,Y);var K=0;while(K==$%3||K==J%3)K++;s.copy(z);z.vsub(Y,z);z.vsub(G,z);z.vsub(o,z);var tt=Math.abs(et);var nt=z.norm();if(tt<c[K].norm()&&nt<h){x=true;var rt=r(f,l);G.vadd(Y,rt.rj);rt.rj.copy(rt.rj);z.negate(rt.ni);rt.ni.normalize();rt.rj.copy(rt.ri);rt.ri.vadd(o,rt.ri);rt.ri.vsub(s,rt.ri);rt.ri.normalize();rt.ri.mult(h,rt.ri);e.push(rt)}}}}n.release(Q,G,W,Y,z)}function D(e,t,i,s,o,u,a,f,l){s.vsub(o,x);var c=i.faceNormals;var p=i.faces;var d=i.vertices;var v=t.radius;var m=[];for(var g=0;g<d.length;g++){var y=d[g];var b=k;a.vmult(y,b);o.vadd(b,b);var w=C;b.vsub(s,w);if(w.norm2()<v*v){S=true;var E=r(f,l);w.copy(E.ri);E.ri.normalize();E.ri.copy(E.ni);E.ri.mult(v,E.ri);b.vsub(o,E.rj);e.push(E);return}}var S=false;for(var g=0,D=p.length;g!==D&&S===false;g++){var P=c[g];var H=p[g];var B=L;a.vmult(P,B);var j=A;a.vmult(d[H[0]],j);j.vadd(o,j);var F=O;B.mult(-v,F);s.vadd(F,F);var I=M;F.vsub(j,I);var q=I.dot(B);var R=_;s.vsub(j,R);if(q<0&&R.dot(B)>0){var U=[];for(var z=0,W=H.length;z!==W;z++){var X=n.get();a.vmult(d[H[z]],X);o.vadd(X,X);U.push(X)}if(h(U,B,s)){S=true;var E=r(f,l);B.mult(-v,E.ri);B.negate(E.ni);var V=n.get();B.mult(-q,V);var $=n.get();B.mult(-v,$);s.vsub(o,E.rj);E.rj.vadd($,E.rj);E.rj.vadd(V,E.rj);n.release(V);n.release($);e.push(E);return}else{for(var z=0;z<H.length;z++){var J=n.get();var K=n.get();a.vmult(d[H[(z+1)%H.length]],J);a.vmult(d[H[(z+2)%H.length]],K);o.vadd(J,J);o.vadd(K,K);var Q=T;K.vsub(J,Q);edgeUnit=N;Q.unit(edgeUnit);var G=n.get();var Y=n.get();s.vsub(J,Y);edgeUnit.mult(Y.dot(edgeUnit),G);G.vadd(J,G);var Z=n.get();G.vsub(s,Z);if(Z.norm2()<v*v){var E=r(f,l);G.vsub(o,E.rj);G.vsub(s,E.ni);E.ni.normalize();E.ni.mult(v,E.ri);e.push(E);return}n.release(J);n.release(K);n.release(G);n.release(Z);n.release(Y)}}for(var z=0,et=U.length;z!==et;z++){n.release(U[z])}}}}function B(e,t,n,r,i,s,o,u,a){W(e,t,n.convexPolyhedronRepresentation,r,i,s,o,u,a)}function I(t,n,r,i,s,o,u,a,f){var l=j;var c=F;var h=0;for(var p=0,d=r.childShapes.length;p!==d;p++){var v=[];var m=c.pop()||new e.Quaternion;var g=l.pop()||new e.Vec3;u.mult(r.childOrientations[p],m);m.normalize();u.vmult(r.childOffsets[p],g);s.vadd(g,g);st(v,n,r.childShapes[p],i,g,o,m,a,f);c.push(m);var y=g;if(!n)h+=v.length;for(var b=0;b<v.length;b++){u.vmult(r.childOffsets[p],y);v[b].rj.vadd(y,v[b].rj);t.push(v[b])}l.push(g)}}function W(e,t,n,i,s,o,u,a,f){var l=q;var c=R;c.set(0,0,1);o.vmult(c,c);var h=U;for(var p=0;p<n.vertices.length;p++){n.vertices[p].copy(l);u.vmult(l,l);s.vadd(l,l);l.vsub(i,h);var d=c.dot(h);if(d<=0){var v=z;c.mult(c.dot(l),v);l.vsub(v,v);var m=r(a,f);c.copy(m.ni);v.copy(m.ri);l.vsub(s,m.rj);e.push(m)}}}function $(e,t,n,i,s,o,u,a,f){var l=X;if(t.findSeparatingAxis(n,i,o,s,u,l)){var c=[];var h=V;t.clipAgainstHull(i,o,n,s,u,l,-100,100,c);for(var p=0;p<c.length;p++){var d=r(a,f);l.negate(d.ni);c[p].normal.negate(h);h.mult(c[p].depth,h);c[p].point.vadd(h,d.ri);c[p].point.copy(d.rj);d.rj.vsub(s,d.rj);d.ri.vsub(i,d.ri);e.push(d)}}}function G(e,t,n,i,s,o,u,a,f){var l=J;l.set(0,0,1);f.quaternion.vmult(l,l);var c=K;i.vsub(f.position,c);var h=l.dot(c);if(h<=0){var p=r(a,f);l.copy(p.ni);p.ni.negate(p.ni);p.ri.set(0,0,0);var d=Q;l.mult(l.dot(i),d);i.vsub(d,d);d.copy(p.rj);e.push(p)}}function Z(e,t,n,i,s,o,u,a,f){var l=Y;l.set(0,0,1);i.vsub(s,l);var c=l.norm2();if(c<=n.radius*n.radius){var h=r(a,f);l.normalize();l.copy(h.rj);h.rj.mult(n.radius,h.rj);l.copy(h.ni);h.ni.negate(h.ni);h.ri.set(0,0,0);e.push(h)}}function it(t,n,i,s,o,u,a,f,l){var c=-1;var h=rt;var p=null;var d=0;var v=tt;s.copy(v);v.vsub(o,v);a.conjugate(et);et.vmult(v,v);if(i.pointIsInside(v)){for(var m=0,g=i.faces.length;m!==g;m++){var y=[];for(var b=0,w=i.faces[m].length;b!==w;b++){var E=new e.Vec3;i.vertices[i.faces[m][b]].copy(E);a.vmult(E,E);E.vadd(o,E);y.push(E)}var S=nt;i.faceNormals[m].copy(S);S.normalize();a.vmult(S,S);var x=-S.dot(s.vsub(y[0]));if(p===null||Math.abs(x)<Math.abs(p)){p=x;c=m;S.copy(h);d++}}if(c!==-1){var T=r(f,l);var N=h.mult(p);var C=s.vsub(o).vadd(N);C.copy(T.rj);h.negate(T.ni);T.ri.set(0,0,0);t.push(T)}else{console.warn("Point found inside convex, but did not find penetrating face!")}}}function st(t,n,r,o,u,f,l,c,h){var p=false,d=e.Shape.types;if(n&&r){if(n.type>r.type){var v;v=r;r=n;n=v;v=u;u=o;o=v;v=l;l=f;f=v;v=h;h=c;c=v;p=true}}else{if(n&&!r){var v;v=r;r=n;n=v;v=u;u=o;o=v;v=l;l=f;f=v;v=h;h=c;c=v;p=true}}if(n&&r){if(n.type==d.SPHERE){switch(r.type){case d.SPHERE:s(t,n,r,o,u,f,l,c,h);break;case d.PLANE:a(t,n,r,o,u,f,l,c,h);break;case d.BOX:S(t,n,r,o,u,f,l,c,h);break;case d.COMPOUND:I(t,n,r,o,u,f,l,c,h);break;case d.CONVEXPOLYHEDRON:D(t,n,r,o,u,f,l,c,h);break;default:console.warn("Collision between CANNON.Shape.types.SPHERE and "+r.type+" not implemented yet.");break}}else if(n.type==d.PLANE){switch(r.type){case d.PLANE:throw new Error("Plane-plane collision... wait, you did WHAT?");break;case d.BOX:B(t,n,r,o,u,f,l,c,h);break;case d.COMPOUND:I(t,n,r,o,u,f,l,c,h);break;case d.CONVEXPOLYHEDRON:W(t,n,r,o,u,f,l,c,h);break;default:console.warn("Collision between CANNON.Shape.types.PLANE and "+r.type+" not implemented yet.");break}}else if(n.type==d.BOX){switch(r.type){case d.BOX:st(t,n.convexPolyhedronRepresentation,r.convexPolyhedronRepresentation,o,u,f,l,c,h);break;case d.COMPOUND:I(t,n,r,o,u,f,l,c,h);break;case d.CONVEXPOLYHEDRON:st(t,n.convexPolyhedronRepresentation,r,o,u,f,l,c,h);break;default:console.warn("Collision between CANNON.Shape.types.BOX and "+r.type+" not implemented yet.");break}}else if(n.type==d.COMPOUND){switch(r.type){case d.COMPOUND:I(t,n,r,o,u,f,l,c,h);break;case d.CONVEXPOLYHEDRON:var m=[];I(m,r,n,u,o,l,f,h,c);for(var g=0;g<m.length;g++){i(m[g]);t.push(m[g])}break;default:console.warn("Collision between CANNON.Shape.types.COMPOUND and "+r.type+" not implemented yet.");break}}else if(n.type==d.CONVEXPOLYHEDRON){switch(r.type){case d.CONVEXPOLYHEDRON:$(t,n,r,o,u,f,l,c,h);break;default:console.warn("Collision between CANNON.Shape.types.CONVEXPOLYHEDRON and "+r.type+" not implemented yet.");break}}}else{switch(r.type){case d.PLANE:G(t,n,r,o,u,f,l,c,h);break;case d.SPHERE:Z(t,n,r,o,u,f,l,c,h);break;case d.BOX:it(t,n,r.convexPolyhedronRepresentation,o,u,f,l,c,h);break;case d.CONVEXPOLYHEDRON:it(t,n,r,o,u,f,l,c,h);break;case d.COMPOUND:I(t,n,r,o,u,f,l,c,h);break;default:console.warn("Collision between CANNON.Particle and "+r.type+" not implemented yet.");break}}for(var y=0;p&&y<t.length;y++)i(t[y])}this.contactReduction=false;var t=[];var n=new e.Vec3Pool;var o=new e.Vec3;var u=new e.Vec3;var f=new e.Vec3;var l=new e.Vec3;var c=new e.Vec3;var p=new e.Vec3;var d=new e.Vec3;var v=new e.Vec3;var m=new e.Vec3;var g=[new e.Vec3,new e.Vec3,new e.Vec3,new e.Vec3,new e.Vec3,new e.Vec3];var y=new e.Vec3;var b=new e.Vec3;var w=new e.Vec3;var E=new e.Vec3;var x=new e.Vec3;var T=new e.Vec3;var N=new e.Vec3;var C=new e.Vec3;var k=new e.Vec3;var L=new e.Vec3;var A=new e.Vec3;var O=new e.Vec3;var M=new e.Vec3;var _=new e.Vec3;var P=new e.Vec3;var H=new e.Vec3;var j=[];var F=[];var q=new e.Vec3;var R=new e.Vec3;var U=new e.Vec3;var z=new e.Vec3;var X=new e.Vec3;var V=new e.Vec3;var J=new e.Vec3;var K=new e.Vec3;var Q=new e.Vec3;var Y=new e.Vec3;var et=new e.Quaternion;var tt=new e.Vec3;var nt=new e.Vec3;var rt=new e.Vec3;this.reduceContacts=function(e){};this.getContacts=function(e,n,r,i,s){for(var o=0;s&&o<s.length;o++)t.push(s[o]);for(var u=0;u<e.length;u++){var a=e[u],f=n[u];st(i,a.shape,f.shape,a.position,f.position,a.quaternion,f.quaternion,a,f)}}};e.Equation=function(e,t,n,r){this.id=-1;this.minForce=typeof n=="undefined"?-1e6:n;this.maxForce=typeof r=="undefined"?1e6:r;this.bi=e;this.bj=t;this.stiffness=1e7;this.regularizationTime=5;this.a=0;this.b=0;this.eps=0;this.spookParamsNeedsUpdate=true};e.Equation.prototype.constructor=e.Equation;e.Equation.prototype.updateSpookParams=function(e){var t=this.regularizationTime,n=this.stiffness;this.a=4/(e*(1+4*t));this.b=4*t/(1+4*t);this.eps=4/(e*e*n*(1+4*t))};e.ContactEquation=function(t,n){e.Equation.call(this,t,n,0,1e6);this.restitution=0;this.penetration=0;this.ri=new e.Vec3;this.penetrationVec=new e.Vec3;this.rj=new e.Vec3;this.ni=new e.Vec3;this.rixn=new e.Vec3;this.rjxn=new e.Vec3;this.rixw=new e.Vec3;this.rjxw=new e.Vec3;this.invIi=new e.Mat3;this.invIj=new e.Mat3;this.relVel=new e.Vec3;this.relForce=new e.Vec3};e.ContactEquation.prototype=new e.Equation;e.ContactEquation.prototype.constructor=e.ContactEquation;var x=new e.Vec3;var T=new e.Vec3;e.ContactEquation.prototype.computeB=function(t){var n=this.a,r=this.b;var i=this.bi;var s=this.bj;var o=this.ri;var u=this.rj;var a=this.rixn;var f=this.rjxn;var l=i.velocity;var c=i.angularVelocity?i.angularVelocity:new e.Vec3;var h=i.force;var p=i.tau?i.tau:new e.Vec3;var d=s.velocity;var v=s.angularVelocity?s.angularVelocity:new e.Vec3;var m=s.force;var g=s.tau?s.tau:new e.Vec3;var y=this.relVel;var b=this.relForce;var w=this.penetrationVec;var E=i.invMass;var S=s.invMass;var N=this.invIi;var C=this.invIj;if(i.invInertia)N.setTrace(i.invInertia);else N.identity();if(s.invInertia)C.setTrace(s.invInertia);else C.identity();var k=this.ni;o.cross(k,a);u.cross(k,f);var w=this.penetrationVec;w.set(0,0,0);w.vadd(s.position,w);w.vadd(u,w);w.vsub(i.position,w);w.vsub(o,w);var L=k.dot(w);var A=x;var O=T;N.vmult(p,A);C.vmult(g,O);var M=this.restitution+1;var _=M*d.dot(k)-M*l.dot(k)+v.dot(f)-c.dot(a);var D=m.dot(k)*S-h.dot(k)*E+f.dot(O)-a.dot(A);var P=-L*n-_*r-t*D;return P};var N=new e.Vec3;var C=new e.Vec3;e.ContactEquation.prototype.computeC=function(){var e=this.bi;var t=this.bj;var n=this.rixn;var r=this.rjxn;var i=e.invMass;var s=t.invMass;var o=i+s+this.eps;var u=this.invIi;var a=this.invIj;if(e.invInertia)u.setTrace(e.invInertia);else u.identity();if(t.invInertia)a.setTrace(t.invInertia);else a.identity();u.vmult(n,N);a.vmult(r,C);o+=N.dot(n);o+=C.dot(r);return o};var k=new e.Vec3;e.ContactEquation.prototype.computeGWlambda=function(){var e=this.bi;var t=this.bj;var n=k;var r=0;t.vlambda.vsub(e.vlambda,n);r+=n.dot(this.ni);if(e.wlambda)r-=e.wlambda.dot(this.rixn);if(t.wlambda)r+=t.wlambda.dot(this.rjxn);return r};var L=new e.Vec3;var A=new e.Vec3;e.ContactEquation.prototype.addToWlambda=function(e){var t=this.bi;var n=this.bj;var r=this.rixn;var i=this.rjxn;var s=t.invMass;var o=n.invMass;var u=this.ni;var a=L;var f=A;u.mult(s*e,f);t.vlambda.vsub(f,t.vlambda);u.mult(o*e,f);n.vlambda.vadd(f,n.vlambda);if(t.wlambda){var l=this.invIi;l.vmult(r,a);a.mult(e,a);t.wlambda.vsub(a,t.wlambda)}if(n.wlambda){var l=this.invIj;l.vmult(i,a);a.mult(e,a);n.wlambda.vadd(a,n.wlambda)}};e.FrictionEquation=function(t,n,r){e.Equation.call(this,t,n,-r,r);this.ri=new e.Vec3;this.rj=new e.Vec3;this.t=new e.Vec3;this.rixt=new e.Vec3;this.rjxt=new e.Vec3;this.wixri=new e.Vec3;this.wjxrj=new e.Vec3;this.invIi=new e.Mat3;this.invIj=new e.Mat3;this.relVel=new e.Vec3;this.relForce=new e.Vec3};e.FrictionEquation.prototype=new e.Equation;e.FrictionEquation.prototype.constructor=e.FrictionEquation;var O=new e.Vec3;var M=new e.Vec3;e.FrictionEquation.prototype.computeB=function(t){var n=this.a,r=this.b;var i=this.bi;var s=this.bj;var o=this.ri;var u=this.rj;var a=this.rixt;var f=this.rjxt;var l=this.wixri;var c=this.wjxrj;var h=i.velocity;var p=i.angularVelocity?i.angularVelocity:new e.Vec3;var d=i.force;var v=i.tau?i.tau:new e.Vec3;var m=s.velocity;var g=s.angularVelocity?s.angularVelocity:new e.Vec3;var y=s.force;var b=s.tau?s.tau:new e.Vec3;var w=this.relVel;var E=this.relForce;var S=i.invMass;var x=s.invMass;var T=this.invIi;var N=this.invIj;if(i.invInertia)T.setTrace(i.invInertia);if(s.invInertia)N.setTrace(s.invInertia);var C=this.t;o.cross(C,a);u.cross(C,f);p.cross(o,l);g.cross(u,c);var k=O;var L=M;T.vmult(v,k);N.vmult(b,L);var A=0;var _=m.dot(C)-h.dot(C)+c.dot(C)-l.dot(C);var D=y.dot(C)*x-d.dot(C)*S+f.dot(L)-a.dot(k);var P=-A*n-_*r-t*D;return P};var _=new e.Vec3;var D=new e.Vec3;e.FrictionEquation.prototype.computeC=function(){var e=this.bi;var t=this.bj;var n=this.rixt;var r=this.rjxt;var i=e.invMass;var s=t.invMass;var o=i+s+this.eps;var u=this.invIi;var a=this.invIj;if(e.invInertia)u.setTrace(e.invInertia);if(t.invInertia)a.setTrace(t.invInertia);u.vmult(n,_);a.vmult(r,D);o+=_.dot(n);o+=D.dot(r);return o};var P=new e.Vec3;e.FrictionEquation.prototype.computeGWlambda=function(){var e=this.bi;var t=this.bj;var n=0;var r=P;t.vlambda.vsub(e.vlambda,r);n+=r.dot(this.t);if(e.wlambda)n-=e.wlambda.dot(this.rixt);if(t.wlambda)n+=t.wlambda.dot(this.rjxt);return n};var H=new e.Vec3;e.FrictionEquation.prototype.addToWlambda=function(e){var t=this.bi;var n=this.bj;var r=this.rixt;var i=this.rjxt;var s=t.invMass;var o=n.invMass;var u=this.t;var a=H;u.mult(s*e,a);t.vlambda.vsub(a,t.vlambda);u.mult(o*e,a);n.vlambda.vadd(a,n.vlambda);var f=t.wlambda;if(f){var l=this.invIi;l.vmult(r,a);a.mult(e,a);f.vsub(a,f)}var c=n.wlambda;if(c){var l=this.invIj;l.vmult(i,a);a.mult(e,a);c.vadd(a,c)}};e.RotationalEquation=function(t,n){e.Equation.call(this,t,n,-1e6,1e6);this.ni=new e.Vec3;this.nj=new e.Vec3;this.nixnj=new e.Vec3;this.njxni=new e.Vec3;this.invIi=new e.Mat3;this.invIj=new e.Mat3;this.relVel=new e.Vec3;this.relForce=new e.Vec3};e.RotationalEquation.prototype=new e.Equation;e.RotationalEquation.prototype.constructor=e.RotationalEquation;e.RotationalEquation.prototype.computeB=function(t){var n=this.a,r=this.b;var i=this.bi;var s=this.bj;var o=this.ni;var u=this.nj;var a=this.nixnj;var f=this.njxni;var l=i.velocity;var c=i.angularVelocity?i.angularVelocity:new e.Vec3;var h=i.force;var p=i.tau?i.tau:new e.Vec3;var d=s.velocity;var v=s.angularVelocity?s.angularVelocity:new e.Vec3;var m=s.force;var g=s.tau?s.tau:new e.Vec3;var y=i.invMass;var b=s.invMass;var w=this.invIi;var E=this.invIj;if(i.invInertia)w.setTrace(i.invInertia);else w.identity();if(s.invInertia)E.setTrace(s.invInertia);else E.identity();o.cross(u,a);u.cross(o,f);var S=-o.dot(u);var x=f.dot(c)+a.dot(v);var T=0;var N=-S*n-x*r-t*T;return N};e.RotationalEquation.prototype.computeC=function(){var e=this.bi;var t=this.bj;var n=this.nixnj;var r=this.njxni;var i=e.invMass;var s=t.invMass;var o=this.eps;var u=this.invIi;var a=this.invIj;if(e.invInertia)u.setTrace(e.invInertia);else u.identity();if(t.invInertia)a.setTrace(t.invInertia);else a.identity();o+=u.vmult(r).dot(r);o+=a.vmult(n).dot(n);return o};var k=new e.Vec3;e.RotationalEquation.prototype.computeGWlambda=function(){var e=this.bi;var t=this.bj;var n=k;var r=0;if(e.wlambda)r+=e.wlambda.dot(this.njxni);if(t.wlambda)r+=t.wlambda.dot(this.nixnj);return r};e.RotationalEquation.prototype.addToWlambda=function(e){var t=this.bi;var n=this.bj;var r=this.nixnj;var i=this.njxni;var s=t.invMass;var o=n.invMass;if(t.wlambda){var u=this.invIi;t.wlambda.vsub(u.vmult(r).mult(e),t.wlambda)}if(n.wlambda){var u=this.invIj;n.wlambda.vadd(u.vmult(r).mult(e),n.wlambda)}};e.Constraint=function(e,t){this.equations=[];this.bodyA=e;this.bodyB=t};e.Constraint.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};e.DistanceConstraint=function(t,n,r,i){e.Constraint.call(this,t,n);if(typeof i=="undefined")i=1e6;var s=this.equations=[new e.ContactEquation(t,n)];var o=s[0];o.minForce=-i;o.maxForce=i;this.update=function(){n.position.vsub(t.position,o.ni);o.ni.normalize();o.ni.mult(r*.5,o.ri);o.ni.mult(-r*.5,o.rj)}};e.DistanceConstraint.prototype=new e.Constraint;e.RotationalMotorEquation=function(t,n,r){r=r||1e6;e.Equation.call(this,t,n,-r,r);this.axisA=new e.Vec3;this.axisB=new e.Vec3;this.invIi=new e.Mat3;this.invIj=new e.Mat3;this.targetVelocity=0};e.RotationalMotorEquation.prototype=new e.Equation;e.RotationalMotorEquation.prototype.constructor=e.RotationalMotorEquation;e.RotationalMotorEquation.prototype.computeB=function(t){var n=this.a,r=this.b;var i=this.bi;var s=this.bj;var o=this.axisA;var u=this.axisB;var a=i.velocity;var f=i.angularVelocity?i.angularVelocity:new e.Vec3;var l=i.force;var c=i.tau?i.tau:new e.Vec3;var h=s.velocity;var p=s.angularVelocity?s.angularVelocity:new e.Vec3;var d=s.force;var v=s.tau?s.tau:new e.Vec3;var m=i.invMass;var g=s.invMass;var y=this.invIi;var b=this.invIj;if(i.invInertia)y.setTrace(i.invInertia);else y.identity();if(s.invInertia)b.setTrace(s.invInertia);else b.identity();var w=0;var E=o.dot(f)+u.dot(p)+this.targetVelocity;var S=0;var x=-w*n-E*r-t*S;return x};e.RotationalMotorEquation.prototype.computeC=function(){var e=this.bi;var t=this.bj;var n=this.axisA;var r=this.axisB;var i=e.invMass;var s=t.invMass;var o=this.eps;var u=this.invIi;var a=this.invIj;if(e.invInertia)u.setTrace(e.invInertia);else u.identity();if(t.invInertia)a.setTrace(t.invInertia);else a.identity();o+=u.vmult(n).dot(r);o+=a.vmult(r).dot(r);return o};var k=new e.Vec3;e.RotationalMotorEquation.prototype.computeGWlambda=function(){var e=this.bi;var t=this.bj;var n=k;var r=this.axisA;var i=this.axisB;var s=0;if(e.wlambda)s+=e.wlambda.dot(r);if(t.wlambda)s+=t.wlambda.dot(i);return s};e.RotationalMotorEquation.prototype.addToWlambda=function(e){var t=this.bi;var n=this.bj;var r=this.axisA;var i=this.axisB;var s=t.invMass;var o=n.invMass;if(t.wlambda){var u=this.invIi;t.wlambda.vsub(u.vmult(r).mult(e),t.wlambda)}if(n.wlambda){var u=this.invIj;n.wlambda.vadd(u.vmult(i).mult(e),n.wlambda)}};e.HingeConstraint=function(t,n,r,i,s,o,u){e.Constraint.call(this,t,i);u=u||1e6;var a=this;var f=this.equations=[new e.RotationalEquation(t,i),new e.RotationalEquation(t,i),new e.ContactEquation(t,i),new e.ContactEquation(t,i),new e.ContactEquation(t,i)];this.getRotationalEquation1=function(){return f[0]};this.getRotationalEquation2=function(){return f[1]};this.getPointToPointEquation1=function(){return f[2]};this.getPointToPointEquation2=function(){return f[3]};this.getPointToPointEquation3=function(){return f[4]};var l=this.getRotationalEquation1();var c=this.getRotationalEquation2();var h=this.getPointToPointEquation1();var p=this.getPointToPointEquation2();var d=this.getPointToPointEquation3();var v;p.minForce=d.minForce=h.minForce=-u;p.maxForce=d.maxForce=h.maxForce=u;var m=n.unit();var g=s.unit();var y=r.cross(m);var b=r.cross(y);var w=o.cross(g);y.normalize();w.normalize();var E=false;this.motorTargetVelocity=0;this.motorMinForce=-u;this.motorMaxForce=u;this.enableMotor=function(){if(!E){v=new e.RotationalMotorEquation(t,i,u);f.push(v);E=true}};this.disableMotor=function(){if(E){E=false;v=null;f.pop()}};this.update=function(){h.ni.set(1,0,0);p.ni.set(0,1,0);d.ni.set(0,0,1);t.quaternion.vmult(n,h.ri);i.quaternion.vmult(s,h.rj);h.ri.copy(p.ri);h.rj.copy(p.rj);h.ri.copy(d.ri);h.rj.copy(d.rj);t.quaternion.vmult(y,l.ni);i.quaternion.vmult(o,l.nj);t.quaternion.vmult(b,c.ni);i.quaternion.vmult(o,c.nj);if(E){t.quaternion.vmult(r,v.axisA);i.quaternion.vmult(o,v.axisB);v.targetVelocity=a.motorTargetVelocity;v.maxForce=a.motorMaxForce;v.minForce=a.motorMinForce}}};e.HingeConstraint.prototype=new e.Constraint;e.PointToPointConstraint=function(t,n,r,i,s){e.Constraint.call(this,t,r);var o=this.equations=[new e.ContactEquation(t,r),new e.ContactEquation(t,r),new e.ContactEquation(t,r)];var u=o[0];var a=o[1];var f=o[2];a.minForce=f.minForce=u.minForce=-s;a.maxForce=f.maxForce=u.maxForce=s;this.update=function(){r.position.vsub(t.position,u.ni);u.ni.normalize();t.quaternion.vmult(n,u.ri);r.quaternion.vmult(i,u.rj);u.ni.tangents(a.ni,f.ni);u.ri.copy(a.ri);u.rj.copy(a.rj);u.ri.copy(f.ri);u.rj.copy(f.rj)}};e.PointToPointConstraint.prototype=new e.Constraint;if(typeof t!=="undefined"){t.exports=e}else{this.CANNON=e}}).apply(this)},{}],38:[function(e,t,n){},{}],39:[function(e,t,n){function s(e,t,n){if(!(this instanceof s))return new s(e,t,n);var r=typeof e;if(t==="base64"&&r==="string"){e=O(e);while(e.length%4!==0){e=e+"="}}var i;if(r==="number")i=P(e);else if(r==="string")i=s.byteLength(e,t);else if(r==="object")i=P(e.length);else throw new Error("First argument needs to be a number, array or string.");var o;if(s._useTypedArrays){o=_(new Uint8Array(i))}else{o=this;o.length=i;o._isBuffer=true}var u;if(s._useTypedArrays&&typeof Uint8Array==="function"&&e instanceof Uint8Array){o._set(e)}else if(B(e)){for(u=0;u<i;u++){if(s.isBuffer(e))o[u]=e.readUInt8(u);else o[u]=e[u]}}else if(r==="string"){o.write(e,0,t)}else if(r==="number"&&!s._useTypedArrays&&!n){for(u=0;u<i;u++){o[u]=0}}return o}function o(e,t,n,r){n=Number(n)||0;var i=e.length-n;if(!r){r=i}else{r=Number(r);if(r>i){r=i}}var o=t.length;$(o%2===0,"Invalid hex string");if(r>o/2){r=o/2}for(var u=0;u<r;u++){var a=parseInt(t.substr(u*2,2),16);$(!isNaN(a),"Invalid hex string");e[n+u]=a}s._charsWritten=u*2;return u}function u(e,t,n,r){var i=s._charsWritten=U(F(t),e,n,r);return i}function a(e,t,n,r){var i=s._charsWritten=U(I(t),e,n,r);return i}function f(e,t,n,r){return a(e,t,n,r)}function l(e,t,n,r){var i=s._charsWritten=U(R(t),e,n,r);return i}function c(e,t,n,r){var i=s._charsWritten=U(q(t),e,n,r);return i}function h(e,t,n){if(t===0&&n===e.length){return r.fromByteArray(e)}else{return r.fromByteArray(e.slice(t,n))}}function p(e,t,n){var r="";var i="";n=Math.min(e.length,n);for(var s=t;s<n;s++){if(e[s]<=127){r+=z(i)+String.fromCharCode(e[s]);i=""}else{i+="%"+e[s].toString(16)}}return r+z(i)}function d(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;i++)r+=String.fromCharCode(e[i]);return r}function v(e,t,n){return d(e,t,n)}function m(e,t,n){var r=e.length;if(!t||t<0)t=0;if(!n||n<0||n>r)n=r;var i="";for(var s=t;s<n;s++){i+=j(e[s])}return i}function g(e,t,n){var r=e.slice(t,n);var i="";for(var s=0;s<r.length;s+=2){i+=String.fromCharCode(r[s]+r[s+1]*256)}return i}function y(e,t,n,r){if(!r){$(typeof n==="boolean","missing or invalid endian");$(t!==undefined&&t!==null,"missing offset");$(t+1<e.length,"Trying to read beyond buffer length")}var i=e.length;if(t>=i)return;var s;if(n){s=e[t];if(t+1<i)s|=e[t+1]<<8}else{s=e[t]<<8;if(t+1<i)s|=e[t+1]}return s}function b(e,t,n,r){if(!r){$(typeof n==="boolean","missing or invalid endian");$(t!==undefined&&t!==null,"missing offset");$(t+3<e.length,"Trying to read beyond buffer length")}var i=e.length;if(t>=i)return;var s;if(n){if(t+2<i)s=e[t+2]<<16;if(t+1<i)s|=e[t+1]<<8;s|=e[t];if(t+3<i)s=s+(e[t+3]<<24>>>0)}else{if(t+1<i)s=e[t+1]<<16;if(t+2<i)s|=e[t+2]<<8;if(t+3<i)s|=e[t+3];s=s+(e[t]<<24>>>0)}return s}function w(e,t,n,r){if(!r){$(typeof n==="boolean","missing or invalid endian");$(t!==undefined&&t!==null,"missing offset");$(t+1<e.length,"Trying to read beyond buffer length")}var i=e.length;if(t>=i)return;var s=y(e,t,n,true);var o=s&32768;if(o)return(65535-s+1)*-1;else return s}function E(e,t,n,r){if(!r){$(typeof n==="boolean","missing or invalid endian");$(t!==undefined&&t!==null,"missing offset");$(t+3<e.length,"Trying to read beyond buffer length")}var i=e.length;if(t>=i)return;var s=b(e,t,n,true);var o=s&2147483648;if(o)return(4294967295-s+1)*-1;else return s}function S(e,t,n,r){if(!r){$(typeof n==="boolean","missing or invalid endian");$(t+3<e.length,"Trying to read beyond buffer length")}return i.read(e,t,n,23,4)}function x(e,t,n,r){if(!r){$(typeof n==="boolean","missing or invalid endian");$(t+7<e.length,"Trying to read beyond buffer length")}return i.read(e,t,n,52,8)}function T(e,t,n,r,i){if(!i){$(t!==undefined&&t!==null,"missing value");$(typeof r==="boolean","missing or invalid endian");$(n!==undefined&&n!==null,"missing offset");$(n+1<e.length,"trying to write beyond buffer length");W(t,65535)}var s=e.length;if(n>=s)return;for(var o=0,u=Math.min(s-n,2);o<u;o++){e[n+o]=(t&255<<8*(r?o:1-o))>>>(r?o:1-o)*8}}function N(e,t,n,r,i){if(!i){$(t!==undefined&&t!==null,"missing value");$(typeof r==="boolean","missing or invalid endian");$(n!==undefined&&n!==null,"missing offset");$(n+3<e.length,"trying to write beyond buffer length");W(t,4294967295)}var s=e.length;if(n>=s)return;for(var o=0,u=Math.min(s-n,4);o<u;o++){e[n+o]=t>>>(r?o:3-o)*8&255}}function C(e,t,n,r,i){if(!i){$(t!==undefined&&t!==null,"missing value");$(typeof r==="boolean","missing or invalid endian");$(n!==undefined&&n!==null,"missing offset");$(n+1<e.length,"Trying to write beyond buffer length");X(t,32767,-32768)}var s=e.length;if(n>=s)return;if(t>=0)T(e,t,n,r,i);else T(e,65535+t+1,n,r,i)}function k(e,t,n,r,i){if(!i){$(t!==undefined&&t!==null,"missing value");$(typeof r==="boolean","missing or invalid endian");$(n!==undefined&&n!==null,"missing offset");$(n+3<e.length,"Trying to write beyond buffer length");X(t,2147483647,-2147483648)}var s=e.length;if(n>=s)return;if(t>=0)N(e,t,n,r,i);else N(e,4294967295+t+1,n,r,i)}function L(e,t,n,r,s){if(!s){$(t!==undefined&&t!==null,"missing value");$(typeof r==="boolean","missing or invalid endian");$(n!==undefined&&n!==null,"missing offset");$(n+3<e.length,"Trying to write beyond buffer length");V(t,3.4028234663852886e38,-3.4028234663852886e38)}var o=e.length;if(n>=o)return;i.write(e,t,n,r,23,4)}function A(e,t,n,r,s){if(!s){$(t!==undefined&&t!==null,"missing value");$(typeof r==="boolean","missing or invalid endian");$(n!==undefined&&n!==null,"missing offset");$(n+7<e.length,"Trying to write beyond buffer length");V(t,1.7976931348623157e308,-1.7976931348623157e308)}var o=e.length;if(n>=o)return;i.write(e,t,n,r,52,8)}function O(e){if(e.trim)return e.trim();return e.replace(/^\s+|\s+$/g,"")}function _(e){e._isBuffer=true;e._get=e.get;e._set=e.set;e.get=M.get;e.set=M.set;e.write=M.write;e.toString=M.toString;e.toLocaleString=M.toString;e.toJSON=M.toJSON;e.copy=M.copy;e.slice=M.slice;e.readUInt8=M.readUInt8;e.readUInt16LE=M.readUInt16LE;e.readUInt16BE=M.readUInt16BE;e.readUInt32LE=M.readUInt32LE;e.readUInt32BE=M.readUInt32BE;e.readInt8=M.readInt8;e.readInt16LE=M.readInt16LE;e.readInt16BE=M.readInt16BE;e.readInt32LE=M.readInt32LE;e.readInt32BE=M.readInt32BE;e.readFloatLE=M.readFloatLE;e.readFloatBE=M.readFloatBE;e.readDoubleLE=M.readDoubleLE;e.readDoubleBE=M.readDoubleBE;e.writeUInt8=M.writeUInt8;e.writeUInt16LE=M.writeUInt16LE;e.writeUInt16BE=M.writeUInt16BE;e.writeUInt32LE=M.writeUInt32LE;e.writeUInt32BE=M.writeUInt32BE;e.writeInt8=M.writeInt8;e.writeInt16LE=M.writeInt16LE;e.writeInt16BE=M.writeInt16BE;e.writeInt32LE=M.writeInt32LE;e.writeInt32BE=M.writeInt32BE;e.writeFloatLE=M.writeFloatLE;e.writeFloatBE=M.writeFloatBE;e.writeDoubleLE=M.writeDoubleLE;e.writeDoubleBE=M.writeDoubleBE;e.fill=M.fill;e.inspect=M.inspect;e.toArrayBuffer=M.toArrayBuffer;return e}function D(e,t,n){if(typeof e!=="number")return n;e=~~e;if(e>=t)return t;if(e>=0)return e;e+=t;if(e>=0)return e;return 0}function P(e){e=~~Math.ceil(+e);return e<0?0:e}function H(e){return(Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"})(e)}function B(e){return H(e)||s.isBuffer(e)||e&&typeof e==="object"&&typeof e.length==="number"}function j(e){if(e<16)return"0"+e.toString(16);return e.toString(16)}function F(e){var t=[];for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(e.charCodeAt(n));else{var i=n;if(r>=55296&&r<=57343)n++;var s=encodeURIComponent(e.slice(i,n+1)).substr(1).split("%");for(var o=0;o<s.length;o++)t.push(parseInt(s[o],16))}}return t}function I(e){var t=[];for(var n=0;n<e.length;n++){t.push(e.charCodeAt(n)&255)}return t}function q(e){var t,n,r;var i=[];for(var s=0;s<e.length;s++){t=e.charCodeAt(s);n=t>>8;r=t%256;i.push(r);i.push(n)}return i}function R(e){return r.toByteArray(e)}function U(e,t,n,r){var i;for(var s=0;s<r;s++){if(s+n>=t.length||s>=e.length)break;t[s+n]=e[s]}return s}function z(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}function W(e,t){$(typeof e==="number","cannot write a non-number as a number");$(e>=0,"specified a negative value for writing an unsigned value");$(e<=t,"value is larger than maximum value for type");$(Math.floor(e)===e,"value has a fractional component")}function X(e,t,n){$(typeof e==="number","cannot write a non-number as a number");$(e<=t,"value larger than maximum allowed value");$(e>=n,"value smaller than minimum allowed value");$(Math.floor(e)===e,"value has a fractional component")}function V(e,t,n){$(typeof e==="number","cannot write a non-number as a number");$(e<=t,"value larger than maximum allowed value");$(e>=n,"value smaller than minimum allowed value")}function $(e,t){if(!e)throw new Error(t||"Failed assertion")}var r=e("base64-js");var i=e("ieee754");n.Buffer=s;n.SlowBuffer=s;n.INSPECT_MAX_BYTES=50;s.poolSize=8192;s._useTypedArrays=function(){if(typeof Uint8Array!=="function"||typeof ArrayBuffer!=="function")return false;try{var e=new Uint8Array(0);e.foo=function(){return 42};return 42===e.foo()&&typeof e.subarray==="function"}catch(t){return false}}();s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};s.isBuffer=function(e){return!!(e!==null&&e!==undefined&&e._isBuffer)};s.byteLength=function(e,t){var n;e=e+"";switch(t||"utf8"){case"hex":n=e.length/2;break;case"utf8":case"utf-8":n=F(e).length;break;case"ascii":case"binary":case"raw":n=e.length;break;case"base64":n=R(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=e.length*2;break;default:throw new Error("Unknown encoding")}return n};s.concat=function(e,t){$(H(e),"Usage: Buffer.concat(list, [totalLength])\n"+"list should be an Array.");if(e.length===0){return new s(0)}else if(e.length===1){return e[0]}var n;if(typeof t!=="number"){t=0;for(n=0;n<e.length;n++){t+=e[n].length}}var r=new s(t);var i=0;for(n=0;n<e.length;n++){var o=e[n];o.copy(r,i);i+=o.length}return r};s.prototype.write=function(e,t,n,r){if(isFinite(t)){if(!isFinite(n)){r=n;n=undefined}}else{var i=r;r=t;t=n;n=i}t=Number(t)||0;var s=this.length-t;if(!n){n=s}else{n=Number(n);if(n>s){n=s}}r=String(r||"utf8").toLowerCase();var h;switch(r){case"hex":h=o(this,e,t,n);break;case"utf8":case"utf-8":h=u(this,e,t,n);break;case"ascii":h=a(this,e,t,n);break;case"binary":h=f(this,e,t,n);break;case"base64":h=l(this,e,t,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":h=c(this,e,t,n);break;default:throw new Error("Unknown encoding")}return h};s.prototype.toString=function(e,t,n){var r=this;e=String(e||"utf8").toLowerCase();t=Number(t)||0;n=n!==undefined?Number(n):n=r.length;if(n===t)return"";var i;switch(e){case"hex":i=m(r,t,n);break;case"utf8":case"utf-8":i=p(r,t,n);break;case"ascii":i=d(r,t,n);break;case"binary":i=v(r,t,n);break;case"base64":i=h(r,t,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=g(r,t,n);break;default:throw new Error("Unknown encoding")}return i};s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};s.prototype.copy=function(e,t,n,r){var i=this;if(!n)n=0;if(!r&&r!==0)r=this.length;if(!t)t=0;if(r===n)return;if(e.length===0||i.length===0)return;$(r>=n,"sourceEnd < sourceStart");$(t>=0&&t<e.length,"targetStart out of bounds");$(n>=0&&n<i.length,"sourceStart out of bounds");$(r>=0&&r<=i.length,"sourceEnd out of bounds");if(r>this.length)r=this.length;if(e.length-t<r-n)r=e.length-t+n;var o=r-n;if(o<100||!s._useTypedArrays){for(var u=0;u<o;u++)e[u+t]=this[u+n]}else{e._set(new Uint8Array(this.buffer,n,o),t)}};s.prototype.slice=function(e,t){var n=this.length;e=D(e,n,0);t=D(t,n,n);if(s._useTypedArrays){return _(this.subarray(e,t))}else{var r=t-e;var i=new s(r,undefined,true);for(var o=0;o<r;o++){i[o]=this[o+e]}return i}};s.prototype.get=function(e){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(e)};s.prototype.set=function(e,t){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(e,t)};s.prototype.readUInt8=function(e,t){if(!t){$(e!==undefined&&e!==null,"missing offset");$(e<this.length,"Trying to read beyond buffer length")}if(e>=this.length)return;return this[e]};s.prototype.readUInt16LE=function(e,t){return y(this,e,true,t)};s.prototype.readUInt16BE=function(e,t){return y(this,e,false,t)};s.prototype.readUInt32LE=function(e,t){return b(this,e,true,t)};s.prototype.readUInt32BE=function(e,t){return b(this,e,false,t)};s.prototype.readInt8=function(e,t){if(!t){$(e!==undefined&&e!==null,"missing offset");$(e<this.length,"Trying to read beyond buffer length")}if(e>=this.length)return;var n=this[e]&128;if(n)return(255-this[e]+1)*-1;else return this[e]};s.prototype.readInt16LE=function(e,t){return w(this,e,true,t)};s.prototype.readInt16BE=function(e,t){return w(this,e,false,t)};s.prototype.readInt32LE=function(e,t){return E(this,e,true,t)};s.prototype.readInt32BE=function(e,t){return E(this,e,false,t)};s.prototype.readFloatLE=function(e,t){return S(this,e,true,t)};s.prototype.readFloatBE=function(e,t){return S(this,e,false,t)};s.prototype.readDoubleLE=function(e,t){return x(this,e,true,t)};s.prototype.readDoubleBE=function(e,t){return x(this,e,false,t)};s.prototype.writeUInt8=function(e,t,n){if(!n){$(e!==undefined&&e!==null,"missing value");$(t!==undefined&&t!==null,"missing offset");$(t<this.length,"trying to write beyond buffer length");W(e,255)}if(t>=this.length)return;this[t]=e};s.prototype.writeUInt16LE=function(e,t,n){T(this,e,t,true,n)};s.prototype.writeUInt16BE=function(e,t,n){T(this,e,t,false,n)};s.prototype.writeUInt32LE=function(e,t,n){N(this,e,t,true,n)};s.prototype.writeUInt32BE=function(e,t,n){N(this,e,t,false,n)};s.prototype.writeInt8=function(e,t,n){if(!n){$(e!==undefined&&e!==null,"missing value");$(t!==undefined&&t!==null,"missing offset");$(t<this.length,"Trying to write beyond buffer length");X(e,127,-128)}if(t>=this.length)return;if(e>=0)this.writeUInt8(e,t,n);else this.writeUInt8(255+e+1,t,n)};s.prototype.writeInt16LE=function(e,t,n){C(this,e,t,true,n)};s.prototype.writeInt16BE=function(e,t,n){C(this,e,t,false,n)};s.prototype.writeInt32LE=function(e,t,n){k(this,e,t,true,n)};s.prototype.writeInt32BE=function(e,t,n){k(this,e,t,false,n)};s.prototype.writeFloatLE=function(e,t,n){L(this,e,t,true,n)};s.prototype.writeFloatBE=function(e,t,n){L(this,e,t,false,n)};s.prototype.writeDoubleLE=function(e,t,n){A(this,e,t,true,n)};s.prototype.writeDoubleBE=function(e,t,n){A(this,e,t,false,n)};s.prototype.fill=function(e,t,n){if(!e)e=0;if(!t)t=0;if(!n)n=this.length;if(typeof e==="string"){e=e.charCodeAt(0)}$(typeof e==="number"&&!isNaN(e),"value is not a number");$(n>=t,"end < start");if(n===t)return;if(this.length===0)return;$(t>=0&&t<this.length,"start out of bounds");$(n>=0&&n<=this.length,"end out of bounds");for(var r=t;r<n;r++){this[r]=e}};s.prototype.inspect=function(){var e=[];var t=this.length;for(var r=0;r<t;r++){e[r]=j(this[r]);if(r===n.INSPECT_MAX_BYTES){e[r+1]="...";break}}return"<Buffer "+e.join(" ")+">"};s.prototype.toArrayBuffer=function(){if(typeof Uint8Array==="function"){if(s._useTypedArrays){return(new s(this)).buffer}else{var e=new Uint8Array(this.length);for(var t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer}}else{throw new Error("Buffer.toArrayBuffer not supported in this browser")}};var M=s.prototype},{"base64-js":40,ieee754:41}],40:[function(e,t,n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(e){"use strict";function l(e){var t=e.charCodeAt(0);if(t===s)return 62;if(t===o)return 63;if(t<u)return-1;if(t<u+10)return t-u+26+26;if(t<f+26)return t-f;if(t<a+26)return t-a+26}function c(e){function c(e){u[f++]=e}var t,r,i,s,o,u;if(e.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var a=e.length;o="="===e.charAt(a-2)?2:"="===e.charAt(a-1)?1:0;u=new n(e.length*3/4-o);i=o>0?e.length-4:e.length;var f=0;for(t=0,r=0;t<i;t+=4,r+=3){s=l(e.charAt(t))<<18|l(e.charAt(t+1))<<12|l(e.charAt(t+2))<<6|l(e.charAt(t+3));c((s&16711680)>>16);c((s&65280)>>8);c(s&255)}if(o===2){s=l(e.charAt(t))<<2|l(e.charAt(t+1))>>4;c(s&255)}else if(o===1){s=l(e.charAt(t))<<10|l(e.charAt(t+1))<<4|l(e.charAt(t+2))>>2;c(s>>8&255);c(s&255)}return u}function h(e){function u(e){return r.charAt(e)}function a(e){return u(e>>18&63)+u(e>>12&63)+u(e>>6&63)+u(e&63)}var t,n=e.length%3,i="",s,o;for(t=0,o=e.length-n;t<o;t+=3){s=(e[t]<<16)+(e[t+1]<<8)+e[t+2];i+=a(s)}switch(n){case 1:s=e[e.length-1];i+=u(s>>2);i+=u(s<<4&63);i+="==";break;case 2:s=(e[e.length-2]<<8)+e[e.length-1];i+=u(s>>10);i+=u(s>>4&63);i+=u(s<<2&63);i+="=";break}return i}var n=typeof Uint8Array!=="undefined"?Uint8Array:Array;var i="0".charCodeAt(0);var s="+".charCodeAt(0);var o="/".charCodeAt(0);var u="0".charCodeAt(0);var a="a".charCodeAt(0);var f="A".charCodeAt(0);t.exports.toByteArray=c;t.exports.fromByteArray=h})()},{}],41:[function(e,t,n){n.read=function(e,t,n,r,i){var s,o,u=i*8-r-1,a=(1<<u)-1,f=a>>1,l=-7,c=n?i-1:0,h=n?-1:1,p=e[t+c];c+=h;s=p&(1<<-l)-1;p>>=-l;l+=u;for(;l>0;s=s*256+e[t+c],c+=h,l-=8);o=s&(1<<-l)-1;s>>=-l;l+=r;for(;l>0;o=o*256+e[t+c],c+=h,l-=8);if(s===0){s=1-f}else if(s===a){return o?NaN:(p?-1:1)*Infinity}else{o=o+Math.pow(2,r);s=s-f}return(p?-1:1)*o*Math.pow(2,s-r)};n.write=function(e,t,n,r,i,s){var o,u,a,f=s*8-i-1,l=(1<<f)-1,c=l>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,d=r?1:-1,v=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){u=isNaN(t)?1:0;o=l}else{o=Math.floor(Math.log(t)/Math.LN2);if(t*(a=Math.pow(2,-o))<1){o--;a*=2}if(o+c>=1){t+=h/a}else{t+=h*Math.pow(2,1-c)}if(t*a>=2){o++;a/=2}if(o+c>=l){u=0;o=l}else if(o+c>=1){u=(t*a-1)*Math.pow(2,i);o=o+c}else{u=t*Math.pow(2,c-1)*Math.pow(2,i);o=0}}for(;i>=8;e[n+p]=u&255,p+=d,u/=256,i-=8);o=o<<i|u;f+=i;for(;f>0;e[n+p]=o&255,p+=d,o/=256,f-=8);e[n+p-d]|=v*128}},{}],42:[function(e,t,n){function i(){}var r=t.exports={};r.nextTick=function(){var e=typeof window!=="undefined"&&window.setImmediate;var t=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(e){return function(e){return window.setImmediate(e)}}if(t){var n=[];window.addEventListener("message",function(e){var t=e.source;if((t===window||t===null)&&e.data==="process-tick"){e.stopPropagation();if(n.length>0){var r=n.shift();r()}}},true);return function(t){n.push(t);window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}();r.title="browser";r.browser=true;r.env={};r.argv=[];r.on=i;r.once=i;r.off=i;r.emit=i;r.binding=function(e){throw new Error("process.binding is not supported")};r.cwd=function(){return"/"};r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],43:[function(require,module,exports){(function(e,t){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=e.document?t(e,true):function(e){if(!e.document){throw new Error("jQuery requires a window with a document")}return t(e)}}else{t(e)}})(typeof window!=="undefined"?window:this,function(window,noGlobal){function isArraylike(e){var t=e.length,n=jQuery.type(e);if(n==="function"||jQuery.isWindow(e)){return false}if(e.nodeType===1&&t){return true}return n==="array"||t===0||typeof t==="number"&&t>0&&t-1 in e}function winnow(e,t,n){if(jQuery.isFunction(t)){return jQuery.grep(e,function(e,r){return!!t.call(e,r,e)!==n})}if(t.nodeType){return jQuery.grep(e,function(e){return e===t!==n})}if(typeof t==="string"){if(risSimple.test(t)){return jQuery.filter(t,e,n)}t=jQuery.filter(t,e)}return jQuery.grep(e,function(e){return indexOf.call(t,e)>=0!==n})}function sibling(e,t){while((e=e[t])&&e.nodeType!==1){}return e}function createOptions(e){var t=optionsCache[e]={};jQuery.each(e.match(rnotwhite)||[],function(e,n){t[n]=true});return t}function completed(){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false);jQuery.ready()}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=jQuery.expando+Math.random()}function dataAttr(e,t,n){var r;if(n===undefined&&e.nodeType===1){r="data-"+t.replace(rmultiDash,"-$1").toLowerCase();n=e.getAttribute(r);if(typeof n==="string"){try{n=n==="true"?true:n==="false"?false:n==="null"?null:+n+""===n?+n:rbrace.test(n)?jQuery.parseJSON(n):n}catch(i){}data_user.set(e,t,n)}else{n=undefined}}return n}function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(e){}}function manipulationTarget(e,t){return jQuery.nodeName(e,"table")&&jQuery.nodeName(t.nodeType!==11?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function disableScript(e){e.type=(e.getAttribute("type")!==null)+"/"+e.type;return e}function restoreScript(e){var t=rscriptTypeMasked.exec(e.type);if(t){e.type=t[1]}else{e.removeAttribute("type")}return e}function setGlobalEval(e,t){var n=0,r=e.length;for(;n<r;n++){data_priv.set(e[n],"globalEval",!t||data_priv.get(t[n],"globalEval"))}}function cloneCopyEvent(e,t){var n,r,i,s,o,u,a,f;if(t.nodeType!==1){return}if(data_priv.hasData(e)){s=data_priv.access(e);o=data_priv.set(t,s);f=s.events;if(f){delete o.handle;o.events={};for(i in f){for(n=0,r=f[i].length;n<r;n++){jQuery.event.add(t,i,f[i][n])}}}}if(data_user.hasData(e)){u=data_user.access(e);a=jQuery.extend({},u);data_user.set(t,a)}}function getAll(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&jQuery.nodeName(e,t)?jQuery.merge([e],n):n}function fixInput(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&rcheckableType.test(e.type)){t.checked=e.checked}else if(n==="input"||n==="textarea"){t.defaultValue=e.defaultValue}}function actualDisplay(e,t){var n=jQuery(t.createElement(e)).appendTo(t.body),r=window.getDefaultComputedStyle?window.getDefaultComputedStyle(n[0]).display:jQuery.css(n[0],"display");n.detach();return r}function defaultDisplay(e){var t=document,n=elemdisplay[e];if(!n){n=actualDisplay(e,t);if(n==="none"||!n){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement);t=iframe[0].contentDocument;t.write();t.close();n=actualDisplay(e,t);iframe.detach()}elemdisplay[e]=n}return n}function curCSS(e,t,n){var r,i,s,o,u=e.style;n=n||getStyles(e);if(n){o=n.getPropertyValue(t)||n[t]}if(n){if(o===""&&!jQuery.contains(e.ownerDocument,e)){o=jQuery.style(e,t)}if(rnumnonpx.test(o)&&rmargin.test(t)){r=u.width;i=u.minWidth;s=u.maxWidth;u.minWidth=u.maxWidth=u.width=o;o=n.width;u.width=r;u.minWidth=i;u.maxWidth=s}}return o!==undefined?o+"":o}function addGetHookIf(e,t){return{get:function(){if(e()){delete this.get;return}return(this.get=t).apply(this,arguments)}}}function vendorPropName(e,t){if(t in e){return t}var n=t[0].toUpperCase()+t.slice(1),r=t,i=cssPrefixes.length;while(i--){t=cssPrefixes[i]+n;if(t in e){return t}}return r}function setPositiveNumber(e,t,n){var r=rnumsplit.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function augmentWidthOrHeight(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2){if(n==="margin"){o+=jQuery.css(e,n+cssExpand[s],true,i)}if(r){if(n==="content"){o-=jQuery.css(e,"padding"+cssExpand[s],true,i)}if(n!=="margin"){o-=jQuery.css(e,"border"+cssExpand[s]+"Width",true,i)}}else{o+=jQuery.css(e,"padding"+cssExpand[s],true,i);if(n!=="padding"){o+=jQuery.css(e,"border"+cssExpand[s]+"Width",true,i)}}}return o}function getWidthOrHeight(e,t,n){var r=true,i=t==="width"?e.offsetWidth:e.offsetHeight,s=getStyles(e),o=jQuery.css(e,"boxSizing",false,s)==="border-box";if(i<=0||i==null){i=curCSS(e,t,s);if(i<0||i==null){i=e.style[t]}if(rnumnonpx.test(i)){return i}r=o&&(support.boxSizingReliable()||i===e.style[t]);i=parseFloat(i)||0}return i+augmentWidthOrHeight(e,t,n||(o?"border":"content"),r,s)+"px"}function showHide(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style){continue}s[o]=data_priv.get(r,"olddisplay");n=r.style.display;if(t){if(!s[o]&&n==="none"){r.style.display=""}if(r.style.display===""&&isHidden(r)){s[o]=data_priv.access(r,"olddisplay",defaultDisplay(r.nodeName))}}else{if(!s[o]){i=isHidden(r);if(n&&n!=="none"||!i){data_priv.set(r,"olddisplay",i?n:jQuery.css(r,"display"))}}}}for(o=0;o<u;o++){r=e[o];if(!r.style){continue}if(!t||r.style.display==="none"||r.style.display===""){r.style.display=t?s[o]||"":"none"}}return e}function Tween(e,t,n,r,i){return new Tween.prototype.init(e,t,n,r,i)}function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function genFx(e,t){var n,r=0,i={height:e};t=t?1:0;for(;r<4;r+=2-t){n=cssExpand[r];i["margin"+n]=i["padding"+n]=e}if(t){i.opacity=i.width=e}return i}function createTween(e,t,n){var r,i=(tweeners[t]||[]).concat(tweeners["*"]),s=0,o=i.length;for(;s<o;s++){if(r=i[s].call(n,t,e)){return r}}}function defaultPrefilter(e,t,n){var r,i,s,o,u,a,f,l=this,c={},h=e.style,p=e.nodeType&&isHidden(e),d=data_priv.get(e,"fxshow");if(!n.queue){u=jQuery._queueHooks(e,"fx");if(u.unqueued==null){u.unqueued=0;a=u.empty.fire;u.empty.fire=function(){if(!u.unqueued){a()}}}u.unqueued++;l.always(function(){l.always(function(){u.unqueued--;if(!jQuery.queue(e,"fx").length){u.empty.fire()}})})}if(e.nodeType===1&&("height"in t||"width"in t)){n.overflow=[h.overflow,h.overflowX,h.overflowY];f=jQuery.css(e,"display");if(f==="none"){f=defaultDisplay(e.nodeName)}if(f==="inline"&&jQuery.css(e,"float")==="none"){h.display="inline-block"}}if(n.overflow){h.overflow="hidden";l.always(function(){h.overflow=n.overflow[0];h.overflowX=n.overflow[1];h.overflowY=n.overflow[2]})}for(r in t){i=t[r];if(rfxtypes.exec(i)){delete t[r];s=s||i==="toggle";if(i===(p?"hide":"show")){if(i==="show"&&d&&d[r]!==undefined){p=true}else{continue}}c[r]=d&&d[r]||jQuery.style(e,r)}}if(!jQuery.isEmptyObject(c)){if(d){if("hidden"in d){p=d.hidden}}else{d=data_priv.access(e,"fxshow",{})}if(s){d.hidden=!p}if(p){jQuery(e).show()}else{l.done(function(){jQuery(e).hide()})}l.done(function(){var t;data_priv.remove(e,"fxshow");for(t in c){jQuery.style(e,t,c[t])}});for(r in c){o=createTween(p?d[r]:0,r,l);if(!(r in d)){d[r]=o.start;if(p){o.end=o.start;o.start=r==="width"||r==="height"?1:0}}}}}function propFilter(e,t){var n,r,i,s,o;for(n in e){r=jQuery.camelCase(n);i=t[r];s=e[n];if(jQuery.isArray(s)){i=s[1];s=e[n]=s[0]}if(n!==r){e[r]=s;delete e[n]}o=jQuery.cssHooks[r];if(o&&"expand"in o){s=o.expand(s);delete e[r];for(n in s){if(!(n in e)){e[n]=s[n];t[n]=i}}}else{t[r]=i}}}function Animation(e,t,n){var r,i,s=0,o=animationPrefilters.length,u=jQuery.Deferred().always(function(){delete a.elem}),a=function(){if(i){return false}var t=fxNow||createFxNow(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++){f.tweens[o].run(s)}u.notifyWith(e,[f,s,n]);if(s<1&&a){return n}else{u.resolveWith(e,[f]);return false}},f=u.promise({elem:e,props:jQuery.extend({},t),opts:jQuery.extend(true,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:fxNow||createFxNow(),duration:n.duration,tweens:[],createTween:function(t,n){var r=jQuery.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);f.tweens.push(r);return r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i){return this}i=true;for(;n<r;n++){f.tweens[n].run(1)}if(t){u.resolveWith(e,[f,t])}else{u.rejectWith(e,[f,t])}return this}}),l=f.props;propFilter(l,f.opts.specialEasing);for(;s<o;s++){r=animationPrefilters[s].call(f,e,l,f.opts);if(r){return r}}jQuery.map(l,createTween,f);if(jQuery.isFunction(f.opts.start)){f.opts.start.call(e,f)}jQuery.fx.timer(jQuery.extend(a,{elem:e,anim:f,queue:f.opts.queue}));return f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function addToPrefiltersOrTransports(e){return function(t,n){if(typeof t!=="string"){n=t;t="*"}var r,i=0,s=t.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(n)){while(r=s[i++]){if(r[0]==="+"){r=r.slice(1)||"*";(e[r]=e[r]||[]).unshift(n)}else{(e[r]=e[r]||[]).push(n)}}}}}function inspectPrefiltersOrTransports(e,t,n,r){function o(u){var a;i[u]=true;jQuery.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f==="string"&&!s&&!i[f]){t.dataTypes.unshift(f);o(f);return false}else if(s){return!(a=f)}});return a}var i={},s=e===transports;return o(t.dataTypes[0])||!i["*"]&&o("*")}function ajaxExtend(e,t){var n,r,i=jQuery.ajaxSettings.flatOptions||{};for(n in t){if(t[n]!==undefined){(i[n]?e:r||(r={}))[n]=t[n]}}if(r){jQuery.extend(true,e,r)}return e}function ajaxHandleResponses(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*"){a.shift();if(r===undefined){r=e.mimeType||t.getResponseHeader("Content-Type")}}if(r){for(i in u){if(u[i]&&u[i].test(r)){a.unshift(i);break}}}if(a[0]in n){s=a[0]}else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}if(!o){o=i}}s=s||o}if(s){if(s!==a[0]){a.unshift(s)}return n[s]}}function ajaxConvert(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1]){for(o in e.converters){f[o.toLowerCase()]=e.converters[o]}}s=l.shift();while(s){if(e.responseFields[s]){n[e.responseFields[s]]=t}if(!a&&r&&e.dataFilter){t=e.dataFilter(t,e.dataType)}a=s;s=l.shift();if(s){if(s==="*"){s=a}else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o){for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){if(o===true){o=f[i]}else if(f[i]!==true){s=u[0];l.unshift(u[1])}break}}}}if(o!==true){if(o&&e["throws"]){t=o(t)}else{try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}}}}return{state:"success",data:t}}function buildParams(e,t,n,r){var i;if(jQuery.isArray(t)){jQuery.each(t,function(t,i){if(n||rbracket.test(e)){r(e,i)}else{buildParams(e+"["+(typeof i==="object"?t:"")+"]",i,n,r)}})}else if(!n&&jQuery.type(t)==="object"){for(i in t){buildParams(e+"["+i+"]",t[i],n,r)}}else{r(e,t)}}function getWindow(e){return jQuery.isWindow(e)?e:e.nodeType===9&&e.defaultView}var arr=[];var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var trim="".trim;var support={};var document=window.document,version="2.1.0",jQuery=function(e,t){return new jQuery.fn.init(e,t)},rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(e,t){return t.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(e){return e!=null?e<0?this[e+this.length]:this[e]:slice.call(this)},pushStack:function(e){var t=jQuery.merge(this.constructor(),e);t.prevObject=this;t.context=this.context;return t},each:function(e,t){return jQuery.each(this,e,t)},map:function(e){return this.pushStack(jQuery.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=false;if(typeof o==="boolean"){f=o;o=arguments[u]||{};u++}if(typeof o!=="object"&&!jQuery.isFunction(o)){o={}}if(u===a){o=this;u--}for(;u<a;u++){if((e=arguments[u])!=null){for(t in e){n=o[t];r=e[t];if(o===r){continue}if(f&&r&&(jQuery.isPlainObject(r)||(i=jQuery.isArray(r)))){if(i){i=false;s=n&&jQuery.isArray(n)?n:[]}else{s=n&&jQuery.isPlainObject(n)?n:{}}o[t]=jQuery.extend(f,s,r)}else if(r!==undefined){o[t]=r}}}}return o};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return jQuery.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return e-parseFloat(e)>=0},isPlainObject:function(e){if(jQuery.type(e)!=="object"||e.nodeType||jQuery.isWindow(e)){return false}try{if(e.constructor&&!hasOwn.call(e.constructor.prototype,"isPrototypeOf")){return false}}catch(t){return false}return true},isEmptyObject:function(e){var t;for(t in e){return false}return true},type:function(e){if(e==null){return e+""}return typeof e==="object"||typeof e==="function"?class2type[toString.call(e)]||"object":typeof e},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code);if(code){if(code.indexOf("use strict")===1){script=document.createElement("script");script.text=code;document.head.appendChild(script).parentNode.removeChild(script)}else{indirect(code)}}},camelCase:function(e){return e.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e);if(n){if(o){for(;i<s;i++){r=t.apply(e[i],n);if(r===false){break}}}else{for(i in e){r=t.apply(e[i],n);if(r===false){break}}}}else{if(o){for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===false){break}}}else{for(i in e){r=t.call(e[i],i,e[i]);if(r===false){break}}}}return e},trim:function(e){return e==null?"":trim.call(e)},makeArray:function(e,t){var n=t||[];if(e!=null){if(isArraylike(Object(e))){jQuery.merge(n,typeof e==="string"?[e]:e)}else{push.call(n,e)}}return n},inArray:function(e,t,n){return t==null?-1:indexOf.call(t,e,n)},merge:function(e,t){var n=+t.length,r=0,i=e.length;for(;r<n;r++){e[i++]=t[r]}e.length=i;return e},grep:function(e,t,n){var r,i=[],s=0,o=e.length,u=!n;for(;s<o;s++){r=!t(e[s],s);if(r!==u){i.push(e[s])}}return i},map:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e),u=[];if(o){for(;i<s;i++){r=t(e[i],i,n);if(r!=null){u.push(r)}}}else{for(i in e){r=t(e[i],i,n);if(r!=null){u.push(r)}}}return concat.apply([],u)},guid:1,proxy:function(e,t){var n,r,i;if(typeof t==="string"){n=e[t];t=e;e=n}if(!jQuery.isFunction(e)){return undefined}r=slice.call(arguments,2);i=function(){return e.apply(t||this,r.concat(slice.call(arguments)))};i.guid=e.guid=e.guid||jQuery.guid++;return i},now:Date.now,support:support});jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()});var Sizzle=function(e){function rt(e,t,r,i){var s,o,u,a,f,h,v,m,w,E;if((t?t.ownerDocument||t:b)!==c){l(t)}t=t||c;r=r||[];if(!e||typeof e!=="string"){return r}if((a=t.nodeType)!==1&&a!==9){return[]}if(p&&!i){if(s=G.exec(e)){if(u=s[1]){if(a===9){o=t.getElementById(u);if(o&&o.parentNode){if(o.id===u){r.push(o);return r}}else{return r}}else{if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&g(t,o)&&o.id===u){r.push(o);return r}}}else if(s[2]){_.apply(r,t.getElementsByTagName(e));return r}else if((u=s[3])&&n.getElementsByClassName&&t.getElementsByClassName){_.apply(r,t.getElementsByClassName(u));return r}}if(n.qsa&&(!d||!d.test(e))){m=v=y;w=t;E=a===9&&e;if(a===1&&t.nodeName.toLowerCase()!=="object"){h=dt(e);if(v=t.getAttribute("id")){m=v.replace(Z,"\\$&")}else{t.setAttribute("id",m)}m="[id='"+m+"'] ";f=h.length;while(f--){h[f]=m+vt(h[f])}w=Y.test(e)&&ht(t.parentNode)||t;E=h.join(",")}if(E){try{_.apply(r,w.querySelectorAll(E));return r}catch(S){}finally{if(!v){t.removeAttribute("id")}}}}}return xt(e.replace(R,"$1"),t,r,i)}function it(){function t(n,i){if(e.push(n+" ")>r.cacheLength){delete t[e.shift()]}return t[n+" "]=i}var e=[];return t}function st(e){e[y]=true;return e}function ot(e){var t=c.createElement("div");try{return!!e(t)}catch(n){return false}finally{if(t.parentNode){t.parentNode.removeChild(t)}t=null}}function ut(e,t){var n=e.split("|"),i=e.length;while(i--){r.attrHandle[n[i]]=t}}function at(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||k)-(~e.sourceIndex||k);if(r){return r}if(n){while(n=n.nextSibling){if(n===t){return-1}}}return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function ct(e){return st(function(t){t=+t;return st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--){if(n[i=s[o]]){n[i]=!(r[i]=n[i])}}})})}function ht(e){return e&&typeof e.getElementsByTagName!==C&&e}function pt(){}function dt(e,t){var n,i,s,o,u,a,f,l=x[e+" "];if(l){return t?0:l.slice(0)}u=e;a=[];f=r.preFilter;while(u){if(!n||(i=U.exec(u))){if(i){u=u.slice(i[0].length)||u}a.push(s=[])}n=false;if(i=z.exec(u)){n=i.shift();s.push({value:n,type:i[0].replace(R," ")});u=u.slice(n.length)}for(o in r.filter){if((i=$[o].exec(u))&&(!f[o]||(i=f[o](i)))){n=i.shift();s.push({value:n,type:o,matches:i});u=u.slice(n.length)}}if(!n){break}}return t?u.length:u?rt.error(e):x(e,a).slice(0)}function vt(e){var t=0,n=e.length,r="";for(;t<n;t++){r+=e[t].value}return r}function mt(e,t,n){var r=t.dir,i=n&&r==="parentNode",s=E++;return t.first?function(t,n,s){while(t=t[r]){if(t.nodeType===1||i){return e(t,n,s)}}}:function(t,n,o){var u,a,f=[w,s];if(o){while(t=t[r]){if(t.nodeType===1||i){if(e(t,n,o)){return true}}}}else{while(t=t[r]){if(t.nodeType===1||i){a=t[y]||(t[y]={});if((u=a[r])&&u[0]===w&&u[1]===s){return f[2]=u[2]}else{a[r]=f;if(f[2]=e(t,n,o)){return true}}}}}}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--){if(!e[i](t,n,r)){return false}}return true}:e[0]}function yt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++){if(s=e[u]){if(!n||n(s,r,i)){o.push(s);if(f){t.push(u)}}}}return o}function bt(e,t,n,r,i,s){if(r&&!r[y]){r=bt(r)}if(i&&!i[y]){i=bt(i,s)}return st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||St(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?yt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;if(n){n(m,g,u,a)}if(r){f=yt(g,p);r(f,[],u,a);l=f.length;while(l--){if(c=f[l]){g[p[l]]=!(m[p[l]]=c)}}}if(s){if(i||e){if(i){f=[];l=g.length;while(l--){if(c=g[l]){f.push(m[l]=c)}}i(null,g=[],f,a)}l=g.length;while(l--){if((c=g[l])&&(f=i?P.call(s,c):h[l])>-1){s[f]=!(o[f]=c)}}}}else{g=yt(g===o?g.splice(d,g.length):g);if(i){i(null,o,g,a)}else{_.apply(o,g)}}})}function wt(e){var t,n,i,s=e.length,o=r.relative[e[0].type],a=o||r.relative[" "],f=o?1:0,l=mt(function(e){return e===t},a,true),c=mt(function(e){return P.call(t,e)>-1},a,true),h=[function(e,n,r){return!o&&(r||n!==u)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;f<s;f++){if(n=r.relative[e[f].type]){h=[mt(gt(h),n)]}else{n=r.filter[e[f].type].apply(null,e[f].matches);if(n[y]){i=++f;for(;i<s;i++){if(r.relative[e[i].type]){break}}return bt(f>1&&gt(h),f>1&&vt(e.slice(0,f-1).concat({value:e[f-2].type===" "?"*":""})).replace(R,"$1"),n,f<i&&wt(e.slice(f,i)),i<s&&wt(e=e.slice(i)),i<s&&vt(e))}h.push(n)}}return gt(h)}function Et(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,a,f,l){var h,p,d,v=0,m="0",g=s&&[],y=[],b=u,E=s||i&&r.find["TAG"]("*",l),S=w+=b==null?1:Math.random()||.1,x=E.length;if(l){u=o!==c&&o}for(;m!==x&&(h=E[m])!=null;m++){if(i&&h){p=0;while(d=e[p++]){if(d(h,o,a)){f.push(h);break}}if(l){w=S}}if(n){if(h=!d&&h){v--}if(s){g.push(h)}}}v+=m;if(n&&m!==v){p=0;while(d=t[p++]){d(g,y,o,a)}if(s){if(v>0){while(m--){if(!(g[m]||y[m])){y[m]=O.call(f)}}}y=yt(y)}_.apply(f,y);if(l&&!s&&y.length>0&&v+t.length>1){rt.uniqueSort(f)}}if(l){w=S;u=b}return g};return n?st(s):s}function St(e,t,n){var r=0,i=t.length;for(;r<i;r++){rt(e,t[r],n)}return n}function xt(e,t,i,s){var u,a,f,l,c,h=dt(e);if(!s){if(h.length===1){a=h[0]=h[0].slice(0);if(a.length>2&&(f=a[0]).type==="ID"&&n.getById&&t.nodeType===9&&p&&r.relative[a[1].type]){t=(r.find["ID"](f.matches[0].replace(et,tt),t)||[])[0];if(!t){return i}e=e.slice(a.shift().value.length)}u=$["needsContext"].test(e)?0:a.length;while(u--){f=a[u];if(r.relative[l=f.type]){break}if(c=r.find[l]){if(s=c(f.matches[0].replace(et,tt),Y.test(a[0].type)&&ht(t.parentNode)||t)){a.splice(u,1);e=s.length&&vt(a);if(!e){_.apply(i,s);return i}break}}}}}o(e,h)(s,t,!p,i,Y.test(e)&&ht(t.parentNode)||t);return i}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y="sizzle"+ -(new Date),b=e.document,w=0,E=0,S=it(),x=it(),T=it(),N=function(e,t){if(e===t){f=true}return 0},C=typeof undefined,k=1<<31,L={}.hasOwnProperty,A=[],O=A.pop,M=A.push,_=A.push,D=A.slice,P=A.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++){if(this[t]===e){return t}}return-1},H="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",j="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",F=j.replace("w","w#"),I="\\["+B+"*("+j+")"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+F+")|)|)"+B+"*\\]",q=":("+j+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),U=new RegExp("^"+B+"*,"+B+"*"),z=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),W=new RegExp("="+B+"*([^\\]'\"]*?)"+B+"*\\]","g"),X=new RegExp(q),V=new RegExp("^"+F+"$"),$={ID:new RegExp("^#("+j+")"),CLASS:new RegExp("^\\.("+j+")"),TAG:new RegExp("^("+j.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+H+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},J=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,G=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Y=/[+~]/,Z=/'|\\/g,et=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),tt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{_.apply(A=D.call(b.childNodes),b.childNodes);A[b.childNodes.length].nodeType}catch(nt){_={apply:A.length?function(e,t){M.apply(e,D.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]){}e.length=n-1}}}n=rt.support={};s=rt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":false};l=rt.setDocument=function(e){var t,i=e?e.ownerDocument||e:b,o=i.defaultView;if(i===c||i.nodeType!==9||!i.documentElement){return c}c=i;h=i.documentElement;p=!s(i);if(o&&o!==o.top){if(o.addEventListener){o.addEventListener("unload",function(){l()},false)}else if(o.attachEvent){o.attachEvent("onunload",function(){l()})}}n.attributes=ot(function(e){e.className="i";return!e.getAttribute("className")});n.getElementsByTagName=ot(function(e){e.appendChild(i.createComment(""));return!e.getElementsByTagName("*").length});n.getElementsByClassName=Q.test(i.getElementsByClassName)&&ot(function(e){e.innerHTML="<div class='a'></div><div class='a i'></div>";e.firstChild.className="i";return e.getElementsByClassName("i").length===2});n.getById=ot(function(e){h.appendChild(e).id=y;return!i.getElementsByName||!i.getElementsByName(y).length});if(n.getById){r.find["ID"]=function(e,t){if(typeof t.getElementById!==C&&p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}};r.filter["ID"]=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}}else{delete r.find["ID"];r.filter["ID"]=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==C&&e.getAttributeNode("id");return n&&n.value===t}}}r.find["TAG"]=n.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==C){return t.getElementsByTagName(e)}}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++]){if(n.nodeType===1){r.push(n)}}return r}return s};r.find["CLASS"]=n.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==C&&p){return t.getElementsByClassName(e)}};v=[];d=[];if(n.qsa=Q.test(i.querySelectorAll)){ot(function(e){e.innerHTML="<select t=''><option selected=''></option></select>";if(e.querySelectorAll("[t^='']").length){d.push("[*^$]="+B+"*(?:''|\"\")")}if(!e.querySelectorAll("[selected]").length){d.push("\\["+B+"*(?:value|"+H+")")}if(!e.querySelectorAll(":checked").length){d.push(":checked")}});ot(function(e){var t=i.createElement("input");t.setAttribute("type","hidden");e.appendChild(t).setAttribute("name","D");if(e.querySelectorAll("[name=d]").length){d.push("name"+B+"*[*^$|!~]?=")}if(!e.querySelectorAll(":enabled").length){d.push(":enabled",":disabled")}e.querySelectorAll("*,:x");d.push(",.*:")})}if(n.matchesSelector=Q.test(m=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector)){ot(function(e){n.disconnectedMatch=m.call(e,"div");m.call(e,"[s!='']:x");v.push("!=",q)})}d=d.length&&new RegExp(d.join("|"));v=v.length&&new RegExp(v.join("|"));t=Q.test(h.compareDocumentPosition);g=t||Q.test(h.contains)?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16))}:function(e,t){if(t){while(t=t.parentNode){if(t===e){return true}}}return false};N=t?function(e,t){if(e===t){f=true;return 0}var r=!e.compareDocumentPosition-!t.compareDocumentPosition;if(r){return r}r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1;if(r&1||!n.sortDetached&&t.compareDocumentPosition(e)===r){if(e===i||e.ownerDocument===b&&g(b,e)){return-1}if(t===i||t.ownerDocument===b&&g(b,t)){return 1}return a?P.call(a,e)-P.call(a,t):0}return r&4?-1:1}:function(e,t){if(e===t){f=true;return 0}var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],l=[t];if(!s||!o){return e===i?-1:t===i?1:s?-1:o?1:a?P.call(a,e)-P.call(a,t):0}else if(s===o){return at(e,t)}n=e;while(n=n.parentNode){u.unshift(n)}n=t;while(n=n.parentNode){l.unshift(n)}while(u[r]===l[r]){r++}return r?at(u[r],l[r]):u[r]===b?-1:l[r]===b?1:0};return i};rt.matches=function(e,t){return rt(e,null,null,t)};rt.matchesSelector=function(e,t){if((e.ownerDocument||e)!==c){l(e)}t=t.replace(W,"='$1']");if(n.matchesSelector&&p&&(!v||!v.test(t))&&(!d||!d.test(t))){try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&e.document.nodeType!==11){return r}}catch(i){}}return rt(t,c,null,[e]).length>0};rt.contains=function(e,t){if((e.ownerDocument||e)!==c){l(e)}return g(e,t)};rt.attr=function(e,t){if((e.ownerDocument||e)!==c){l(e)}var i=r.attrHandle[t.toLowerCase()],s=i&&L.call(r.attrHandle,t.toLowerCase())?i(e,t,!p):undefined;return s!==undefined?s:n.attributes||!p?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null};rt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};rt.uniqueSort=function(e){var t,r=[],i=0,s=0;f=!n.detectDuplicates;a=!n.sortStable&&e.slice(0);e.sort(N);if(f){while(t=e[s++]){if(t===e[s]){i=r.push(s)}}while(i--){e.splice(r[i],1)}}a=null;return e};i=rt.getText=function(e){var t,n="",r=0,s=e.nodeType;if(!s){while(t=e[r++]){n+=i(t)}}else if(s===1||s===9||s===11){if(typeof e.textContent==="string"){return e.textContent}else{for(e=e.firstChild;e;e=e.nextSibling){n+=i(e)}}}else if(s===3||s===4){return e.nodeValue}return n};r=rt.selectors={cacheLength:50,createPseudo:st,match:$,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(et,tt);e[3]=(e[4]||e[5]||"").replace(et,tt);if(e[2]==="~="){e[3]=" "+e[3]+" "}return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if(e[1].slice(0,3)==="nth"){if(!e[3]){rt.error(e[0])}e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd"));e[5]=+(e[7]+e[8]||e[3]==="odd")}else if(e[3]){rt.error(e[0])}return e},PSEUDO:function(e){var t,n=!e[5]&&e[2];if($["CHILD"].test(e[0])){return null}if(e[3]&&e[4]!==undefined){e[2]=e[4]}else if(n&&X.test(n)&&(t=dt(n,true))&&(t=n.indexOf(")",n.length-t)-n.length)){e[0]=e[0].slice(0,t);e[2]=n.slice(0,t)}return e.slice(0,3)}},filter:{TAG:function(e){var t=e.replace(et,tt).toLowerCase();return e==="*"?function(){return true}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=S[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&S(e,function(e){return t.test(typeof e.className==="string"&&e.className||typeof e.getAttribute!==C&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=rt.attr(r,e);if(i==null){return t==="!="}if(!t){return true}i+="";return t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":false}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),b=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v]){if(u?c.nodeName.toLowerCase()===g:c.nodeType===1){return false}}d=v=e==="only"&&!d&&"nextSibling"}return true}d=[o?m.firstChild:m.lastChild];if(o&&b){l=m[y]||(m[y]={});f=l[e]||[];p=f[0]===w&&f[1];h=f[0]===w&&f[2];c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop()){if(c.nodeType===1&&++h&&c===t){l[e]=[w,p,h];break}}}else if(b&&(f=(t[y]||(t[y]={}))[e])&&f[0]===w){h=f[1]}else{while(c=++p&&c&&c[v]||(h=p=0)||d.pop()){if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){if(b){(c[y]||(c[y]={}))[e]=[w,h]}if(c===t){break}}}}h-=i;return h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||rt.error("unsupported pseudo: "+e);if(i[y]){return i(t)}if(i.length>1){n=[e,e,"",t];return r.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var r,s=i(e,t),o=s.length;while(o--){r=P.call(e,s[o]);e[r]=!(n[r]=s[o])}}):function(e){return i(e,0,n)}}return i}},pseudos:{not:st(function(e){var t=[],n=[],r=o(e.replace(R,"$1"));return r[y]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--){if(s=o[u]){e[u]=!(t[u]=s)}}}):function(e,i,s){t[0]=e;r(t,null,s,n);return!n.pop()}}),has:st(function(e){return function(t){return rt(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:st(function(e){if(!V.test(e||"")){rt.error("unsupported lang: "+e)}e=e.replace(et,tt).toLowerCase();return function(t){var n;do{if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang")){n=n.toLowerCase();return n===e||n.indexOf(e+"-")===0}}while((t=t.parentNode)&&t.nodeType===1);return false}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===false},disabled:function(e){return e.disabled===true},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){if(e.parentNode){e.parentNode.selectedIndex}return e.selected===true},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling){if(e.nodeType<6){return false}}return true},parent:function(e){return!r.pseudos["empty"](e)},header:function(e){return K.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()==="text")},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[n<0?n+t:n]}),even:ct(function(e,t){var n=0;for(;n<t;n+=2){e.push(n)}return e}),odd:ct(function(e,t){var n=1;for(;n<t;n+=2){e.push(n)}return e}),lt:ct(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;){e.push(r)}return e}),gt:ct(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;){e.push(r)}return e})}};r.pseudos["nth"]=r.pseudos["eq"];for(t in{radio:true,checkbox:true,file:true,password:true,image:true}){r.pseudos[t]=ft(t)}for(t in{submit:true,reset:true}){r.pseudos[t]=lt(t)}pt.prototype=r.filters=r.pseudos;r.setFilters=new pt;o=rt.compile=function(e,t){var n,r=[],i=[],s=T[e+" "];if(!s){if(!t){t=dt(e)}n=t.length;while(n--){s=wt(t[n]);if(s[y]){r.push(s)}else{i.push(s)}}s=T(e,Et(i,r))}return s};n.sortStable=y.split("").sort(N).join("")===y;n.detectDuplicates=!!f;l();n.sortDetached=ot(function(e){return e.compareDocumentPosition(c.createElement("div"))&1});if(!ot(function(e){e.innerHTML="<a href='#'></a>";return e.firstChild.getAttribute("href")==="#"})){ut("type|href|height|width",function(e,t,n){if(!n){return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}})}if(!n.attributes||!ot(function(e){e.innerHTML="<input/>";e.firstChild.setAttribute("value","");return e.firstChild.getAttribute("value")===""})){ut("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input"){return e.defaultValue}})}if(!ot(function(e){return e.getAttribute("disabled")==null})){ut(H,function(e,t,n){var r;if(!n){return e[t]===true?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}})}return rt}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/;var risSimple=/^.[^:#\[\.,]*$/;jQuery.filter=function(e,t,n){var r=t[0];if(n){e=":not("+e+")"}return t.length===1&&r.nodeType===1?jQuery.find.matchesSelector(r,e)?[r]:[]:jQuery.find.matches(e,jQuery.grep(t,function(e){return e.nodeType===1}))};jQuery.fn.extend({find:function(e){var t,n=this.length,r=[],i=this;if(typeof e!=="string"){return this.pushStack(jQuery(e).filter(function(){for(t=0;t<n;t++){if(jQuery.contains(i[t],this)){return true}}}))}for(t=0;t<n;t++){jQuery.find(e,i[t],r)}r=this.pushStack(n>1?jQuery.unique(r):r);r.selector=this.selector?this.selector+" "+e:e;return r},filter:function(e){return this.pushStack(winnow(this,e||[],false))},not:function(e){return this.pushStack(winnow(this,e||[],true))},is:function(e){return!!winnow(this,typeof e==="string"&&rneedsContext.test(e)?jQuery(e):e||[],false).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(e,t){var n,r;if(!e){return this}if(typeof e==="string"){if(e[0]==="<"&&e[e.length-1]===">"&&e.length>=3){n=[null,e,null]}else{n=rquickExpr.exec(e)}if(n&&(n[1]||!t)){if(n[1]){t=t instanceof jQuery?t[0]:t;jQuery.merge(this,jQuery.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:document,true));if(rsingleTag.test(n[1])&&jQuery.isPlainObject(t)){for(n in t){if(jQuery.isFunction(this[n])){this[n](t[n])}else{this.attr(n,t[n])}}}return this}else{r=document.getElementById(n[2]);if(r&&r.parentNode){this.length=1;this[0]=r}this.context=document;this.selector=e;return this}}else if(!t||t.jquery){return(t||rootjQuery).find(e)}else{return this.constructor(t).find(e)}}else if(e.nodeType){this.context=this[0]=e;this.length=1;return this}else if(jQuery.isFunction(e)){return typeof rootjQuery.ready!=="undefined"?rootjQuery.ready(e):e(jQuery)}if(e.selector!==undefined){this.selector=e.selector;this.context=e.context}return jQuery.makeArray(e,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.extend({dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&e.nodeType!==9){if(e.nodeType===1){if(i&&jQuery(e).is(n)){break}r.push(e)}}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling){if(e.nodeType===1&&e!==t){n.push(e)}}return n}});jQuery.fn.extend({has:function(e){var t=jQuery(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++){if(jQuery.contains(this,t[e])){return true}}})},closest:function(e,t){var n,r=0,i=this.length,s=[],o=rneedsContext.test(e)||typeof e!=="string"?jQuery(e,t||this.context):0;for(;r<i;r++){for(n=this[r];n&&n!==t;n=n.parentNode){if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&jQuery.find.matchesSelector(n,e))){s.push(n);break}}}return this.pushStack(s.length>1?jQuery.unique(s):s)},index:function(e){if(!e){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof e==="string"){return indexOf.call(jQuery(e),this[0])}return indexOf.call(this,e.jquery?e[0]:e)},add:function(e,t){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(e,t))))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}});jQuery.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return jQuery.dir(e,"parentNode")},parentsUntil:function(e,t,n){return jQuery.dir(e,"parentNode",n)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return jQuery.dir(e,"nextSibling")},prevAll:function(e){return jQuery.dir(e,"previousSibling")},nextUntil:function(e,t,n){return jQuery.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return jQuery.dir(e,"previousSibling",n)},siblings:function(e){return jQuery.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return jQuery.sibling(e.firstChild)},contents:function(e){return e.contentDocument||jQuery.merge([],e.childNodes)}},function(e,t){jQuery.fn[e]=function(n,r){var i=jQuery.map(this,t,n);if(e.slice(-5)!=="Until"){r=n}if(r&&typeof r==="string"){i=jQuery.filter(r,i)}if(this.length>1){if(!guaranteedUnique[e]){jQuery.unique(i)}if(rparentsprev.test(e)){i.reverse()}}return this.pushStack(i)}});var rnotwhite=/\S+/g;var optionsCache={};jQuery.Callbacks=function(e){e=typeof e==="string"?optionsCache[e]||createOptions(e):jQuery.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){t=e.memory&&c;n=true;o=i||0;i=0;s=u.length;r=true;for(;u&&o<s;o++){if(u[o].apply(c[0],c[1])===false&&e.stopOnFalse){t=false;break}}r=false;if(u){if(a){if(a.length){f(a.shift())}}else if(t){u=[]}else{l.disable()}}},l={add:function(){if(u){var n=u.length;(function o(t){jQuery.each(t,function(t,n){var r=jQuery.type(n);if(r==="function"){if(!e.unique||!l.has(n)){u.push(n)}}else if(n&&n.length&&r!=="string"){o(n)}})})(arguments);if(r){s=u.length}else if(t){i=n;f(t)}}return this},remove:function(){if(u){jQuery.each(arguments,function(e,t){var n;while((n=jQuery.inArray(t,u,n))>-1){u.splice(n,1);if(r){if(n<=s){s--}if(n<=o){o--}}}})}return this},has:function(e){return e?jQuery.inArray(e,u)>-1:!!(u&&u.length)},empty:function(){u=[];s=0;return this},disable:function(){u=a=t=undefined;return this},disabled:function(){return!u},lock:function(){a=undefined;if(!t){l.disable()}return this},locked:function(){return!a},fireWith:function(e,t){if(u&&(!n||a)){t=t||[];t=[e,t.slice?t.slice():t];if(r){a.push(t)}else{f(t)}}return this},fire:function(){l.fireWith(this,arguments);return this},fired:function(){return!!n}};return l};jQuery.extend({Deferred:function(e){var t=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){i.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return jQuery.Deferred(function(n){jQuery.each(t,function(t,s){var o=jQuery.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);if(e&&jQuery.isFunction(e.promise)){e.promise().done(n.resolve).fail(n.reject).progress(n.notify)}else{n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)}})});e=null}).promise()},promise:function(e){return e!=null?jQuery.extend(e,r):r}},i={};r.pipe=r.then;jQuery.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add;if(u){o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock)}i[s[0]]=function(){i[s[0]+"With"](this===i?r:this,arguments);return this};i[s[0]+"With"]=o.fireWith});r.promise(i);if(e){e.call(i,i)}return i},when:function(e){var t=0,n=slice.call(arguments),r=n.length,i=r!==1||e&&jQuery.isFunction(e.promise)?r:0,s=i===1?e:jQuery.Deferred(),o=function(e,t,n){return function(r){t[e]=this;n[e]=arguments.length>1?slice.call(arguments):r;if(n===u){s.notifyWith(t,n)}else if(!--i){s.resolveWith(t,n)}}},u,a,f;if(r>1){u=new Array(r);a=new Array(r);f=new Array(r);for(;t<r;t++){if(n[t]&&jQuery.isFunction(n[t].promise)){n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u))}else{--i}}}if(!i){s.resolveWith(f,n)}return s.promise()}});var readyList;jQuery.fn.ready=function(e){jQuery.ready.promise().done(e);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(e){if(e){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(e){if(e===true?--jQuery.readyWait:jQuery.isReady){return}jQuery.isReady=true;if(e!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}}});jQuery.ready.promise=function(e){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}return readyList.promise(e)};jQuery.ready.promise();var access=jQuery.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(jQuery.type(n)==="object"){i=true;for(u in n){jQuery.access(e,t,u,n[u],true,s,o)}}else if(r!==undefined){i=true;if(!jQuery.isFunction(r)){o=true}if(f){if(o){t.call(e,r);t=null}else{f=t;t=function(e,t,n){return f.call(jQuery(e),n)}}}if(t){for(;u<a;u++){t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}}}return i?e:f?t.call(e):a?t(e[0],n):s};jQuery.acceptData=function(e){return e.nodeType===1||e.nodeType===9||!+e.nodeType};Data.uid=1;Data.accepts=jQuery.acceptData;Data.prototype={key:function(e){if(!Data.accepts(e)){return 0}var t={},n=e[this.expando];if(!n){n=Data.uid++;try{t[this.expando]={value:n};Object.defineProperties(e,t)}catch(r){t[this.expando]=n;jQuery.extend(e,t)}}if(!this.cache[n]){this.cache[n]={}}return n},set:function(e,t,n){var r,i=this.key(e),s=this.cache[i];if(typeof t==="string"){s[t]=n}else{if(jQuery.isEmptyObject(s)){jQuery.extend(this.cache[i],t)}else{for(r in t){s[r]=t[r]}}}return s},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){var r;if(t===undefined||t&&typeof t==="string"&&n===undefined){r=this.get(e,t);return r!==undefined?r:this.get(e,jQuery.camelCase(t))}this.set(e,t,n);return n!==undefined?n:t},remove:function(e,t){var n,r,i,s=this.key(e),o=this.cache[s];if(t===undefined){this.cache[s]={}}else{if(jQuery.isArray(t)){r=t.concat(t.map(jQuery.camelCase))}else{i=jQuery.camelCase(t);if(t in o){r=[t,i]}else{r=i;r=r in o?[r]:r.match(rnotwhite)||[]}}n=r.length;while(n--){delete o[r[n]]}}},hasData:function(e){return!jQuery.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){if(e[this.expando]){delete this.cache[e[this.expando]]}}};var data_priv=new Data;var data_user=new Data;var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({hasData:function(e){return data_user.hasData(e)||data_priv.hasData(e)},data:function(e,t,n){return data_user.access(e,t,n)},removeData:function(e,t){data_user.remove(e,t)},_data:function(e,t,n){return data_priv.access(e,t,n)},_removeData:function(e,t){data_priv.remove(e,t)}});jQuery.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(e===undefined){if(this.length){i=data_user.get(s);if(s.nodeType===1&&!data_priv.get(s,"hasDataAttrs")){n=o.length;while(n--){r=o[n].name;if(r.indexOf("data-")===0){r=jQuery.camelCase(r.slice(5));dataAttr(s,r,i[r])}}data_priv.set(s,"hasDataAttrs",true)}}return i}if(typeof e==="object"){return this.each(function(){data_user.set(this,e)})}return access(this,function(t){var n,r=jQuery.camelCase(e);if(s&&t===undefined){n=data_user.get(s,e);if(n!==undefined){return n}n=data_user.get(s,r);if(n!==undefined){return n}n=dataAttr(s,r,undefined);if(n!==undefined){return n}return}this.each(function(){var n=data_user.get(this,r);data_user.set(this,r,t);if(e.indexOf("-")!==-1&&n!==undefined){data_user.set(this,e,t)}})},null,t,arguments.length>1,null,true)},removeData:function(e){return this.each(function(){data_user.remove(this,e)})}});jQuery.extend({queue:function(e,t,n){var r;if(e){t=(t||"fx")+"queue";r=data_priv.get(e,t);if(n){if(!r||jQuery.isArray(n)){r=data_priv.access(e,t,jQuery.makeArray(n))}else{r.push(n)}}return r||[]}},dequeue:function(e,t){t=t||"fx";var n=jQuery.queue(e,t),r=n.length,i=n.shift(),s=jQuery._queueHooks(e,t),o=function(){jQuery.dequeue(e,t)};if(i==="inprogress"){i=n.shift();r--}if(i){if(t==="fx"){n.unshift("inprogress")}delete s.stop;i.call(e,o,s)}if(!r&&s){s.empty.fire()}},_queueHooks:function(e,t){var n=t+"queueHooks";return data_priv.get(e,n)||data_priv.access(e,n,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(e,[t+"queue",n])})})}});jQuery.fn.extend({queue:function(e,t){var n=2;if(typeof e!=="string"){t=e;e="fx";n--}if(arguments.length<n){return jQuery.queue(this[0],e)}return t===undefined?this:this.each(function(){var n=jQuery.queue(this,e,t);jQuery._queueHooks(this,e);if(e==="fx"&&n[0]!=="inprogress"){jQuery.dequeue(this,e)}})},dequeue:function(e){return this.each(function(){jQuery.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=jQuery.Deferred(),s=this,o=this.length,u=function(){if(!--r){i.resolveWith(s,[s])}};if(typeof e!=="string"){t=e;e=undefined}e=e||"fx";while(o--){n=data_priv.get(s[o],e+"queueHooks");if(n&&n.empty){r++;n.empty.add(u)}}u();return i.promise(t)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var cssExpand=["Top","Right","Bottom","Left"];var isHidden=function(e,t){e=t||e;return jQuery.css(e,"display")==="none"||!jQuery.contains(e.ownerDocument,e)};var rcheckableType=/^(?:checkbox|radio)$/i;(function(){var e=document.createDocumentFragment(),t=e.appendChild(document.createElement("div"));t.innerHTML="<input type='radio' checked='checked' name='t'/>";support.checkClone=t.cloneNode(true).cloneNode(true).lastChild.checked;t.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!t.cloneNode(true).lastChild.defaultValue})();var strundefined=typeof undefined;support.focusinBubbles="onfocusin"in window;var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.get(e);if(!m){return}if(n.handler){s=n;n=s.handler;i=s.selector}if(!n.guid){n.guid=jQuery.guid++}if(!(a=m.events)){a=m.events={}}if(!(o=m.handle)){o=m.handle=function(t){return typeof jQuery!==strundefined&&jQuery.event.triggered!==t.type?jQuery.event.dispatch.apply(e,arguments):undefined}}t=(t||"").match(rnotwhite)||[""];f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[];p=v=u[1];d=(u[2]||"").split(".").sort();if(!p){continue}c=jQuery.event.special[p]||{};p=(i?c.delegateType:c.bindType)||p;c=jQuery.event.special[p]||{};l=jQuery.extend({type:p,origType:v,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&jQuery.expr.match.needsContext.test(i),namespace:d.join(".")},s);if(!(h=a[p])){h=a[p]=[];h.delegateCount=0;if(!c.setup||c.setup.call(e,r,d,o)===false){if(e.addEventListener){e.addEventListener(p,o,false)}}}if(c.add){c.add.call(e,l);if(!l.handler.guid){l.handler.guid=n.guid}}if(i){h.splice(h.delegateCount++,0,l)}else{h.push(l)}jQuery.event.global[p]=true}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.hasData(e)&&data_priv.get(e);if(!m||!(a=m.events)){return}t=(t||"").match(rnotwhite)||[""];f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[];p=v=u[1];d=(u[2]||"").split(".").sort();if(!p){for(p in a){jQuery.event.remove(e,p+t[f],n,r,true)}continue}c=jQuery.event.special[p]||{};p=(r?c.delegateType:c.bindType)||p;h=a[p]||[];u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)");o=s=h.length;while(s--){l=h[s];if((i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)){h.splice(s,1);if(l.selector){h.delegateCount--}if(c.remove){c.remove.call(e,l)}}}if(o&&!h.length){if(!c.teardown||c.teardown.call(e,d,m.handle)===false){jQuery.removeEvent(e,p,m.handle)}delete a[p]}}if(jQuery.isEmptyObject(a)){delete m.handle;data_priv.remove(e,"events")}},trigger:function(e,t,n,r){var i,s,o,u,a,f,l,c=[n||document],h=hasOwn.call(e,"type")?e.type:e,p=hasOwn.call(e,"namespace")?e.namespace.split("."):[];s=o=n=n||document;if(n.nodeType===3||n.nodeType===8){return}if(rfocusMorph.test(h+jQuery.event.triggered)){return}if(h.indexOf(".")>=0){p=h.split(".");h=p.shift();p.sort()}a=h.indexOf(":")<0&&"on"+h;e=e[jQuery.expando]?e:new jQuery.Event(h,typeof e==="object"&&e);e.isTrigger=r?2:3;e.namespace=p.join(".");e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;e.result=undefined;if(!e.target){e.target=n}t=t==null?[e]:jQuery.makeArray(t,[e]);l=jQuery.event.special[h]||{};if(!r&&l.trigger&&l.trigger.apply(n,t)===false){return}if(!r&&!l.noBubble&&!jQuery.isWindow(n)){u=l.delegateType||h;if(!rfocusMorph.test(u+h)){s=s.parentNode}for(;s;s=s.parentNode){c.push(s);o=s}if(o===(n.ownerDocument||document)){c.push(o.defaultView||o.parentWindow||window)}}i=0;while((s=c[i++])&&!e.isPropagationStopped()){e.type=i>1?u:l.bindType||h;f=(data_priv.get(s,"events")||{})[e.type]&&data_priv.get(s,"handle");if(f){f.apply(s,t)}f=a&&s[a];if(f&&f.apply&&jQuery.acceptData(s)){e.result=f.apply(s,t);if(e.result===false){e.preventDefault()}}}e.type=h;if(!r&&!e.isDefaultPrevented()){if((!l._default||l._default.apply(c.pop(),t)===false)&&jQuery.acceptData(n)){if(a&&jQuery.isFunction(n[h])&&!jQuery.isWindow(n)){o=n[a];if(o){n[a]=null}jQuery.event.triggered=h;n[h]();jQuery.event.triggered=undefined;if(o){n[a]=o}}}}return e.result},dispatch:function(e){e=jQuery.event.fix(e);var t,n,r,i,s,o=[],u=slice.call(arguments),a=(data_priv.get(this,"events")||{})[e.type]||[],f=jQuery.event.special[e.type]||{};u[0]=e;e.delegateTarget=this;if(f.preDispatch&&f.preDispatch.call(this,e)===false){return}o=jQuery.event.handlers.call(this,e,a);t=0;while((i=o[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem;n=0;while((s=i.handlers[n++])&&!e.isImmediatePropagationStopped()){if(!e.namespace_re||e.namespace_re.test(s.namespace)){e.handleObj=s;e.data=s.data;r=((jQuery.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,u);if(r!==undefined){if((e.result=r)===false){e.preventDefault();e.stopPropagation()}}}}}if(f.postDispatch){f.postDispatch.call(this,e)}return e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click")){for(;a!==this;a=a.parentNode||this){if(a.disabled!==true||e.type!=="click"){r=[];for(n=0;n<u;n++){s=t[n];i=s.selector+" ";if(r[i]===undefined){r[i]=s.needsContext?jQuery(i,this).index(a)>=0:jQuery.find(i,this,null,[a]).length}if(r[i]){r.push(s)}}if(r.length){o.push({elem:a,handlers:r})}}}}if(u<t.length){o.push({elem:this,handlers:t.slice(u)})}return o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){if(e.which==null){e.which=t.charCode!=null?t.charCode:t.keyCode}return e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;if(e.pageX==null&&t.clientX!=null){n=e.target.ownerDocument||document;r=n.documentElement;i=n.body;e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0);e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)}if(!e.which&&s!==undefined){e.which=s&1?1:s&2?3:s&4?2:0}return e}},fix:function(e){if(e[jQuery.expando]){return e}var t,n,r,i=e.type,s=e,o=this.fixHooks[i];if(!o){this.fixHooks[i]=o=rmouseEvent.test(i)?this.mouseHooks:rkeyEvent.test(i)?this.keyHooks:{}}r=o.props?this.props.concat(o.props):this.props;e=new jQuery.Event(s);t=r.length;while(t--){n=r[t];e[n]=s[n]}if(!e.target){e.target=document}if(e.target.nodeType===3){e.target=e.target.parentNode}return o.filter?o.filter(e,s):e},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){this.focus();return false}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input")){this.click();return false}},_default:function(e){return jQuery.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){if(e.result!==undefined){e.originalEvent.returnValue=e.result}}}},simulate:function(e,t,n,r){var i=jQuery.extend(new jQuery.Event,n,{type:e,isSimulated:true,originalEvent:{}});if(r){jQuery.event.trigger(i,null,t)}else{jQuery.event.dispatch.call(t,i)}if(i.isDefaultPrevented()){n.preventDefault()}}};jQuery.removeEvent=function(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}};jQuery.Event=function(e,t){if(!(this instanceof jQuery.Event)){return new jQuery.Event(e,t)}if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||e.defaultPrevented===undefined&&e.getPreventDefault&&e.getPreventDefault()?returnTrue:returnFalse}else{this.type=e}if(t){jQuery.extend(this,t)}this.timeStamp=e&&e.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&e.preventDefault){e.preventDefault()}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){jQuery.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!jQuery.contains(r,i)){e.type=s.origType;n=s.handler.apply(this,arguments);e.type=t}return n}}});if(!support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){jQuery.event.simulate(t,e.target,jQuery.event.fix(e),true)};jQuery.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=data_priv.access(r,t);if(!i){r.addEventListener(e,n,true)}data_priv.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=data_priv.access(r,t)-1;if(!i){r.removeEventListener(e,n,true);data_priv.remove(r,t)}else{data_priv.access(r,t,i)}}}})}jQuery.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e==="object"){if(typeof t!=="string"){n=n||t;t=undefined}for(o in e){this.on(o,t,n,e[o],i)}return this}if(n==null&&r==null){r=t;n=t=undefined}else if(r==null){if(typeof t==="string"){r=n;n=undefined}else{r=n;n=t;t=undefined}}if(r===false){r=returnFalse}else if(!r){return this}if(i===1){s=r;r=function(e){jQuery().off(e);return s.apply(this,arguments)};r.guid=s.guid||(s.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj){r=e.handleObj;jQuery(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler);return this}if(typeof e==="object"){for(i in e){this.off(i,t,e[i])}return this}if(t===false||typeof t==="function"){n=t;t=undefined}if(n===false){n=returnFalse}return this.each(function(){jQuery.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){jQuery.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n){return jQuery.event.trigger(e,t,n,true)}}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;jQuery.extend({clone:function(e,t,n){var r,i,s,o,u=e.cloneNode(true),a=jQuery.contains(e.ownerDocument,e);if(!support.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!jQuery.isXMLDoc(e)){o=getAll(u);s=getAll(e);for(r=0,i=s.length;r<i;r++){fixInput(s[r],o[r])}}if(t){if(n){s=s||getAll(e);o=o||getAll(u);for(r=0,i=s.length;r<i;r++){cloneCopyEvent(s[r],o[r])}}else{cloneCopyEvent(e,u)}}o=getAll(u,"script");if(o.length>0){setGlobalEval(o,!a&&getAll(e,"script"))}return u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l=t.createDocumentFragment(),c=[],h=0,p=e.length;for(;h<p;h++){i=e[h];if(i||i===0){if(jQuery.type(i)==="object"){jQuery.merge(c,i.nodeType?[i]:i)}else if(!rhtml.test(i)){c.push(t.createTextNode(i))}else{s=s||l.appendChild(t.createElement("div"));o=(rtagName.exec(i)||["",""])[1].toLowerCase();u=wrapMap[o]||wrapMap._default;s.innerHTML=u[1]+i.replace(rxhtmlTag,"<$1></$2>")+u[2];f=u[0];while(f--){s=s.lastChild}jQuery.merge(c,s.childNodes);s=l.firstChild;s.textContent=""}}}l.textContent="";h=0;while(i=c[h++]){if(r&&jQuery.inArray(i,r)!==-1){continue}a=jQuery.contains(i.ownerDocument,i);s=getAll(l.appendChild(i),"script");if(a){setGlobalEval(s)}if(n){f=0;while(i=s[f++]){if(rscriptType.test(i.type||"")){n.push(i)}}}}return l},cleanData:function(e){var t,n,r,i,s,o,u=jQuery.event.special,a=0;for(;(n=e[a])!==undefined;a++){if(jQuery.acceptData(n)){s=n[data_priv.expando];if(s&&(t=data_priv.cache[s])){r=Object.keys(t.events||{});if(r.length){for(o=0;(i=r[o])!==undefined;o++){if(u[i]){jQuery.event.remove(n,i)}else{jQuery.removeEvent(n,i,t.handle)}}}if(data_priv.cache[s]){delete data_priv.cache[s]}}}delete data_user.cache[n[data_user.expando]]}}});jQuery.fn.extend({text:function(e){return access(this,function(e){return e===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=e}})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){if(this.parentNode){this.parentNode.insertBefore(e,this)}})},after:function(){return this.domManip(arguments,function(e){if(this.parentNode){this.parentNode.insertBefore(e,this.nextSibling)}})},remove:function(e,t){var n,r=e?jQuery.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++){if(!t&&n.nodeType===1){jQuery.cleanData(getAll(n))}if(n.parentNode){if(t&&jQuery.contains(n.ownerDocument,n)){setGlobalEval(getAll(n,"script"))}n.parentNode.removeChild(n)}}return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){if(e.nodeType===1){jQuery.cleanData(getAll(e,false));e.textContent=""}}return this},clone:function(e,t){e=e==null?false:e;t=t==null?e:t;return this.map(function(){return jQuery.clone(this,e,t)})},html:function(e){return access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&t.nodeType===1){return t.innerHTML}if(typeof e==="string"&&!rnoInnerhtml.test(e)&&!wrapMap[(rtagName.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(rxhtmlTag,"<$1></$2>");try{for(;n<r;n++){t=this[n]||{};if(t.nodeType===1){jQuery.cleanData(getAll(t,false));t.innerHTML=e}}t=0}catch(i){}}if(t){this.empty().append(e)}},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];this.domManip(arguments,function(t){e=this.parentNode;jQuery.cleanData(getAll(this));if(e){e.replaceChild(t,this)}});return e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,true)},domManip:function(e,t){e=concat.apply([],e);var n,r,i,s,o,u,a=0,f=this.length,l=this,c=f-1,h=e[0],p=jQuery.isFunction(h);if(p||f>1&&typeof h==="string"&&!support.checkClone&&rchecked.test(h)){return this.each(function(n){var r=l.eq(n);if(p){e[0]=h.call(this,n,r.html())}r.domManip(e,t)})}if(f){n=jQuery.buildFragment(e,this[0].ownerDocument,false,this);r=n.firstChild;if(n.childNodes.length===1){n=r}if(r){i=jQuery.map(getAll(n,"script"),disableScript);s=i.length;for(;a<f;a++){o=n;if(a!==c){o=jQuery.clone(o,true,true);if(s){jQuery.merge(i,getAll(o,"script"))}}t.call(this[a],o,a)}if(s){u=i[i.length-1].ownerDocument;jQuery.map(i,restoreScript);for(a=0;a<s;a++){o=i[a];if(rscriptType.test(o.type||"")&&!data_priv.access(o,"globalEval")&&jQuery.contains(u,o)){if(o.src){if(jQuery._evalUrl){jQuery._evalUrl(o.src)}}else{jQuery.globalEval(o.textContent.replace(rcleanScript,""))}}}}}}return this}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){jQuery.fn[e]=function(e){var n,r=[],i=jQuery(e),s=i.length-1,o=0;for(;o<=s;o++){n=o===s?this:this.clone(true);jQuery(i[o])[t](n);push.apply(r,n.get())}return this.pushStack(r)}});var iframe,elemdisplay={};var rmargin=/^margin/;var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)};(function(){function o(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;"+"box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;"+"position:absolute;top:1%";r.appendChild(i);var n=window.getComputedStyle(s,null);e=n.top!=="1%";t=n.width==="4px";r.removeChild(i)}var e,t,n="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;"+"-moz-box-sizing:content-box;box-sizing:content-box",r=document.documentElement,i=document.createElement("div"),s=document.createElement("div");s.style.backgroundClip="content-box";s.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=s.style.backgroundClip==="content-box";i.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;"+"margin-top:1px";i.appendChild(s);if(window.getComputedStyle){jQuery.extend(support,{pixelPosition:function(){o();return e},boxSizingReliable:function(){if(t==null){o()}return t},reliableMarginRight:function(){var e,t=s.appendChild(document.createElement("div"));t.style.cssText=s.style.cssText=n;t.style.marginRight=t.style.width="0";s.style.width="1px";r.appendChild(i);e=!parseFloat(window.getComputedStyle(t,null).marginRight);r.removeChild(i);s.innerHTML="";return e}})}})();jQuery.swap=function(e,t,n,r){var i,s,o={};for(s in t){o[s]=e.style[s];e.style[s]=t[s]}i=n.apply(e,r||[]);for(s in t){e.style[s]=o[s]}return i};var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssPrefixes=["Webkit","O","Moz","ms"];jQuery.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=curCSS(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style){return}var i,s,o,u=jQuery.camelCase(t),a=e.style;t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(a,u));o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(n!==undefined){s=typeof n;if(s==="string"&&(i=rrelNum.exec(n))){n=(i[1]+1)*i[2]+parseFloat(jQuery.css(e,t));s="number"}if(n==null||n!==n){return}if(s==="number"&&!jQuery.cssNumber[u]){n+="px"}if(!support.clearCloneStyle&&n===""&&t.indexOf("background")===0){a[t]="inherit"}if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined){a[t]="";a[t]=n}}else{if(o&&"get"in o&&(i=o.get(e,false,r))!==undefined){return i}return a[t]}},css:function(e,t,n,r){var i,s,o,u=jQuery.camelCase(t);t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(e.style,u));o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(o&&"get"in o){i=o.get(e,true,n)}if(i===undefined){i=curCSS(e,t,r)}if(i==="normal"&&t in cssNormalTransform){i=cssNormalTransform[t]}if(n===""||n){s=parseFloat(i);return n===true||jQuery.isNumeric(s)?s||0:i}return i}});jQuery.each(["height","width"],function(e,t){jQuery.cssHooks[t]={get:function(e,n,r){if(n){return e.offsetWidth===0&&rdisplayswap.test(jQuery.css(e,"display"))?jQuery.swap(e,cssShow,function(){return getWidthOrHeight(e,t,r)}):getWidthOrHeight(e,t,r)}},set:function(e,n,r){var i=r&&getStyles(e);return setPositiveNumber(e,n,r?augmentWidthOrHeight(e,t,r,jQuery.css(e,"boxSizing",false,i)==="border-box",i):0)}}});jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(e,t){if(t){return jQuery.swap(e,{display:"inline-block"},curCSS,[e,"marginRight"])}});jQuery.each({margin:"",padding:"",border:"Width"},function(e,t){jQuery.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n==="string"?n.split(" "):[n];for(;r<4;r++){i[e+cssExpand[r]+t]=s[r]||s[r-2]||s[0]}return i}};if(!rmargin.test(e)){jQuery.cssHooks[e+t].set=setPositiveNumber}});jQuery.fn.extend({css:function(e,t){return access(this,function(e,t,n){var r,i,s={},o=0;if(jQuery.isArray(t)){r=getStyles(e);i=t.length;for(;o<i;o++){s[t[o]]=jQuery.css(e,t[o],false,r)}return s}return n!==undefined?jQuery.style(e,t,n):jQuery.css(e,t)},e,t,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(e){if(typeof e==="boolean"){return e?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(e,t,n,r,i,s){this.elem=e;this.prop=n;this.easing=i||"swing";this.options=t;this.start=this.now=this.cur();this.end=r;this.unit=s||(jQuery.cssNumber[n]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,n=Tween.propHooks[this.prop];if(this.options.duration){this.pos=t=jQuery.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration)}else{this.pos=t=e}this.now=(this.end-this.start)*t+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(n&&n.set){n.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(e){var t;if(e.elem[e.prop]!=null&&(!e.elem.style||e.elem.style[e.prop]==null)){return e.elem[e.prop]}t=jQuery.css(e.elem,e.prop,"");return!t||t==="auto"?0:t},set:function(e){if(jQuery.fx.step[e.prop]){jQuery.fx.step[e.prop](e)}else if(e.elem.style&&(e.elem.style[jQuery.cssProps[e.prop]]!=null||jQuery.cssHooks[e.prop])){jQuery.style(e.elem,e.prop,e.now+e.unit)}else{e.elem[e.prop]=e.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(e){if(e.elem.nodeType&&e.elem.parentNode){e.elem[e.prop]=e.now}}};jQuery.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=rfxnum.exec(t),s=i&&i[3]||(jQuery.cssNumber[e]?"":"px"),o=(jQuery.cssNumber[e]||s!=="px"&&+r)&&rfxnum.exec(jQuery.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3];i=i||[];o=+r||1;do{u=u||".5";o=o/u;jQuery.style(n.elem,e,o+s)}while(u!==(u=n.cur()/r)&&u!==1&&--a)}if(i){o=n.start=+o||+r||0;n.unit=s;n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]}return n}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(e,t){if(jQuery.isFunction(e)){t=e;e=["*"]}else{e=e.split(" ")}var n,r=0,i=e.length;for(;r<i;r++){n=e[r];tweeners[n]=tweeners[n]||[];tweeners[n].unshift(t)}},prefilter:function(e,t){if(t){animationPrefilters.unshift(e)}else{animationPrefilters.push(e)}}});jQuery.speed=function(e,t,n){var r=e&&typeof e==="object"?jQuery.extend({},e):{complete:n||!n&&t||jQuery.isFunction(e)&&e,duration:e,easing:n&&t||t&&!jQuery.isFunction(t)&&t};r.duration=jQuery.fx.off?0:typeof r.duration==="number"?r.duration:r.duration in jQuery.fx.speeds?jQuery.fx.speeds[r.duration]:jQuery.fx.speeds._default;if(r.queue==null||r.queue===true){r.queue="fx"}r.old=r.complete;r.complete=function(){if(jQuery.isFunction(r.old)){r.old.call(this)}if(r.queue){jQuery.dequeue(this,r.queue)}};return r};jQuery.fn.extend({fadeTo:function(e,t,n,r){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=jQuery.isEmptyObject(e),s=jQuery.speed(t,n,r),o=function(){var t=Animation(this,jQuery.extend({},e),s);if(i||data_priv.get(this,"finish")){t.stop(true)}};o.finish=o;return i||s.queue===false?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop;t(n)};if(typeof e!=="string"){n=t;t=e;e=undefined}if(t&&e!==false){this.queue(e||"fx",[])}return this.each(function(){var t=true,i=e!=null&&e+"queueHooks",s=jQuery.timers,o=data_priv.get(this);if(i){if(o[i]&&o[i].stop){r(o[i])}}else{for(i in o){if(o[i]&&o[i].stop&&rrun.test(i)){r(o[i])}}}for(i=s.length;i--;){if(s[i].elem===this&&(e==null||s[i].queue===e)){s[i].anim.stop(n);t=false;s.splice(i,1)}}if(t||!n){jQuery.dequeue(this,e)}})},finish:function(e){if(e!==false){e=e||"fx"}return this.each(function(){var t,n=data_priv.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=jQuery.timers,o=r?r.length:0;n.finish=true;jQuery.queue(this,e,[]);if(i&&i.stop){i.stop.call(this,true)}for(t=s.length;t--;){if(s[t].elem===this&&s[t].queue===e){s[t].anim.stop(true);s.splice(t,1)}}for(t=0;t<o;t++){if(r[t]&&r[t].finish){r[t].finish.call(this)}}delete n.finish})}});jQuery.each(["toggle","show","hide"],function(e,t){var n=jQuery.fn[t];jQuery.fn[t]=function(e,r,i){return e==null||typeof e==="boolean"?n.apply(this,arguments):this.animate(genFx(t,true),e,r,i)}});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){jQuery.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}});jQuery.timers=[];jQuery.fx.tick=function(){var e,t=0,n=jQuery.timers;fxNow=jQuery.now();for(;t<n.length;t++){e=n[t];if(!e()&&n[t]===e){n.splice(t--,1)}}if(!n.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(e){jQuery.timers.push(e);if(e()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(e,t){e=jQuery.fx?jQuery.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})};(function(){var e=document.createElement("input"),t=document.createElement("select"),n=t.appendChild(document.createElement("option"));e.type="checkbox";support.checkOn=e.value!=="";support.optSelected=n.selected;t.disabled=true;support.optDisabled=!n.disabled;e=document.createElement("input");e.value="t";e.type="radio";support.radioValue=e.value==="t"})();var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(e,t){return access(this,jQuery.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){jQuery.removeAttr(this,e)})}});jQuery.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2){return}if(typeof e.getAttribute===strundefined){return jQuery.prop(e,t,n)}if(s!==1||!jQuery.isXMLDoc(e)){t=t.toLowerCase();r=jQuery.attrHooks[t]||(jQuery.expr.match.bool.test(t)?boolHook:nodeHook)}if(n!==undefined){if(n===null){jQuery.removeAttr(e,t)}else if(r&&"set"in r&&(i=r.set(e,n,t))!==undefined){return i}else{e.setAttribute(t,n+"");return n}}else if(r&&"get"in r&&(i=r.get(e,t))!==null){return i}else{i=jQuery.find.attr(e,t);return i==null?undefined:i}},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(rnotwhite);if(s&&e.nodeType===1){while(n=s[i++]){r=jQuery.propFix[n]||n;if(jQuery.expr.match.bool.test(n)){e[r]=false}e.removeAttribute(n)}}},attrHooks:{type:{set:function(e,t){if(!support.radioValue&&t==="radio"&&jQuery.nodeName(e,"input")){var n=e.value;e.setAttribute("type",t);if(n){e.value=n}return t}}}}});boolHook={set:function(e,t,n){if(t===false){jQuery.removeAttr(e,n)}else{e.setAttribute(n,n)}return n}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(e,t){var n=attrHandle[t]||jQuery.find.attr;attrHandle[t]=function(e,t,r){var i,s;if(!r){s=attrHandle[t];attrHandle[t]=i;i=n(e,t,r)!=null?t.toLowerCase():null;attrHandle[t]=s}return i}});var rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({prop:function(e,t){return access(this,jQuery.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[jQuery.propFix[e]||e]})}});jQuery.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2){return}s=o!==1||!jQuery.isXMLDoc(e);if(s){t=jQuery.propFix[t]||t;i=jQuery.propHooks[t]}if(n!==undefined){return i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n}else{return i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]}},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||rfocusable.test(e.nodeName)||e.href?e.tabIndex:-1}}}});if(!support.optSelected){jQuery.propHooks.selected={get:function(e){var t=e.parentNode;if(t&&t.parentNode){t.parentNode.selectedIndex}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=typeof e==="string"&&e,a=0,f=this.length;if(jQuery.isFunction(e)){return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))})}if(u){t=(e||"").match(rnotwhite)||[];for(;a<f;a++){n=this[a];r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):" ");if(r){s=0;while(i=t[s++]){if(r.indexOf(" "+i+" ")<0){r+=i+" "}}o=jQuery.trim(r);if(n.className!==o){n.className=o}}}}return this},removeClass:function(e){var t,n,r,i,s,o,u=arguments.length===0||typeof e==="string"&&e,a=0,f=this.length;if(jQuery.isFunction(e)){return this.each(function(t){jQuery(this).removeClass(e.call(this,t,this.className))})}if(u){t=(e||"").match(rnotwhite)||[];for(;a<f;a++){n=this[a];r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):"");if(r){s=0;while(i=t[s++]){while(r.indexOf(" "+i+" ")>=0){r=r.replace(" "+i+" "," ")}}o=e?jQuery.trim(r):"";if(n.className!==o){n.className=o}}}}return this},toggleClass:function(e,t){var n=typeof e;if(typeof t==="boolean"&&n==="string"){return t?this.addClass(e):this.removeClass(e)}if(jQuery.isFunction(e)){return this.each(function(n){jQuery(this).toggleClass(e.call(this,n,this.className,t),t)})}return this.each(function(){if(n==="string"){var t,r=0,i=jQuery(this),s=e.match(rnotwhite)||[];while(t=s[r++]){if(i.hasClass(t)){i.removeClass(t)}else{i.addClass(t)}}}else if(n===strundefined||n==="boolean"){if(this.className){data_priv.set(this,"__className__",this.className)}this.className=this.className||e===false?"":data_priv.get(this,"__className__")||""}})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++){if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(rclass," ").indexOf(t)>=0){return true}}return false}});var rreturn=/\r/g;jQuery.fn.extend({val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i){t=jQuery.valHooks[i.type]||jQuery.valHooks[i.nodeName.toLowerCase()];if(t&&"get"in t&&(n=t.get(i,"value"))!==undefined){return n}n=i.value;return typeof n==="string"?n.replace(rreturn,""):n==null?"":n}return}r=jQuery.isFunction(e);return this.each(function(n){var i;if(this.nodeType!==1){return}if(r){i=e.call(this,n,jQuery(this).val())}else{i=e}if(i==null){i=""}else if(typeof i==="number"){i+=""}else if(jQuery.isArray(i)){i=jQuery.map(i,function(e){return e==null?"":e+""})}t=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined){this.value=i}})}});jQuery.extend({valHooks:{select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!jQuery.nodeName(n.parentNode,"optgroup"))){t=jQuery(n).val();if(s){return t}o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=jQuery.makeArray(t),o=i.length;while(o--){r=i[o];if(r.selected=jQuery.inArray(jQuery(r).val(),s)>=0){n=true}}if(!n){e.selectedIndex=-1}return s}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(e,t){if(jQuery.isArray(t)){return e.checked=jQuery.inArray(jQuery(e).val(),t)>=0}}};if(!support.checkOn){jQuery.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value}}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(e,t){jQuery.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});jQuery.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var nonce=jQuery.now();var rquery=/\?/;jQuery.parseJSON=function(e){return JSON.parse(e+"")};jQuery.parseXML=function(e){var t,n;if(!e||typeof e!=="string"){return null}try{n=new DOMParser;t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}if(!t||t.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+e)}return t};var ajaxLocParts,ajaxLocation,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,jQuery.ajaxSettings),t):ajaxExtend(jQuery.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(e,t){function S(e,t,s,u){var f,m,g,b,E,S=t;if(y===2){return}y=2;if(o){clearTimeout(o)}n=undefined;i=u||"";w.readyState=e>0?4:0;f=e>=200&&e<300||e===304;if(s){b=ajaxHandleResponses(l,w,s)}b=ajaxConvert(l,b,w,f);if(f){if(l.ifModified){E=w.getResponseHeader("Last-Modified");if(E){jQuery.lastModified[r]=E}E=w.getResponseHeader("etag");if(E){jQuery.etag[r]=E}}if(e===204||l.type==="HEAD"){S="nocontent"}else if(e===304){S="notmodified"}else{S=b.state;m=b.data;g=b.error;f=!g}}else{g=S;if(e||!S){S="error";if(e<0){e=0}}}w.status=e;w.statusText=(t||S)+"";if(f){p.resolveWith(c,[m,S,w])}else{p.rejectWith(c,[w,S,g])}w.statusCode(v);v=undefined;if(a){h.trigger(f?"ajaxSuccess":"ajaxError",[w,l,f?m:g])}d.fireWith(c,[w,S]);if(a){h.trigger("ajaxComplete",[w,l]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}if(typeof e==="object"){t=e;e=undefined}t=t||{};var n,r,i,s,o,u,a,f,l=jQuery.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?jQuery(c):jQuery.event,p=jQuery.Deferred(),d=jQuery.Callbacks("once memory"),v=l.statusCode||{},m={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!s){s={};while(t=rheaders.exec(i)){s[t[1].toLowerCase()]=t[2]}}t=s[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();if(!y){e=g[n]=g[n]||e;m[e]=t}return this},overrideMimeType:function(e){if(!y){l.mimeType=e}return this},statusCode:function(e){var t;if(e){if(y<2){for(t in e){v[t]=[v[t],e[t]]}}else{w.always(e[w.status])}}return this},abort:function(e){var t=e||b;if(n){n.abort(t)}S(0,t);return this}};p.promise(w).complete=d.add;w.success=w.done;w.error=w.fail;l.url=((e||l.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");l.type=t.method||t.type||l.method||l.type;l.dataTypes=jQuery.trim(l.dataType||"*").toLowerCase().match(rnotwhite)||[""];if(l.crossDomain==null){u=rurl.exec(l.url.toLowerCase());l.crossDomain=!!(u&&(u[1]!==ajaxLocParts[1]||u[2]!==ajaxLocParts[2]||(u[3]||(u[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(l.data&&l.processData&&typeof l.data!=="string"){l.data=jQuery.param(l.data,l.traditional)}inspectPrefiltersOrTransports(prefilters,l,t,w);if(y===2){return w}a=l.global;if(a&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}l.type=l.type.toUpperCase();l.hasContent=!rnoContent.test(l.type);r=l.url;if(!l.hasContent){if(l.data){r=l.url+=(rquery.test(r)?"&":"?")+l.data;delete l.data}if(l.cache===false){l.url=rts.test(r)?r.replace(rts,"$1_="+nonce++):r+(rquery.test(r)?"&":"?")+"_="+nonce++}}if(l.ifModified){if(jQuery.lastModified[r]){w.setRequestHeader("If-Modified-Since",jQuery.lastModified[r])}if(jQuery.etag[r]){w.setRequestHeader("If-None-Match",jQuery.etag[r])}}if(l.data&&l.hasContent&&l.contentType!==false||t.contentType){w.setRequestHeader("Content-Type",l.contentType)}w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):l.accepts["*"]);for(f in l.headers){w.setRequestHeader(f,l.headers[f])}if(l.beforeSend&&(l.beforeSend.call(c,w,l)===false||y===2)){return w.abort()}b="abort";for(f in{success:1,error:1,complete:1}){w[f](l[f])}n=inspectPrefiltersOrTransports(transports,l,t,w);if(!n){S(-1,"No Transport")}else{w.readyState=1;if(a){h.trigger("ajaxSend",[w,l])}if(l.async&&l.timeout>0){o=setTimeout(function(){w.abort("timeout")},l.timeout)}try{y=1;n.send(m,S)}catch(E){if(y<2){S(-1,E)}else{throw E}}}return w},getJSON:function(e,t,n){return jQuery.get(e,t,n,"json")},getScript:function(e,t){return jQuery.get(e,undefined,t,"script")}});jQuery.each(["get","post"],function(e,t){jQuery[t]=function(e,n,r,i){if(jQuery.isFunction(n)){i=i||r;r=n;n=undefined}return jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}});jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){jQuery.fn[t]=function(e){return this.on(t,e)}});jQuery._evalUrl=function(e){return jQuery.ajax({url:e,type:"GET",dataType:"script",async:false,global:false,"throws":true})};jQuery.fn.extend({wrapAll:function(e){var t;if(jQuery.isFunction(e)){return this.each(function(t){jQuery(this).wrapAll(e.call(this,t))})}if(this[0]){t=jQuery(e,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){t.insertBefore(this[0])}t.map(function(){var e=this;while(e.firstElementChild){e=e.firstElementChild}return e}).append(this)}return this},wrapInner:function(e){if(jQuery.isFunction(e)){return this.each(function(t){jQuery(this).wrapInner(e.call(this,t))})}return this.each(function(){var t=jQuery(this),n=t.contents();if(n.length){n.wrapAll(e)}else{t.append(e)}})},wrap:function(e){var t=jQuery.isFunction(e);return this.each(function(n){jQuery(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});jQuery.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0};jQuery.expr.filters.visible=function(e){return!jQuery.expr.filters.hidden(e)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.param=function(e,t){var n,r=[],i=function(e,t){t=jQuery.isFunction(t)?t():t==null?"":t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(t===undefined){t=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(e)||e.jquery&&!jQuery.isPlainObject(e)){jQuery.each(e,function(){i(this.name,this.value)})}else{for(n in e){buildParams(n,e[n],t,i)}}return r.join("&").replace(r20,"+")};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(e)&&(this.checked||!rcheckableType.test(e))}).map(function(e,t){var n=jQuery(this).val();return n==null?null:jQuery.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(rCRLF,"\r\n")}}):{name:t.name,value:n.replace(rCRLF,"\r\n")}}).get()}});jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrId=0,xhrCallbacks={},xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();if(window.ActiveXObject){jQuery(window).on("unload",function(){for(var e in xhrCallbacks){xhrCallbacks[e]()}})}support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(e){var t;if(support.cors||xhrSupported&&!e.crossDomain){return{send:function(n,r){var i,s=e.xhr(),o=++xhrId;s.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields){for(i in e.xhrFields){s[i]=e.xhrFields[i]}}if(e.mimeType&&s.overrideMimeType){s.overrideMimeType(e.mimeType)}if(!e.crossDomain&&!n["X-Requested-With"]){n["X-Requested-With"]="XMLHttpRequest"}for(i in n){s.setRequestHeader(i,n[i])}t=function(e){return function(){if(t){delete xhrCallbacks[o];t=s.onload=s.onerror=null;if(e==="abort"){s.abort()}else if(e==="error"){r(s.status,s.statusText)}else{r(xhrSuccessStatus[s.status]||s.status,s.statusText,typeof s.responseText==="string"?{text:s.responseText}:undefined,s.getAllResponseHeaders())}}}};s.onload=t();s.onerror=t("error");t=xhrCallbacks[o]=t("abort");s.send(e.hasContent&&e.data||null)},abort:function(){if(t){t()}}}}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){jQuery.globalEval(e);return e}}});jQuery.ajaxPrefilter("script",function(e){if(e.cache===undefined){e.cache=false}if(e.crossDomain){e.type="GET"}});jQuery.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=jQuery("<script>").prop({async:true,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove();n=null;if(e){i(e.type==="error"?404:200,e.type)}});document.head.appendChild(t[0])},abort:function(){if(n){n()}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;this[e]=true;return e}});jQuery.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,o=e.jsonp!==false&&(rjsonp.test(e.url)?"url":typeof e.data==="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(e.data)&&"data");if(o||e.dataTypes[0]==="jsonp"){r=e.jsonpCallback=jQuery.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback;if(o){e[o]=e[o].replace(rjsonp,"$1"+r)}else if(e.jsonp!==false){e.url+=(rquery.test(e.url)?"&":"?")+e.jsonp+"="+r}e.converters["script json"]=function(){if(!s){jQuery.error(r+" was not called")}return s[0]};e.dataTypes[0]="json";i=window[r];window[r]=function(){s=arguments};n.always(function(){window[r]=i;if(e[r]){e.jsonpCallback=t.jsonpCallback;oldCallbacks.push(r)}if(s&&jQuery.isFunction(i)){i(s[0])}s=i=undefined});return"script"}});jQuery.parseHTML=function(e,t,n){if(!e||typeof e!=="string"){return null}if(typeof t==="boolean"){n=t;t=false}t=t||document;var r=rsingleTag.exec(e),i=!n&&[];if(r){return[t.createElement(r[1])]}r=jQuery.buildFragment([e],t,i);if(i&&i.length){jQuery(i).remove()}return jQuery.merge([],r.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(e,t,n){if(typeof e!=="string"&&_load){return _load.apply(this,arguments)}var r,i,s,o=this,u=e.indexOf(" ");if(u>=0){r=e.slice(u);e=e.slice(0,u)}if(jQuery.isFunction(t)){n=t;t=undefined}else if(t&&typeof t==="object"){i="POST"}if(o.length>0){jQuery.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){s=arguments;o.html(r?jQuery("<div>").append(jQuery.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,s||[e.responseText,t,e])})}return this};jQuery.expr.filters.animated=function(e){return jQuery.grep(jQuery.timers,function(t){return e===t.elem}).length};var docElem=window.document.documentElement;jQuery.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=jQuery.css(e,"position"),c=jQuery(e),h={};if(l==="static"){e.style.position="relative"}u=c.offset();s=jQuery.css(e,"top");a=jQuery.css(e,"left");f=(l==="absolute"||l==="fixed")&&(s+a).indexOf("auto")>-1;if(f){r=c.position();o=r.top;i=r.left}else{o=parseFloat(s)||0;i=parseFloat(a)||0}if(jQuery.isFunction(t)){t=t.call(e,n,u)}if(t.top!=null){h.top=t.top-u.top+o}if(t.left!=null){h.left=t.left-u.left+i}if("using"in t){t.using.call(e,h)}else{c.css(h)}}};jQuery.fn.extend({offset:function(e){if(arguments.length){return e===undefined?this:this.each(function(t){jQuery.offset.setOffset(this,e,t)})}var t,n,r=this[0],i={top:0,left:0},s=r&&r.ownerDocument;if(!s){return}t=s.documentElement;if(!jQuery.contains(t,r)){return i}if(typeof r.getBoundingClientRect!==strundefined){i=r.getBoundingClientRect()}n=getWindow(s);return{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}},position:function(){if(!this[0]){return}var e,t,n=this[0],r={top:0,left:0};if(jQuery.css(n,"position")==="fixed"){t=n.getBoundingClientRect()}else{e=this.offsetParent();t=this.offset();if(!jQuery.nodeName(e[0],"html")){r=e.offset()}r.top+=jQuery.css(e[0],"borderTopWidth",true);r.left+=jQuery.css(e[0],"borderLeftWidth",true)}return{top:t.top-r.top-jQuery.css(n,"marginTop",true),left:t.left-r.left-jQuery.css(n,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||docElem;while(e&&!jQuery.nodeName(e,"html")&&jQuery.css(e,"position")==="static"){e=e.offsetParent}return e||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;jQuery.fn[e]=function(r){return access(this,function(e,r,i){var s=getWindow(e);if(i===undefined){return s?s[t]:e[r]}if(s){s.scrollTo(!n?i:window.pageXOffset,n?i:window.pageYOffset)}else{e[r]=i}},e,r,arguments.length,null)}});jQuery.each(["top","left"],function(e,t){jQuery.cssHooks[t]=addGetHookIf(support.pixelPosition,function(e,n){if(n){n=curCSS(e,t);return rnumnonpx.test(n)?jQuery(e).position()[t]+"px":n}})});jQuery.each({Height:"height",Width:"width"},function(e,t){jQuery.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){jQuery.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!=="boolean"),o=n||(r===true||i===true?"margin":"border");return access(this,function(t,n,r){var i;if(jQuery.isWindow(t)){return t.document.documentElement["client"+e]}if(t.nodeType===9){i=t.documentElement;return Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])}return r===undefined?jQuery.css(t,n,o):jQuery.style(t,n,r,o)},t,s?r:undefined,s,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(e){if(window.$===jQuery){window.$=_$}if(e&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};if(typeof noGlobal===strundefined){window.jQuery=window.$=jQuery}return jQuery})},{}],44:[function(e,t,n){(function(e){(function(e){if(typeof bootstrap==="function"){bootstrap("promise",e)}else if(typeof n==="object"){t.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else if(typeof ses!=="undefined"){if(!ses.ok()){return}else{ses.makeQ=e}}else{Q=e()}})(function(){"use strict";function a(e){return function(){return u.apply(e,arguments)}}function g(e){return e===Object(e)}function y(e){return m(e)==="[object StopIteration]"||e instanceof b}function E(e,n){if(t&&n.stack&&typeof e==="object"&&e!==null&&e.stack&&e.stack.indexOf(w)===-1){var r=[];for(var i=n;!!i;i=i.source){if(i.stack){r.unshift(i.stack)}}r.unshift(e.stack);var s=r.join("\n"+w+"\n");e.stack=S(s)}}function S(e){var t=e.split("\n");var n=[];for(var r=0;r<t.length;++r){var i=t[r];if(!N(i)&&!x(i)&&i){n.push(i)}}return n.join("\n")}function x(e){return e.indexOf("(module.js:")!==-1||e.indexOf("(node.js:")!==-1}function T(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t){return[t[1],Number(t[2])]}var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n){return[n[1],Number(n[2])]}var r=/.*@(.+):(\d+)$/.exec(e);if(r){return[r[1],Number(r[2])]}}function N(e){var t=T(e);if(!t){return false}var n=t[0];var s=t[1];return n===i&&s>=r&&s<=ut}function C(){if(!t){return}try{throw new Error}catch(e){var n=e.stack.split("\n");var r=n[0].indexOf("@")>0?n[1]:n[2];var s=T(r);if(!s){return}i=s[0];return s[1]}}function k(e,t,n){return function(){if(typeof console!=="undefined"&&typeof console.warn==="function"){console.warn(t+" is deprecated, use "+n+" instead.",(new Error("")).stack)}return e.apply(e,arguments)}}function L(e){if(H(e)){return e}if(B(e)){return J(e)}else{return $(e)}}function A(){function a(t){r=t;s.source=t;l(e,function(e,n){o(function(){t.promiseDispatch.apply(t,n)})},void 0);e=void 0;n=void 0}var e=[],n=[],r;var i=p(A.prototype);var s=p(_.prototype);s.promiseDispatch=function(t,i,s){var u=f(arguments);if(e){e.push(u);if(i==="when"&&s[1]){n.push(s[1])}}else{o(function(){r.promiseDispatch.apply(r,u)})}};s.valueOf=function(){if(e){return s}var t=P(r);if(H(t)){r=t}return t};s.inspect=function(){if(!r){return{state:"pending"}}return r.inspect()};if(L.longStackSupport&&t){try{throw new Error}catch(u){s.stack=u.stack.substring(u.stack.indexOf("\n")+1)}}i.promise=s;i.resolve=function(e){if(r){return}a(L(e))};i.fulfill=function(e){if(r){return}a($(e))};i.reject=function(e){if(r){return}a(V(e))};i.notify=function(e){if(r){return}l(n,function(t,n){o(function(){n(e)})},void 0)};return i}function O(e){if(typeof e!=="function"){throw new TypeError("resolver must be a function.")}var t=A();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function M(e){return O(function(t,n){for(var r=0,i=e.length;r<i;r++){L(e[r]).then(t,n)}})}function _(e,t,n){if(t===void 0){t=function(e){return V(new Error("Promise does not support operation: "+e))}}if(n===void 0){n=function(){return{state:"unknown"}}}var r=p(_.prototype);r.promiseDispatch=function(n,i,s){var o;try{if(e[i]){o=e[i].apply(r,s)}else{o=t.call(r,i,s)}}catch(u){o=V(u)}if(n){n(o)}};r.inspect=n;if(n){var i=n();if(i.state==="rejected"){r.exception=i.reason}r.valueOf=function(){var e=n();if(e.state==="pending"||e.state==="rejected"){return r}return e.value}}return r}function D(e,t,n,r){return L(e).then(t,n,r)}function P(e){if(H(e)){var t=e.inspect();if(t.state==="fulfilled"){return t.value}}return e}function H(e){return g(e)&&typeof e.promiseDispatch==="function"&&typeof e.inspect==="function"}function B(e){return g(e)&&typeof e.then==="function"}function j(e){return H(e)&&e.inspect().state==="pending"}function F(e){return!H(e)||e.inspect().state==="fulfilled"}function I(e){return H(e)&&e.inspect().state==="rejected"}function z(){q.length=0;R.length=0;if(!U){U=true}}function W(e,t){if(!U){return}R.push(e);if(t&&typeof t.stack!=="undefined"){q.push(t.stack)}else{q.push("(no stack) "+t)}}function X(e){if(!U){return}var t=c(R,e);if(t!==-1){R.splice(t,1);q.splice(t,1)}}function V(e){var t=_({when:function(t){if(t){X(this)}return t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});W(t,e);return t}function $(e){return _({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){if(t===null||t===void 0){return e.apply(void 0,n)}else{return e[t].apply(e,n)}},apply:function(t,n){return e.apply(t,n)},keys:function(){return v(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function J(e){var t=A();o(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}});return t.promise}function K(e){return _({isDef:function(){}},function(n,r){return tt(e,n,r)},function(){return L(e).inspect()})}function Q(e,t,n){return L(e).spread(t,n)}function G(e){return function(){function t(e,t){var s;if(typeof StopIteration==="undefined"){try{s=n[e](t)}catch(o){return V(o)}if(s.done){return s.value}else{return D(s.value,r,i)}}else{try{s=n[e](t)}catch(o){if(y(o)){return o.value}else{return V(o)}}return D(s,r,i)}}var n=e.apply(this,arguments);var r=t.bind(t,"next");var i=t.bind(t,"throw");return r()}}function Y(e){L.done(L.async(e)())}function Z(e){throw new b(e)}function et(e){return function(){return Q([this,nt(arguments)],function(t,n){return e.apply(t,n)})}}function tt(e,t,n){return L(e).dispatch(t,n)}function nt(e){return D(e,function(e){var t=0;var n=A();l(e,function(r,i,s){var o;if(H(i)&&(o=i.inspect()).state==="fulfilled"){e[s]=o.value}else{++t;D(i,function(r){e[s]=r;if(--t===0){n.resolve(e)}},n.reject,function(e){n.notify({index:s,value:e})})}},void 0);if(t===0){n.resolve(e)}return n.promise})}function rt(e){return D(e,function(e){e=h(e,L);return D(nt(h(e,function(e){return D(e,s,s)})),function(){return e})})}function it(e){return L(e).allSettled()}function st(e,t){return L(e).then(void 0,void 0,t)}function ot(e,t){return L(e).nodeify(t)}var t=false;try{throw new Error}catch(n){t=!!n.stack}var r=C();var i;var s=function(){};var o=function(){function u(){while(t.next){t=t.next;var e=t.task;t.task=void 0;var n=t.domain;if(n){t.domain=void 0;n.enter()}try{e()}catch(i){if(s){if(n){n.exit()}setTimeout(u,0);if(n){n.enter()}throw i}else{setTimeout(function(){throw i},0)}}if(n){n.exit()}}r=false}var t={task:void 0,next:null};var n=t;var r=false;var i=void 0;var s=false;o=function(t){n=n.next={task:t,domain:s&&e.domain,next:null};if(!r){r=true;i()}};if(typeof e!=="undefined"&&e.nextTick){s=true;i=function(){e.nextTick(u)}}else if(typeof setImmediate==="function"){if(typeof window!=="undefined"){i=setImmediate.bind(window,u)}else{i=function(){setImmediate(u)}}}else if(typeof MessageChannel!=="undefined"){var a=new MessageChannel;a.port1.onmessage=function(){i=f;a.port1.onmessage=u;u()};var f=function(){a.port2.postMessage(0)};i=function(){setTimeout(u,0);f()}}else{i=function(){setTimeout(u,0)}}return o}();var u=Function.call;var f=a(Array.prototype.slice);var l=a(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(arguments.length===1){do{if(n in this){t=this[n++];break}if(++n>=r){throw new TypeError}}while(1)}for(;n<r;n++){if(n in this){t=e(t,this[n],n)}}return t});var c=a(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++){if(this[t]===e){return t}}return-1});var h=a(Array.prototype.map||function(e,t){var n=this;var r=[];l(n,function(i,s,o){r.push(e.call(t,s,o,n))},void 0);return r});var p=Object.create||function(e){function t(){}t.prototype=e;return new t};var d=a(Object.prototype.hasOwnProperty);var v=Object.keys||function(e){var t=[];for(var n in e){if(d(e,n)){t.push(n)}}return t};var m=a(Object.prototype.toString);var b;if(typeof ReturnValue!=="undefined"){b=ReturnValue}else{b=function(e){this.value=e}}var w="From previous event:";L.resolve=L;L.nextTick=o;L.longStackSupport=false;L.defer=A;A.prototype.makeNodeResolver=function(){var e=this;return function(t,n){if(t){e.reject(t)}else if(arguments.length>2){e.resolve(f(arguments,1))}else{e.resolve(n)}}};L.Promise=O;L.promise=O;O.race=M;O.all=nt;O.reject=V;O.resolve=L;L.passByCopy=function(e){return e};_.prototype.passByCopy=function(){return this};L.join=function(e,t){return L(e).join(t)};_.prototype.join=function(e){return L([this,e]).spread(function(e,t){if(e===t){return e}else{throw new Error("Can't join: not the same: "+e+" "+t)}})};L.race=M;_.prototype.race=function(){return this.then(L.race)};L.makePromise=_;_.prototype.toString=function(){return"[object Promise]"};_.prototype.then=function(e,t,n){function u(t){try{return typeof e==="function"?e(t):t}catch(n){return V(n)}}function a(e){if(typeof t==="function"){E(e,r);try{return t(e)}catch(n){return V(n)}}return V(e)}function f(e){return typeof n==="function"?n(e):e}var r=this;var i=A();var s=false;o(function(){r.promiseDispatch(function(e){if(s){return}s=true;i.resolve(u(e))},"when",[function(e){if(s){return}s=true;i.resolve(a(e))}])});r.promiseDispatch(void 0,"when",[void 0,function(e){var t;var n=false;try{t=f(e)}catch(r){n=true;if(L.onerror){L.onerror(r)}else{throw r}}if(!n){i.notify(t)}}]);return i.promise};L.when=D;_.prototype.thenResolve=function(e){return this.then(function(){return e})};L.thenResolve=function(e,t){return L(e).thenResolve(t)};_.prototype.thenReject=function(e){return this.then(function(){throw e})};L.thenReject=function(e,t){return L(e).thenReject(t)};L.nearer=P;L.isPromise=H;L.isPromiseAlike=B;L.isPending=j;_.prototype.isPending=function(){return this.inspect().state==="pending"};L.isFulfilled=F;_.prototype.isFulfilled=function(){return this.inspect().state==="fulfilled"};L.isRejected=I;_.prototype.isRejected=function(){return this.inspect().state==="rejected"};var q=[];var R=[];var U=true;L.resetUnhandledRejections=z;L.getUnhandledReasons=function(){return q.slice()};L.stopUnhandledRejectionTracking=function(){z();U=false};z();L.reject=V;L.fulfill=$;L.master=K;L.spread=Q;_.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)};L.async=G;L.spawn=Y;L["return"]=Z;L.promised=et;L.dispatch=tt;_.prototype.dispatch=function(e,t){var n=this;var r=A();o(function(){n.promiseDispatch(r.resolve,e,t)});return r.promise};L.get=function(e,t){return L(e).dispatch("get",[t])};_.prototype.get=function(e){return this.dispatch("get",[e])};L.set=function(e,t,n){return L(e).dispatch("set",[t,n])};_.prototype.set=function(e,t){return this.dispatch("set",[e,t])};L.del=L["delete"]=function(e,t){return L(e).dispatch("delete",[t])};_.prototype.del=_.prototype["delete"]=function(e){return this.dispatch("delete",[e])};L.mapply=L.post=function(e,t,n){return L(e).dispatch("post",[t,n])};_.prototype.mapply=_.prototype.post=function(e,t){return this.dispatch("post",[e,t])};L.send=L.mcall=L.invoke=function(e,t){return L(e).dispatch("post",[t,f(arguments,2)])};_.prototype.send=_.prototype.mcall=_.prototype.invoke=function(e){return this.dispatch("post",[e,f(arguments,1)])};L.fapply=function(e,t){return L(e).dispatch("apply",[void 0,t])};_.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])};L["try"]=L.fcall=function(e){return L(e).dispatch("apply",[void 0,f(arguments,1)])};_.prototype.fcall=function(){return this.dispatch("apply",[void 0,f(arguments)])};L.fbind=function(e){var t=L(e);var n=f(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(f(arguments))])}};_.prototype.fbind=function(){var e=this;var t=f(arguments);return function(){return e.dispatch("apply",[this,t.concat(f(arguments))])}};L.keys=function(e){return L(e).dispatch("keys",[])};_.prototype.keys=function(){return this.dispatch("keys",[])};L.all=nt;_.prototype.all=function(){return nt(this)};L.allResolved=k(rt,"allResolved","allSettled");_.prototype.allResolved=function(){return rt(this)};L.allSettled=it;_.prototype.allSettled=function(){return this.then(function(e){return nt(h(e,function(e){function t(){return e.inspect()}e=L(e);return e.then(t,t)}))})};L.fail=L["catch"]=function(e,t){return L(e).then(void 0,t)};_.prototype.fail=_.prototype["catch"]=function(e){return this.then(void 0,e)};L.progress=st;_.prototype.progress=function(e){return this.then(void 0,void 0,e)};L.fin=L["finally"]=function(e,t){return L(e)["finally"](t)};_.prototype.fin=_.prototype["finally"]=function(e){e=L(e);return this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})};L.done=function(e,t,n,r){return L(e).done(t,n,r)};_.prototype.done=function(t,n,r){var i=function(e){o(function(){E(e,s);if(L.onerror){L.onerror(e)}else{throw e}})};var s=t||n||r?this.then(t,n,r):this;if(typeof e==="object"&&e&&e.domain){i=e.domain.bind(i)}s.then(void 0,i)};L.timeout=function(e,t,n){return L(e).timeout(t,n)};_.prototype.timeout=function(e,t){var n=A();var r=setTimeout(function(){n.reject(new Error(t||"Timed out after "+e+" ms"))},e);this.then(function(e){clearTimeout(r);n.resolve(e)},function(e){clearTimeout(r);n.reject(e)},n.notify);return n.promise};L.delay=function(e,t){if(t===void 0){t=e;e=void 0}return L(e).delay(t)};_.prototype.delay=function(e){return this.then(function(t){var n=A();setTimeout(function(){n.resolve(t)},e);return n.promise})};L.nfapply=function(e,t){return L(e).nfapply(t)};_.prototype.nfapply=function(e){var t=A();var n=f(e);n.push(t.makeNodeResolver());this.fapply(n).fail(t.reject);return t.promise};L.nfcall=function(e){var t=f(arguments,1);return L(e).nfapply(t)};_.prototype.nfcall=function(){var e=f(arguments);var t=A();e.push(t.makeNodeResolver());this.fapply(e).fail(t.reject);return t.promise};L.nfbind=L.denodeify=function(e){var t=f(arguments,1);return function(){var n=t.concat(f(arguments));var r=A();n.push(r.makeNodeResolver());L(e).fapply(n).fail(r.reject);return r.promise}};_.prototype.nfbind=_.prototype.denodeify=function(){var e=f(arguments);e.unshift(this);return L.denodeify.apply(void 0,e)};L.nbind=function(e,t){var n=f(arguments,2);return function(){function s(){return e.apply(t,arguments)}var r=n.concat(f(arguments));var i=A();r.push(i.makeNodeResolver());L(s).fapply(r).fail(i.reject);return i.promise}};_.prototype.nbind=function(){var e=f(arguments,0);e.unshift(this);return L.nbind.apply(void 0,e)};L.nmapply=L.npost=function(e,t,n){return L(e).npost(t,n)};_.prototype.nmapply=_.prototype.npost=function(e,t){var n=f(t||[]);var r=A();n.push(r.makeNodeResolver());this.dispatch("post",[e,n]).fail(r.reject);return r.promise};L.nsend=L.nmcall=L.ninvoke=function(e,t){var n=f(arguments,2);var r=A();n.push(r.makeNodeResolver());L(e).dispatch("post",[t,n]).fail(r.reject);return r.promise};_.prototype.nsend=_.prototype.nmcall=_.prototype.ninvoke=function(e){var t=f(arguments,1);var n=A();t.push(n.makeNodeResolver());this.dispatch("post",[e,t]).fail(n.reject);return n.promise};L.nodeify=ot;_.prototype.nodeify=function(e){if(e){this.then(function(t){o(function(){e(null,t)})},function(t){o(function(){e(t)})})}else{return this}};var ut=C();return L})}).call(this,e("E:\\Libraries\\Documents\\Dropbox\\GitHub\\PainterlyRendering\\node_modules\\grunt-browserify\\node_modules\\browserify\\node_modules\\insert-module-globals\\node_modules\\process\\browser.js"))},{"E:\\Libraries\\Documents\\Dropbox\\GitHub\\PainterlyRendering\\node_modules\\grunt-browserify\\node_modules\\browserify\\node_modules\\insert-module-globals\\node_modules\\process\\browser.js":42}],45:[function(e,t,n){var r=r||{};var i={REVISION:"66"};r.console=r.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};(function(){var e=0;var t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!r.requestAnimationFrame;++n){r.requestAnimationFrame=r[t[n]+"RequestAnimationFrame"];r.cancelAnimationFrame=r[t[n]+"CancelAnimationFrame"]||r[t[n]+"CancelRequestAnimationFrame"]}if(r.requestAnimationFrame===undefined&&r["setTimeout"]!==undefined){r.requestAnimationFrame=function(t){var n=Date.now(),i=Math.max(0,16-(n-e));var s=r.setTimeout(function(){t(n+i)},i);e=n+i;return s}}if(r.cancelAnimationFrame===undefined&&r["clearTimeout"]!==undefined){r.cancelAnimationFrame=function(e){r.clearTimeout(e)}}})();i.CullFaceNone=0;i.CullFaceBack=1;i.CullFaceFront=2;i.CullFaceFrontBack=3;i.FrontFaceDirectionCW=0;i.FrontFaceDirectionCCW=1;i.BasicShadowMap=0;i.PCFShadowMap=1;i.PCFSoftShadowMap=2;i.FrontSide=0;i.BackSide=1;i.DoubleSide=2;i.NoShading=0;i.FlatShading=1;i.SmoothShading=2;i.NoColors=0;i.FaceColors=1;i.VertexColors=2;i.NoBlending=0;i.NormalBlending=1;i.AdditiveBlending=2;i.SubtractiveBlending=3;i.MultiplyBlending=4;i.CustomBlending=5;i.AddEquation=100;i.SubtractEquation=101;i.ReverseSubtractEquation=102;i.ZeroFactor=200;i.OneFactor=201;i.SrcColorFactor=202;i.OneMinusSrcColorFactor=203;i.SrcAlphaFactor=204;i.OneMinusSrcAlphaFactor=205;i.DstAlphaFactor=206;i.OneMinusDstAlphaFactor=207;i.DstColorFactor=208;i.OneMinusDstColorFactor=209;i.SrcAlphaSaturateFactor=210;i.MultiplyOperation=0;i.MixOperation=1;i.AddOperation=2;i.UVMapping=function(){};i.CubeReflectionMapping=function(){};i.CubeRefractionMapping=function(){};i.SphericalReflectionMapping=function(){};i.SphericalRefractionMapping=function(){};i.RepeatWrapping=1e3;i.ClampToEdgeWrapping=1001;i.MirroredRepeatWrapping=1002;i.NearestFilter=1003;i.NearestMipMapNearestFilter=1004;i.NearestMipMapLinearFilter=1005;i.LinearFilter=1006;i.LinearMipMapNearestFilter=1007;i.LinearMipMapLinearFilter=1008;i.UnsignedByteType=1009;i.ByteType=1010;i.ShortType=1011;i.UnsignedShortType=1012;i.IntType=1013;i.UnsignedIntType=1014;i.FloatType=1015;i.UnsignedShort4444Type=1016;i.UnsignedShort5551Type=1017;i.UnsignedShort565Type=1018;i.AlphaFormat=1019;i.RGBFormat=1020;i.RGBAFormat=1021;i.LuminanceFormat=1022;i.LuminanceAlphaFormat=1023;i.RGB_S3TC_DXT1_Format=2001;i.RGBA_S3TC_DXT1_Format=2002;i.RGBA_S3TC_DXT3_Format=2003;i.RGBA_S3TC_DXT5_Format=2004;i.Color=function(e){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(e)};i.Color.prototype={constructor:i.Color,r:1,g:1,b:1,set:function(e){if(e instanceof i.Color){this.copy(e)}else if(typeof e==="number"){this.setHex(e)}else if(typeof e==="string"){this.setStyle(e)}return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},setRGB:function(e,t,n){this.r=e;this.g=t;this.b=n;return this},setHSL:function(e,t,n){if(t===0){this.r=this.g=this.b=n}else{var r=function(e,t,n){if(n<0)n+=1;if(n>1)n-=1;if(n<1/6)return e+(t-e)*6*n;if(n<1/2)return t;if(n<2/3)return e+(t-e)*6*(2/3-n);return e};var i=n<=.5?n*(1+t):n+t-n*t;var s=2*n-i;this.r=r(s,i,e+1/3);this.g=r(s,i,e);this.b=r(s,i,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);this.r=Math.min(255,parseInt(t[1],10))/255;this.g=Math.min(255,parseInt(t[2],10))/255;this.b=Math.min(255,parseInt(t[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);this.r=Math.min(100,parseInt(t[1],10))/100;this.g=Math.min(100,parseInt(t[2],10))/100;this.b=Math.min(100,parseInt(t[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);this.setHex(parseInt(t[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16));return this}if(/^(\w+)$/i.test(e)){this.setHex(i.ColorKeywords[e]);return this}},copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e){this.r=e.r*e.r;this.g=e.g*e.g;this.b=e.b*e.b;return this},copyLinearToGamma:function(e){this.r=Math.sqrt(e.r);this.g=Math.sqrt(e.g);this.b=Math.sqrt(e.b);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;this.r=e*e;this.g=t*t;this.b=n*n;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0};var n=this.r,r=this.g,i=this.b;var s=Math.max(n,r,i);var o=Math.min(n,r,i);var u,a;var f=(o+s)/2;if(o===s){u=0;a=0}else{var l=s-o;a=f<=.5?l/(s+o):l/(2-s-o);switch(s){case n:u=(r-i)/l+(r<i?6:0);break;case r:u=(i-n)/l+2;break;case i:u=(n-r)/l+4;break}u/=6}t.h=u;t.s=a;t.l=f;return t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();r.h+=e;r.s+=t;r.l+=n;this.setHSL(r.h,r.s,r.l);return this},add:function(e){this.r+=e.r;this.g+=e.g;this.b+=e.b;return this},addColors:function(e,t){this.r=e.r+t.r;this.g=e.g+t.g;this.b=e.b+t.b;return this},addScalar:function(e){this.r+=e;this.g+=e;this.b+=e;return this},multiply:function(e){this.r*=e.r;this.g*=e.g;this.b*=e.b;return this},multiplyScalar:function(e){this.r*=e;this.g*=e;this.b*=e;return this},lerp:function(e,t){this.r+=(e.r-this.r)*t;this.g+=(e.g-this.g)*t;this.b+=(e.b-this.b)*t;return this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){this.r=e[0];this.g=e[1];this.b=e[2];return this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new i.Color).setRGB(this.r,this.g,this.b)}};i.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};i.Quaternion=function(e,t,n,r){this._x=e||0;this._y=t||0;this._z=n||0;this._w=r!==undefined?r:1};i.Quaternion.prototype={constructor:i.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:undefined,_updateEuler:function(e){if(this._euler!==undefined){this._euler.setFromQuaternion(this,undefined,false)}},get x(){return this._x},set x(e){this._x=e;this._updateEuler()},get y(){return this._y},set y(e){this._y=e;this._updateEuler()},get z(){return this._z},set z(e){this._z=e;this._updateEuler()},get w(){return this._w},set w(e){this._w=e;this._updateEuler()},set:function(e,t,n,r){this._x=e;this._y=t;this._z=n;this._w=r;this._updateEuler();return this},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._w=e._w;this._updateEuler();return this},setFromEuler:function(e,t){if(e instanceof i.Euler===false){throw new Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.")}var n=Math.cos(e._x/2);var r=Math.cos(e._y/2);var s=Math.cos(e._z/2);var o=Math.sin(e._x/2);var u=Math.sin(e._y/2);var a=Math.sin(e._z/2);if(e.order==="XYZ"){this._x=o*r*s+n*u*a;this._y=n*u*s-o*r*a;this._z=n*r*a+o*u*s;this._w=n*r*s-o*u*a}else if(e.order==="YXZ"){this._x=o*r*s+n*u*a;this._y=n*u*s-o*r*a;this._z=n*r*a-o*u*s;this._w=n*r*s+o*u*a}else if(e.order==="ZXY"){this._x=o*r*s-n*u*a;this._y=n*u*s+o*r*a;this._z=n*r*a+o*u*s;this._w=n*r*s-o*u*a}else if(e.order==="ZYX"){this._x=o*r*s-n*u*a;this._y=n*u*s+o*r*a;this._z=n*r*a-o*u*s;this._w=n*r*s+o*u*a}else if(e.order==="YZX"){this._x=o*r*s+n*u*a;this._y=n*u*s+o*r*a;this._z=n*r*a-o*u*s;this._w=n*r*s-o*u*a}else if(e.order==="XZY"){this._x=o*r*s-n*u*a;this._y=n*u*s-o*r*a;this._z=n*r*a+o*u*s;this._w=n*r*s+o*u*a}if(t!==false)this._updateEuler();return this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);this._x=e.x*r;this._y=e.y*r;this._z=e.z*r;this._w=Math.cos(n);this._updateEuler();return this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],o=t[5],u=t[9],a=t[2],f=t[6],l=t[10],c=n+o+l,h;if(c>0){h=.5/Math.sqrt(c+1);this._w=.25/h;this._x=(f-u)*h;this._y=(i-a)*h;this._z=(s-r)*h}else if(n>o&&n>l){h=2*Math.sqrt(1+n-o-l);this._w=(f-u)/h;this._x=.25*h;this._y=(r+s)/h;this._z=(i+a)/h}else if(o>l){h=2*Math.sqrt(1+o-n-l);this._w=(i-a)/h;this._x=(r+s)/h;this._y=.25*h;this._z=(u+f)/h}else{h=2*Math.sqrt(1+l-n-o);this._w=(s-r)/h;this._x=(i+a)/h;this._y=(u+f)/h;this._z=.25*h}this._updateEuler();return this},inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this._updateEuler();return this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();if(e===0){this._x=0;this._y=0;this._z=0;this._w=1}else{e=1/e;this._x=this._x*e;this._y=this._y*e;this._z=this._z*e;this._w=this._w*e}return this},multiply:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(e,t)}return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w;var o=t._x,u=t._y,a=t._z,f=t._w;this._x=n*f+s*o+r*a-i*u;this._y=r*f+s*u+i*o-n*a;this._z=i*f+s*a+n*u-r*o;this._w=s*f-n*o-r*u-i*a;this._updateEuler();return this},multiplyVector3:function(e){console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return e.applyQuaternion(this)},slerp:function(e,t){var n=this._x,r=this._y,i=this._z,s=this._w;var o=s*e._w+n*e._x+r*e._y+i*e._z;if(o<0){this._w=-e._w;this._x=-e._x;this._y=-e._y;this._z=-e._z;o=-o}else{this.copy(e)}if(o>=1){this._w=s;this._x=n;this._y=r;this._z=i;return this}var u=Math.acos(o);var a=Math.sqrt(1-o*o);if(Math.abs(a)<.001){this._w=.5*(s+this._w);this._x=.5*(n+this._x);this._y=.5*(r+this._y);this._z=.5*(i+this._z);return this}var f=Math.sin((1-t)*u)/a,l=Math.sin(t*u)/a;this._w=s*f+this._w*l;this._x=n*f+this._x*l;this._y=r*f+this._y*l;this._z=i*f+this._z*l;this._updateEuler();return this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];this._w=e[3];this._updateEuler();return this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new i.Quaternion(this._x,this._y,this._z,this._w)}};i.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)};i.Vector2=function(e,t){this.x=e||0;this.y=t||0};i.Vector2.prototype={constructor:i.Vector2,set:function(e,t){this.x=e;this.y=t;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addScalar:function(e){this.x+=e;this.y+=e;return this},sub:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t}else{this.x=0;this.y=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}return this},clampScalar:function(){var e,t;return function(n,r){if(e===undefined){e=new i.Vector2;t=new i.Vector2}e.set(n,n);t.set(r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){this.x=e[0];this.y=e[1];return this},toArray:function(){return[this.x,this.y]},clone:function(){return new i.Vector2(this.x,this.y)}};i.Vector3=function(e,t,n){this.x=e||0;this.y=t||0;this.z=n||0};i.Vector3.prototype={constructor:i.Vector3,set:function(e,t,n){this.x=e;this.y=t;this.z=n;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},sub:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},multiply:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(e,t)}this.x*=e.x;this.y*=e.y;this.z*=e.z;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;return this},multiplyVectors:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},applyEuler:function(){var e;return function(t){if(t instanceof i.Euler===false){console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.")}if(e===undefined)e=new i.Quaternion;this.applyQuaternion(e.setFromEuler(t));return this}}(),applyAxisAngle:function(){var e;return function(t,n){if(e===undefined)e=new i.Quaternion;this.applyQuaternion(e.setFromAxisAngle(t,n));return this}}(),applyMatrix3:function(e){var t=this.x;var n=this.y;var r=this.z;var i=e.elements;this.x=i[0]*t+i[3]*n+i[6]*r;this.y=i[1]*t+i[4]*n+i[7]*r;this.z=i[2]*t+i[5]*n+i[8]*r;return this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z;var i=e.elements;this.x=i[0]*t+i[4]*n+i[8]*r+i[12];this.y=i[1]*t+i[5]*n+i[9]*r+i[13];this.z=i[2]*t+i[6]*n+i[10]*r+i[14];return this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z;var i=e.elements;var s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s;this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s;this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s;return this},applyQuaternion:function(e){var t=this.x;var n=this.y;var r=this.z;var i=e.x;var s=e.y;var o=e.z;var u=e.w;var a=u*t+s*r-o*n;var f=u*n+o*t-i*r;var l=u*r+i*n-s*t;var c=-i*t-s*n-o*r;this.x=a*u+c*-i+f*-o-l*-s;this.y=f*u+c*-s+l*-i-a*-o;this.z=l*u+c*-o+a*-s-f*-i;return this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z;var i=e.elements;this.x=i[0]*t+i[4]*n+i[8]*r;this.y=i[1]*t+i[5]*n+i[9]*r;this.z=i[2]*t+i[6]*n+i[10]*r;this.normalize();return this},divide:function(e){this.x/=e.x;this.y/=e.y;this.z/=e.z;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t}else{this.x=0;this.y=0;this.z=0}return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}return this},clampScalar:function(){var e,t;return function(n,r){if(e===undefined){e=new i.Vector3;t=new i.Vector3}e.set(n,n,n);t.set(r,r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;return this},cross:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(e,t)}var n=this.x,r=this.y,i=this.z;this.x=r*e.z-i*e.y;this.y=i*e.x-n*e.z;this.z=n*e.y-r*e.x;return this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z;var s=t.x,o=t.y,u=t.z;this.x=r*u-i*o;this.y=i*s-n*u;this.z=n*o-r*s;return this},projectOnVector:function(){var e,t;return function(n){if(e===undefined)e=new i.Vector3;e.copy(n).normalize();t=this.dot(e);return this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){if(e===undefined)e=new i.Vector3;e.copy(this).projectOnVector(t);return this.sub(e)}}(),reflect:function(){var e;return function(t){if(e===undefined)e=new i.Vector3;return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(i.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;var n=this.y-e.y;var r=this.z-e.z;return t*t+n*n+r*r},setEulerFromRotationMatrix:function(e,t){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code.");return this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code.");return this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code.");return this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length();var n=this.set(e.elements[4],e.elements[5],e.elements[6]).length();var r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=n;this.z=r;return this},setFromMatrixColumn:function(e,t){var n=e*4;var r=t.elements;this.x=r[n];this.y=r[n+1];this.z=r[n+2];return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){this.x=e[0];this.y=e[1];this.z=e[2];return this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new i.Vector3(this.x,this.y,this.z)}};i.Vector4=function(e,t,n,r){this.x=e||0;this.y=t||0;this.z=n||0;this.w=r!==undefined?r:1};i.Vector4.prototype={constructor:i.Vector4,set:function(e,t,n,r){this.x=e;this.y=t;this.z=n;this.w=r;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},setW:function(e){this.w=e;return this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==undefined?e.w:1;return this},add:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(e,t)}this.x+=e.x;this.y+=e.y;this.z+=e.z;this.w+=e.w;return this},addScalar:function(e){this.x+=e;this.y+=e;this.z+=e;this.w+=e;return this},addVectors:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},sub:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(e,t)}this.x-=e.x;this.y-=e.y;this.z-=e.z;this.w-=e.w;return this},subVectors:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},multiplyScalar:function(e){this.x*=e;this.y*=e;this.z*=e;this.w*=e;return this},applyMatrix4:function(e){var t=this.x;var n=this.y;var r=this.z;var i=this.w;var s=e.elements;this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i;this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i;this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i;this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i;return this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t;this.y*=t;this.z*=t;this.w*=t}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);if(t<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=e.x/t;this.y=e.y/t;this.z=e.z/t}return this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,s=.01,o=.1,u=e.elements,a=u[0],f=u[4],l=u[8],c=u[1],h=u[5],p=u[9],d=u[2],v=u[6],m=u[10];if(Math.abs(f-c)<s&&Math.abs(l-d)<s&&Math.abs(p-v)<s){if(Math.abs(f+c)<o&&Math.abs(l+d)<o&&Math.abs(p+v)<o&&Math.abs(a+h+m-3)<o){this.set(1,0,0,0);return this}t=Math.PI;var g=(a+1)/2;var y=(h+1)/2;var b=(m+1)/2;var w=(f+c)/4;var E=(l+d)/4;var S=(p+v)/4;if(g>y&&g>b){if(g<s){n=0;r=.707106781;i=.707106781}else{n=Math.sqrt(g);r=w/n;i=E/n}}else if(y>b){if(y<s){n=.707106781;r=0;i=.707106781}else{r=Math.sqrt(y);n=w/r;i=S/r}}else{if(b<s){n=.707106781;r=.707106781;i=0}else{i=Math.sqrt(b);n=E/i;r=S/i}}this.set(n,r,i,t);return this}var x=Math.sqrt((v-p)*(v-p)+(l-d)*(l-d)+(c-f)*(c-f));if(Math.abs(x)<.001)x=1;this.x=(v-p)/x;this.y=(l-d)/x;this.z=(c-f)/x;this.w=Math.acos((a+h+m-1)/2);return this},min:function(e){if(this.x>e.x){this.x=e.x}if(this.y>e.y){this.y=e.y}if(this.z>e.z){this.z=e.z}if(this.w>e.w){this.w=e.w}return this},max:function(e){if(this.x<e.x){this.x=e.x}if(this.y<e.y){this.y=e.y}if(this.z<e.z){this.z=e.z}if(this.w<e.w){this.w=e.w}return this},clamp:function(e,t){if(this.x<e.x){this.x=e.x}else if(this.x>t.x){this.x=t.x}if(this.y<e.y){this.y=e.y}else if(this.y>t.y){this.y=t.y}if(this.z<e.z){this.z=e.z}else if(this.z>t.z){this.z=t.z}if(this.w<e.w){this.w=e.w}else if(this.w>t.w){this.w=t.w}return this},clampScalar:function(){var e,t;return function(n,r){if(e===undefined){e=new i.Vector4;t=new i.Vector4}e.set(n,n,n,n);t.set(r,r,r,r);return this.clamp(e,t)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();if(t!==0&&e!==t){this.multiplyScalar(e/t)}return this},lerp:function(e,t){this.x+=(e.x-this.x)*t;this.y+=(e.y-this.y)*t;this.z+=(e.z-this.z)*t;this.w+=(e.w-this.w)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){this.x=e[0];this.y=e[1];this.z=e[2];this.w=e[3];return this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new i.Vector4(this.x,this.y,this.z,this.w)}};i.Euler=function(e,t,n,r){this._x=e||0;this._y=t||0;this._z=n||0;this._order=r||i.Euler.DefaultOrder};i.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];i.Euler.DefaultOrder="XYZ";i.Euler.prototype={constructor:i.Euler,_x:0,_y:0,_z:0,_order:i.Euler.DefaultOrder,_quaternion:undefined,_updateQuaternion:function(){if(this._quaternion!==undefined){this._quaternion.setFromEuler(this,false)}},get x(){return this._x},set x(e){this._x=e;this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e;this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e;this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e;this._updateQuaternion()},set:function(e,t,n,r){this._x=e;this._y=t;this._z=n;this._order=r||this._order;this._updateQuaternion();return this},copy:function(e){this._x=e._x;this._y=e._y;this._z=e._z;this._order=e._order;this._updateQuaternion();return this},setFromVector:function(e,t){this._x=e.x;this._y=e.y;this._z=e.z;this._order=t||this._order;this._updateQuaternion();return this},setFromRotationMatrix:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.elements;var i=r[0],s=r[4],o=r[8];var u=r[1],a=r[5],f=r[9];var l=r[2],c=r[6],h=r[10];t=t||this._order;if(t==="XYZ"){this._y=Math.asin(n(o));if(Math.abs(o)<.99999){this._x=Math.atan2(-f,h);this._z=Math.atan2(-s,i)}else{this._x=Math.atan2(c,a);this._z=0}}else if(t==="YXZ"){this._x=Math.asin(-n(f));if(Math.abs(f)<.99999){this._y=Math.atan2(o,h);this._z=Math.atan2(u,a)}else{this._y=Math.atan2(-l,i);this._z=0}}else if(t==="ZXY"){this._x=Math.asin(n(c));if(Math.abs(c)<.99999){this._y=Math.atan2(-l,h);this._z=Math.atan2(-s,a)}else{this._y=0;this._z=Math.atan2(u,i)}}else if(t==="ZYX"){this._y=Math.asin(-n(l));if(Math.abs(l)<.99999){this._x=Math.atan2(c,h);this._z=Math.atan2(u,i)}else{this._x=0;this._z=Math.atan2(-s,a)}}else if(t==="YZX"){this._z=Math.asin(n(u));if(Math.abs(u)<.99999){this._x=Math.atan2(-f,a);this._y=Math.atan2(-l,i)}else{this._x=0;this._y=Math.atan2(o,h)}}else if(t==="XZY"){this._z=Math.asin(-n(s));if(Math.abs(s)<.99999){this._x=Math.atan2(c,a);this._y=Math.atan2(o,i)}else{this._x=Math.atan2(-f,h);this._y=0}}else{console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t)}this._order=t;this._updateQuaternion();return this},setFromQuaternion:function(e,t,n){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.x*e.x;var s=e.y*e.y;var o=e.z*e.z;var u=e.w*e.w;t=t||this._order;if(t==="XYZ"){this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),u-i-s+o);this._y=Math.asin(r(2*(e.x*e.z+e.y*e.w)));this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u+i-s-o)}else if(t==="YXZ"){this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z)));this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u-i-s+o);this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u-i+s-o)}else if(t==="ZXY"){this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z)));this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),u-i-s+o);this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u-i+s-o)}else if(t==="ZYX"){this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),u-i-s+o);this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z)));this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u+i-s-o)}else if(t==="YZX"){this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),u-i+s-o);this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),u+i-s-o);this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))}else if(t==="XZY"){this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),u-i+s-o);this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u+i-s-o);this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))}else{console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t)}this._order=t;if(n!==false)this._updateQuaternion();return this},reorder:function(){var e=new i.Quaternion;return function(t){e.setFromEuler(this);this.setFromQuaternion(e,t)}}(),fromArray:function(e){this._x=e[0];this._y=e[1];this._z=e[2];if(e[3]!==undefined)this._order=e[3];this._updateQuaternion();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new i.Euler(this._x,this._y,this._z,this._order)}};i.Line3=function(e,t){this.start=e!==undefined?e:new i.Vector3;this.end=t!==undefined?t:new i.Vector3};i.Line3.prototype={constructor:i.Line3,set:function(e,t){this.start.copy(e);this.end.copy(t);return this},copy:function(e){this.start.copy(e.start);this.end.copy(e.end);return this},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new i.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new i.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new i.Vector3;var t=new i.Vector3;return function(n,r){e.subVectors(n,this.start);t.subVectors(this.end,this.start);var s=t.dot(t);var o=t.dot(e);var u=o/s;if(r){u=i.Math.clamp(u,0,1)}return u}}(),closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t);var s=n||new i.Vector3;return this.delta(s).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){this.start.applyMatrix4(e);this.end.applyMatrix4(e);return this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new i.Line3).copy(this)}};i.Box2=function(e,t){this.min=e!==undefined?e:new i.Vector2(Infinity,Infinity);this.max=t!==undefined?t:new i.Vector2(-Infinity,-Infinity)};i.Box2.prototype={constructor:i.Box2,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t);this.max.copy(t);for(var n=1,r=e.length;n<r;n++){t=e[n];if(t.x<this.min.x){this.min.x=t.x}else if(t.x>this.max.x){this.max.x=t.x}if(t.y<this.min.y){this.min.y=t.y}else if(t.y>this.max.y){this.max.y=t.y}}}else{this.makeEmpty()}return this},setFromCenterAndSize:function(){var e=new i.Vector2;return function(t,n){var r=e.copy(n).multiplyScalar(.5);this.min.copy(t).sub(r);this.max.copy(t).add(r);return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new i.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y){return true}return false},getParameter:function(e,t){var n=t||new i.Vector2;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y){return false}return true},clampPoint:function(e,t){var n=t||new i.Vector2;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector2;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new i.Box2).copy(this)}};i.Box3=function(e,t){this.min=e!==undefined?e:new i.Vector3(Infinity,Infinity,Infinity);this.max=t!==undefined?t:new i.Vector3(-Infinity,-Infinity,-Infinity)};i.Box3.prototype={constructor:i.Box3,set:function(e,t){this.min.copy(e);this.max.copy(t);return this},addPoint:function(e){if(e.x<this.min.x){this.min.x=e.x}else if(e.x>this.max.x){this.max.x=e.x}if(e.y<this.min.y){this.min.y=e.y}else if(e.y>this.max.y){this.max.y=e.y}if(e.z<this.min.z){this.min.z=e.z}else if(e.z>this.max.z){this.max.z=e.z}},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t);this.max.copy(t);for(var n=1,r=e.length;n<r;n++){this.addPoint(e[n])}}else{this.makeEmpty()}return this},setFromCenterAndSize:function(){var e=new i.Vector3;return function(t,n){var r=e.copy(n).multiplyScalar(.5);this.min.copy(t).sub(r);this.max.copy(t).add(r);return this}}(),setFromObject:function(){var e=new i.Vector3;return function(t){var n=this;t.updateMatrixWorld(true);this.makeEmpty();t.traverse(function(t){if(t.geometry!==undefined&&t.geometry.vertices!==undefined){var r=t.geometry.vertices;for(var i=0,s=r.length;i<s;i++){e.copy(r[i]);e.applyMatrix4(t.matrixWorld);n.expandByPoint(e)}}});return this}}(),copy:function(e){this.min.copy(e.min);this.max.copy(e.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new i.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new i.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){this.min.min(e);this.max.max(e);return this},expandByVector:function(e){this.min.sub(e);this.max.add(e);return this},expandByScalar:function(e){this.min.addScalar(-e);this.max.addScalar(e);return this},containsPoint:function(e){if(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z){return false}return true},containsBox:function(e){if(this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z){return true}return false},getParameter:function(e,t){var n=t||new i.Vector3;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){if(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z){return false}return true},clampPoint:function(e,t){var n=t||new i.Vector3;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),getBoundingSphere:function(){var e=new i.Vector3;return function(t){var n=t||new i.Sphere;n.center=this.center();n.radius=this.size(e).length()*.5;return n}}(),intersect:function(e){this.min.max(e.min);this.max.min(e.max);return this},union:function(e){this.min.min(e.min);this.max.max(e.max);return this},applyMatrix4:function(){var e=[new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3,new i.Vector3];return function(t){e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t);e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t);e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t);e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t);e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t);e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t);e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t);e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t);this.makeEmpty();this.setFromPoints(e);return this}}(),translate:function(e){this.min.add(e);this.max.add(e);return this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new i.Box3).copy(this)}};i.Matrix3=function(e,t,n,r,i,s,o,u,a){this.elements=new Float32Array(9);this.set(e!==undefined?e:1,t||0,n||0,r||0,i!==undefined?i:1,s||0,o||0,u||0,a!==undefined?a:1)};i.Matrix3.prototype={constructor:i.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;f[0]=e;f[3]=t;f[6]=n;f[1]=r;f[4]=i;f[7]=s;f[2]=o;f[5]=u;f[8]=a;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(e){var t=e.elements;this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]);return this},multiplyVector3:function(e){console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new i.Vector3;return function(t){for(var n=0,r=t.length;n<r;n+=3){e.x=t[n];e.y=t[n+1];e.z=t[n+2];e.applyMatrix3(this);t[n]=e.x;t[n+1]=e.y;t[n+2]=e.z}return t}}(),multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[3]*=e;t[6]*=e;t[1]*=e;t[4]*=e;t[7]*=e;t[2]*=e;t[5]*=e;t[8]*=e;return this},determinant:function(){var e=this.elements;var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*s*f-t*o*a-n*i*f+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements;var r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9];r[1]=-n[10]*n[1]+n[2]*n[9];r[2]=n[6]*n[1]-n[2]*n[5];r[3]=-n[10]*n[4]+n[6]*n[8];r[4]=n[10]*n[0]-n[2]*n[8];r[5]=-n[6]*n[0]+n[2]*n[4];r[6]=n[9]*n[4]-n[5]*n[8];r[7]=-n[9]*n[0]+n[1]*n[8];r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(i===0){var s="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(s)}else{console.warn(s)}this.identity();return this}this.multiplyScalar(1/i);return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},getNormalMatrix:function(e){this.getInverse(e).transpose();return this},transposeIntoArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var e=this.elements;return new i.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}};i.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this.elements=new Float32Array(16);var m=this.elements;m[0]=e!==undefined?e:1;m[4]=t||0;m[8]=n||0;m[12]=r||0;m[1]=i||0;m[5]=s!==undefined?s:1;m[9]=o||0;m[13]=u||0;m[2]=a||0;m[6]=f||0;m[10]=l!==undefined?l:1;m[14]=c||0;m[3]=h||0;m[7]=p||0;m[11]=d||0;m[15]=v!==undefined?v:1};i.Matrix4.prototype={constructor:i.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;m[0]=e;m[4]=t;m[8]=n;m[12]=r;m[1]=i;m[5]=s;m[9]=o;m[13]=u;m[2]=a;m[6]=f;m[10]=l;m[14]=c;m[3]=h;m[7]=p;m[11]=d;m[15]=v;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(e){this.elements.set(e.elements);return this},extractPosition:function(e){console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(e)},copyPosition:function(e){var t=this.elements;var n=e.elements;t[12]=n[12];t[13]=n[13];t[14]=n[14];return this},extractRotation:function(){var e=new i.Vector3;return function(t){var n=this.elements;var r=t.elements;var i=1/e.set(r[0],r[1],r[2]).length();var s=1/e.set(r[4],r[5],r[6]).length();var o=1/e.set(r[8],r[9],r[10]).length();n[0]=r[0]*i;n[1]=r[1]*i;n[2]=r[2]*i;n[4]=r[4]*s;n[5]=r[5]*s;n[6]=r[6]*s;n[8]=r[8]*o;n[9]=r[9]*o;n[10]=r[10]*o;return this}}(),makeRotationFromEuler:function(e){if(e instanceof i.Euler===false){console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.")}var t=this.elements;var n=e.x,r=e.y,s=e.z;var o=Math.cos(n),u=Math.sin(n);var a=Math.cos(r),f=Math.sin(r);var l=Math.cos(s),c=Math.sin(s);if(e.order==="XYZ"){var h=o*l,p=o*c,d=u*l,v=u*c;t[0]=a*l;t[4]=-a*c;t[8]=f;t[1]=p+d*f;t[5]=h-v*f;t[9]=-u*a;t[2]=v-h*f;t[6]=d+p*f;t[10]=o*a}else if(e.order==="YXZ"){var m=a*l,g=a*c,y=f*l,b=f*c;t[0]=m+b*u;t[4]=y*u-g;t[8]=o*f;t[1]=o*c;t[5]=o*l;t[9]=-u;t[2]=g*u-y;t[6]=b+m*u;t[10]=o*a}else if(e.order==="ZXY"){var m=a*l,g=a*c,y=f*l,b=f*c;t[0]=m-b*u;t[4]=-o*c;t[8]=y+g*u;t[1]=g+y*u;t[5]=o*l;t[9]=b-m*u;t[2]=-o*f;t[6]=u;t[10]=o*a}else if(e.order==="ZYX"){var h=o*l,p=o*c,d=u*l,v=u*c;t[0]=a*l;t[4]=d*f-p;t[8]=h*f+v;t[1]=a*c;t[5]=v*f+h;t[9]=p*f-d;t[2]=-f;t[6]=u*a;t[10]=o*a}else if(e.order==="YZX"){var w=o*a,E=o*f,S=u*a,x=u*f;t[0]=a*l;t[4]=x-w*c;t[8]=S*c+E;t[1]=c;t[5]=o*l;t[9]=-u*l;t[2]=-f*l;t[6]=E*c+S;t[10]=w-x*c}else if(e.order==="XZY"){var w=o*a,E=o*f,S=u*a,x=u*f;t[0]=a*l;t[4]=-c;t[8]=f*l;t[1]=w*c+x;t[5]=o*l;t[9]=E*c-S;t[2]=S*c-E;t[6]=u*l;t[10]=x*c+w}t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},setRotationFromQuaternion:function(e){console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code.");return this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements;var n=e.x,r=e.y,i=e.z,s=e.w;var o=n+n,u=r+r,a=i+i;var f=n*o,l=n*u,c=n*a;var h=r*u,p=r*a,d=i*a;var v=s*o,m=s*u,g=s*a;t[0]=1-(h+d);t[4]=l-g;t[8]=c+m;t[1]=l+g;t[5]=1-(f+d);t[9]=p-v;t[2]=c-m;t[6]=p+v;t[10]=1-(f+h);t[3]=0;t[7]=0;t[11]=0;t[12]=0;t[13]=0;t[14]=0;t[15]=1;return this},lookAt:function(){var e=new i.Vector3;var t=new i.Vector3;var n=new i.Vector3;return function(r,i,s){var o=this.elements;n.subVectors(r,i).normalize();if(n.length()===0){n.z=1}e.crossVectors(s,n).normalize();if(e.length()===0){n.x+=1e-4;e.crossVectors(s,n).normalize()}t.crossVectors(n,e);o[0]=e.x;o[4]=t.x;o[8]=n.x;o[1]=e.y;o[5]=t.y;o[9]=n.y;o[2]=e.z;o[6]=t.z;o[10]=n.z;return this}}(),multiply:function(e,t){if(t!==undefined){console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(e,t)}return this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements;var r=t.elements;var i=this.elements;var s=n[0],o=n[4],u=n[8],a=n[12];var f=n[1],l=n[5],c=n[9],h=n[13];var p=n[2],d=n[6],v=n[10],m=n[14];var g=n[3],y=n[7],b=n[11],w=n[15];var E=r[0],S=r[4],x=r[8],T=r[12];var N=r[1],C=r[5],k=r[9],L=r[13];var A=r[2],O=r[6],M=r[10],_=r[14];var D=r[3],P=r[7],H=r[11],B=r[15];i[0]=s*E+o*N+u*A+a*D;i[4]=s*S+o*C+u*O+a*P;i[8]=s*x+o*k+u*M+a*H;i[12]=s*T+o*L+u*_+a*B;i[1]=f*E+l*N+c*A+h*D;i[5]=f*S+l*C+c*O+h*P;i[9]=f*x+l*k+c*M+h*H;i[13]=f*T+l*L+c*_+h*B;i[2]=p*E+d*N+v*A+m*D;i[6]=p*S+d*C+v*O+m*P;i[10]=p*x+d*k+v*M+m*H;i[14]=p*T+d*L+v*_+m*B;i[3]=g*E+y*N+b*A+w*D;i[7]=g*S+y*C+b*O+w*P;i[11]=g*x+y*k+b*M+w*H;i[15]=g*T+y*L+b*_+w*B;return this},multiplyToArray:function(e,t,n){var r=this.elements;this.multiplyMatrices(e,t);n[0]=r[0];n[1]=r[1];n[2]=r[2];n[3]=r[3];n[4]=r[4];n[5]=r[5];n[6]=r[6];n[7]=r[7];n[8]=r[8];n[9]=r[9];n[10]=r[10];n[11]=r[11];n[12]=r[12];n[13]=r[13];n[14]=r[14];n[15]=r[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]*=e;t[4]*=e;t[8]*=e;t[12]*=e;t[1]*=e;t[5]*=e;t[9]*=e;t[13]*=e;t[2]*=e;t[6]*=e;t[10]*=e;t[14]*=e;t[3]*=e;t[7]*=e;t[11]*=e;t[15]*=e;return this},multiplyVector3:function(e){console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return e.applyProjection(this)},multiplyVector4:function(e){console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new i.Vector3;return function(t){for(var n=0,r=t.length;n<r;n+=3){e.x=t[n];e.y=t[n+1];e.z=t[n+2];e.applyProjection(this);t[n]=e.x;t[n+1]=e.y;t[n+2]=e.z}return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");e.transformDirection(this)},crossVector:function(e){console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return e.applyMatrix4(this)},determinant:function(){var e=this.elements;var t=e[0],n=e[4],r=e[8],i=e[12];var s=e[1],o=e[5],u=e[9],a=e[13];var f=e[2],l=e[6],c=e[10],h=e[14];var p=e[3],d=e[7],v=e[11],m=e[15];return p*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+d*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+v*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+m*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements;var t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e},flattenToArrayOffset:function(e,t){var n=this.elements;e[t]=n[0];e[t+1]=n[1];e[t+2]=n[2];e[t+3]=n[3];e[t+4]=n[4];e[t+5]=n[5];e[t+6]=n[6];e[t+7]=n[7];e[t+8]=n[8];e[t+9]=n[9];e[t+10]=n[10];e[t+11]=n[11];e[t+12]=n[12];e[t+13]=n[13];e[t+14]=n[14];e[t+15]=n[15];return e},getPosition:function(){var e=new i.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getInverse:function(e,t){var n=this.elements;var r=e.elements;var i=r[0],s=r[4],o=r[8],u=r[12];var a=r[1],f=r[5],l=r[9],c=r[13];var h=r[2],p=r[6],d=r[10],v=r[14];var m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b;n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b;n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b;n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v;n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b;n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b;n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b;n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v;n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b;n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b;n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b;n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v;n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y;n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y;n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y;n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d;var w=i*n[0]+a*n[4]+h*n[8]+m*n[12];if(w==0){var E="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||false){throw new Error(E)}else{console.warn(E)}this.identity();return this}this.multiplyScalar(1/w);return this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements;var n=e.x,r=e.y,i=e.z;t[0]*=n;t[4]*=r;t[8]*=i;t[1]*=n;t[5]*=r;t[9]*=i;t[2]*=n;t[6]*=r;t[10]*=i;t[3]*=n;t[7]*=r;t[11]*=i;return this},getMaxScaleOnAxis:function(){var e=this.elements;var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];var n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6];var r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,r)))},makeTranslation:function(e,t,n){this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var n=Math.cos(t);var r=Math.sin(t);var i=1-n;var s=e.x,o=e.y,u=e.z;var a=i*s,f=i*o;this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1);return this},makeScale:function(e,t,n){this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1);return this},compose:function(e,t,n){this.makeRotationFromQuaternion(t);this.scale(n);this.setPosition(e);return this},decompose:function(){var e=new i.Vector3;var t=new i.Matrix4;return function(n,r,i){var s=this.elements;var o=e.set(s[0],s[1],s[2]).length();var u=e.set(s[4],s[5],s[6]).length();var a=e.set(s[8],s[9],s[10]).length();var f=this.determinant();if(f<0){o=-o}n.x=s[12];n.y=s[13];n.z=s[14];t.elements.set(this.elements);var l=1/o;var c=1/u;var h=1/a;t.elements[0]*=l;t.elements[1]*=l;t.elements[2]*=l;t.elements[4]*=c;t.elements[5]*=c;t.elements[6]*=c;t.elements[8]*=h;t.elements[9]*=h;t.elements[10]*=h;r.setFromRotationMatrix(t);i.x=o;i.y=u;i.z=a;return this}}(),makeFrustum:function(e,t,n,r,i,s){var o=this.elements;var u=2*i/(t-e);var a=2*i/(r-n);var f=(t+e)/(t-e);var l=(r+n)/(r-n);var c=-(s+i)/(s-i);var h=-2*s*i/(s-i);o[0]=u;o[4]=0;o[8]=f;o[12]=0;o[1]=0;o[5]=a;o[9]=l;o[13]=0;o[2]=0;o[6]=0;o[10]=c;o[14]=h;o[3]=0;o[7]=0;o[11]=-1;o[15]=0;return this},makePerspective:function(e,t,n,r){var s=n*Math.tan(i.Math.degToRad(e*.5));var o=-s;var u=o*t;var a=s*t;return this.makeFrustum(u,a,o,s,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements;var u=t-e;var a=n-r;var f=s-i;var l=(t+e)/u;var c=(n+r)/a;var h=(s+i)/f;o[0]=2/u;o[4]=0;o[8]=0;o[12]=-l;o[1]=0;o[5]=2/a;o[9]=0;o[13]=-c;o[2]=0;o[6]=0;o[10]=-2/f;o[14]=-h;o[3]=0;o[7]=0;o[11]=0;o[15]=1;return this},fromArray:function(e){this.elements.set(e);return this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new i.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}};i.Ray=function(e,t){this.origin=e!==undefined?e:new i.Vector3;this.direction=t!==undefined?t:new i.Vector3};i.Ray.prototype={constructor:i.Ray,set:function(e,t){this.origin.copy(e);this.direction.copy(t);return this},copy:function(e){this.origin.copy(e.origin);this.direction.copy(e.direction);return this},at:function(e,t){var n=t||new i.Vector3;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new i.Vector3;return function(t){this.origin.copy(this.at(t,e));return this}}(),closestPointToPoint:function(e,t){var n=t||new i.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);if(r<0){return n.copy(this.origin)}return n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new i.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);if(n<0){return this.origin.distanceTo(t)}e.copy(this.direction).multiplyScalar(n).add(this.origin);return e.distanceTo(t)}}(),distanceSqToSegment:function(e,t,n,r){var i=e.clone().add(t).multiplyScalar(.5);var s=t.clone().sub(e).normalize();var o=e.distanceTo(t)*.5;var u=this.origin.clone().sub(i);var a=-this.direction.dot(s);var f=u.dot(this.direction);var l=-u.dot(s);var c=u.lengthSq();var h=Math.abs(1-a*a);var p,d,v,m;if(h>=0){p=a*l-f;d=a*f-l;m=o*h;if(p>=0){if(d>=-m){if(d<=m){var g=1/h;p*=g;d*=g;v=p*(p+a*d+2*f)+d*(a*p+d+2*l)+c}else{d=o;p=Math.max(0,-(a*d+f));v=-p*p+d*(d+2*l)+c}}else{d=-o;p=Math.max(0,-(a*d+f));v=-p*p+d*(d+2*l)+c}}else{if(d<=-m){p=Math.max(0,-(-a*o+f));d=p>0?-o:Math.min(Math.max(-o,-l),o);v=-p*p+d*(d+2*l)+c}else if(d<=m){p=0;d=Math.min(Math.max(-o,-l),o);v=d*(d+2*l)+c}else{p=Math.max(0,-(a*o+f));d=p>0?o:Math.min(Math.max(-o,-l),o);v=-p*p+d*(d+2*l)+c}}}else{d=a>0?-o:o;p=Math.max(0,-(a*d+f));v=-p*p+d*(d+2*l)+c}if(n){n.copy(this.direction.clone().multiplyScalar(p).add(this.origin))}if(r){r.copy(s.clone().multiplyScalar(d).add(i))}return v},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0){return true}var n=e.normal.dot(this.direction);if(n*t<0){return true}return false},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t==0){if(e.distanceToPoint(this.origin)==0){return 0}return null}var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);if(n===null){return null}return this.at(n,t)},isIntersectionBox:function(){var e=new i.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var n,r,i,s,o,u;var a=1/this.direction.x,f=1/this.direction.y,l=1/this.direction.z;var c=this.origin;if(a>=0){n=(e.min.x-c.x)*a;r=(e.max.x-c.x)*a}else{n=(e.max.x-c.x)*a;r=(e.min.x-c.x)*a}if(f>=0){i=(e.min.y-c.y)*f;s=(e.max.y-c.y)*f}else{i=(e.max.y-c.y)*f;s=(e.min.y-c.y)*f}if(n>s||i>r)return null;if(i>n||n!==n)n=i;if(s<r||r!==r)r=s;if(l>=0){o=(e.min.z-c.z)*l;u=(e.max.z-c.z)*l}else{o=(e.max.z-c.z)*l;u=(e.min.z-c.z)*l}if(n>u||o>r)return null;if(o>n||n!==n)n=o;if(u<r||r!==r)r=u;if(r<0)return null;return this.at(n>=0?n:r,t)},intersectTriangle:function(){var e=new i.Vector3;var t=new i.Vector3;var n=new i.Vector3;var r=new i.Vector3;return function(i,s,o,u,a){t.subVectors(s,i);n.subVectors(o,i);r.crossVectors(t,n);var f=this.direction.dot(r);var l;if(f>0){if(u)return null;l=1}else if(f<0){l=-1;f=-f}else{return null}e.subVectors(this.origin,i);var c=l*this.direction.dot(n.crossVectors(e,n));if(c<0){return null}var h=l*this.direction.dot(t.cross(e));if(h<0){return null}if(c+h>f){return null}var p=-l*e.dot(r);if(p<0){return null}return this.at(p/f,a)}}(),applyMatrix4:function(e){this.direction.add(this.origin).applyMatrix4(e);this.origin.applyMatrix4(e);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new i.Ray).copy(this)}};i.Sphere=function(e,t){this.center=e!==undefined?e:new i.Vector3;this.radius=t!==undefined?t:0};i.Sphere.prototype={constructor:i.Sphere,set:function(e,t){this.center.copy(e);this.radius=t;return this},setFromPoints:function(){var e=new i.Box3;return function(t,n){var r=this.center;if(n!==undefined){r.copy(n)}else{e.setFromPoints(t).center(r)}var i=0;for(var s=0,o=t.length;s<o;s++){i=Math.max(i,r.distanceToSquared(t[s]))}this.radius=Math.sqrt(i);return this}}(),copy:function(e){this.center.copy(e.center);this.radius=e.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);var r=t||new i.Vector3;r.copy(e);if(n>this.radius*this.radius){r.sub(this.center).normalize();r.multiplyScalar(this.radius).add(this.center)}return r},getBoundingBox:function(e){var t=e||new i.Box3;t.set(this.center,this.center);t.expandByScalar(this.radius);return t},applyMatrix4:function(e){this.center.applyMatrix4(e);this.radius=this.radius*e.getMaxScaleOnAxis();return this},translate:function(e){this.center.add(e);return this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new i.Sphere).copy(this)}};i.Frustum=function(e,t,n,r,s,o){this.planes=[e!==undefined?e:new i.Plane,t!==undefined?t:new i.Plane,n!==undefined?n:new i.Plane,r!==undefined?r:new i.Plane,s!==undefined?s:new i.Plane,o!==undefined?o:new i.Plane]};i.Frustum.prototype={constructor:i.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;o[0].copy(e);o[1].copy(t);o[2].copy(n);o[3].copy(r);o[4].copy(i);o[5].copy(s);return this},copy:function(e){var t=this.planes;for(var n=0;n<6;n++){t[n].copy(e.planes[n])}return this},setFromMatrix:function(e){var t=this.planes;var n=e.elements;var r=n[0],i=n[1],s=n[2],o=n[3];var u=n[4],a=n[5],f=n[6],l=n[7];var c=n[8],h=n[9],p=n[10],d=n[11];var v=n[12],m=n[13],g=n[14],y=n[15];t[0].setComponents(o-r,l-u,d-c,y-v).normalize();t[1].setComponents(o+r,l+u,d+c,y+v).normalize();t[2].setComponents(o+i,l+a,d+h,y+m).normalize();t[3].setComponents(o-i,l-a,d-h,y-m).normalize();t[4].setComponents(o-s,l-f,d-p,y-g).normalize();t[5].setComponents(o+s,l+f,d+p,y+g).normalize();return this},intersectsObject:function(){var e=new i.Sphere;return function(t){var n=t.geometry;if(n.boundingSphere===null)n.computeBoundingSphere();e.copy(n.boundingSphere);e.applyMatrix4(t.matrixWorld);return this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes;var n=e.center;var r=-e.radius;for(var i=0;i<6;i++){var s=t[i].distanceToPoint(n);if(s<r){return false}}return true},intersectsBox:function(){var e=new i.Vector3,t=new i.Vector3;return function(n){var r=this.planes;for(var i=0;i<6;i++){var s=r[i];e.x=s.normal.x>0?n.min.x:n.max.x;t.x=s.normal.x>0?n.max.x:n.min.x;e.y=s.normal.y>0?n.min.y:n.max.y;t.y=s.normal.y>0?n.max.y:n.min.y;e.z=s.normal.z>0?n.min.z:n.max.z;t.z=s.normal.z>0?n.max.z:n.min.z;var o=s.distanceToPoint(e);var u=s.distanceToPoint(t);if(o<0&&u<0){return false}}return true}}(),containsPoint:function(e){var t=this.planes;for(var n=0;n<6;n++){if(t[n].distanceToPoint(e)<0){return false}}return true},clone:function(){return(new i.Frustum).copy(this)}};i.Plane=function(e,t){this.normal=e!==undefined?e:new i.Vector3(1,0,0);this.constant=t!==undefined?t:0};i.Plane.prototype={constructor:i.Plane,set:function(e,t){this.normal.copy(e);this.constant=t;return this},setComponents:function(e,t,n,r){this.normal.set(e,t,n);this.constant=r;return this},setFromNormalAndCoplanarPoint:function(e,t){this.normal.copy(e);this.constant=-t.dot(this.normal);return this},setFromCoplanarPoints:function(){var e=new i.Vector3;var t=new i.Vector3;return function(n,r,i){var s=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();this.setFromNormalAndCoplanarPoint(s,n);return this}}(),copy:function(e){this.normal.copy(e.normal);this.constant=e.constant;return this},normalize:function(){var e=1/this.normal.length();this.normal.multiplyScalar(e);this.constant*=e;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e);var r=t||new i.Vector3;return r.copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);var n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var e=new i.Vector3;return function(t,n){var r=n||new i.Vector3;var s=t.delta(e);var o=this.normal.dot(s);if(o==0){if(this.distanceToPoint(t.start)==0){return r.copy(t.start)}return undefined}var u=-(t.start.dot(this.normal)+this.constant)/o;if(u<0||u>1){return undefined}return r.copy(s).multiplyScalar(u).add(t.start)}}(),coplanarPoint:function(e){var t=e||new i.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new i.Vector3;var t=new i.Vector3;var n=new i.Matrix3;return function(r,i){var s=i||n.getNormalMatrix(r);var o=e.copy(this.normal).applyMatrix3(s);var u=this.coplanarPoint(t);u.applyMatrix4(r);this.setFromNormalAndCoplanarPoint(o,u);return this}}(),translate:function(e){this.constant=this.constant-e.dot(this.normal);return this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new i.Plane).copy(this)}};i.Math={PI2:Math.PI*2,generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var t=new Array(36);var n=0,r;return function(){for(var i=0;i<36;i++){if(i==8||i==13||i==18||i==23){t[i]="-"}else if(i==14){t[i]="4"}else{if(n<=2)n=33554432+Math.random()*16777216|0;r=n&15;n=n>>4;t[i]=e[i==19?r&3|8:r]}}return t.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){if(e<=t)return 0;if(e>=n)return 1;e=(e-t)/(n-t);return e*e*(3-2*e)},smootherstep:function(e,t,n){if(e<=t)return 0;if(e>=n)return 1;e=(e-t)/(n-t);return e*e*e*(e*(e*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0}};i.Spline=function(e){function p(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t}this.points=e;var t=[],n={x:0,y:0,z:0},r,s,o,u,a,f,l,c,h;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++){this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}}};this.getPoint=function(e){r=(this.points.length-1)*e;s=Math.floor(r);o=r-s;t[0]=s===0?s:s-1;t[1]=s;t[2]=s>this.points.length-2?this.points.length-1:s+1;t[3]=s>this.points.length-3?this.points.length-1:s+2;f=this.points[t[0]];l=this.points[t[1]];c=this.points[t[2]];h=this.points[t[3]];u=o*o;a=o*u;n.x=p(f.x,l.x,c.x,h.x,o,u,a);n.y=p(f.y,l.y,c.y,h.y,o,u,a);n.z=p(f.z,l.z,c.z,h.z,o,u,a);return n};this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++){t=this.points[e];r[e]=[t.x,t.y,t.z]}return r};this.getLength=function(e){var t,n,r,s,o=0,u=0,a=0,f=new i.Vector3,l=new i.Vector3,c=[],h=0;c[0]=0;if(!e)e=100;r=this.points.length*e;f.copy(this.points[0]);for(t=1;t<r;t++){n=t/r;s=this.getPoint(n);l.copy(s);h+=l.distanceTo(f);f.copy(s);o=(this.points.length-1)*n;u=Math.floor(o);if(u!=a){c[u]=h;a=u}}c[c.length]=h;return{chunks:c,total:h}};this.reparametrizeByArcLength=function(e){var t,n,r,s,o,u,a,f,l,c=[],h=new i.Vector3,p=this.getLength();c.push(h.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){a=p.chunks[t]-p.chunks[t-1];f=Math.ceil(e*a/p.total);s=(t-1)/(this.points.length-1);o=t/(this.points.length-1);for(n=1;n<f-1;n++){r=s+n*(1/f)*(o-s);l=this.getPoint(r);c.push(h.copy(l).clone())}c.push(h.copy(this.points[t]).clone())}this.points=c};};i.Triangle=function(e,t,n){this.a=e!==undefined?e:new i.Vector3;this.b=t!==undefined?t:new i.Vector3;this.c=n!==undefined?n:new i.Vector3};i.Triangle.normal=function(){var e=new i.Vector3;return function(t,n,r,s){var o=s||new i.Vector3;o.subVectors(r,n);e.subVectors(t,n);o.cross(e);var u=o.lengthSq();if(u>0){return o.multiplyScalar(1/Math.sqrt(u))}return o.set(0,0,0)}}();i.Triangle.barycoordFromPoint=function(){var e=new i.Vector3;var t=new i.Vector3;var n=new i.Vector3;return function(r,s,o,u,a){e.subVectors(u,s);t.subVectors(o,s);n.subVectors(r,s);var f=e.dot(e);var l=e.dot(t);var c=e.dot(n);var h=t.dot(t);var p=t.dot(n);var d=f*h-l*l;var v=a||new i.Vector3;if(d==0){return v.set(-2,-1,-1)}var m=1/d;var g=(h*c-l*p)*m;var y=(f*p-l*c)*m;return v.set(1-g-y,y,g)}}();i.Triangle.containsPoint=function(){var e=new i.Vector3;return function(t,n,r,s){var o=i.Triangle.barycoordFromPoint(t,n,r,s,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}();i.Triangle.prototype={constructor:i.Triangle,set:function(e,t,n){this.a.copy(e);this.b.copy(t);this.c.copy(n);return this},setFromPointsAndIndices:function(e,t,n,r){this.a.copy(e[t]);this.b.copy(e[n]);this.c.copy(e[r]);return this},copy:function(e){this.a.copy(e.a);this.b.copy(e.b);this.c.copy(e.c);return this},area:function(){var e=new i.Vector3;var t=new i.Vector3;return function(){e.subVectors(this.c,this.b);t.subVectors(this.a,this.b);return e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new i.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return i.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new i.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return i.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return i.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new i.Triangle).copy(this)}};i.Vertex=function(e){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.");return e};i.UV=function(e,t){console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead.");return new i.Vector2(e,t)};i.Clock=function(e){this.autoStart=e!==undefined?e:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};i.Clock.prototype={constructor:i.Clock,start:function(){this.startTime=r.performance!==undefined&&r.performance.now!==undefined?r.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var t=r.performance!==undefined&&r.performance.now!==undefined?r.performance.now():Date.now();e=.001*(t-this.oldTime);this.oldTime=t;this.elapsedTime+=e}return e}};i.EventDispatcher=function(){};i.EventDispatcher.prototype={constructor:i.EventDispatcher,apply:function(e){e.addEventListener=i.EventDispatcher.prototype.addEventListener;e.hasEventListener=i.EventDispatcher.prototype.hasEventListener;e.removeEventListener=i.EventDispatcher.prototype.removeEventListener;e.dispatchEvent=i.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){if(this._listeners===undefined)this._listeners={};var n=this._listeners;if(n[e]===undefined){n[e]=[]}if(n[e].indexOf(t)===-1){n[e].push(t)}},hasEventListener:function(e,t){if(this._listeners===undefined)return false;var n=this._listeners;if(n[e]!==undefined&&n[e].indexOf(t)!==-1){return true}return false},removeEventListener:function(e,t){if(this._listeners===undefined)return;var n=this._listeners;var r=n[e];if(r!==undefined){var i=r.indexOf(t);if(i!==-1){r.splice(i,1)}}},dispatchEvent:function(){var e=[];return function(t){if(this._listeners===undefined)return;var n=this._listeners;var r=n[t.type];if(r!==undefined){t.target=this;var i=r.length;for(var s=0;s<i;s++){e[s]=r[s]}for(var s=0;s<i;s++){e[s].call(this,t)}}}}()};(function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n);this.near=r||0;this.far=i||Infinity};var t=new e.Sphere;var n=new e.Ray;var r=new e.Plane;var i=new e.Vector3;var s=new e.Vector3;var o=new e.Matrix4;var u=function(e,t){return e.distance-t.distance};var a=new e.Vector3;var f=new e.Vector3;var l=new e.Vector3;var c=function(r,i,u){if(r instanceof e.Sprite){s.setFromMatrixPosition(r.matrixWorld);var h=i.ray.distanceToPoint(s);if(h>r.scale.x){return u}u.push({distance:h,point:r.position,face:null,object:r})}else if(r instanceof e.LOD){s.setFromMatrixPosition(r.matrixWorld);var h=i.ray.origin.distanceTo(s);c(r.getObjectForDistance(h),i,u)}else if(r instanceof e.Mesh){var p=r.geometry;if(p.boundingSphere===null)p.computeBoundingSphere();t.copy(p.boundingSphere);t.applyMatrix4(r.matrixWorld);if(i.ray.isIntersectionSphere(t)===false){return u}o.getInverse(r.matrixWorld);n.copy(i.ray).applyMatrix4(o);if(p.boundingBox!==null){if(n.isIntersectionBox(p.boundingBox)===false){return u}}if(p instanceof e.BufferGeometry){var d=r.material;if(d===undefined)return u;var v=p.attributes;var m,g,y;var b=i.precision;if(v.index!==undefined){var w=p.offsets;var E=v.index.array;var S=v.position.array;for(var x=0,T=w.length;x<T;++x){var N=w[x].start;var C=w[x].count;var k=w[x].index;for(var L=N,A=N+C;L<A;L+=3){m=k+E[L];g=k+E[L+1];y=k+E[L+2];a.set(S[m*3],S[m*3+1],S[m*3+2]);f.set(S[g*3],S[g*3+1],S[g*3+2]);l.set(S[y*3],S[y*3+1],S[y*3+2]);if(d.side===e.BackSide){var O=n.intersectTriangle(l,f,a,true)}else{var O=n.intersectTriangle(a,f,l,d.side!==e.DoubleSide)}if(O===null)continue;O.applyMatrix4(r.matrixWorld);var h=i.ray.origin.distanceTo(O);if(h<b||h<i.near||h>i.far)continue;u.push({distance:h,point:O,indices:[m,g,y],face:null,faceIndex:null,object:r})}}}else{var w=p.offsets;var S=v.position.array;for(var L=0,A=v.position.array.length;L<A;L+=3){m=L;g=L+1;y=L+2;a.set(S[m*3],S[m*3+1],S[m*3+2]);f.set(S[g*3],S[g*3+1],S[g*3+2]);l.set(S[y*3],S[y*3+1],S[y*3+2]);if(d.side===e.BackSide){var O=n.intersectTriangle(l,f,a,true)}else{var O=n.intersectTriangle(a,f,l,d.side!==e.DoubleSide)}if(O===null)continue;O.applyMatrix4(r.matrixWorld);var h=i.ray.origin.distanceTo(O);if(h<b||h<i.near||h>i.far)continue;u.push({distance:h,point:O,indices:[m,g,y],face:null,faceIndex:null,object:r})}}}else if(p instanceof e.Geometry){var M=r.material instanceof e.MeshFaceMaterial;var _=M===true?r.material.materials:null;var m,g,y,D;var b=i.precision;var P=p.vertices;for(var H=0,B=p.faces.length;H<B;H++){var j=p.faces[H];var d=M===true?_[j.materialIndex]:r.material;if(d===undefined)continue;m=P[j.a];g=P[j.b];y=P[j.c];if(d.morphTargets===true){var F=p.morphTargets;var I=r.morphTargetInfluences;a.set(0,0,0);f.set(0,0,0);l.set(0,0,0);for(var q=0,R=F.length;q<R;q++){var U=I[q];if(U===0)continue;var z=F[q].vertices;a.x+=(z[j.a].x-m.x)*U;a.y+=(z[j.a].y-m.y)*U;a.z+=(z[j.a].z-m.z)*U;f.x+=(z[j.b].x-g.x)*U;f.y+=(z[j.b].y-g.y)*U;f.z+=(z[j.b].z-g.z)*U;l.x+=(z[j.c].x-y.x)*U;l.y+=(z[j.c].y-y.y)*U;l.z+=(z[j.c].z-y.z)*U}a.add(m);f.add(g);l.add(y);m=a;g=f;y=l}if(d.side===e.BackSide){var O=n.intersectTriangle(y,g,m,true)}else{var O=n.intersectTriangle(m,g,y,d.side!==e.DoubleSide)}if(O===null)continue;O.applyMatrix4(r.matrixWorld);var h=i.ray.origin.distanceTo(O);if(h<b||h<i.near||h>i.far)continue;u.push({distance:h,point:O,face:j,faceIndex:H,object:r})}}}else if(r instanceof e.Line){var b=i.linePrecision;var W=b*b;var p=r.geometry;if(p.boundingSphere===null)p.computeBoundingSphere();t.copy(p.boundingSphere);t.applyMatrix4(r.matrixWorld);if(i.ray.isIntersectionSphere(t)===false){return u}o.getInverse(r.matrixWorld);n.copy(i.ray).applyMatrix4(o);if(p instanceof e.Geometry){var P=p.vertices;var X=P.length;var V=new e.Vector3;var $=new e.Vector3;var J=r.type===e.LineStrip?1:2;for(var L=0;L<X-1;L=L+J){var K=n.distanceSqToSegment(P[L],P[L+1],$,V);if(K>W)continue;var h=n.origin.distanceTo($);if(h<i.near||h>i.far)continue;u.push({distance:h,point:V.clone().applyMatrix4(r.matrixWorld),face:null,faceIndex:null,object:r})}}}};var h=function(e,t,n){var r=e.getDescendants();for(var i=0,s=r.length;i<s;i++){c(r[i],t,n)}};e.Raycaster.prototype.precision=1e-4;e.Raycaster.prototype.linePrecision=1;e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)};e.Raycaster.prototype.intersectObject=function(e,t){var n=[];if(t===true){h(e,this,n)}c(e,this,n);n.sort(u);return n};e.Raycaster.prototype.intersectObjects=function(e,t){var n=[];for(var r=0,i=e.length;r<i;r++){c(e[r],this,n);if(t===true){h(e[r],this,n)}}n.sort(u);return n}})(i);i.Object3D=function(){this.id=i.Object3DIdCount++;this.uuid=i.Math.generateUUID();this.name="";this.parent=undefined;this.children=[];this.up=new i.Vector3(0,1,0);this.position=new i.Vector3;this._rotation=new i.Euler;this._quaternion=new i.Quaternion;this.scale=new i.Vector3(1,1,1);this._rotation._quaternion=this.quaternion;this._quaternion._euler=this.rotation;this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new i.Matrix4;this.matrixWorld=new i.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.userData={}};i.Object3D.prototype={constructor:i.Object3D,get rotation(){return this._rotation},set rotation(e){this._rotation=e;this._rotation._quaternion=this._quaternion;this._quaternion._euler=this._rotation;this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(e){this._quaternion=e;this._quaternion._euler=this._rotation;this._rotation._quaternion=this._quaternion;this._quaternion._updateEuler()},get eulerOrder(){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order.");return this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order.");this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,true)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new i.Quaternion;return function(t,n){e.setFromAxisAngle(t,n);this.quaternion.multiply(e);return this}}(),rotateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new i.Vector3;return function(t,n){e.copy(t);e.applyQuaternion(this.quaternion);this.position.add(e.multiplyScalar(n));return this}}(),translate:function(e,t){console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed.");return this.translateOnAxis(t,e)},translateX:function(){var e=new i.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new i.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new i.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new i.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new i.Matrix4;return function(t){e.lookAt(t,this.position,this.up);this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e===this){console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");return}if(e instanceof i.Object3D){if(e.parent!==undefined){e.parent.remove(e)}e.parent=this;e.dispatchEvent({type:"added"});this.children.push(e);var t=this;while(t.parent!==undefined){t=t.parent}if(t!==undefined&&t instanceof i.Scene){t.__addObject(e)}}},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=undefined;e.dispatchEvent({type:"removed"});this.children.splice(t,1);var n=this;while(n.parent!==undefined){n=n.parent}if(n!==undefined&&n instanceof i.Scene){n.__removeObject(e)}}},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++){this.children[t].traverse(e)}},getObjectById:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.id===e){return i}if(t===true){i=i.getObjectById(e,t);if(i!==undefined){return i}}}return undefined},getObjectByName:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.name===e){return i}if(t===true){i=i.getObjectByName(e,t);if(i!==undefined){return i}}}return undefined},getChildByName:function(e,t){console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(e,t)},getDescendants:function(e){if(e===undefined)e=[];Array.prototype.push.apply(e,this.children);for(var t=0,n=this.children.length;t<n;t++){this.children[t].getDescendants(e)}return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||e===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,n=this.children.length;t<n;t++){this.children[t].updateMatrixWorld(e)}},clone:function(e,t){if(e===undefined)e=new i.Object3D;if(t===undefined)t=true;e.name=this.name;e.up.copy(this.up);e.position.copy(this.position);e.quaternion.copy(this.quaternion);e.scale.copy(this.scale);e.renderDepth=this.renderDepth;e.rotationAutoUpdate=this.rotationAutoUpdate;e.matrix.copy(this.matrix);e.matrixWorld.copy(this.matrixWorld);e.matrixAutoUpdate=this.matrixAutoUpdate;e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;e.visible=this.visible;e.castShadow=this.castShadow;e.receiveShadow=this.receiveShadow;e.frustumCulled=this.frustumCulled;e.userData=JSON.parse(JSON.stringify(this.userData));if(t===true){for(var n=0;n<this.children.length;n++){var r=this.children[n];e.add(r.clone())}}return e}};i.EventDispatcher.prototype.apply(i.Object3D.prototype);i.Object3DIdCount=0;i.Projector=function(){function z(){if(t===r){var e=new i.RenderableObject;n.push(e);r++;t++;return e}return n[t++]}function W(){if(o===a){var e=new i.RenderableVertex;u.push(e);a++;o++;return e}return u[o++]}function X(){if(l===h){var e=new i.RenderableFace;c.push(e);h++;l++;return e}return c[l++]}function V(){if(d===m){var e=new i.RenderableLine;v.push(e);m++;d++;return e}return v[d++]}function $(){if(y===w){var e=new i.RenderableSprite;b.push(e);w++;y++;return e}return b[y++]}function J(e,t){if(e.z!==t.z){return t.z-e.z}else if(e.id!==t.id){return e.id-t.id}else{return 0}}function K(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;if(i>=0&&s>=0&&o>=0&&u>=0){return true}else if(i<0&&s<0||o<0&&u<0){return false}else{if(i<0){n=Math.max(n,i/(i-s))}else if(s<0){r=Math.min(r,i/(i-s))}if(o<0){n=Math.max(n,o/(o-u))}else if(u<0){r=Math.min(r,o/(o-u))}if(r<n){return false}else{e.lerp(t,n);t.lerp(e,1-r);return true}}}var e,t,n=[],r=0,s,o,u=[],a=0,f,l,c=[],h=0,p,d,v=[],m=0,g,y,b=[],w=0,E={objects:[],lights:[],elements:[]},S=new i.Vector3,x=new i.Vector3,T=new i.Vector3,N=new i.Vector3,C=new i.Vector4,k=new i.Box3(new i.Vector3(-1,-1,-1),new i.Vector3(1,1,1)),L=new i.Box3,A=new Array(3),O=new Array(4),M=new i.Matrix4,_=new i.Matrix4,D,P=new i.Matrix4,H=new i.Matrix3,B=new i.Frustum,j=new i.Vector4,F=new i.Vector4;this.projectVector=function(e,t){t.matrixWorldInverse.getInverse(t.matrixWorld);_.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);return e.applyProjection(_)};this.unprojectVector=function(){var e=new i.Matrix4;return function(t,n){e.getInverse(n.projectionMatrix);_.multiplyMatrices(n.matrixWorld,e);return t.applyProjection(_)}}();this.pickingRay=function(e,t){e.z=-1;var n=new i.Vector3(e.x,e.y,1);this.unprojectVector(e,t);this.unprojectVector(n,t);n.sub(e).normalize();return new i.Raycaster(e,n)};var I=function(t){if(t.visible===false)return;if(t instanceof i.Light){E.lights.push(t)}else if(t instanceof i.Mesh||t instanceof i.Line||t instanceof i.Sprite){if(t.frustumCulled===false||B.intersectsObject(t)===true){e=z();e.id=t.id;e.object=t;if(t.renderDepth!==null){e.z=t.renderDepth}else{N.setFromMatrixPosition(t.matrixWorld);N.applyProjection(_);e.z=N.z}E.objects.push(e)}}for(var n=0,r=t.children.length;n<r;n++){I(t.children[n])}};var q=function(e,n){t=0;E.objects.length=0;E.lights.length=0;I(e);if(n===true){E.objects.sort(J)}};var R=function(){var e=[];var t=null;var n=new i.Matrix3;var r=function(r){t=r;n.getNormalMatrix(t.matrixWorld);e.length=0};var o=function(e){var t=e.position;var n=e.positionWorld;var r=e.positionScreen;n.copy(t).applyMatrix4(D);r.copy(n).applyMatrix4(_);var i=1/r.w;r.x*=i;r.y*=i;r.z*=i;e.visible=r.x>=-1&&r.x<=1&&r.y>=-1&&r.y<=1&&r.z>=-1&&r.z<=1};var a=function(e,t,n){s=W();s.position.set(e,t,n);o(s)};var l=function(t,n,r){e.push(t,n,r)};var c=function(e,t,n){A[0]=e.positionScreen;A[1]=t.positionScreen;A[2]=n.positionScreen;if(e.visible===true||t.visible===true||n.visible===true||k.isIntersectionBox(L.setFromPoints(A))){return(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return false};var h=function(e,n){var r=u[e];var i=u[n];p=V();p.id=t.id;p.v1.copy(r);p.v2.copy(i);p.z=(r.positionScreen.z+i.positionScreen.z)/2;p.material=t.material;E.elements.push(p)};var d=function(r,i,s){var o=u[r];var a=u[i];var l=u[s];if(c(o,a,l)===true){f=X();f.id=t.id;f.v1.copy(o);f.v2.copy(a);f.v3.copy(l);f.z=(o.positionScreen.z+a.positionScreen.z+l.positionScreen.z)/3;for(var h=0;h<3;h++){var p=arguments[h]*3;var d=f.vertexNormalsModel[h];d.set(e[p+0],e[p+1],e[p+2]);d.applyMatrix3(n).normalize()}f.vertexNormalsLength=3;f.material=t.material;E.elements.push(f)}};return{setObject:r,projectVertex:o,checkTriangleVisibility:c,pushVertex:a,pushNormal:l,pushLine:h,pushTriangle:d}};var U=new R;this.projectScene=function(e,t,n,r){var s,a,c,h,v,m,b,w,N,k;l=0;d=0;y=0;E.elements.length=0;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===undefined)t.updateMatrixWorld();M.copy(t.matrixWorldInverse.getInverse(t.matrixWorld));_.multiplyMatrices(t.projectionMatrix,M);B.setFromMatrix(_);q(e,n);for(var L=0,A=E.objects.length;L<A;L++){s=E.objects[L].object;a=s.geometry;U.setObject(s);D=s.matrixWorld;o=0;if(s instanceof i.Mesh){if(a instanceof i.BufferGeometry){var O=a.attributes;var I=a.offsets;if(O.position===undefined)continue;var R=O.position.array;for(var z=0,Q=R.length;z<Q;z+=3){U.pushVertex(R[z],R[z+1],R[z+2])}var G=O.normal.array;for(var z=0,Q=G.length;z<Q;z+=3){U.pushNormal(G[z],G[z+1],G[z+2])}if(O.index!==undefined){var Y=O.index.array;if(I.length>0){for(var L=0;L<I.length;L++){var Z=I[L];var et=Z.index;for(var z=Z.start,Q=Z.start+Z.count;z<Q;z+=3){U.pushTriangle(Y[z]+et,Y[z+1]+et,Y[z+2]+et)}}}else{for(var z=0,Q=Y.length;z<Q;z+=3){U.pushTriangle(Y[z],Y[z+1],Y[z+2])}}}else{for(var z=0,Q=R.length/3;z<Q;z+=3){U.pushTriangle(z,z+1,z+2)}}}else if(a instanceof i.Geometry){c=a.vertices;h=a.faces;b=a.faceVertexUvs;H.getNormalMatrix(D);N=s.material instanceof i.MeshFaceMaterial;k=N===true?s.material:null;for(var tt=0,nt=c.length;tt<nt;tt++){var rt=c[tt];U.pushVertex(rt.x,rt.y,rt.z)}for(var it=0,st=h.length;it<st;it++){v=h[it];var ot=N===true?k.materials[v.materialIndex]:s.material;if(ot===undefined)continue;var ut=ot.side;var at=u[v.a];var ft=u[v.b];var lt=u[v.c];if(ot.morphTargets===true){var ct=a.morphTargets;var ht=s.morphTargetInfluences;var pt=at.position;var dt=ft.position;var vt=lt.position;S.set(0,0,0);x.set(0,0,0);T.set(0,0,0);for(var mt=0,gt=ct.length;mt<gt;mt++){var yt=ht[mt];if(yt===0)continue;var bt=ct[mt].vertices;S.x+=(bt[v.a].x-pt.x)*yt;S.y+=(bt[v.a].y-pt.y)*yt;S.z+=(bt[v.a].z-pt.z)*yt;x.x+=(bt[v.b].x-dt.x)*yt;x.y+=(bt[v.b].y-dt.y)*yt;x.z+=(bt[v.b].z-dt.z)*yt;T.x+=(bt[v.c].x-vt.x)*yt;T.y+=(bt[v.c].y-vt.y)*yt;T.z+=(bt[v.c].z-vt.z)*yt}at.position.add(S);ft.position.add(x);lt.position.add(T);U.projectVertex(at);U.projectVertex(ft);U.projectVertex(lt)}var wt=U.checkTriangleVisibility(at,ft,lt);if(wt===false&&ut===i.FrontSide||wt===true&&ut===i.BackSide)continue;f=X();f.id=s.id;f.v1.copy(at);f.v2.copy(ft);f.v3.copy(lt);f.normalModel.copy(v.normal);if(wt===false&&(ut===i.BackSide||ut===i.DoubleSide)){f.normalModel.negate()}f.normalModel.applyMatrix3(H).normalize();f.centroidModel.copy(v.centroid).applyMatrix4(D);m=v.vertexNormals;for(var Et=0,St=Math.min(m.length,3);Et<St;Et++){var xt=f.vertexNormalsModel[Et];xt.copy(m[Et]);if(wt===false&&(ut===i.BackSide||ut===i.DoubleSide)){xt.negate()}xt.applyMatrix3(H).normalize()}f.vertexNormalsLength=m.length;for(var Tt=0,Nt=Math.min(b.length,3);Tt<Nt;Tt++){w=b[Tt][it];if(w===undefined)continue;for(var Ct=0,kt=w.length;Ct<kt;Ct++){f.uvs[Tt][Ct]=w[Ct]}}f.color=v.color;f.material=ot;f.z=(at.positionScreen.z+ft.positionScreen.z+lt.positionScreen.z)/3;E.elements.push(f)}}}else if(s instanceof i.Line){if(a instanceof i.BufferGeometry){var O=a.attributes;if(O.position!==undefined){var R=O.position.array;for(var z=0,Q=R.length;z<Q;z+=3){U.pushVertex(R[z],R[z+1],R[z+2])}if(O.index!==undefined){var Y=O.index.array;for(var z=0,Q=Y.length;z<Q;z+=2){U.pushLine(Y[z],Y[z+1])}}else{for(var z=0,Q=R.length/3-1;z<Q;z++){U.pushLine(z,z+1)}}}}else if(a instanceof i.Geometry){P.multiplyMatrices(_,D);c=s.geometry.vertices;if(c.length===0)continue;at=W();at.positionScreen.copy(c[0]).applyMatrix4(P);var Lt=s.type===i.LinePieces?2:1;for(var tt=1,nt=c.length;tt<nt;tt++){at=W();at.positionScreen.copy(c[tt]).applyMatrix4(P);if((tt+1)%Lt>0)continue;ft=u[o-2];j.copy(at.positionScreen);F.copy(ft.positionScreen);if(K(j,F)===true){j.multiplyScalar(1/j.w);F.multiplyScalar(1/F.w);p=V();p.id=s.id;p.v1.positionScreen.copy(j);p.v2.positionScreen.copy(F);p.z=Math.max(j.z,F.z);p.material=s.material;if(s.material.vertexColors===i.VertexColors){p.vertexColors[0].copy(s.geometry.colors[tt]);p.vertexColors[1].copy(s.geometry.colors[tt-1])}E.elements.push(p)}}}}else if(s instanceof i.Sprite){C.set(D.elements[12],D.elements[13],D.elements[14],1);C.applyMatrix4(_);var At=1/C.w;C.z*=At;if(C.z>=-1&&C.z<=1){g=$();g.id=s.id;g.x=C.x*At;g.y=C.y*At;g.z=C.z;g.object=s;g.rotation=s.rotation;g.scale.x=s.scale.x*Math.abs(g.x-(C.x+t.projectionMatrix.elements[0])/(C.w+t.projectionMatrix.elements[12]));g.scale.y=s.scale.y*Math.abs(g.y-(C.y+t.projectionMatrix.elements[5])/(C.w+t.projectionMatrix.elements[13]));g.material=s.material;E.elements.push(g)}}}if(r===true)E.elements.sort(J);return E}};i.Face3=function(e,t,n,r,s,o){this.a=e;this.b=t;this.c=n;this.normal=r instanceof i.Vector3?r:new i.Vector3;this.vertexNormals=r instanceof Array?r:[];this.color=s instanceof i.Color?s:new i.Color;this.vertexColors=s instanceof Array?s:[];this.vertexTangents=[];this.materialIndex=o!==undefined?o:0;this.centroid=new i.Vector3};i.Face3.prototype={constructor:i.Face3,clone:function(){var e=new i.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.centroid.copy(this.centroid);e.materialIndex=this.materialIndex;var t,n;for(t=0,n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}};i.Face4=function(e,t,n,r,s,o,u){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new i.Face3(e,t,n,s,o,u)};i.BufferGeometry=function(){this.id=i.GeometryIdCount++;this.uuid=i.Math.generateUUID();this.name="";this.attributes={};this.offsets=[];this.boundingBox=null;this.boundingSphere=null};i.BufferGeometry.prototype={constructor:i.BufferGeometry,addAttribute:function(e,t,n,r){this.attributes[e]={array:new t(n*r),itemSize:r};return this.attributes[e]},applyMatrix:function(e){var t=this.attributes.position;if(t!==undefined){e.multiplyVector3Array(t.array);t.needsUpdate=true}var n=this.attributes.normal;if(n!==undefined){var r=(new i.Matrix3).getNormalMatrix(e);r.multiplyVector3Array(n.array);n.needsUpdate=true}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new i.Box3}var e=this.attributes["position"].array;if(e){var t=this.boundingBox;if(e.length>=3){t.min.x=t.max.x=e[0];t.min.y=t.max.y=e[1];t.min.z=t.max.z=e[2]}for(var n=3,r=e.length;n<r;n+=3){var s=e[n];var o=e[n+1];var u=e[n+2];if(s<t.min.x){t.min.x=s}else if(s>t.max.x){t.max.x=s}if(o<t.min.y){t.min.y=o}else if(o>t.max.y){t.max.y=o}if(u<t.min.z){t.min.z=u}else if(u>t.max.z){t.max.z=u}}}if(e===undefined||e.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){var e=new i.Box3;var t=new i.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new i.Sphere}var n=this.attributes["position"].array;if(n){e.makeEmpty();var r=this.boundingSphere.center;for(var s=0,o=n.length;s<o;s+=3){t.set(n[s],n[s+1],n[s+2]);e.addPoint(t)}e.center(r);var u=0;for(var s=0,o=n.length;s<o;s+=3){t.set(n[s],n[s+1],n[s+2]);u=Math.max(u,r.distanceToSquared(t))}this.boundingSphere.radius=Math.sqrt(u)}}}(),computeVertexNormals:function(){if(this.attributes["position"]){var e,t;var n,r;var s=this.attributes["position"].array.length;if(this.attributes["normal"]===undefined){this.attributes["normal"]={itemSize:3,array:new Float32Array(s)}}else{for(e=0,t=this.attributes["normal"].array.length;e<t;e++){this.attributes["normal"].array[e]=0}}var o=this.attributes["position"].array;var u=this.attributes["normal"].array;var a,f,l,c,h,p,d=new i.Vector3,v=new i.Vector3,m=new i.Vector3,g=new i.Vector3,y=new i.Vector3;if(this.attributes["index"]){var b=this.attributes["index"].array;var w=this.offsets;for(n=0,r=w.length;n<r;++n){var E=w[n].start;var S=w[n].count;var x=w[n].index;for(e=E,t=E+S;e<t;e+=3){a=x+b[e];f=x+b[e+1];l=x+b[e+2];c=o[a*3];h=o[a*3+1];p=o[a*3+2];d.set(c,h,p);c=o[f*3];h=o[f*3+1];p=o[f*3+2];v.set(c,h,p);c=o[l*3];h=o[l*3+1];p=o[l*3+2];m.set(c,h,p);g.subVectors(m,v);y.subVectors(d,v);g.cross(y);u[a*3]+=g.x;u[a*3+1]+=g.y;u[a*3+2]+=g.z;u[f*3]+=g.x;u[f*3+1]+=g.y;u[f*3+2]+=g.z;u[l*3]+=g.x;u[l*3+1]+=g.y;u[l*3+2]+=g.z}}}else{for(e=0,t=o.length;e<t;e+=9){c=o[e];h=o[e+1];p=o[e+2];d.set(c,h,p);c=o[e+3];h=o[e+4];p=o[e+5];v.set(c,h,p);c=o[e+6];h=o[e+7];p=o[e+8];m.set(c,h,p);g.subVectors(m,v);y.subVectors(d,v);g.cross(y);u[e]=g.x;u[e+1]=g.y;u[e+2]=g.z;u[e+3]=g.x;u[e+4]=g.y;u[e+5]=g.z;u[e+6]=g.x;u[e+7]=g.y;u[e+8]=g.z}}this.normalizeNormals();this.normalsNeedUpdate=true}},normalizeNormals:function(){var e=this.attributes["normal"].array;var t,n,r,i;for(var s=0,o=e.length;s<o;s+=3){t=e[s];n=e[s+1];r=e[s+2];i=1/Math.sqrt(t*t+n*n+r*r);e[s]*=i;e[s+1]*=i;e[s+2]*=i}},computeTangents:function(){function I(e,n,i){c=t[e*3];h=t[e*3+1];p=t[e*3+2];d=t[n*3];v=t[n*3+1];m=t[n*3+2];g=t[i*3];y=t[i*3+1];b=t[i*3+2];w=r[e*2];E=r[e*2+1];S=r[n*2];x=r[n*2+1];T=r[i*2];N=r[i*2+1];C=d-c;k=g-c;L=v-h;A=y-h;O=m-p;M=b-p;_=S-w;D=T-w;P=x-E;H=N-E;B=1/(_*H-D*P);j.set((H*C-P*k)*B,(H*L-P*A)*B,(H*O-P*M)*B);F.set((_*k-D*C)*B,(_*A-D*L)*B,(_*M-D*O)*B);a[e].add(j);a[n].add(j);a[i].add(j);f[e].add(F);f[n].add(F);f[i].add(F)}function it(e){Z.x=n[e*3];Z.y=n[e*3+1];Z.z=n[e*3+2];et.copy(Z);nt=a[e];G.copy(nt);G.sub(Z.multiplyScalar(Z.dot(nt))).normalize();Y.crossVectors(et,nt);rt=Y.dot(f[e]);tt=rt<0?-1:1;u[e*4]=G.x;u[e*4+1]=G.y;u[e*4+2]=G.z;u[e*4+3]=tt}if(this.attributes["index"]===undefined||this.attributes["position"]===undefined||this.attributes["normal"]===undefined||this.attributes["uv"]===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var e=this.attributes["index"].array;var t=this.attributes["position"].array;var n=this.attributes["normal"].array;var r=this.attributes["uv"].array;var s=t.length/3;if(this.attributes["tangent"]===undefined){var o=4*s;this.attributes["tangent"]={itemSize:4,array:new Float32Array(o)}}var u=this.attributes["tangent"].array;var a=[],f=[];for(var l=0;l<s;l++){a[l]=new i.Vector3;f[l]=new i.Vector3}var c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B;var j=new i.Vector3,F=new i.Vector3;var q,R;var U,z;var W,X,V;var $=this.offsets;for(U=0,z=$.length;U<z;++U){var J=$[U].start;var K=$[U].count;var Q=$[U].index;for(q=J,R=J+K;q<R;q+=3){W=Q+e[q];X=Q+e[q+1];V=Q+e[q+2];I(W,X,V)}}var G=new i.Vector3,Y=new i.Vector3;var Z=new i.Vector3,et=new i.Vector3;var tt,nt,rt;for(U=0,z=$.length;U<z;++U){var J=$[U].start;var K=$[U].count;var Q=$[U].index;for(q=J,R=J+K;q<R;q+=3){W=Q+e[q];X=Q+e[q+1];V=Q+e[q+2];it(W);it(X);it(V)}}},computeOffsets:function(e){var t=e;if(e===undefined)t=65535;var n=Date.now();var r=this.attributes["index"].array;var i=this.attributes["position"].array;var s=i.length/3;var o=r.length/3;var u=new Uint16Array(r.length);var a=0;var f=0;var l=[{start:0,count:0,index:0}];var c=l[0];var h=0;var p=0;var d=new Int32Array(6);var v=new Int32Array(i.length);var m=new Int32Array(i.length);for(var g=0;g<i.length;g++){v[g]=-1;m[g]=-1}for(var y=0;y<o;y++){p=0;for(var b=0;b<3;b++){var w=r[y*3+b];if(v[w]==-1){d[b*2]=w;d[b*2+1]=-1;p++}else if(v[w]<c.index){d[b*2]=w;d[b*2+1]=-1;h++}else{d[b*2]=w;d[b*2+1]=v[w]}}var E=f+p;if(E>c.index+t){var S={start:a,count:0,index:f};l.push(S);c=S;for(var x=0;x<6;x+=2){var T=d[x+1];if(T>-1&&T<c.index)d[x+1]=-1}}for(var x=0;x<6;x+=2){var w=d[x];var T=d[x+1];if(T===-1)T=f++;v[w]=T;m[T]=w;u[a++]=T-c.index;c.count++}}this.reorderBuffers(u,m,f);this.offsets=l;return l},reorderBuffers:function(e,t,n){var r={};var i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var s in this.attributes){if(s=="index")continue;var o=this.attributes[s].array;for(var u=0,a=i.length;u<a;u++){var f=i[u];if(o instanceof f){r[s]=new f(this.attributes[s].itemSize*n);break}}}for(var l=0;l<n;l++){var c=t[l];for(var s in this.attributes){if(s=="index")continue;var h=this.attributes[s].array;var p=this.attributes[s].itemSize;var d=r[s];for(var v=0;v<p;v++)d[l*p+v]=h[c*p+v]}}this.attributes["index"].array=e;for(var s in this.attributes){if(s=="index")continue;this.attributes[s].array=r[s];this.attributes[s].numItems=this.attributes[s].itemSize*n}},clone:function(){var e=new i.BufferGeometry;var t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var n in this.attributes){var r=this.attributes[n];var s=r.array;var o={itemSize:r.itemSize,array:null};for(var u=0,a=t.length;u<a;u++){var f=t[u];if(s instanceof f){o.array=new f(s);break}}e.attributes[n]=o}for(var u=0,a=this.offsets.length;u<a;u++){var l=this.offsets[u];e.offsets.push({start:l.start,index:l.index,count:l.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.BufferGeometry.prototype);i.Geometry=function(){this.id=i.GeometryIdCount++;this.uuid=i.Math.generateUUID();this.name="";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.buffersNeedUpdate=false};i.Geometry.prototype={constructor:i.Geometry,applyMatrix:function(e){var t=(new i.Matrix3).getNormalMatrix(e);for(var n=0,r=this.vertices.length;n<r;n++){var s=this.vertices[n];s.applyMatrix4(e)}for(var n=0,r=this.faces.length;n<r;n++){var o=this.faces[n];o.normal.applyMatrix3(t).normalize();for(var u=0,a=o.vertexNormals.length;u<a;u++){o.vertexNormals[u].applyMatrix3(t).normalize()}o.centroid.applyMatrix4(e)}if(this.boundingBox instanceof i.Box3){this.computeBoundingBox()}if(this.boundingSphere instanceof i.Sphere){this.computeBoundingSphere()}},computeCentroids:function(){var e,t,n;for(e=0,t=this.faces.length;e<t;e++){n=this.faces[e];n.centroid.set(0,0,0);n.centroid.add(this.vertices[n.a]);n.centroid.add(this.vertices[n.b]);n.centroid.add(this.vertices[n.c]);n.centroid.divideScalar(3)}},computeFaceNormals:function(){var e=new i.Vector3,t=new i.Vector3;for(var n=0,r=this.faces.length;n<r;n++){var s=this.faces[n];var o=this.vertices[s.a];var u=this.vertices[s.b];var a=this.vertices[s.c];e.subVectors(a,u);t.subVectors(o,u);e.cross(t);e.normalize();s.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,s,o,u;u=new Array(this.vertices.length);for(t=0,n=this.vertices.length;t<n;t++){u[t]=new i.Vector3}if(e){var a,f,l,c;var h=new i.Vector3,p=new i.Vector3,d=new i.Vector3,v=new i.Vector3,m=new i.Vector3;for(r=0,s=this.faces.length;r<s;r++){o=this.faces[r];a=this.vertices[o.a];f=this.vertices[o.b];l=this.vertices[o.c];h.subVectors(l,f);p.subVectors(a,f);h.cross(p);u[o.a].add(h);u[o.b].add(h);u[o.c].add(h)}}else{for(r=0,s=this.faces.length;r<s;r++){o=this.faces[r];u[o.a].add(o.normal);u[o.b].add(o.normal);u[o.c].add(o.normal)}}for(t=0,n=this.vertices.length;t<n;t++){u[t].normalize()}for(r=0,s=this.faces.length;r<s;r++){o=this.faces[r];o.vertexNormals[0]=u[o.a].clone();o.vertexNormals[1]=u[o.b].clone();o.vertexNormals[2]=u[o.c].clone()}},computeMorphNormals:function(){var e,t,n,r,s;for(n=0,r=this.faces.length;n<r;n++){s=this.faces[n];if(!s.__originalFaceNormal){s.__originalFaceNormal=s.normal.clone()}else{s.__originalFaceNormal.copy(s.normal)}if(!s.__originalVertexNormals)s.__originalVertexNormals=[];for(e=0,t=s.vertexNormals.length;e<t;e++){if(!s.__originalVertexNormals[e]){s.__originalVertexNormals[e]=s.vertexNormals[e].clone()}else{s.__originalVertexNormals[e].copy(s.vertexNormals[e])}}}var o=new i.Geometry;o.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var u=this.morphNormals[e].faceNormals;var a=this.morphNormals[e].vertexNormals;var f,l;for(n=0,r=this.faces.length;n<r;n++){s=this.faces[n];f=new i.Vector3;l={a:new i.Vector3,b:new i.Vector3,c:new i.Vector3};u.push(f);a.push(l)}}var c=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices;o.computeFaceNormals();o.computeVertexNormals();var f,l;for(n=0,r=this.faces.length;n<r;n++){s=this.faces[n];f=c.faceNormals[n];l=c.vertexNormals[n];f.copy(s.normal);l.a.copy(s.vertexNormals[0]);l.b.copy(s.vertexNormals[1]);l.c.copy(s.vertexNormals[2])}}for(n=0,r=this.faces.length;n<r;n++){s=this.faces[n];s.normal=s.__originalFaceNormal;s.vertexNormals=s.__originalVertexNormals}},computeTangents:function(){function j(e,t,n,r,i,s,o){l=e.vertices[t];c=e.vertices[n];h=e.vertices[r];p=f[i];d=f[s];v=f[o];m=c.x-l.x;g=h.x-l.x;y=c.y-l.y;b=h.y-l.y;w=c.z-l.z;E=h.z-l.z;S=d.x-p.x;x=v.x-p.x;T=d.y-p.y;N=v.y-p.y;C=1/(S*N-x*T);M.set((N*m-T*g)*C,(N*y-T*b)*C,(N*w-T*E)*C);_.set((S*g-x*m)*C,(S*b-x*y)*C,(S*E-x*w)*C);A[t].add(M);A[n].add(M);A[r].add(M);O[t].add(_);O[n].add(_);O[r].add(_)}var e,t,n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A=[],O=[],M=new i.Vector3,_=new i.Vector3,D=new i.Vector3,P=new i.Vector3,H=new i.Vector3,B;for(n=0,r=this.vertices.length;n<r;n++){A[n]=new i.Vector3;O[n]=new i.Vector3}for(e=0,t=this.faces.length;e<t;e++){a=this.faces[e];f=this.faceVertexUvs[0][e];j(this,a.a,a.b,a.c,0,1,2)}var F=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++){a=this.faces[e];for(s=0;s<Math.min(a.vertexNormals.length,3);s++){H.copy(a.vertexNormals[s]);u=a[F[s]];k=A[u];D.copy(k);D.sub(H.multiplyScalar(H.dot(k))).normalize();P.crossVectors(a.vertexNormals[s],k);L=P.dot(O[u]);B=L<0?-1:1;a.vertexTangents[s]=new i.Vector4(D.x,D.y,D.z,B)}}this.hasTangents=true},computeLineDistances:function(){var e=0;var t=this.vertices;for(var n=0,r=t.length;n<r;n++){if(n>0){e+=t[n].distanceTo(t[n-1])}this.lineDistances[n]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new i.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new i.Sphere}this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e={};var t=[],n=[];var r,i;var s=4;var o=Math.pow(10,s);var u,a,f;var l,c,h,p,d;for(u=0,a=this.vertices.length;u<a;u++){r=this.vertices[u];i=Math.round(r.x*o)+"_"+Math.round(r.y*o)+"_"+Math.round(r.z*o);if(e[i]===undefined){e[i]=u;t.push(this.vertices[u]);n[u]=t.length-1}else{n[u]=n[e[i]]}}var v=[];for(u=0,a=this.faces.length;u<a;u++){f=this.faces[u];f.a=n[f.a];f.b=n[f.b];f.c=n[f.c];l=[f.a,f.b,f.c];var m=-1;for(var g=0;g<3;g++){if(l[g]==l[(g+1)%3]){m=g;v.push(u);break}}}for(u=v.length-1;u>=0;u--){var y=v[u];this.faces.splice(y,1);for(h=0,p=this.faceVertexUvs.length;h<p;h++){this.faceVertexUvs[h].splice(y,1)}}var b=this.vertices.length-t.length;this.vertices=t;return b},makeGroups:function(){var e=0;return function(t){var n,r,i,s,o,u={};var a=this.morphTargets.length;var f=this.morphNormals.length;this.geometryGroups={};for(n=0,r=this.faces.length;n<r;n++){i=this.faces[n];s=t?i.materialIndex:0;if(!(s in u)){u[s]={hash:s,counter:0}}o=u[s].hash+"_"+u[s].counter;if(!(o in this.geometryGroups)){this.geometryGroups[o]={faces3:[],materialIndex:s,vertices:0,numMorphTargets:a,numMorphNormals:f}}if(this.geometryGroups[o].vertices+3>65535){u[s].counter+=1;o=u[s].hash+"_"+u[s].counter;if(!(o in this.geometryGroups)){this.geometryGroups[o]={faces3:[],materialIndex:s,vertices:0,numMorphTargets:a,numMorphNormals:f}}}this.geometryGroups[o].faces3.push(n);this.geometryGroups[o].vertices+=3}this.geometryGroupsList=[];for(var l in this.geometryGroups){this.geometryGroups[l].id=e++;this.geometryGroupsList.push(this.geometryGroups[l])}}}(),clone:function(){var e=new i.Geometry;var t=this.vertices;for(var n=0,r=t.length;n<r;n++){e.vertices.push(t[n].clone())}var s=this.faces;for(var n=0,r=s.length;n<r;n++){e.faces.push(s[n].clone())}var o=this.faceVertexUvs[0];for(var n=0,r=o.length;n<r;n++){var u=o[n],a=[];for(var f=0,l=u.length;f<l;f++){a.push(new i.Vector2(u[f].x,u[f].y))}e.faceVertexUvs[0].push(a)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.Geometry.prototype);i.GeometryIdCount=0;i.Geometry2=function(e){i.BufferGeometry.call(this);this.vertices=this.addAttribute("position",Float32Array,e,3).array;this.normals=this.addAttribute("normal",Float32Array,e,3).array;this.uvs=this.addAttribute("uv",Float32Array,e,2).array;this.boundingBox=null;this.boundingSphere=null};i.Geometry2.prototype=Object.create(i.BufferGeometry.prototype);i.Camera=function(){i.Object3D.call(this);this.matrixWorldInverse=new i.Matrix4;this.projectionMatrix=new i.Matrix4};i.Camera.prototype=Object.create(i.Object3D.prototype);i.Camera.prototype.lookAt=function(){var e=new i.Matrix4;return function(t){e.lookAt(this.position,t,this.up);this.quaternion.setFromRotationMatrix(e)}}();i.Camera.prototype.clone=function(e){if(e===undefined)e=new i.Camera;i.Object3D.prototype.clone.call(this,e);e.matrixWorldInverse.copy(this.matrixWorldInverse);e.projectionMatrix.copy(this.projectionMatrix);return e};i.OrthographicCamera=function(e,t,n,r,s,o){i.Camera.call(this);this.left=e;this.right=t;this.top=n;this.bottom=r;this.near=s!==undefined?s:.1;this.far=o!==undefined?o:2e3;this.updateProjectionMatrix()};i.OrthographicCamera.prototype=Object.create(i.Camera.prototype);i.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};i.OrthographicCamera.prototype.clone=function(){var e=new i.OrthographicCamera;i.Camera.prototype.clone.call(this,e);e.left=this.left;e.right=this.right;e.top=this.top;e.bottom=this.bottom;e.near=this.near;e.far=this.far;return e};i.PerspectiveCamera=function(e,t,n,r){i.Camera.call(this);this.fov=e!==undefined?e:50;this.aspect=t!==undefined?t:1;this.near=n!==undefined?n:.1;this.far=r!==undefined?r:2e3;this.updateProjectionMatrix()};i.PerspectiveCamera.prototype=Object.create(i.Camera.prototype);i.PerspectiveCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;this.fov=2*i.Math.radToDeg(Math.atan(t/(e*2)));this.updateProjectionMatrix()};i.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e;this.fullHeight=t;this.x=n;this.y=r;this.width=i;this.height=s;this.updateProjectionMatrix()};i.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight;var t=Math.tan(i.Math.degToRad(this.fov*.5))*this.near;var n=-t;var r=e*n;var s=e*t;var o=Math.abs(s-r);var u=Math.abs(t-n);this.projectionMatrix.makeFrustum(r+this.x*o/this.fullWidth,r+(this.x+this.width)*o/this.fullWidth,t-(this.y+this.height)*u/this.fullHeight,t-this.y*u/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)}};i.PerspectiveCamera.prototype.clone=function(){var e=new i.PerspectiveCamera;i.Camera.prototype.clone.call(this,e);e.fov=this.fov;e.aspect=this.aspect;e.near=this.near;e.far=this.far;return e};i.Light=function(e){i.Object3D.call(this);this.color=new i.Color(e)};i.Light.prototype=Object.create(i.Object3D.prototype);i.Light.prototype.clone=function(e){if(e===undefined)e=new i.Light;i.Object3D.prototype.clone.call(this,e);e.color.copy(this.color);return e};i.AmbientLight=function(e){i.Light.call(this,e)};i.AmbientLight.prototype=Object.create(i.Light.prototype);i.AmbientLight.prototype.clone=function(){var e=new i.AmbientLight;i.Light.prototype.clone.call(this,e);return e};i.AreaLight=function(e,t){i.Light.call(this,e);this.normal=new i.Vector3(0,-1,0);this.right=new i.Vector3(1,0,0);this.intensity=t!==undefined?t:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};i.AreaLight.prototype=Object.create(i.Light.prototype);i.DirectionalLight=function(e,t){i.Light.call(this,e);this.position.set(0,1,0);this.target=new i.Object3D;this.intensity=t!==undefined?t:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new i.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};i.DirectionalLight.prototype=Object.create(i.Light.prototype);i.DirectionalLight.prototype.clone=function(){var e=new i.DirectionalLight;i.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;return e};i.HemisphereLight=function(e,t,n){i.Light.call(this,e);this.position.set(0,100,0);this.groundColor=new i.Color(t);this.intensity=n!==undefined?n:1};i.HemisphereLight.prototype=Object.create(i.Light.prototype);i.HemisphereLight.prototype.clone=function(){var e=new i.HemisphereLight;i.Light.prototype.clone.call(this,e);e.groundColor.copy(this.groundColor);e.intensity=this.intensity;return e};i.PointLight=function(e,t,n){i.Light.call(this,e);this.intensity=t!==undefined?t:1;this.distance=n!==undefined?n:0};i.PointLight.prototype=Object.create(i.Light.prototype);i.PointLight.prototype.clone=function(){var e=new i.PointLight;i.Light.prototype.clone.call(this,e);e.intensity=this.intensity;e.distance=this.distance;return e};i.SpotLight=function(e,t,n,r,s){i.Light.call(this,e);this.position.set(0,1,0);this.target=new i.Object3D;this.intensity=t!==undefined?t:1;this.distance=n!==undefined?n:0;this.angle=r!==undefined?r:Math.PI/3;this.exponent=s!==undefined?s:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};i.SpotLight.prototype=Object.create(i.Light.prototype);i.SpotLight.prototype.clone=function(){var e=new i.SpotLight;i.Light.prototype.clone.call(this,e);e.target=this.target.clone();e.intensity=this.intensity;e.distance=this.distance;e.angle=this.angle;e.exponent=this.exponent;e.castShadow=this.castShadow;e.onlyShadow=this.onlyShadow;return e};i.Loader=function(e){this.showStatus=e;this.statusDomElement=e?i.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};i.Loader.prototype={constructor:i.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(e){var t="Loaded ";if(e.total){t+=(100*e.loaded/e.total).toFixed(0)+"%"}else{t+=(e.loaded/1e3).toFixed(2)+" KB"}this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");if(t.length===1)return"./";t.pop();return t.join("/")+"/"},initMaterials:function(e,t){var n=[];for(var r=0;r<e.length;++r){n[r]=i.Loader.prototype.createMaterial(e[r],t)}return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r instanceof i.ShaderMaterial)return true}return false},createMaterial:function(e,t){function r(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function s(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function o(e,t){var i=new Image;i.onload=function(){if(!r(this.width)||!r(this.height)){var t=s(this.width);var n=s(this.height);e.image.width=t;e.image.height=n;e.image.getContext("2d").drawImage(this,0,0,t,n)}else{e.image=this}e.needsUpdate=true};if(n.crossOrigin!==undefined)i.crossOrigin=n.crossOrigin;i.src=t}function u(e,n,r,s,u,a,f){var l=/\.dds$/i.test(r);var c=t+r;if(l){var h=i.ImageUtils.loadCompressedTexture(c);e[n]=h}else{var h=document.createElement("canvas");e[n]=new i.Texture(h)}e[n].sourceFile=r;if(s){e[n].repeat.set(s[0],s[1]);if(s[0]!==1)e[n].wrapS=i.RepeatWrapping;if(s[1]!==1)e[n].wrapT=i.RepeatWrapping}if(u){e[n].offset.set(u[0],u[1])}if(a){var p={repeat:i.RepeatWrapping,mirror:i.MirroredRepeatWrapping};if(p[a[0]]!==undefined)e[n].wrapS=p[a[0]];if(p[a[1]]!==undefined)e[n].wrapT=p[a[1]]}if(f){e[n].anisotropy=f}if(!l){o(e[n],c)}}function a(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var n=this;var f="MeshLambertMaterial";var l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(e.shading){var c=e.shading.toLowerCase();if(c==="phong")f="MeshPhongMaterial";else if(c==="basic")f="MeshBasicMaterial"}if(e.blending!==undefined&&i[e.blending]!==undefined){l.blending=i[e.blending]}if(e.transparent!==undefined||e.opacity<1){l.transparent=e.transparent}if(e.depthTest!==undefined){l.depthTest=e.depthTest}if(e.depthWrite!==undefined){l.depthWrite=e.depthWrite}if(e.visible!==undefined){l.visible=e.visible}if(e.flipSided!==undefined){l.side=i.BackSide}if(e.doubleSided!==undefined){l.side=i.DoubleSide}if(e.wireframe!==undefined){l.wireframe=e.wireframe}if(e.vertexColors!==undefined){if(e.vertexColors==="face"){l.vertexColors=i.FaceColors}else if(e.vertexColors){l.vertexColors=i.VertexColors}}if(e.colorDiffuse){l.color=a(e.colorDiffuse)}else if(e.DbgColor){l.color=e.DbgColor}if(e.colorSpecular){l.specular=a(e.colorSpecular)}if(e.colorAmbient){l.ambient=a(e.colorAmbient)}if(e.transparency){l.opacity=e.transparency}if(e.specularCoef){l.shininess=e.specularCoef}if(e.mapDiffuse&&t){u(l,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy)}if(e.mapLight&&t){u(l,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy)}if(e.mapBump&&t){u(l,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy)}if(e.mapNormal&&t){u(l,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy)}if(e.mapSpecular&&t){u(l,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy)}if(e.mapBumpScale){l.bumpScale=e.mapBumpScale}if(e.mapNormal){var h=i.ShaderLib["normalmap"];var p=i.UniformsUtils.clone(h.uniforms);p["tNormal"].value=l.normalMap;if(e.mapNormalFactor){p["uNormalScale"].value.set(e.mapNormalFactor,e.mapNormalFactor)}if(l.map){p["tDiffuse"].value=l.map;p["enableDiffuse"].value=true}if(l.specularMap){p["tSpecular"].value=l.specularMap;p["enableSpecular"].value=true}if(l.lightMap){p["tAO"].value=l.lightMap;p["enableAO"].value=true}p["diffuse"].value.setHex(l.color);p["specular"].value.setHex(l.specular);p["ambient"].value.setHex(l.ambient);p["shininess"].value=l.shininess;if(l.opacity!==undefined){p["opacity"].value=l.opacity}var d={fragmentShader:h.fragmentShader,vertexShader:h.vertexShader,uniforms:p,lights:true,fog:true};var v=new i.ShaderMaterial(d);if(l.transparent){v.transparent=true}}else{var v=new i[f](l)}if(e.DbgName!==undefined)v.name=e.DbgName;return v}};i.XHRLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.XHRLoader.prototype={constructor:i.XHRLoader,load:function(e,t,n,r){var i=this;var s=new XMLHttpRequest;if(t!==undefined){s.addEventListener("load",function(n){t(n.target.responseText);i.manager.itemEnd(e)},false)}if(n!==undefined){s.addEventListener("progress",function(e){n(e)},false)}if(r!==undefined){s.addEventListener("error",function(e){r(e)},false)}if(this.crossOrigin!==undefined)s.crossOrigin=this.crossOrigin;s.open("GET",e,true);s.send(null);i.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}};i.ImageLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.ImageLoader.prototype={constructor:i.ImageLoader,load:function(e,t,n,r){var i=this;var s=document.createElement("img");if(t!==undefined){s.addEventListener("load",function(n){i.manager.itemEnd(e);t(this)},false)}if(n!==undefined){s.addEventListener("progress",function(e){n(e)},false)}if(r!==undefined){s.addEventListener("error",function(e){r(e)},false)}if(this.crossOrigin!==undefined)s.crossOrigin=this.crossOrigin;s.src=e;i.manager.itemStart(e);return s},setCrossOrigin:function(e){this.crossOrigin=e}};i.JSONLoader=function(e){i.Loader.call(this,e);this.withCredentials=false};i.JSONLoader.prototype=Object.create(i.Loader.prototype);i.JSONLoader.prototype.load=function(e,t,n){var r=this;n=n&&typeof n==="string"?n:this.extractUrlBase(e);this.onLoadStart();this.loadAjaxJSON(this,e,t,n)};i.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest;var o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE){if(s.status===200||s.status===0){if(s.responseText){var u=JSON.parse(s.responseText);if(u.metadata.type==="scene"){console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}var a=e.parse(u,r);n(a.geometry,a.materials)}else{console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.')}e.onLoadComplete()}else{console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+s.status+")")}}else if(s.readyState===s.LOADING){if(i){if(o===0){o=s.getResponseHeader("Content-Length")}i({total:o,loaded:s.responseText.length})}}else if(s.readyState===s.HEADERS_RECEIVED){if(i!==undefined){o=s.getResponseHeader("Content-Length")}}};s.open("GET",t,true);s.withCredentials=this.withCredentials;s.send(null)};i.JSONLoader.prototype.parse=function(e,t){function o(t){function n(e,t){return e&1<<t}var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D=e.faces,P=e.vertices,H=e.normals,B=e.colors,j=0;if(e.uvs!==undefined){for(s=0;s<e.uvs.length;s++){if(e.uvs[s].length)j++}for(s=0;s<j;s++){r.faceVertexUvs[s]=[]}}a=0;f=P.length;while(a<f){S=new i.Vector3;S.x=P[a++]*t;S.y=P[a++]*t;S.z=P[a++]*t;r.vertices.push(S)}a=0;f=D.length;while(a<f){d=D[a++];v=n(d,0);m=n(d,1);g=n(d,3);y=n(d,4);b=n(d,5);w=n(d,6);E=n(d,7);if(v){T=new i.Face3;T.a=D[a];T.b=D[a+1];T.c=D[a+3];N=new i.Face3;N.a=D[a+1];N.b=D[a+2];N.c=D[a+3];a+=4;if(m){p=D[a++];T.materialIndex=p;N.materialIndex=p}u=r.faces.length;if(g){for(s=0;s<j;s++){A=e.uvs[s];r.faceVertexUvs[s][u]=[];r.faceVertexUvs[s][u+1]=[];for(o=0;o<4;o++){h=D[a++];M=A[h*2];_=A[h*2+1];O=new i.Vector2(M,_);if(o!==2)r.faceVertexUvs[s][u].push(O);if(o!==0)r.faceVertexUvs[s][u+1].push(O)}}}if(y){c=D[a++]*3;T.normal.set(H[c++],H[c++],H[c]);N.normal.copy(T.normal)}if(b){for(s=0;s<4;s++){c=D[a++]*3;L=new i.Vector3(H[c++],H[c++],H[c]);if(s!==2)T.vertexNormals.push(L);if(s!==0)N.vertexNormals.push(L)}}if(w){l=D[a++];k=B[l];T.color.setHex(k);N.color.setHex(k)}if(E){for(s=0;s<4;s++){l=D[a++];k=B[l];if(s!==2)T.vertexColors.push(new i.Color(k));if(s!==0)N.vertexColors.push(new i.Color(k))}}r.faces.push(T);r.faces.push(N)}else{x=new i.Face3;x.a=D[a++];x.b=D[a++];x.c=D[a++];if(m){p=D[a++];x.materialIndex=p}u=r.faces.length;if(g){for(s=0;s<j;s++){A=e.uvs[s];r.faceVertexUvs[s][u]=[];for(o=0;o<3;o++){h=D[a++];M=A[h*2];_=A[h*2+1];O=new i.Vector2(M,_);r.faceVertexUvs[s][u].push(O)}}}if(y){c=D[a++]*3;x.normal.set(H[c++],H[c++],H[c])}if(b){for(s=0;s<3;s++){c=D[a++]*3;L=new i.Vector3(H[c++],H[c++],H[c]);x.vertexNormals.push(L)}}if(w){l=D[a++];x.color.setHex(B[l])}if(E){for(s=0;s<3;s++){l=D[a++];x.vertexColors.push(new i.Color(B[l]))}}r.faces.push(x)}}}function u(){if(e.skinWeights){for(var t=0,n=e.skinWeights.length;t<n;t+=2){var s=e.skinWeights[t];var o=e.skinWeights[t+1];var u=0;var a=0;r.skinWeights.push(new i.Vector4(s,o,u,a))}}if(e.skinIndices){for(var t=0,n=e.skinIndices.length;t<n;t+=2){var f=e.skinIndices[t];var l=e.skinIndices[t+1];var c=0;var h=0;r.skinIndices.push(new i.Vector4(f,l,c,h))}}r.bones=e.bones;if(r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)){console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.")}r.animation=e.animation;r.animations=e.animations}function a(t){if(e.morphTargets!==undefined){var n,s,o,u,a,f;for(n=0,s=e.morphTargets.length;n<s;n++){r.morphTargets[n]={};r.morphTargets[n].name=e.morphTargets[n].name;r.morphTargets[n].vertices=[];a=r.morphTargets[n].vertices;f=e.morphTargets[n].vertices;for(o=0,u=f.length;o<u;o+=3){var l=new i.Vector3;l.x=f[o]*t;l.y=f[o+1]*t;l.z=f[o+2]*t;a.push(l)}}}if(e.morphColors!==undefined){var n,s,c,h,p,d,v;for(n=0,s=e.morphColors.length;n<s;n++){r.morphColors[n]={};r.morphColors[n].name=e.morphColors[n].name;r.morphColors[n].colors=[];p=r.morphColors[n].colors;d=e.morphColors[n].colors;for(c=0,h=d.length;c<h;c+=3){v=new i.Color(16755200);v.setRGB(d[c],d[c+1],d[c+2]);p.push(v)}}}}var n=this,r=new i.Geometry,s=e.scale!==undefined?1/e.scale:1;o(s);u();a(s);r.computeCentroids();r.computeFaceNormals();r.computeBoundingSphere();if(e.materials===undefined){return{geometry:r}}else{var f=this.initMaterials(e.materials,t);if(this.needsTangents(f)){r.computeTangents()}return{geometry:r,materials:f}}};i.LoadingManager=function(e,t,n){var r=this;var i=0,s=0;this.onLoad=e;this.onProgress=t;this.onError=n;this.itemStart=function(e){s++};this.itemEnd=function(e){i++;if(r.onProgress!==undefined){r.onProgress(e,i,s)}if(i===s&&r.onLoad!==undefined){r.onLoad()}}};i.DefaultLoadingManager=new i.LoadingManager;i.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.BufferGeometryLoader.prototype={constructor:i.BufferGeometryLoader,load:function(e,t,n,r){var s=this;var o=new i.XHRLoader;o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(s.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i.BufferGeometry;var n=e.attributes;var s=e.offsets;var o=e.boundingSphere;for(var u in n){var a=n[u];t.attributes[u]={itemSize:a.itemSize,array:new r[a.type](a.array)}}if(s!==undefined){t.offsets=JSON.parse(JSON.stringify(s))}if(o!==undefined){t.boundingSphere=new i.Sphere((new i.Vector3).fromArray(o.center!==undefined?o.center:[0,0,0]),o.radius)}return t}};i.Geometry2Loader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.Geometry2Loader.prototype={constructor:i.Geometry2Loader,load:function(e,t,n,r){var s=this;var o=new i.XHRLoader;o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(s.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i.Geometry2(e.vertices.length/3);var n=["vertices","normals","uvs"];var r=e.boundingSphere;for(var s in n){var o=n[s];t[o].set(e[o])}if(r!==undefined){t.boundingSphere=new i.Sphere((new i.Vector3).fromArray(r.center!==undefined?r.center:[0,0,0]),r.radius)}return t}};i.MaterialLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.MaterialLoader.prototype={constructor:i.MaterialLoader,load:function(e,t,n,r){var s=this;var o=new i.XHRLoader;o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(s.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new i[e.type];if(e.color!==undefined)t.color.setHex(e.color);if(e.ambient!==undefined)t.ambient.setHex(e.ambient);if(e.emissive!==undefined)t.emissive.setHex(e.emissive);if(e.specular!==undefined)t.specular.setHex(e.specular);if(e.shininess!==undefined)t.shininess=e.shininess;if(e.vertexColors!==undefined)t.vertexColors=e.vertexColors;if(e.blending!==undefined)t.blending=e.blending;if(e.side!==undefined)t.side=e.side;if(e.opacity!==undefined)t.opacity=e.opacity;if(e.transparent!==undefined)t.transparent=e.transparent;if(e.wireframe!==undefined)t.wireframe=e.wireframe;if(e.materials!==undefined){for(var n=0,r=e.materials.length;n<r;n++){t.materials.push(this.parse(e.materials[n]))}}return t}};i.ObjectLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.ObjectLoader.prototype={constructor:i.ObjectLoader,load:function(e,t,n,r){var s=this;var o=new i.XHRLoader(s.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){t(s.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries);var n=this.parseMaterials(e.materials);var r=this.parseObject(e.object,t,n);return r},parseGeometries:function(e){var t={};if(e!==undefined){var n=new i.JSONLoader;var r=new i.Geometry2Loader;var s=new i.BufferGeometryLoader;for(var o=0,u=e.length;o<u;o++){var a;var f=e[o];switch(f.type){case"PlaneGeometry":a=new i.PlaneGeometry(f.width,f.height,f.widthSegments,f.heightSegments);break;case"BoxGeometry":case"CubeGeometry":a=new i.BoxGeometry(f.width,f.height,f.depth,f.widthSegments,f.heightSegments,f.depthSegments);break;case"CircleGeometry":a=new i.CircleGeometry(f.radius,f.segments);break;case"CylinderGeometry":a=new i.CylinderGeometry(f.radiusTop,f.radiusBottom,f.height,f.radialSegments,f.heightSegments,f.openEnded);break;case"SphereGeometry":a=new i.SphereGeometry(f.radius,f.widthSegments,f.heightSegments,f.phiStart,f.phiLength,f.thetaStart,f.thetaLength);break;case"IcosahedronGeometry":a=new i.IcosahedronGeometry(f.radius,f.detail);break;case"TorusGeometry":a=new i.TorusGeometry(f.radius,f.tube,f.radialSegments,f.tubularSegments,f.arc);break;case"TorusKnotGeometry":a=new i.TorusKnotGeometry(f.radius,f.tube,f.radialSegments,f.tubularSegments,f.p,f.q,f.heightScale);break;case"BufferGeometry":a=s.parse(f.data);break;case"Geometry2":a=r.parse(f.data);break;case"Geometry":a=n.parse(f.data).geometry;break}a.uuid=f.uuid;if(f.name!==undefined)a.name=f.name;t[f.uuid]=a}}return t},parseMaterials:function(e){var t={};if(e!==undefined){var n=new i.MaterialLoader;for(var r=0,s=e.length;r<s;r++){var o=e[r];var u=n.parse(o);u.uuid=o.uuid;if(o.name!==undefined)u.name=o.name;t[o.uuid]=u}}return t},parseObject:function(){var e=new i.Matrix4;return function(t,n,r){var s;switch(t.type){case"Scene":s=new i.Scene;break;case"PerspectiveCamera":s=new i.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":s=new i.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":s=new i.AmbientLight(t.color);break;case"DirectionalLight":s=new i.DirectionalLight(t.color,t.intensity);break;case"PointLight":s=new i.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":s=new i.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":s=new i.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var o=n[t.geometry];var u=r[t.material];if(o===undefined){console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry)}if(u===undefined){console.error("THREE.ObjectLoader: Undefined material "+t.material)}s=new i.Mesh(o,u);break;case"Sprite":var u=r[t.material];if(u===undefined){console.error("THREE.ObjectLoader: Undefined material "+t.material)}s=new i.Sprite(u);break;default:s=new i.Object3D}s.uuid=t.uuid;if(t.name!==undefined)s.name=t.name;if(t.matrix!==undefined){e.fromArray(t.matrix);e.decompose(s.position,s.quaternion,s.scale)}else{if(t.position!==undefined)s.position.fromArray(t.position);if(t.rotation!==undefined)s.rotation.fromArray(t.rotation);if(t.scale!==undefined)s.scale.fromArray(t.scale)}if(t.visible!==undefined)s.visible=t.visible;if(t.userData!==undefined)s.userData=t.userData;if(t.children!==undefined){for(var a in t.children){s.add(this.parseObject(t.children[a],n,r))}}return s}}()};i.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){};this.geometryHandlers={};this.hierarchyHandlers={};this.addGeometryHandler("ascii",i.JSONLoader)};i.SceneLoader.prototype={constructor:i.SceneLoader,load:function(e,t,n,r){var s=this;var o=new i.XHRLoader(s.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(n){s.parse(JSON.parse(n),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,n){function L(e,t){if(t=="relativeToHTML"){return e}else{return s+e}}function A(){O(w.scene,S.objects)}function O(e,t){var n,s,f,l,c,h;for(var d in t){var v=w.objects[d];var m=t[d];if(v===undefined){if(m.type&&m.type in r.hierarchyHandlers){if(m.loading===undefined){var g={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var y={};for(var b in m){if(!(b in g)){y[b]=m[b]}}u=w.materials[m.material];m.loading=true;var E=r.hierarchyHandlers[m.type]["loaderObject"];if(E.options){E.load(L(m.url,S.urlBaseType),P(d,e,u,m))}else{E.load(L(m.url,S.urlBaseType),P(d,e,u,m),y)}}}else if(m.geometry!==undefined){o=w.geometries[m.geometry];if(o){var x=false;u=w.materials[m.material];x=u instanceof i.ShaderMaterial;f=m.position;l=m.rotation;c=m.scale;n=m.matrix;h=m.quaternion;if(!m.material){u=new i.MeshFaceMaterial(w.face_materials[m.geometry])}if(u instanceof i.MeshFaceMaterial&&u.materials.length===0){u=new i.MeshFaceMaterial(w.face_materials[m.geometry])}if(u instanceof i.MeshFaceMaterial){for(var T=0;T<u.materials.length;T++){x=x||u.materials[T]instanceof i.ShaderMaterial}}if(x){o.computeTangents()}if(m.skin){v=new i.SkinnedMesh(o,u)}else if(m.morph){v=new i.MorphAnimMesh(o,u);if(m.duration!==undefined){v.duration=m.duration}if(m.time!==undefined){v.time=m.time}if(m.mirroredLoop!==undefined){v.mirroredLoop=m.mirroredLoop}if(u.morphNormals){o.computeMorphNormals()}}else{v=new i.Mesh(o,u)}v.name=d;if(n){v.matrixAutoUpdate=false;v.matrix.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}else{v.position.fromArray(f);if(h){v.quaternion.fromArray(h)}else{v.rotation.fromArray(l)}v.scale.fromArray(c)}v.visible=m.visible;v.castShadow=m.castShadow;v.receiveShadow=m.receiveShadow;e.add(v);w.objects[d]=v}}else if(m.type==="AmbientLight"||m.type==="PointLight"||m.type==="DirectionalLight"||m.type==="SpotLight"||m.type==="HemisphereLight"||m.type==="AreaLight"){var N=m.color;var C=m.intensity;var k=m.distance;var A=m.position;var M=m.rotation;switch(m.type){case"AmbientLight":p=new i.AmbientLight(N);break;case"PointLight":p=new i.PointLight(N,C,k);p.position.fromArray(A);break;case"DirectionalLight":p=new i.DirectionalLight(N,C);p.position.fromArray(m.direction);break;case"SpotLight":p=new i.SpotLight(N,C,k,1);p.angle=m.angle;p.position.fromArray(A);p.target.set(A[0],A[1]-k,A[2]);p.target.applyEuler(new i.Euler(M[0],M[1],M[2],"XYZ"));break;case"HemisphereLight":p=new i.DirectionalLight(N,C,k);p.target.set(A[0],A[1]-k,A[2]);p.target.applyEuler(new i.Euler(M[0],M[1],M[2],"XYZ"));break;case"AreaLight":p=new i.AreaLight(N,C);p.position.fromArray(A);p.width=m.size;p.height=m.size_y;break}e.add(p);p.name=d;w.lights[d]=p;w.objects[d]=p}else if(m.type==="PerspectiveCamera"||m.type==="OrthographicCamera"){f=m.position;l=m.rotation;h=m.quaternion;if(m.type==="PerspectiveCamera"){a=new i.PerspectiveCamera(m.fov,m.aspect,m.near,m.far)}else if(m.type==="OrthographicCamera"){a=new i.OrthographicCamera(m.left,m.right,m.top,m.bottom,m.near,m.far)}a.name=d;a.position.fromArray(f);if(h!==undefined){a.quaternion.fromArray(h)}else if(l!==undefined){a.rotation.fromArray(l)}e.add(a);w.cameras[d]=a;w.objects[d]=a}else{f=m.position;l=m.rotation;c=m.scale;h=m.quaternion;v=new i.Object3D;v.name=d;v.position.fromArray(f);if(h){v.quaternion.fromArray(h)}else{v.rotation.fromArray(l)}v.scale.fromArray(c);v.visible=m.visible!==undefined?m.visible:false;e.add(v);w.objects[d]=v;w.empties[d]=v}if(v){if(m.userData!==undefined){for(var _ in m.userData){var D=m.userData[_];v.userData[_]=D}}if(m.groups!==undefined){for(var T=0;T<m.groups.length;T++){var H=m.groups[T];if(w.groups[H]===undefined){w.groups[H]=[]}w.groups[H].push(d)}}}}if(v!==undefined&&m.children!==undefined){O(v,m.children)}}}function M(e,t,n){w.geometries[n]=e;w.face_materials[n]=t;A()}function _(e,t,n,r,i){var s=i.position;var o=i.rotation;var u=i.quaternion;var a=i.scale;e.position.fromArray(s);if(u){e.quaternion.fromArray(u)}else{e.rotation.fromArray(o)}e.scale.fromArray(a);if(r){e.traverse(function(e){e.material=r})}var f=i.visible!==undefined?i.visible:true;e.traverse(function(e){e.visible=f});n.add(e);e.name=t;w.objects[t]=e;A()}function D(e){return function(t,n){t.name=e;M(t,n,e);m-=1;r.onLoadComplete();B()}}function P(e,t,n,i){return function(s){var o;if(s.content){o=s.content}else if(s.dae){o=s.scene}else{o=s}_(o,e,t,n,i);m-=1;r.onLoadComplete();B()}}function H(e){return function(t,n){t.name=e;w.geometries[e]=t;w.face_materials[e]=n}}function B(){var e={totalModels:y,totalTextures:b,loadedModels:y-m,loadedTextures:b-g};r.callbackProgress(e,w);r.onLoadProgress();if(m===0&&g===0){j();t(w)}}function j(){for(var e=0;e<E.length;e++){var t=E[e];var n=w.objects[t.targetName];if(n){t.object.target=n}else{t.object.target=new i.Object3D;w.scene.add(t.object.target)}t.object.target.userData.targetInverse=t.object}}function q(e,t){t(e);if(e.children!==undefined){for(var n in e.children){q(e.children[n],t)}}}var r=this;var s=i.Loader.prototype.extractUrlBase(n);var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;var E=[];var S=e;for(var x in this.geometryHandlers){var T=this.geometryHandlers[x]["loaderClass"];this.geometryHandlers[x]["loaderObject"]=new T}for(var x in this.hierarchyHandlers){var T=this.hierarchyHandlers[x]["loaderClass"];this.hierarchyHandlers[x]["loaderObject"]=new T}m=0;g=0;w={scene:new i.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}};if(S.transform){var N=S.transform.position,C=S.transform.rotation,k=S.transform.scale;if(N){w.scene.position.fromArray(N)}if(C){w.scene.rotation.fromArray(C)}if(k){w.scene.scale.fromArray(k)}if(N||C||k){w.scene.updateMatrix();w.scene.updateMatrixWorld()}}var F=function(e){g-=e;B();r.onLoadComplete()};var I=function(e){return function(){F(e)}};var R,U;for(R in S.fogs){U=S.fogs[R];if(U.type==="linear"){f=new i.Fog(0,U.near,U.far)}else if(U.type==="exp2"){f=new i.FogExp2(0,U.density)}h=U.color;f.color.setRGB(h[0],h[1],h[2]);w.fogs[R]=f}var z,W;for(z in S.geometries){W=S.geometries[z];if(W.type in this.geometryHandlers){m+=1;r.onLoadStart()}}for(var X in S.objects){q(S.objects[X],function(e){if(e.type&&e.type in r.hierarchyHandlers){m+=1;r.onLoadStart()}})}y=m;for(z in S.geometries){W=S.geometries[z];if(W.type==="cube"){o=new i.BoxGeometry(W.width,W.height,W.depth,W.widthSegments,W.heightSegments,W.depthSegments);o.name=z;w.geometries[z]=o}else if(W.type==="plane"){o=new i.PlaneGeometry(W.width,W.height,W.widthSegments,W.heightSegments);o.name=z;w.geometries[z]=o}else if(W.type==="sphere"){o=new i.SphereGeometry(W.radius,W.widthSegments,W.heightSegments);o.name=z;w.geometries[z]=o}else if(W.type==="cylinder"){o=new i.CylinderGeometry(W.topRad,W.botRad,W.height,W.radSegs,W.heightSegs);o.name=z;w.geometries[z]=o}else if(W.type==="torus"){o=new i.TorusGeometry(W.radius,W.tube,W.segmentsR,W.segmentsT);o.name=z;w.geometries[z]=o}else if(W.type==="icosahedron"){o=new i.IcosahedronGeometry(W.radius,W.subdivisions);o.name=z;w.geometries[z]=o}else if(W.type in this.geometryHandlers){var V={};for(var $ in W){if($!=="type"&&$!=="url"){V[$]=W[$]}}var J=this.geometryHandlers[W.type]["loaderObject"];J.load(L(W.url,S.urlBaseType),D(z),V)}else if(W.type==="embedded"){var K=S.embeds[W.id],Q="";K.metadata=S.metadata;if(K){var G=this.geometryHandlers["ascii"]["loaderObject"];var Y=G.parse(K,Q);H(z)(Y.geometry,Y.materials)}}}var Z,et;for(Z in S.textures){et=S.textures[Z];if(et.url instanceof Array){g+=et.url.length;for(var tt=0;tt<et.url.length;tt++){r.onLoadStart()}}else{g+=1;r.onLoadStart()}}b=g;for(Z in S.textures){et=S.textures[Z];if(et.mapping!==undefined&&i[et.mapping]!==undefined){et.mapping=new i[et.mapping]}if(et.url instanceof Array){var nt=et.url.length;var rt=[];for(var it=0;it<nt;it++){rt[it]=L(et.url[it],S.urlBaseType)}var st=/\.dds$/i.test(rt[0]);if(st){l=i.ImageUtils.loadCompressedTextureCube(rt,et.mapping,I(nt))}else{l=i.ImageUtils.loadTextureCube(rt,et.mapping,I(nt))}}else{var st=/\.dds$/i.test(et.url);var ot=L(et.url,S.urlBaseType);var ut=I(1);if(st){l=i.ImageUtils.loadCompressedTexture(ot,et.mapping,ut)}else{l=i.ImageUtils.loadTexture(ot,et.mapping,ut)}if(i[et.minFilter]!==undefined)l.minFilter=i[et.minFilter];if(i[et.magFilter]!==undefined)l.magFilter=i[et.magFilter];if(et.anisotropy)l.anisotropy=et.anisotropy;if(et.repeat){l.repeat.set(et.repeat[0],et.repeat[1]);if(et.repeat[0]!==1)l.wrapS=i.RepeatWrapping;if(et.repeat[1]!==1)l.wrapT=i.RepeatWrapping}if(et.offset){l.offset.set(et.offset[0],et.offset[1])}if(et.wrap){var at={repeat:i.RepeatWrapping,mirror:i.MirroredRepeatWrapping};if(at[et.wrap[0]]!==undefined)l.wrapS=at[et.wrap[0]];if(at[et.wrap[1]]!==undefined)l.wrapT=at[et.wrap[1]]}}w.textures[Z]=l}var ft,lt;var ct;for(ft in S.materials){lt=S.materials[ft];for(ct in lt.parameters){if(ct==="envMap"||ct==="map"||ct==="lightMap"||ct==="bumpMap"){lt.parameters[ct]=w.textures[lt.parameters[ct]]}else if(ct==="shading"){lt.parameters[ct]=lt.parameters[ct]==="flat"?i.FlatShading:i.SmoothShading}else if(ct==="side"){if(lt.parameters[ct]=="double"){lt.parameters[ct]=i.DoubleSide}else if(lt.parameters[ct]=="back"){lt.parameters[ct]=i.BackSide}else{lt.parameters[ct]=i.FrontSide}}else if(ct==="blending"){lt.parameters[ct]=lt.parameters[ct]in i?i[lt.parameters[ct]]:i.NormalBlending}else if(ct==="combine"){lt.parameters[ct]=lt.parameters[ct]in i?i[lt.parameters[ct]]:i.MultiplyOperation}else if(ct==="vertexColors"){if(lt.parameters[ct]=="face"){lt.parameters[ct]=i.FaceColors}else if(lt.parameters[ct]){lt.parameters[ct]=i.VertexColors}}else if(ct==="wrapRGB"){var ht=lt.parameters[ct];lt.parameters[ct]=new i.Vector3(ht[0],ht[1],ht[2])}}if(lt.parameters.opacity!==undefined&&lt.parameters.opacity<1){lt.parameters.transparent=true}if(lt.parameters.normalMap){var pt=i.ShaderLib["normalmap"];var dt=i.UniformsUtils.clone(pt.uniforms);var vt=lt.parameters.color;var mt=lt.parameters.specular;var gt=lt.parameters.ambient;var yt=lt.parameters.shininess;dt["tNormal"].value=w.textures[lt.parameters.normalMap];if(lt.parameters.normalScale){dt["uNormalScale"].value.set(lt.parameters.normalScale[0],lt.parameters.normalScale[1])}if(lt.parameters.map){dt["tDiffuse"].value=lt.parameters.map;dt["enableDiffuse"].value=true}if(lt.parameters.envMap){dt["tCube"].value=lt.parameters.envMap;dt["enableReflection"].value=true;dt["reflectivity"].value=lt.parameters.reflectivity}if(lt.parameters.lightMap){dt["tAO"].value=lt.parameters.lightMap;dt["enableAO"].value=true}if(lt.parameters.specularMap){dt["tSpecular"].value=w.textures[lt.parameters.specularMap];dt["enableSpecular"].value=true}if(lt.parameters.displacementMap){dt["tDisplacement"].value=w.textures[lt.parameters.displacementMap];dt["enableDisplacement"].value=true;dt["uDisplacementBias"].value=lt.parameters.displacementBias;dt["uDisplacementScale"].value=lt.parameters.displacementScale}dt["diffuse"].value.setHex(vt);dt["specular"].value.setHex(mt);dt["ambient"].value.setHex(gt);dt["shininess"].value=yt;if(lt.parameters.opacity){dt["opacity"].value=lt.parameters.opacity}var bt={fragmentShader:pt.fragmentShader,vertexShader:pt.vertexShader,uniforms:dt,lights:true,fog:true};u=new i.ShaderMaterial(bt)}else{u=new i[lt.type](lt.parameters)}u.name=ft;w.materials[ft]=u}for(ft in S.materials){lt=S.materials[ft];if(lt.parameters.materials){var wt=[];for(var it=0;it<lt.parameters.materials.length;it++){var Et=lt.parameters.materials[it];wt.push(w.materials[Et])}w.materials[ft].materials=wt}}A();if(w.cameras&&S.defaults.camera){w.currentCamera=w.cameras[S.defaults.camera]}if(w.fogs&&S.defaults.fog){w.scene.fog=w.fogs[S.defaults.fog]}r.callbackSync(w);B()}};i.TextureLoader=function(e){this.manager=e!==undefined?e:i.DefaultLoadingManager};i.TextureLoader.prototype={constructor:i.TextureLoader,load:function(e,t,n,r){var s=this;var o=new i.ImageLoader(s.manager);o.setCrossOrigin(this.crossOrigin);o.load(e,function(e){var n=new i.Texture(e);n.needsUpdate=true;if(t!==undefined){t(n)}})},setCrossOrigin:function(e){this.crossOrigin=e}};i.Material=function(){this.id=i.MaterialIdCount++;this.uuid=i.Math.generateUUID();this.name="";this.side=i.FrontSide;this.opacity=1;this.transparent=false;this.blending=i.NormalBlending;this.blendSrc=i.SrcAlphaFactor;this.blendDst=i.OneMinusSrcAlphaFactor;this.blendEquation=i.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this.needsUpdate=true};i.Material.prototype={constructor:i.Material,setValues:function(e){if(e===undefined)return;for(var t in e){var n=e[t];if(n===undefined){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t in this){var r=this[t];if(r instanceof i.Color){r.set(n)}else if(r instanceof i.Vector3&&n instanceof i.Vector3){r.copy(n)}else if(t=="overdraw"){this[t]=Number(n)}else{this[t]=n}}}},clone:function(e){if(e===undefined)e=new i.Material;e.name=this.name;e.side=this.side;e.opacity=this.opacity;e.transparent=this.transparent;e.blending=this.blending;e.blendSrc=this.blendSrc;e.blendDst=this.blendDst;e.blendEquation=this.blendEquation;e.depthTest=this.depthTest;e.depthWrite=this.depthWrite;e.polygonOffset=this.polygonOffset;e.polygonOffsetFactor=this.polygonOffsetFactor;e.polygonOffsetUnits=this.polygonOffsetUnits;e.alphaTest=this.alphaTest;e.overdraw=this.overdraw;e.visible=this.visible;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.Material.prototype);i.MaterialIdCount=0;i.LineBasicMaterial=function(e){i.Material.call(this);this.color=new i.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=false;this.fog=true;this.setValues(e)};i.LineBasicMaterial.prototype=Object.create(i.Material.prototype);i.LineBasicMaterial.prototype.clone=function(){var e=new i.LineBasicMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.linecap=this.linecap;e.linejoin=this.linejoin;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};i.LineDashedMaterial=function(e){i.Material.call(this);this.color=new i.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(e)};i.LineDashedMaterial.prototype=Object.create(i.Material.prototype);i.LineDashedMaterial.prototype.clone=function(){var e=new i.LineDashedMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.linewidth=this.linewidth;e.scale=this.scale;e.dashSize=this.dashSize;e.gapSize=this.gapSize;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};i.MeshBasicMaterial=function(e){i.Material.call(this);this.color=new i.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(e)};i.MeshBasicMaterial.prototype=Object.create(i.Material.prototype);i.MeshBasicMaterial.prototype.clone=function(){var e=new i.MeshBasicMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;return e};i.MeshLambertMaterial=function(e){i.Material.call(this);this.color=new i.Color(16777215);this.ambient=new i.Color(16777215);this.emissive=new i.Color(0);this.wrapAround=false;this.wrapRGB=new i.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};i.MeshLambertMaterial.prototype=Object.create(i.Material.prototype);i.MeshLambertMaterial.prototype.clone=function(){var e=new i.MeshLambertMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.ambient.copy(this.ambient);e.emissive.copy(this.emissive);e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.specularMap=this.specularMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};i.MeshPhongMaterial=function(e){i.Material.call(this);this.color=new i.Color(16777215);this.ambient=new i.Color(16777215);this.emissive=new i.Color(0);this.specular=new i.Color(1118481);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new i.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new i.Vector2(1,1);this.specularMap=null;this.envMap=null;this.combine=i.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=i.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(e)};i.MeshPhongMaterial.prototype=Object.create(i.Material.prototype);i.MeshPhongMaterial.prototype.clone=function(){var e=new i.MeshPhongMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.ambient.copy(this.ambient);e.emissive.copy(this.emissive);e.specular.copy(this.specular);e.shininess=this.shininess;e.metal=this.metal;e.wrapAround=this.wrapAround;e.wrapRGB.copy(this.wrapRGB);e.map=this.map;e.lightMap=this.lightMap;e.bumpMap=this.bumpMap;e.bumpScale=this.bumpScale;e.normalMap=this.normalMap;e.normalScale.copy(this.normalScale);e.specularMap=this.specularMap;e.envMap=this.envMap;e.combine=this.combine;e.reflectivity=this.reflectivity;e.refractionRatio=this.refractionRatio;e.fog=this.fog;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.wireframeLinecap=this.wireframeLinecap;e.wireframeLinejoin=this.wireframeLinejoin;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};i.MeshDepthMaterial=function(e){i.Material.call(this);this.wireframe=false;this.wireframeLinewidth=1;this.setValues(e)};i.MeshDepthMaterial.prototype=Object.create(i.Material.prototype);i.MeshDepthMaterial.prototype.clone=function(){var e=new i.MeshDepthMaterial;i.Material.prototype.clone.call(this,e);e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};i.MeshNormalMaterial=function(e){i.Material.call(this,e);this.shading=i.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(e)};i.MeshNormalMaterial.prototype=Object.create(i.Material.prototype);i.MeshNormalMaterial.prototype.clone=function(){var e=new i.MeshNormalMaterial;i.Material.prototype.clone.call(this,e);e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;return e};i.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]};i.MeshFaceMaterial.prototype.clone=function(){var e=new i.MeshFaceMaterial;for(var t=0;t<this.materials.length;t++){e.materials.push(this.materials[t].clone())}return e};i.ParticleSystemMaterial=function(e){i.Material.call(this);this.color=new i.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=false;this.fog=true;this.setValues(e)};i.ParticleSystemMaterial.prototype=Object.create(i.Material.prototype);i.ParticleSystemMaterial.prototype.clone=function(){var e=new i.ParticleSystemMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.size=this.size;e.sizeAttenuation=this.sizeAttenuation;e.vertexColors=this.vertexColors;e.fog=this.fog;return e};i.ParticleBasicMaterial=i.ParticleSystemMaterial;i.ShaderMaterial=function(e){i.Material.call(this);this.fragmentShader="void main() {}";this.vertexShader="void main() {}";this.uniforms={};this.defines={};this.attributes=null;this.shading=i.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=i.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName="position";this.setValues(e)};i.ShaderMaterial.prototype=Object.create(i.Material.prototype);i.ShaderMaterial.prototype.clone=function(){var e=new i.ShaderMaterial;i.Material.prototype.clone.call(this,e);e.fragmentShader=this.fragmentShader;e.vertexShader=this.vertexShader;e.uniforms=i.UniformsUtils.clone(this.uniforms);e.attributes=this.attributes;e.defines=this.defines;e.shading=this.shading;e.wireframe=this.wireframe;e.wireframeLinewidth=this.wireframeLinewidth;e.fog=this.fog;e.lights=this.lights;e.vertexColors=this.vertexColors;e.skinning=this.skinning;e.morphTargets=this.morphTargets;e.morphNormals=this.morphNormals;return e};i.SpriteMaterial=function(e){i.Material.call(this);this.color=new i.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(e)};i.SpriteMaterial.prototype=Object.create(i.Material.prototype);i.SpriteMaterial.prototype.clone=function(){var e=new i.SpriteMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.map=this.map;e.rotation=this.rotation;e.fog=this.fog;return e};i.SpriteCanvasMaterial=function(e){i.Material.call(this);this.color=new i.Color(16777215);this.program=function(e,t){};this.setValues(e)};i.SpriteCanvasMaterial.prototype=Object.create(i.Material.prototype);i.SpriteCanvasMaterial.prototype.clone=function(){var e=new i.SpriteCanvasMaterial;i.Material.prototype.clone.call(this,e);e.color.copy(this.color);e.program=this.program;return e};i.ParticleCanvasMaterial=i.SpriteCanvasMaterial;i.Texture=function(e,t,n,r,s,o,u,a,f){this.id=i.TextureIdCount++;this.uuid=i.Math.generateUUID();this.name="";this.image=e;this.mipmaps=[];this.mapping=t!==undefined?t:new i.UVMapping;this.wrapS=n!==undefined?n:i.ClampToEdgeWrapping;this.wrapT=r!==undefined?r:i.ClampToEdgeWrapping;this.magFilter=s!==undefined?s:i.LinearFilter;this.minFilter=o!==undefined?o:i.LinearMipMapLinearFilter;this.anisotropy=f!==undefined?f:1;this.format=u!==undefined?u:i.RGBAFormat;this.type=a!==undefined?a:i.UnsignedByteType;this.offset=new i.Vector2(0,0);this.repeat=new i.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null};i.Texture.prototype={constructor:i.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){if(e===true)this.update();this._needsUpdate=e},clone:function(e){if(e===undefined)e=new i.Texture;e.image=this.image;e.mipmaps=this.mipmaps.slice(0);e.mapping=this.mapping;e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.format=this.format;e.type=this.type;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.generateMipmaps=this.generateMipmaps;e.premultiplyAlpha=this.premultiplyAlpha;e.flipY=this.flipY;e.unpackAlignment=this.unpackAlignment;return e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.Texture.prototype);i.TextureIdCount=0;i.CompressedTexture=function(e,t,n,r,s,o,u,a,f,l,c){i.Texture.call(this,null,o,u,a,f,l,r,s,c);this.image={width:t,height:n};this.mipmaps=e;this.generateMipmaps=false};i.CompressedTexture.prototype=Object.create(i.Texture.prototype);i.CompressedTexture.prototype.clone=function(){var e=new i.CompressedTexture;i.Texture.prototype.clone.call(this,e);return e};i.DataTexture=function(e,t,n,r,s,o,u,a,f,l,c){i.Texture.call(this,null,o,u,a,f,l,r,s,c);this.image={data:e,width:t,height:n}};i.DataTexture.prototype=Object.create(i.Texture.prototype);i.DataTexture.prototype.clone=function(){var e=new i.DataTexture;i.Texture.prototype.clone.call(this,e);return e};i.ParticleSystem=function(e,t){i.Object3D.call(this);this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.ParticleSystemMaterial({color:Math.random()*16777215});this.sortParticles=false;this.frustumCulled=false};i.ParticleSystem.prototype=Object.create(i.Object3D.prototype);i.ParticleSystem.prototype.clone=function(e){if(e===undefined)e=new i.ParticleSystem(this.geometry,this.material);e.sortParticles=this.sortParticles;i.Object3D.prototype.clone.call(this,e);return e};i.Line=function(e,t,n){i.Object3D.call(this);this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.LineBasicMaterial({color:Math.random()*16777215});this.type=n!==undefined?n:i.LineStrip};i.LineStrip=0;i.LinePieces=1;i.Line.prototype=Object.create(i.Object3D.prototype);i.Line.prototype.clone=function(e){if(e===undefined)e=new i.Line(this.geometry,this.material,this.type);i.Object3D.prototype.clone.call(this,e);return e};i.Mesh=function(e,t){i.Object3D.call(this);this.geometry=e!==undefined?e:new i.Geometry;this.material=t!==undefined?t:new i.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};i.Mesh.prototype=Object.create(i.Object3D.prototype);i.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}}};i.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==undefined){return this.morphTargetDictionary[e]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};i.Mesh.prototype.clone=function(e){if(e===undefined)e=new i.Mesh(this.geometry,this.material);i.Object3D.prototype.clone.call(this,e);return e};i.Bone=function(e){i.Object3D.call(this);this.skin=e;this.skinMatrix=new i.Matrix4};i.Bone.prototype=Object.create(i.Object3D.prototype);i.Bone.prototype.update=function(e,t){if(this.matrixAutoUpdate){t|=this.updateMatrix()}if(t||this.matrixWorldNeedsUpdate){if(e){this.skinMatrix.multiplyMatrices(e,this.matrix)}else{this.skinMatrix.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;t=true}var n,r,i=this.children.length;for(r=0;r<i;r++){this.children[r].update(this.skinMatrix,t)}};i.SkinnedMesh=function(e,t,n){i.Mesh.call(this,e,t);this.useVertexTexture=n!==undefined?n:true;this.identityMatrix=new i.Matrix4;this.bones=[];this.boneMatrices=[];var r,s,o,u,a,f;if(this.geometry&&this.geometry.bones!==undefined){for(r=0;r<this.geometry.bones.length;r++){o=this.geometry.bones[r];u=o.pos;a=o.rotq;f=o.scl;s=this.addBone();s.name=o.name;s.position.set(u[0],u[1],u[2]);s.quaternion.set(a[0],a[1],a[2],a[3]);if(f!==undefined){s.scale.set(f[0],f[1],f[2])}else{s.scale.set(1,1,1)}}for(r=0;r<this.bones.length;r++){o=this.geometry.bones[r];s=this.bones[r];if(o.parent===-1){this.add(s)}else{this.bones[o.parent].add(s)}}var l=this.bones.length;if(this.useVertexTexture){var c;if(l>256)c=64;else if(l>64)c=32;else if(l>16)c=16;else c=8;this.boneTextureWidth=c;this.boneTextureHeight=c;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new i.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,i.RGBAFormat,i.FloatType);this.boneTexture.minFilter=i.NearestFilter;this.boneTexture.magFilter=i.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*l)}this.pose()}};i.SkinnedMesh.prototype=Object.create(i.Mesh.prototype);i.SkinnedMesh.prototype.addBone=function(e){if(e===undefined){e=new i.Bone(this)}this.bones.push(e);return e};i.SkinnedMesh.prototype.updateMatrixWorld=function(){var e=new i.Matrix4;return function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;t=true}for(var n=0,r=this.children.length;n<r;n++){var s=this.children[n];if(s instanceof i.Bone){s.update(this.identityMatrix,false)}else{s.updateMatrixWorld(true)}}if(this.boneInverses==undefined){this.boneInverses=[];for(var o=0,u=this.bones.length;o<u;o++){var a=new i.Matrix4;a.getInverse(this.bones[o].skinMatrix);this.boneInverses.push(a)}}for(var o=0,u=this.bones.length;o<u;o++){e.multiplyMatrices(this.bones[o].skinMatrix,this.boneInverses[o]);e.flattenToArrayOffset(this.boneMatrices,o*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();i.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);this.normalizeSkinWeights()};i.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof i.Geometry){for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e];var n=1/t.lengthManhattan();if(n!==Infinity){t.multiplyScalar(n)}else{t.set(1)}}}else{}};i.SkinnedMesh.prototype.clone=function(e){if(e===undefined){e=new i.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}i.Mesh.prototype.clone.call(this,e);return e};i.MorphAnimMesh=function(e,t){i.Mesh.call(this,e,t);this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};i.MorphAnimMesh.prototype=Object.create(i.Mesh.prototype);i.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e;this.endKeyframe=t;this.length=this.endKeyframe-this.startKeyframe+1};i.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};i.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};i.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;if(!e.animations)e.animations={};var t,n=e.animations;var r=/([a-z]+)(\d+)/;for(var i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i];var u=o.name.match(r);if(u&&u.length>1){var a=u[1];var f=u[2];if(!n[a])n[a]={start:Infinity,end:-Infinity};var l=n[a];if(i<l.start)l.start=i;if(i>l.end)l.end=i;if(!t)t=a}}e.firstAnimation=t};i.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[e]={start:t,end:n}};i.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];if(n){this.setFrameRange(n.start,n.end);this.duration=1e3*((n.end-n.start)/t);this.time=0}else{console.warn("animation["+e+"] undefined")}};i.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var n=this.startKeyframe+i.Math.clamp(Math.floor(this.time/t),0,this.length-1);if(n!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[n]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=n}var r=this.time%t/t;if(this.directionBackwards){r=1-r}this.morphTargetInfluences[this.currentKeyframe]=r;this.morphTargetInfluences[this.lastKeyframe]=1-r};i.MorphAnimMesh.prototype.clone=function(e){if(e===undefined)e=new i.MorphAnimMesh(this.geometry,this.material);e.duration=this.duration;e.mirroredLoop=this.mirroredLoop;e.time=this.time;e.lastKeyframe=this.lastKeyframe;e.currentKeyframe=this.currentKeyframe;e.direction=this.direction;e.directionBackwards=this.directionBackwards;i.Mesh.prototype.clone.call(this,e);return e};i.LOD=function(){i.Object3D.call(this);this.objects=[]};i.LOD.prototype=Object.create(i.Object3D.prototype);i.LOD.prototype.addLevel=function(e,t){if(t===undefined)t=0;t=Math.abs(t);for(var n=0;n<this.objects.length;n++){if(t<this.objects[n].distance){break}}this.objects.splice(n,0,{distance:t,object:e});this.add(e)};i.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n;t++){if(e<this.objects[t].distance){break}}return this.objects[t-1].object};i.LOD.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;return function(n){if(this.objects.length>1){e.setFromMatrixPosition(n.matrixWorld);t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);this.objects[0].object.visible=true;for(var i=1,s=this.objects.length;i<s;i++){if(r>=this.objects[i].distance){this.objects[i-1].object.visible=false;this.objects[i].object.visible=true}else{break}}for(;i<s;i++){this.objects[i].object.visible=false}}}}();i.LOD.prototype.clone=function(e){if(e===undefined)e=new i.LOD;i.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;t<n;t++){var r=this.objects[t].object.clone();r.visible=t===0;e.addLevel(r,this.objects[t].distance)}return e};i.Sprite=function(){var e=new i.Geometry2(3);e.vertices.set([-.5,-.5,0,.5,-.5,0,.5,.5,0]);return function(t){i.Object3D.call(this);this.geometry=e;this.material=t!==undefined?t:new i.SpriteMaterial}}();i.Sprite.prototype=Object.create(i.Object3D.prototype);i.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true};i.Sprite.prototype.clone=function(e){if(e===undefined)e=new i.Sprite(this.material);i.Object3D.prototype.clone.call(this,e);return e};i.Particle=i.Sprite;i.Scene=function(){i.Object3D.call(this);this.fog=null;this.overrideMaterial=null;this.autoUpdate=true;this.matrixAutoUpdate=false;this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};i.Scene.prototype=Object.create(i.Object3D.prototype);i.Scene.prototype.__addObject=function(e){if(e instanceof i.Light){if(this.__lights.indexOf(e)===-1){this.__lights.push(e)}if(e.target&&e.target.parent===undefined){this.add(e.target)}}else if(!(e instanceof i.Camera||e instanceof i.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);if(t!==-1){this.__objectsRemoved.splice(t,1)}}this.dispatchEvent({type:"objectAdded",object:e});e.dispatchEvent({type:"addedToScene",scene:this});for(var n=0;n<e.children.length;n++){this.__addObject(e.children[n])}};i.Scene.prototype.__removeObject=function(e){if(e instanceof i.Light){var t=this.__lights.indexOf(e);if(t!==-1){this.__lights.splice(t,1)}if(e.shadowCascadeArray){for(var n=0;n<e.shadowCascadeArray.length;n++){this.__removeObject(e.shadowCascadeArray[n])}}}else if(!(e instanceof i.Camera)){this.__objectsRemoved.push(e);var t=this.__objectsAdded.indexOf(e);if(t!==-1){this.__objectsAdded.splice(t,1)}}this.dispatchEvent({type:"objectRemoved",object:e});e.dispatchEvent({type:"removedFromScene",scene:this});for(var r=0;r<e.children.length;r++){this.__removeObject(e.children[r])}};i.Scene.prototype.clone=function(e){if(e===undefined)e=new i.Scene;i.Object3D.prototype.clone.call(this,e);if(this.fog!==null)e.fog=this.fog.clone();if(this.overrideMaterial!==null)e.overrideMaterial=this.overrideMaterial.clone();e.autoUpdate=this.autoUpdate;e.matrixAutoUpdate=this.matrixAutoUpdate;return e};i.Fog=function(e,t,n){this.name="";this.color=new i.Color(e);this.near=t!==undefined?t:1;this.far=n!==undefined?n:1e3};i.Fog.prototype.clone=function(){return new i.Fog(this.color.getHex(),this.near,this.far)};i.FogExp2=function(e,t){this.name="";this.color=new i.Color(e);this.density=t!==undefined?t:25e-5};i.FogExp2.prototype.clone=function(){return new i.FogExp2(this.color.getHex(),this.density)};i.CanvasRenderer=function(e){function Ct(){pt.setRGB(0,0,0);dt.setRGB(0,0,0);vt.setRGB(0,0,0);for(var e=0,t=u.length;e<t;e++){var n=u[e];var r=n.color;if(n instanceof i.AmbientLight){pt.add(r)}else if(n instanceof i.DirectionalLight){dt.add(r)}else if(n instanceof i.PointLight){vt.add(r)}}}function kt(e,t,n){for(var r=0,s=u.length;r<s;r++){var o=u[r];Y.copy(o.color);if(o instanceof i.DirectionalLight){var a=mt.setFromMatrixPosition(o.matrixWorld).normalize();var f=t.dot(a);if(f<=0)continue;f*=o.intensity;n.add(Y.multiplyScalar(f))}else if(o instanceof i.PointLight){var a=mt.setFromMatrixPosition(o.matrixWorld);var f=t.dot(mt.subVectors(a,e).normalize());if(f<=0)continue;f*=o.distance==0?1:1-Math.min(e.distanceTo(a)/o.distance,1);if(f==0)continue;f*=o.intensity;n.add(Y.multiplyScalar(f))}}}function Lt(e,t,n){qt(n.opacity);Rt(n.blending);var r=t.scale.x*h;var s=t.scale.y*p;var o=.5*Math.sqrt(r*r+s*s);ht.min.set(e.x-o,e.y-o);ht.max.set(e.x+o,e.y+o);if(n instanceof i.SpriteMaterial||n instanceof i.ParticleSystemMaterial){var u=n.map;if(u!==null){if(u.hasEventListener("update",Pt)===false){if(u.image!==undefined&&u.image.width>0){Ht(u)}u.addEventListener("update",Pt)}var a=Z[u.id];if(a!==undefined){Vt(a)}else{Vt("rgba( 0, 0, 0, 1 )")}var f=u.image;var l=f.width*u.offset.x;var c=f.height*u.offset.y;var v=f.width*u.repeat.x;var m=f.height*u.repeat.y;var g=r/v;var y=s/m;d.save();d.translate(e.x,e.y);if(n.rotation!==0)d.rotate(n.rotation);d.translate(-r/2,-s/2);d.scale(g,y);d.translate(-l,-c);d.fillRect(l,c,v,m);d.restore()}else{Vt(n.color.getStyle());d.save();d.translate(e.x,e.y);if(n.rotation!==0)d.rotate(n.rotation);d.scale(r,-s);d.fillRect(-.5,-.5,1,1);d.restore()}}else if(n instanceof i.SpriteCanvasMaterial){Xt(n.color.getStyle());Vt(n.color.getStyle());d.save();d.translate(e.x,e.y);if(n.rotation!==0)d.rotate(n.rotation);d.scale(r,s);n.program(d);d.restore()}}function At(e,t,n,r){qt(r.opacity);Rt(r.blending);d.beginPath();d.moveTo(e.positionScreen.x,e.positionScreen.y);d.lineTo(t.positionScreen.x,t.positionScreen.y);if(r instanceof i.LineBasicMaterial){Ut(r.linewidth);zt(r.linecap);Wt(r.linejoin);if(r.vertexColors!==i.VertexColors){Xt(r.color.getStyle())}else{var s=n.vertexColors[0].getStyle();var o=n.vertexColors[1].getStyle();if(s===o){Xt(s)}else{try{var u=d.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);u.addColorStop(0,s);u.addColorStop(1,o)}catch(a){u=s}Xt(u)}}d.stroke();ht.expandByScalar(r.linewidth*2)}else if(r instanceof i.LineDashedMaterial){Ut(r.linewidth);zt(r.linecap);Wt(r.linejoin);Xt(r.color.getStyle());$t(r.dashSize,r.gapSize);d.stroke();ht.expandByScalar(r.linewidth*2);$t(null,null)}}function Ot(e,r,s,o,u,a,f,l){n.info.render.vertices+=3;n.info.render.faces++;qt(l.opacity);Rt(l.blending);D=e.positionScreen.x;P=e.positionScreen.y;H=r.positionScreen.x;B=r.positionScreen.y;j=s.positionScreen.x;F=s.positionScreen.y;Mt(D,P,H,B,j,F);if((l instanceof i.MeshLambertMaterial||l instanceof i.MeshPhongMaterial)&&l.map===null){Q.copy(l.color);G.copy(l.emissive);if(l.vertexColors===i.FaceColors){Q.multiply(f.color)}if(l.wireframe===false&&l.shading===i.SmoothShading&&f.vertexNormalsLength===3){V.copy(pt);$.copy(pt);J.copy(pt);kt(f.v1.positionWorld,f.vertexNormalsModel[0],V);kt(f.v2.positionWorld,f.vertexNormalsModel[1],$);kt(f.v3.positionWorld,f.vertexNormalsModel[2],J);V.multiply(Q).add(G);$.multiply(Q).add(G);J.multiply(Q).add(G);K.addColors($,J).multiplyScalar(.5);nt=Ft(V,$,J,K);jt(D,P,H,B,j,F,0,0,1,0,0,1,nt)}else{X.copy(pt);kt(f.centroidModel,f.normalModel,X);X.multiply(Q).add(G);l.wireframe===true?_t(X,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):Dt(X)}}else if(l instanceof i.MeshBasicMaterial||l instanceof i.MeshLambertMaterial||l instanceof i.MeshPhongMaterial){if(l.map!==null){if(l.map.mapping instanceof i.UVMapping){rt=f.uvs[0];Bt(D,P,H,B,j,F,rt[o].x,rt[o].y,rt[u].x,rt[u].y,rt[a].x,rt[a].y,l.map)}}else if(l.envMap!==null){if(l.envMap.mapping instanceof i.SphericalReflectionMapping){gt.copy(f.vertexNormalsModel[o]).applyMatrix3(yt);it=.5*gt.x+.5;st=.5*gt.y+.5;gt.copy(f.vertexNormalsModel[u]).applyMatrix3(yt);ot=.5*gt.x+.5;ut=.5*gt.y+.5;gt.copy(f.vertexNormalsModel[a]).applyMatrix3(yt);at=.5*gt.x+.5;ft=.5*gt.y+.5;Bt(D,P,H,B,j,F,it,st,ot,ut,at,ft,l.envMap)}}else{X.copy(l.color);if(l.vertexColors===i.FaceColors){X.multiply(f.color)}l.wireframe===true?_t(X,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):Dt(X)}}else if(l instanceof i.MeshDepthMaterial){et=C.near;tt=C.far;V.r=V.g=V.b=1-t(e.positionScreen.z*e.positionScreen.w,et,tt);$.r=$.g=$.b=1-t(r.positionScreen.z*r.positionScreen.w,et,tt);J.r=J.g=J.b=1-t(s.positionScreen.z*s.positionScreen.w,et,tt);K.addColors($,J).multiplyScalar(.5);nt=Ft(V,$,J,K);jt(D,P,H,B,j,F,0,0,1,0,0,1,nt)}else if(l instanceof i.MeshNormalMaterial){if(l.shading===i.FlatShading){gt.copy(f.normalModel).applyMatrix3(yt);X.setRGB(gt.x,gt.y,gt.z).multiplyScalar(.5).addScalar(.5);l.wireframe===true?_t(X,l.wireframeLinewidth,l.wireframeLinecap,l.wireframeLinejoin):Dt(X)}else if(l.shading===i.SmoothShading){gt.copy(f.vertexNormalsModel[o]).applyMatrix3(yt);V.setRGB(gt.x,gt.y,gt.z).multiplyScalar(.5).addScalar(.5);gt.copy(f.vertexNormalsModel[u]).applyMatrix3(yt);$.setRGB(gt.x,gt.y,gt.z).multiplyScalar(.5).addScalar(.5);gt.copy(f.vertexNormalsModel[a]).applyMatrix3(yt);J.setRGB(gt.x,gt.y,gt.z).multiplyScalar(.5).addScalar(.5);K.addColors($,J).multiplyScalar(.5);nt=Ft(V,$,J,K);jt(D,P,H,B,j,F,0,0,1,0,0,1,nt)}}}function Mt(e,t,n,r,i,s){d.beginPath();d.moveTo(e,t);d.lineTo(n,r);d.lineTo(i,s);d.closePath()}function _t(e,t,n,r){Ut(t);zt(n);Wt(r);Xt(e.getStyle());d.stroke();ht.expandByScalar(t*2)}function Dt(e){Vt(e.getStyle());d.fill()}function Pt(e){Ht(e.target)}function Ht(e){var t=e.wrapS===i.RepeatWrapping;var n=e.wrapT===i.RepeatWrapping;var r=e.image;var s=document.createElement("canvas");s.width=r.width;s.height=r.height;var o=s.getContext("2d");o.setTransform(1,0,0,-1,0,r.height);o.drawImage(r,0,0);Z[e.id]=d.createPattern(s,t===true&&n===true?"repeat":t===true&&n===false?"repeat-x":t===false&&n===true?"repeat-y":"no-repeat")}function Bt(e,t,n,r,s,o,u,a,f,l,c,h,p){if(p instanceof i.DataTexture)return;if(p.hasEventListener("update",Pt)===false){if(p.image!==undefined&&p.image.width>0){Ht(p)}p.addEventListener("update",Pt)}var v=Z[p.id];if(v!==undefined){Vt(v)}else{Vt("rgba(0,0,0,1)");d.fill();return}var m,g,y,b,w,E,S,x,T=p.offset.x/p.repeat.x,N=p.offset.y/p.repeat.y,C=p.image.width*p.repeat.x,k=p.image.height*p.repeat.y;u=(u+T)*C;a=(a+N)*k;f=(f+T)*C;l=(l+N)*k;c=(c+T)*C;h=(h+N)*k;n-=e;r-=t;s-=e;o-=t;f-=u;l-=a;c-=u;h-=a;S=f*h-c*l;if(S===0)return;x=1/S;m=(h*n-l*s)*x;g=(h*r-l*o)*x;y=(f*s-c*n)*x;b=(f*o-c*r)*x;w=e-m*u-y*a;E=t-g*u-b*a;d.save();d.transform(m,g,y,b,w,E);d.fill();d.restore()}function jt(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,v,m,g,y,b,w,E,S=h.width-1,x=h.height-1;o*=S;u*=x;a*=S;f*=x;l*=S;c*=x;n-=e;r-=t;i-=e;s-=t;a-=o;f-=u;l-=o;c-=u;w=a*c-l*f;E=1/w;p=(c*n-f*i)*E;v=(c*r-f*s)*E;m=(a*i-l*n)*E;g=(a*s-l*r)*E;y=e-p*o-m*u;b=t-v*o-g*u;d.save();d.transform(p,v,m,g,y,b);d.clip();d.drawImage(h,0,0);d.restore()}function Ft(e,t,n,r){St[0]=e.r*255|0;St[1]=e.g*255|0;St[2]=e.b*255|0;St[4]=t.r*255|0;St[5]=t.g*255|0;St[6]=t.b*255|0;St[8]=n.r*255|0;St[9]=n.g*255|0;St[10]=n.b*255|0;St[12]=r.r*255|0;St[13]=r.g*255|0;St[14]=r.b*255|0;wt.putImageData(Et,0,0);Tt.drawImage(bt,0,0);return xt}function It(e,t,n){var r=t.x-e.x,i=t.y-e.y,s=r*r+i*i,o;if(s===0)return;o=n/Math.sqrt(s);r*=o;i*=o;t.x+=r;t.y+=i;e.x-=r;e.y-=i}function qt(e){if(g!==e){d.globalAlpha=e;g=e}}function Rt(e){if(y!==e){if(e===i.NormalBlending){d.globalCompositeOperation="source-over"}else if(e===i.AdditiveBlending){d.globalCompositeOperation="lighter"}else if(e===i.SubtractiveBlending){d.globalCompositeOperation="darker"}y=e}}function Ut(e){if(E!==e){d.lineWidth=e;E=e}}function zt(e){if(S!==e){d.lineCap=e;S=e}}function Wt(e){if(x!==e){d.lineJoin=e;x=e}}function Xt(e){if(b!==e){d.strokeStyle=e;b=e}}function Vt(e){if(w!==e){d.fillStyle=e;w=e}}function $t(e,t){if(T!==e||N!==t){d.setLineDash([e,t]);T=e;N=t}}console.log("THREE.CanvasRenderer",i.REVISION);var t=i.Math.smoothstep;e=e||{};var n=this,s,o,u,a=new i.Projector,f=e.canvas!==undefined?e.canvas:document.createElement("canvas"),l=f.width,c=f.height,h=Math.floor(l/2),p=Math.floor(c/2),d=f.getContext("2d",{alpha:e.alpha===true}),v=new i.Color(0),m=0,g=1,y=0,b=null,w=null,E=null,S=null,x=null,T=null,N=0,C,k,L,A,O,M=new i.RenderableVertex,_=new i.RenderableVertex,D,P,H,B,j,F,I,q,R,U,z,W,X=new i.Color,V=new i.Color,$=new i.Color,J=new i.Color,K=new i.Color,Q=new i.Color,G=new i.Color,Y=new i.Color,Z={},et,tt,nt,rt,it,st,ot,ut,at,ft,lt=new i.Box2,ct=new i.Box2,ht=new i.Box2,pt=new i.Color,dt=new i.Color,vt=new i.Color,mt=new i.Vector3,gt=new i.Vector3,yt=new i.Matrix3,bt,wt,Et,St,xt,Tt,Nt=16;bt=document.createElement("canvas");bt.width=bt.height=2;wt=bt.getContext("2d");wt.fillStyle="rgba(0,0,0,1)";wt.fillRect(0,0,2,2);Et=wt.getImageData(0,0,2,2);St=Et.data;xt=document.createElement("canvas");xt.width=xt.height=Nt;Tt=xt.getContext("2d");Tt.translate(-Nt/2,-Nt/2);Tt.scale(Nt,Nt);Nt--;if(d.setLineDash===undefined){if(d.mozDash!==undefined){d.setLineDash=function(e){d.mozDash=e[0]!==null?e:null}}else{d.setLineDash=function(){}}}this.domElement=f;this.devicePixelRatio=e.devicePixelRatio!==undefined?e.devicePixelRatio:r.devicePixelRatio!==undefined?r.devicePixelRatio:1;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setSize=function(e,t,n){l=e*this.devicePixelRatio;c=t*this.devicePixelRatio;h=Math.floor(l/2);p=Math.floor(c/2);f.width=l;f.height=c;if(this.devicePixelRatio!==1&&n!==false){f.style.width=e+"px";f.style.height=t+"px"}lt.min.set(-h,-p),lt.max.set(h,p);ct.min.set(-h,-p);ct.max.set(h,p);g=1;y=0;b=null;w=null;E=null;S=null;x=null};this.setClearColor=function(e,t){v.set(e);m=t!==undefined?t:1;ct.min.set(-h,-p);ct.max.set(h,p)};this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(e,t)};this.getMaxAnisotropy=function(){return 0};this.clear=function(){d.setTransform(1,0,0,-1,h,p);if(ct.empty()===false){ct.intersect(lt);ct.expandByScalar(2);if(m<1){d.clearRect(ct.min.x|0,ct.min.y|0,ct.max.x-ct.min.x|0,ct.max.y-ct.min.y|0)}if(m>0){Rt(i.NormalBlending);qt(1);Vt("rgba("+Math.floor(v.r*255)+","+Math.floor(v.g*255)+","+Math.floor(v.b*255)+","+m+")");d.fillRect(ct.min.x|0,ct.min.y|0,ct.max.x-ct.min.x|0,ct.max.y-ct.min.y|0)}ct.makeEmpty()}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(e,t){if(t instanceof i.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}if(this.autoClear===true)this.clear();d.setTransform(1,0,0,-1,h,p);n.info.render.vertices=0;n.info.render.faces=0;s=a.projectScene(e,t,this.sortObjects,this.sortElements);o=s.elements;u=s.lights;C=t;yt.getNormalMatrix(t.matrixWorldInverse);Ct();for(var r=0,f=o.length;r<f;r++){var l=o[r];var c=l.material;if(c===undefined||c.visible===false)continue;ht.makeEmpty();if(l instanceof i.RenderableSprite){k=l;k.x*=h;k.y*=p;Lt(k,l,c)}else if(l instanceof i.RenderableLine){k=l.v1;L=l.v2;k.positionScreen.x*=h;k.positionScreen.y*=p;L.positionScreen.x*=h;L.positionScreen.y*=p;ht.setFromPoints([k.positionScreen,L.positionScreen]);if(lt.isIntersectionBox(ht)===true){At(k,L,l,c)}}else if(l instanceof i.RenderableFace){k=l.v1;L=l.v2;A=l.v3;if(k.positionScreen.z<-1||k.positionScreen.z>1)continue;if(L.positionScreen.z<-1||L.positionScreen.z>1)continue;if(A.positionScreen.z<-1||A.positionScreen.z>1)continue;k.positionScreen.x*=h;k.positionScreen.y*=p;L.positionScreen.x*=h;L.positionScreen.y*=p;A.positionScreen.x*=h;A.positionScreen.y*=p;if(c.overdraw>0){It(k.positionScreen,L.positionScreen,c.overdraw);It(L.positionScreen,A.positionScreen,c.overdraw);It(A.positionScreen,k.positionScreen,c.overdraw)}ht.setFromPoints([k.positionScreen,L.positionScreen,A.positionScreen]);if(lt.isIntersectionBox(ht)===true){Ot(k,L,A,0,1,2,l,c)}}ct.union(ht)}d.setTransform(1,0,0,1,0,0)}};i.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","mat4 boneMatZ = getBoneMatrix( skinIndex.z );","mat4 boneMatW = getBoneMatrix( skinIndex.w );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned      += boneMatY * skinVertex * skinWeight.y;","skinned      += boneMatZ * skinVertex * skinWeight.z;","skinned      += boneMatW * skinVertex * skinWeight.w;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix   += skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")};i.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(n in r){i[n]=r[n]}}return i},clone:function(e){var t,n,r,s,o={};for(t in e){o[t]={};for(n in e[t]){s=e[t][n];if(s instanceof i.Color||s instanceof i.Vector2||s instanceof i.Vector3||s instanceof i.Vector4||s instanceof i.Matrix4||s instanceof i.Texture){o[t][n]=s.clone()}else if(s instanceof Array){o[t][n]=s.slice()}else{o[t][n]=s}}}return o}};i.UniformsLib={common:{diffuse:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new i.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new i.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new i.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new i.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};i.ShaderLib={basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],i.UniformsLib["shadowmap"]]),vertexShader:[i.ShaderChunk["map_pars_vertex"],i.ShaderChunk["lightmap_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],"void main() {",i.ShaderChunk["map_vertex"],i.ShaderChunk["lightmap_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["skinbase_vertex"],"#ifdef USE_ENVMAP",i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],"#endif",i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["default_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["lightmap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( diffuse, opacity );",i.ShaderChunk["map_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["lightmap_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},lambert:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{ambient:{type:"c",value:new i.Color(16777215)},emissive:{type:"c",value:new i.Color(0)},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",i.ShaderChunk["map_pars_vertex"],i.ShaderChunk["lightmap_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["lights_lambert_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],"void main() {",i.ShaderChunk["map_vertex"],i.ShaderChunk["lightmap_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["default_vertex"],i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["lights_lambert_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["lightmap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",i.ShaderChunk["map_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",i.ShaderChunk["lightmap_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},phong:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["bump"],i.UniformsLib["normalmap"],i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{ambient:{type:"c",value:new i.Color(16777215)},emissive:{type:"c",value:new i.Color(0)},specular:{type:"c",value:new i.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",i.ShaderChunk["map_pars_vertex"],i.ShaderChunk["lightmap_pars_vertex"],i.ShaderChunk["envmap_pars_vertex"],i.ShaderChunk["lights_phong_pars_vertex"],i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],"void main() {",i.ShaderChunk["map_vertex"],i.ShaderChunk["lightmap_vertex"],i.ShaderChunk["color_vertex"],i.ShaderChunk["morphnormal_vertex"],i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],i.ShaderChunk["defaultnormal_vertex"],"vNormal = normalize( transformedNormal );",i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["default_vertex"],"vViewPosition = -mvPosition.xyz;",i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["envmap_vertex"],i.ShaderChunk["lights_phong_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_pars_fragment"],i.ShaderChunk["lightmap_pars_fragment"],i.ShaderChunk["envmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["lights_phong_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["bumpmap_pars_fragment"],i.ShaderChunk["normalmap_pars_fragment"],i.ShaderChunk["specularmap_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",i.ShaderChunk["map_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["specularmap_fragment"],i.ShaderChunk["lights_phong_fragment"],i.ShaderChunk["lightmap_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["envmap_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},particle_basic:{uniforms:i.UniformsUtils.merge([i.UniformsLib["particle"],i.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",i.ShaderChunk["color_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],"void main() {",i.ShaderChunk["color_vertex"],"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",i.ShaderChunk["worldpos_vertex"],i.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["map_particle_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],i.ShaderChunk["shadowmap_pars_fragment"],"void main() {","gl_FragColor = vec4( psColor, opacity );",i.ShaderChunk["map_particle_fragment"],i.ShaderChunk["alphatest_fragment"],i.ShaderChunk["color_fragment"],i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},dashed:{uniforms:i.UniformsUtils.merge([i.UniformsLib["common"],i.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",i.ShaderChunk["color_pars_vertex"],"void main() {",i.ShaderChunk["color_vertex"],"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",i.ShaderChunk["color_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",i.ShaderChunk["color_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",i.ShaderChunk["morphtarget_pars_vertex"],"void main() {","vNormal = normalize( normalMatrix * normal );",i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["default_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:i.UniformsUtils.merge([i.UniformsLib["fog"],i.UniformsLib["lights"],i.UniformsLib["shadowmap"],{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new i.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new i.Color(16777215)},specular:{type:"c",value:new i.Color(1118481)},ambient:{type:"c",value:new i.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new i.Vector2(0,0)},uRepeat:{type:"v2",value:new i.Vector2(1,1)},wrapRGB:{type:"v3",value:new i.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",i.ShaderChunk["shadowmap_pars_fragment"],i.ShaderChunk["fog_pars_fragment"],"void main() {","gl_FragColor = vec4( vec3( 1.0 ), opacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","}",i.ShaderChunk["shadowmap_fragment"],i.ShaderChunk["linear_to_gamma_fragment"],i.ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",i.ShaderChunk["skinning_pars_vertex"],i.ShaderChunk["shadowmap_pars_vertex"],"void main() {",i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["skinnormal_vertex"],"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned      += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned    += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[i.ShaderChunk["morphtarget_pars_vertex"],i.ShaderChunk["skinning_pars_vertex"],"void main() {",i.ShaderChunk["skinbase_vertex"],i.ShaderChunk["morphtarget_vertex"],i.ShaderChunk["skinning_vertex"],i.ShaderChunk["default_vertex"],"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}};i.WebGLRenderer=function(e){function xt(e){e.__webglVertexBuffer=K.createBuffer();e.__webglColorBuffer=K.createBuffer();d.info.memory.geometries++}function Tt(e){e.__webglVertexBuffer=K.createBuffer();e.__webglColorBuffer=K.createBuffer();e.__webglLineDistanceBuffer=K.createBuffer();d.info.memory.geometries++}function Nt(e){e.__webglVertexBuffer=K.createBuffer();e.__webglNormalBuffer=K.createBuffer();e.__webglTangentBuffer=K.createBuffer();e.__webglColorBuffer=K.createBuffer();e.__webglUVBuffer=K.createBuffer();e.__webglUV2Buffer=K.createBuffer();e.__webglSkinIndicesBuffer=K.createBuffer();e.__webglSkinWeightsBuffer=K.createBuffer();e.__webglFaceBuffer=K.createBuffer();e.__webglLineBuffer=K.createBuffer();var t,n;if(e.numMorphTargets){e.__webglMorphTargetsBuffers=[];for(t=0,n=e.numMorphTargets;t<n;t++){e.__webglMorphTargetsBuffers.push(K.createBuffer())}}if(e.numMorphNormals){e.__webglMorphNormalsBuffers=[];for(t=0,n=e.numMorphNormals;t<n;t++){e.__webglMorphNormalsBuffers.push(K.createBuffer())}}d.info.memory.geometries++}function Ht(e,t){var n=e.vertices.length;var r=t.material;if(r.attributes){if(e.__webglCustomAttributesList===undefined){e.__webglCustomAttributesList=[]}for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=true;var o=1;if(s.type==="v2")o=2;else if(s.type==="v3")o=3;else if(s.type==="v4")o=4;else if(s.type==="c")o=3;s.size=o;s.array=new Float32Array(n*o);s.buffer=K.createBuffer();s.buffer.belongsToAttribute=i;s.needsUpdate=true}e.__webglCustomAttributesList.push(s)}}}function Bt(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__sortArray=[];e.__webglParticleCount=n;Ht(e,t)}function jt(e,t){var n=e.vertices.length;e.__vertexArray=new Float32Array(n*3);e.__colorArray=new Float32Array(n*3);e.__lineDistanceArray=new Float32Array(n*1);e.__webglLineCount=n;Ht(e,t)}function Ft(e,t){var n=t.geometry,r=e.faces3,i=r.length*3,s=r.length*1,o=r.length*3,u=It(t,e),a=zt(u),f=Rt(u),l=Ut(u);e.__vertexArray=new Float32Array(i*3);if(f){e.__normalArray=new Float32Array(i*3)}if(n.hasTangents){e.__tangentArray=new Float32Array(i*4)}if(l){e.__colorArray=new Float32Array(i*3)}if(a){if(n.faceVertexUvs.length>0){e.__uvArray=new Float32Array(i*2)}if(n.faceVertexUvs.length>1){e.__uv2Array=new Float32Array(i*2)}}if(t.geometry.skinWeights.length&&t.geometry.skinIndices.length){e.__skinIndexArray=new Float32Array(i*4);e.__skinWeightArray=new Float32Array(i*4)}e.__faceArray=new Uint16Array(s*3);e.__lineArray=new Uint16Array(o*2);var c,h;if(e.numMorphTargets){e.__morphTargetsArrays=[];for(c=0,h=e.numMorphTargets;c<h;c++){e.__morphTargetsArrays.push(new Float32Array(i*3))}}if(e.numMorphNormals){e.__morphNormalsArrays=[];for(c=0,h=e.numMorphNormals;c<h;c++){e.__morphNormalsArrays.push(new Float32Array(i*3))}}e.__webglFaceCount=s*3;e.__webglLineCount=o*2;if(u.attributes){if(e.__webglCustomAttributesList===undefined){e.__webglCustomAttributesList=[]}for(var p in u.attributes){var d=u.attributes[p];var v={};for(var m in d){v[m]=d[m]}if(!v.__webglInitialized||v.createUniqueBuffers){v.__webglInitialized=true;var g=1;if(v.type==="v2")g=2;else if(v.type==="v3")g=3;else if(v.type==="v4")g=4;else if(v.type==="c")g=3;v.size=g;v.array=new Float32Array(i*g);v.buffer=K.createBuffer();v.buffer.belongsToAttribute=p;d.needsUpdate=true;v.__original=d}e.__webglCustomAttributesList.push(v)}}e.__inittedArrays=true}function It(e,t){return e.material instanceof i.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function qt(e){return e&&e.shading!==undefined&&e.shading===i.SmoothShading}function Rt(e){if(e instanceof i.MeshBasicMaterial&&!e.envMap||e instanceof i.MeshDepthMaterial){return false}if(qt(e)){return i.SmoothShading}else{return i.FlatShading}}function Ut(e){if(e.vertexColors){return e.vertexColors}return false}function zt(e){if(e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof i.ShaderMaterial){return true}return false}function Wt(e){var t,n,r;for(t in e.attributes){if(t==="index"){r=K.ELEMENT_ARRAY_BUFFER}else{r=K.ARRAY_BUFFER}n=e.attributes[t];n.buffer=K.createBuffer();K.bindBuffer(r,n.buffer);K.bufferData(r,n.array,K.STATIC_DRAW)}}function Xt(e,t,n){var r,i,s,o,u,a,f=e.vertices,l=f.length,c=e.colors,h=c.length,p=e.__vertexArray,d=e.__colorArray,v=e.__sortArray,m=e.verticesNeedUpdate,g=e.elementsNeedUpdate,y=e.colorsNeedUpdate,b=e.__webglCustomAttributesList,w,E,S,x,T,N,C;if(n.sortParticles){W.copy(z);W.multiply(n.matrixWorld);for(r=0;r<l;r++){s=f[r];X.copy(s);X.applyProjection(W);v[r]=[X.z,r]}v.sort(en);for(r=0;r<l;r++){s=f[v[r][1]];o=r*3;p[o]=s.x;p[o+1]=s.y;p[o+2]=s.z}for(i=0;i<h;i++){o=i*3;a=c[v[i][1]];d[o]=a.r;d[o+1]=a.g;d[o+2]=a.b}if(b){for(w=0,E=b.length;w<E;w++){C=b[w];if(!(C.boundTo===undefined||C.boundTo==="vertices"))continue;o=0;T=C.value.length;if(C.size===1){for(x=0;x<T;x++){u=v[x][1];C.array[x]=C.value[u]}}else if(C.size===2){for(x=0;x<T;x++){u=v[x][1];N=C.value[u];C.array[o]=N.x;C.array[o+1]=N.y;o+=2}}else if(C.size===3){if(C.type==="c"){for(x=0;x<T;x++){u=v[x][1];N=C.value[u];C.array[o]=N.r;C.array[o+1]=N.g;C.array[o+2]=N.b;o+=3}}else{for(x=0;x<T;x++){u=v[x][1];N=C.value[u];C.array[o]=N.x;C.array[o+1]=N.y;C.array[o+2]=N.z;o+=3}}}else if(C.size===4){for(x=0;x<T;x++){u=v[x][1];N=C.value[u];C.array[o]=N.x;C.array[o+1]=N.y;C.array[o+2]=N.z;C.array[o+3]=N.w;o+=4}}}}}else{if(m){for(r=0;r<l;r++){s=f[r];o=r*3;p[o]=s.x;p[o+1]=s.y;p[o+2]=s.z}}if(y){for(i=0;i<h;i++){a=c[i];o=i*3;d[o]=a.r;d[o+1]=a.g;d[o+2]=a.b}}if(b){for(w=0,E=b.length;w<E;w++){C=b[w];if(C.needsUpdate&&(C.boundTo===undefined||C.boundTo==="vertices")){T=C.value.length;o=0;if(C.size===1){for(x=0;x<T;x++){C.array[x]=C.value[x]}}else if(C.size===2){for(x=0;x<T;x++){N=C.value[x];C.array[o]=N.x;C.array[o+1]=N.y;o+=2}}else if(C.size===3){if(C.type==="c"){for(x=0;x<T;x++){N=C.value[x];C.array[o]=N.r;C.array[o+1]=N.g;C.array[o+2]=N.b;o+=3}}else{for(x=0;x<T;x++){N=C.value[x];C.array[o]=N.x;C.array[o+1]=N.y;C.array[o+2]=N.z;o+=3}}}else if(C.size===4){for(x=0;x<T;x++){N=C.value[x];C.array[o]=N.x;C.array[o+1]=N.y;C.array[o+2]=N.z;C.array[o+3]=N.w;o+=4}}}}}}if(m||n.sortParticles){K.bindBuffer(K.ARRAY_BUFFER,e.__webglVertexBuffer);K.bufferData(K.ARRAY_BUFFER,p,t)}if(y||n.sortParticles){K.bindBuffer(K.ARRAY_BUFFER,e.__webglColorBuffer);K.bufferData(K.ARRAY_BUFFER,d,t)}if(b){for(w=0,E=b.length;w<E;w++){C=b[w];if(C.needsUpdate||n.sortParticles){K.bindBuffer(K.ARRAY_BUFFER,C.buffer);K.bufferData(K.ARRAY_BUFFER,C.array,t)}}}}function Vt(e,t){var n,r,i,s,o,u,a=e.vertices,f=e.colors,l=e.lineDistances,c=a.length,h=f.length,p=l.length,d=e.__vertexArray,v=e.__colorArray,m=e.__lineDistanceArray,g=e.verticesNeedUpdate,y=e.colorsNeedUpdate,b=e.lineDistancesNeedUpdate,w=e.__webglCustomAttributesList,E,S,x,T,N,C,k;if(g){for(n=0;n<c;n++){s=a[n];o=n*3;d[o]=s.x;d[o+1]=s.y;d[o+2]=s.z}K.bindBuffer(K.ARRAY_BUFFER,e.__webglVertexBuffer);K.bufferData(K.ARRAY_BUFFER,d,t)}if(y){for(r=0;r<h;r++){u=f[r];o=r*3;v[o]=u.r;v[o+1]=u.g;v[o+2]=u.b}K.bindBuffer(K.ARRAY_BUFFER,e.__webglColorBuffer);K.bufferData(K.ARRAY_BUFFER,v,t)}if(b){for(i=0;i<p;i++){m[i]=l[i]}K.bindBuffer(K.ARRAY_BUFFER,e.__webglLineDistanceBuffer);K.bufferData(K.ARRAY_BUFFER,m,t)}if(w){for(E=0,S=w.length;E<S;E++){k=w[E];if(k.needsUpdate&&(k.boundTo===undefined||k.boundTo==="vertices")){o=0;N=k.value.length;if(k.size===1){for(T=0;T<N;T++){k.array[T]=k.value[T]}}else if(k.size===2){for(T=0;T<N;T++){C=k.value[T];k.array[o]=C.x;k.array[o+1]=C.y;o+=2}}else if(k.size===3){if(k.type==="c"){for(T=0;T<N;T++){C=k.value[T];k.array[o]=C.r;k.array[o+1]=C.g;k.array[o+2]=C.b;o+=3}}else{for(T=0;T<N;T++){C=k.value[T];k.array[o]=C.x;k.array[o+1]=C.y;k.array[o+2]=C.z;o+=3}}}else if(k.size===4){for(T=0;T<N;T++){C=k.value[T];k.array[o]=C.x;k.array[o+1]=C.y;k.array[o+2]=C.z;k.array[o+3]=C.w;o+=4}}K.bindBuffer(K.ARRAY_BUFFER,k.buffer);K.bufferData(K.ARRAY_BUFFER,k.array,t)}}}}function $t(e,t,n,r,s){if(!e.__inittedArrays){return}var o=Rt(s),u=Ut(s),a=zt(s),f=o===i.SmoothShading;var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt=0,mt=0,gt=0,yt=0,bt=0,wt=0,Et=0,St=0,xt=0,Tt=0,Nt=0,Ct=0,kt=0,Lt,At=e.__vertexArray,Ot=e.__uvArray,Mt=e.__uv2Array,_t=e.__normalArray,Dt=e.__tangentArray,Pt=e.__colorArray,Ht=e.__skinIndexArray,Bt=e.__skinWeightArray,jt=e.__morphTargetsArrays,Ft=e.__morphNormalsArrays,It=e.__webglCustomAttributesList,qt,Wt=e.__faceArray,Xt=e.__lineArray,Vt=t.geometry,$t=Vt.verticesNeedUpdate,Jt=Vt.elementsNeedUpdate,Kt=Vt.uvsNeedUpdate,Qt=Vt.normalsNeedUpdate,Gt=Vt.tangentsNeedUpdate,Yt=Vt.colorsNeedUpdate,Zt=Vt.morphTargetsNeedUpdate,en=Vt.vertices,tn=e.faces3,nn=Vt.faces,rn=Vt.faceVertexUvs[0],sn=Vt.faceVertexUvs[1],on=Vt.colors,un=Vt.skinIndices,an=Vt.skinWeights,fn=Vt.morphTargets,ln=Vt.morphNormals;if($t){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];S=en[p.a];x=en[p.b];T=en[p.c];At[mt]=S.x;At[mt+1]=S.y;At[mt+2]=S.z;At[mt+3]=x.x;At[mt+4]=x.y;At[mt+5]=x.z;At[mt+6]=T.x;At[mt+7]=T.y;At[mt+8]=T.z;mt+=9}K.bindBuffer(K.ARRAY_BUFFER,e.__webglVertexBuffer);K.bufferData(K.ARRAY_BUFFER,At,n)}if(Zt){for(at=0,ft=fn.length;at<ft;at++){Nt=0;for(l=0,c=tn.length;l<c;l++){ht=tn[l];p=nn[ht];S=fn[at].vertices[p.a];x=fn[at].vertices[p.b];T=fn[at].vertices[p.c];lt=jt[at];lt[Nt]=S.x;lt[Nt+1]=S.y;lt[Nt+2]=S.z;lt[Nt+3]=x.x;lt[Nt+4]=x.y;lt[Nt+5]=x.z;lt[Nt+6]=T.x;lt[Nt+7]=T.y;lt[Nt+8]=T.z;if(s.morphNormals){if(f){pt=ln[at].vertexNormals[ht];O=pt.a;M=pt.b;_=pt.c}else{O=ln[at].faceNormals[ht];M=O;_=O}ct=Ft[at];ct[Nt]=O.x;ct[Nt+1]=O.y;ct[Nt+2]=O.z;ct[Nt+3]=M.x;ct[Nt+4]=M.y;ct[Nt+5]=M.z;ct[Nt+6]=_.x;ct[Nt+7]=_.y;ct[Nt+8]=_.z}Nt+=9}K.bindBuffer(K.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[at]);K.bufferData(K.ARRAY_BUFFER,jt[at],n);if(s.morphNormals){K.bindBuffer(K.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[at]);K.bufferData(K.ARRAY_BUFFER,Ft[at],n)}}}if(an.length){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];F=an[p.a];I=an[p.b];q=an[p.c];Bt[Tt]=F.x;Bt[Tt+1]=F.y;Bt[Tt+2]=F.z;Bt[Tt+3]=F.w;Bt[Tt+4]=I.x;Bt[Tt+5]=I.y;Bt[Tt+6]=I.z;Bt[Tt+7]=I.w;Bt[Tt+8]=q.x;Bt[Tt+9]=q.y;Bt[Tt+10]=q.z;Bt[Tt+11]=q.w;U=un[p.a];z=un[p.b];W=un[p.c];Ht[Tt]=U.x;Ht[Tt+1]=U.y;Ht[Tt+2]=U.z;Ht[Tt+3]=U.w;Ht[Tt+4]=z.x;Ht[Tt+5]=z.y;Ht[Tt+6]=z.z;Ht[Tt+7]=z.w;Ht[Tt+8]=W.x;Ht[Tt+9]=W.y;Ht[Tt+10]=W.z;Ht[Tt+11]=W.w;Tt+=12}if(Tt>0){K.bindBuffer(K.ARRAY_BUFFER,e.__webglSkinIndicesBuffer);K.bufferData(K.ARRAY_BUFFER,Ht,n);K.bindBuffer(K.ARRAY_BUFFER,e.__webglSkinWeightsBuffer);K.bufferData(K.ARRAY_BUFFER,Bt,n)}}if(Yt&&u){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];g=p.vertexColors;y=p.color;if(g.length===3&&u===i.VertexColors){P=g[0];H=g[1];B=g[2]}else{P=y;H=y;B=y}Pt[xt]=P.r;Pt[xt+1]=P.g;Pt[xt+2]=P.b;Pt[xt+3]=H.r;Pt[xt+4]=H.g;Pt[xt+5]=H.b;Pt[xt+6]=B.r;Pt[xt+7]=B.g;Pt[xt+8]=B.b;xt+=9}if(xt>0){K.bindBuffer(K.ARRAY_BUFFER,e.__webglColorBuffer);K.bufferData(K.ARRAY_BUFFER,Pt,n)}}if(Gt&&Vt.hasTangents){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];b=p.vertexTangents;C=b[0];k=b[1];L=b[2];Dt[Et]=C.x;Dt[Et+1]=C.y;Dt[Et+2]=C.z;Dt[Et+3]=C.w;Dt[Et+4]=k.x;Dt[Et+5]=k.y;Dt[Et+6]=k.z;Dt[Et+7]=k.w;Dt[Et+8]=L.x;Dt[Et+9]=L.y;Dt[Et+10]=L.z;Dt[Et+11]=L.w;Et+=12}K.bindBuffer(K.ARRAY_BUFFER,e.__webglTangentBuffer);K.bufferData(K.ARRAY_BUFFER,Dt,n)}if(Qt&&o){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];d=p.vertexNormals;v=p.normal;if(d.length===3&&f){for(rt=0;rt<3;rt++){st=d[rt];_t[wt]=st.x;_t[wt+1]=st.y;_t[wt+2]=st.z;wt+=3}}else{for(rt=0;rt<3;rt++){_t[wt]=v.x;_t[wt+1]=v.y;_t[wt+2]=v.z;wt+=3}}}K.bindBuffer(K.ARRAY_BUFFER,e.__webglNormalBuffer);K.bufferData(K.ARRAY_BUFFER,_t,n)}if(Kt&&rn&&a){for(l=0,c=tn.length;l<c;l++){h=tn[l];w=rn[h];if(w===undefined)continue;for(rt=0;rt<3;rt++){ot=w[rt];Ot[gt]=ot.x;Ot[gt+1]=ot.y;gt+=2}}if(gt>0){K.bindBuffer(K.ARRAY_BUFFER,e.__webglUVBuffer);K.bufferData(K.ARRAY_BUFFER,Ot,n)}}if(Kt&&sn&&a){for(l=0,c=tn.length;l<c;l++){h=tn[l];E=sn[h];if(E===undefined)continue;for(rt=0;rt<3;rt++){ut=E[rt];Mt[yt]=ut.x;Mt[yt+1]=ut.y;yt+=2}}if(yt>0){K.bindBuffer(K.ARRAY_BUFFER,e.__webglUV2Buffer);K.bufferData(K.ARRAY_BUFFER,Mt,n)}}if(Jt){for(l=0,c=tn.length;l<c;l++){Wt[bt]=vt;Wt[bt+1]=vt+1;Wt[bt+2]=vt+2;bt+=3;Xt[St]=vt;Xt[St+1]=vt+1;Xt[St+2]=vt;Xt[St+3]=vt+2;Xt[St+4]=vt+1;Xt[St+5]=vt+2;St+=6;vt+=3}K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer);K.bufferData(K.ELEMENT_ARRAY_BUFFER,Wt,n);K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer);K.bufferData(K.ELEMENT_ARRAY_BUFFER,Xt,n)}if(It){for(rt=0,it=It.length;rt<it;rt++){qt=It[rt];if(!qt.__original.needsUpdate)continue;Ct=0;kt=0;if(qt.size===1){if(qt.boundTo===undefined||qt.boundTo==="vertices"){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];qt.array[Ct]=qt.value[p.a];qt.array[Ct+1]=qt.value[p.b];qt.array[Ct+2]=qt.value[p.c];Ct+=3}}else if(qt.boundTo==="faces"){for(l=0,c=tn.length;l<c;l++){Lt=qt.value[tn[l]];qt.array[Ct]=Lt;qt.array[Ct+1]=Lt;qt.array[Ct+2]=Lt;Ct+=3}}}else if(qt.size===2){if(qt.boundTo===undefined||qt.boundTo==="vertices"){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];S=qt.value[p.a];x=qt.value[p.b];T=qt.value[p.c];qt.array[Ct]=S.x;qt.array[Ct+1]=S.y;qt.array[Ct+2]=x.x;qt.array[Ct+3]=x.y;qt.array[Ct+4]=T.x;qt.array[Ct+5]=T.y;Ct+=6}}else if(qt.boundTo==="faces"){for(l=0,c=tn.length;l<c;l++){Lt=qt.value[tn[l]];S=Lt;x=Lt;T=Lt;qt.array[Ct]=S.x;qt.array[Ct+1]=S.y;qt.array[Ct+2]=x.x;qt.array[Ct+3]=x.y;qt.array[Ct+4]=T.x;qt.array[Ct+5]=T.y;Ct+=6}}}else if(qt.size===3){var cn;if(qt.type==="c"){cn=["r","g","b"]}else{cn=["x","y","z"]}if(qt.boundTo===undefined||qt.boundTo==="vertices"){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];S=qt.value[p.a];x=qt.value[p.b];T=qt.value[p.c];qt.array[Ct]=S[cn[0]];qt.array[Ct+1]=S[cn[1]];qt.array[Ct+2]=S[cn[2]];qt.array[Ct+3]=x[cn[0]];qt.array[Ct+4]=x[cn[1]];qt.array[Ct+5]=x[cn[2]];qt.array[Ct+6]=T[cn[0]];qt.array[Ct+7]=T[cn[1]];qt.array[Ct+8]=T[cn[2]];Ct+=9}}else if(qt.boundTo==="faces"){for(l=0,c=tn.length;l<c;l++){Lt=qt.value[tn[l]];S=Lt;x=Lt;T=Lt;qt.array[Ct]=S[cn[0]];qt.array[Ct+1]=S[cn[1]];qt.array[Ct+2]=S[cn[2]];qt.array[Ct+3]=x[cn[0]];qt.array[Ct+4]=x[cn[1]];qt.array[Ct+5]=x[cn[2]];qt.array[Ct+6]=T[cn[0]];qt.array[Ct+7]=T[cn[1]];qt.array[Ct+8]=T[cn[2]];Ct+=9}}else if(qt.boundTo==="faceVertices"){for(l=0,c=tn.length;l<c;l++){Lt=qt.value[tn[l]];S=Lt[0];x=Lt[1];T=Lt[2];qt.array[Ct]=S[cn[0]];qt.array[Ct+1]=S[cn[1]];qt.array[Ct+2]=S[cn[2]];qt.array[Ct+3]=x[cn[0]];qt.array[Ct+4]=x[cn[1]];qt.array[Ct+5]=x[cn[2]];qt.array[Ct+6]=T[cn[0]];qt.array[Ct+7]=T[cn[1]];qt.array[Ct+8]=T[cn[2]];Ct+=9}}}else if(qt.size===4){if(qt.boundTo===undefined||qt.boundTo==="vertices"){for(l=0,c=tn.length;l<c;l++){p=nn[tn[l]];S=qt.value[p.a];x=qt.value[p.b];T=qt.value[p.c];qt.array[Ct]=S.x;qt.array[Ct+1]=S.y;qt.array[Ct+2]=S.z;qt.array[Ct+3]=S.w;qt.array[Ct+4]=x.x;qt.array[Ct+5]=x.y;qt.array[Ct+6]=x.z;qt.array[Ct+7]=x.w;qt.array[Ct+8]=T.x;qt.array[Ct+9]=T.y;qt.array[Ct+10]=T.z;qt.array[Ct+11]=T.w;Ct+=12}}else if(qt.boundTo==="faces"){for(l=0,c=tn.length;l<c;l++){Lt=qt.value[tn[l]];S=Lt;x=Lt;T=Lt;qt.array[Ct]=S.x;qt.array[Ct+1]=S.y;qt.array[Ct+2]=S.z;qt.array[Ct+3]=S.w;qt.array[Ct+4]=x.x;qt.array[Ct+5]=x.y;qt.array[Ct+6]=x.z;qt.array[Ct+7]=x.w;qt.array[Ct+8]=T.x;qt.array[Ct+9]=T.y;qt.array[Ct+10]=T.z;qt.array[Ct+11]=T.w;Ct+=12}}else if(qt.boundTo==="faceVertices"){for(l=0,c=tn.length;l<c;l++){Lt=qt.value[tn[l]];S=Lt[0];x=Lt[1];T=Lt[2];qt.array[Ct]=S.x;qt.array[Ct+1]=S.y;qt.array[Ct+2]=S.z;qt.array[Ct+3]=S.w;qt.array[Ct+4]=x.x;qt.array[Ct+5]=x.y;qt.array[Ct+6]=x.z;qt.array[Ct+7]=x.w;qt.array[Ct+8]=T.x;qt.array[Ct+9]=T.y;qt.array[Ct+10]=T.z;qt.array[Ct+11]=T.w;Ct+=12}}}K.bindBuffer(K.ARRAY_BUFFER,qt.buffer);K.bufferData(K.ARRAY_BUFFER,qt.array,n)}}if(r){delete e.__inittedArrays;delete e.__colorArray;delete e.__normalArray;delete e.__tangentArray;delete e.__uvArray;delete e.__uv2Array;delete e.__faceArray;delete e.__vertexArray;delete e.__lineArray;delete e.__skinIndexArray;delete e.__skinWeightArray}}function Jt(e,t,n,r){var i,s,o,u;for(s in t){o=t[s];i=n[s];if(o>=0){if(i){u=i.itemSize;K.bindBuffer(K.ARRAY_BUFFER,i.buffer);Qt(o);K.vertexAttribPointer(o,u,K.FLOAT,false,0,r*u*4)}else if(e.defaultAttributeValues){if(e.defaultAttributeValues[s].length===2){K.vertexAttrib2fv(o,e.defaultAttributeValues[s])}else if(e.defaultAttributeValues[s].length===3){K.vertexAttrib3fv(o,e.defaultAttributeValues[s])}}}}}function Kt(e,t){var n=e.attributes;var r,i;for(r in n){i=n[r];if(i.needsUpdate){if(r==="index"){K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,i.buffer);K.bufferData(K.ELEMENT_ARRAY_BUFFER,i.array,t)}else{K.bindBuffer(K.ARRAY_BUFFER,i.buffer);K.bufferData(K.ARRAY_BUFFER,i.array,t)}i.needsUpdate=false}}}function Qt(e){if(R[e]===0){K.enableVertexAttribArray(e);R[e]=1}}function Gt(){for(var e in R){if(R[e]===1){K.disableVertexAttribArray(e);R[e]=0}}}function Yt(e,t,n){var r=e.program.attributes;if(n.morphTargetBase!==-1&&r.position>=0){K.bindBuffer(K.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n.morphTargetBase]);Qt(r.position);K.vertexAttribPointer(r.position,3,K.FLOAT,false,0,0)}else if(r.position>=0){K.bindBuffer(K.ARRAY_BUFFER,t.__webglVertexBuffer);Qt(r.position);K.vertexAttribPointer(r.position,3,K.FLOAT,false,0,0)}if(n.morphTargetForcedOrder.length){var i=0;var s=n.morphTargetForcedOrder;var o=n.morphTargetInfluences;while(i<e.numSupportedMorphTargets&&i<s.length){if(r["morphTarget"+i]>=0){K.bindBuffer(K.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[s[i]]);Qt(r["morphTarget"+i]);K.vertexAttribPointer(r["morphTarget"+i],3,K.FLOAT,false,0,0)}if(r["morphNormal"+i]>=0&&e.morphNormals){K.bindBuffer(K.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[s[i]]);Qt(r["morphNormal"+i]);K.vertexAttribPointer(r["morphNormal"+i],3,K.FLOAT,false,0,0)}n.__webglMorphTargetInfluences[i]=o[s[i]];i++}}else{var u,a=[];var o=n.morphTargetInfluences;var f,l=o.length;for(f=0;f<l;f++){u=o[f];if(u>0){a.push([u,f])}}if(a.length>e.numSupportedMorphTargets){a.sort(en);a.length=e.numSupportedMorphTargets}else if(a.length>e.numSupportedMorphNormals){a.sort(en)}else if(a.length===0){a.push([0,0])}var c,i=0;while(i<e.numSupportedMorphTargets){if(a[i]){c=a[i][1];if(r["morphTarget"+i]>=0){K.bindBuffer(K.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[c]);Qt(r["morphTarget"+i]);K.vertexAttribPointer(r["morphTarget"+i],3,K.FLOAT,false,0,0)}if(r["morphNormal"+i]>=0&&e.morphNormals){K.bindBuffer(K.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[c]);Qt(r["morphNormal"+i]);K.vertexAttribPointer(r["morphNormal"+i],3,K.FLOAT,false,0,0)}n.__webglMorphTargetInfluences[i]=o[c]}else{n.__webglMorphTargetInfluences[i]=0}i++}}if(e.program.uniforms.morphTargetInfluences!==null){K.uniform1fv(e.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}}function Zt(e,t){if(e.z!==t.z){return t.z-e.z}else{return e.id-t.id}}function en(e,t){return t[0]-e[0]}function tn(e,t,n){if(!e.length)return;for(var r=0,i=e.length;r<i;r++){g=null;E=null;N=-1;A=-1;O=-1;x=-1;T=-1;w=-1;b=-1;$=true;e[r].render(t,n,I,q);g=null;E=null;N=-1;A=-1;O=-1;x=-1;T=-1;w=-1;b=-1;$=true}}function nn(e,t,n,r,s,o,u,a){var f,l,c,h,p,v,m;if(t){p=e.length-1;v=-1;m=-1}else{p=0;v=e.length;m=1}for(var g=p;g!==v;g+=m){f=e[g];if(f.render){l=f.object;c=f.buffer;if(a){h=a}else{h=f[n];if(!h)continue;if(u)d.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst);d.setDepthTest(h.depthTest);d.setDepthWrite(h.depthWrite);Hn(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}d.setMaterialFaces(h);if(c instanceof i.BufferGeometry){d.renderBufferDirect(r,s,o,h,c,l)}else{d.renderBuffer(r,s,o,h,c,l)}}}}function rn(e,t,n,r,i,s,o){var u,a,f,l;for(var c=0,h=e.length;c<h;c++){u=e[c];a=u.object;if(a.visible){if(o){f=o}else{f=u[t];if(!f)continue;if(s)d.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst);d.setDepthTest(f.depthTest);d.setDepthWrite(f.depthWrite);Hn(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}d.renderImmediateObject(n,r,i,f,a)}}}function sn(e){var t=e.object,n=t.material;if(n.transparent){e.transparent=n;e.opaque=null}else{e.opaque=n;e.transparent=null}}function on(e){var t=e.object;var n=e.buffer;var r=t.geometry;var s=t.material;if(s instanceof i.MeshFaceMaterial){var o=r instanceof i.BufferGeometry?0:n.materialIndex;s=s.materials[o];if(s.transparent){e.transparent=s;e.opaque=null}else{e.opaque=s;e.transparent=null}}else{if(s){if(s.transparent){e.transparent=s;e.opaque=null}else{e.opaque=s;e.transparent=null}}}}function un(e,t){var n,r,s,o;if(e.__webglInit===undefined){e.__webglInit=true;e._modelViewMatrix=new i.Matrix4;e._normalMatrix=new i.Matrix3;if(e.geometry!==undefined&&e.geometry.__webglInit===undefined){e.geometry.__webglInit=true;e.geometry.addEventListener("dispose",Ct)}r=e.geometry;if(r===undefined){}else if(r instanceof i.BufferGeometry){Wt(r)}else if(e instanceof i.Mesh){s=e.material;if(r.geometryGroups===undefined){r.makeGroups(s instanceof i.MeshFaceMaterial)}for(n in r.geometryGroups){o=r.geometryGroups[n];if(!o.__webglVertexBuffer){Nt(o);Ft(o,e);r.verticesNeedUpdate=true;r.morphTargetsNeedUpdate=true;r.elementsNeedUpdate=true;r.uvsNeedUpdate=true;r.normalsNeedUpdate=true;r.tangentsNeedUpdate=true;r.colorsNeedUpdate=true}}}else if(e instanceof i.Line){if(!r.__webglVertexBuffer){Tt(r);jt(r,e);r.verticesNeedUpdate=true;r.colorsNeedUpdate=true;r.lineDistancesNeedUpdate=true}}else if(e instanceof i.ParticleSystem){if(!r.__webglVertexBuffer){xt(r);Bt(r,e);r.verticesNeedUpdate=true;r.colorsNeedUpdate=true}}}if(e.__webglActive===undefined){if(e instanceof i.Mesh){r=e.geometry;if(r instanceof i.BufferGeometry){an(t.__webglObjects,r,e)}else if(r instanceof i.Geometry){for(n in r.geometryGroups){o=r.geometryGroups[n];an(t.__webglObjects,o,e)}}}else if(e instanceof i.Line||e instanceof i.ParticleSystem){r=e.geometry;an(t.__webglObjects,r,e)}else if(e instanceof i.ImmediateRenderObject||e.immediateRenderCallback){fn(t.__webglObjectsImmediate,e)}else if(e instanceof i.Sprite){t.__webglSprites.push(e)}else if(e instanceof i.LensFlare){t.__webglFlares.push(e)}e.__webglActive=true}}function an(e,t,n){e.push({id:null,buffer:t,object:n,opaque:null,transparent:null,z:0})}function fn(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function ln(e){var t=e.geometry,n,r,s;if(t instanceof i.BufferGeometry){Kt(t,K.DYNAMIC_DRAW)}else if(e instanceof i.Mesh){for(var o=0,u=t.geometryGroupsList.length;o<u;o++){n=t.geometryGroupsList[o];s=It(e,n);if(t.buffersNeedUpdate){Ft(n,e)}r=s.attributes&&cn(s);if(t.verticesNeedUpdate||t.morphTargetsNeedUpdate||t.elementsNeedUpdate||t.uvsNeedUpdate||t.normalsNeedUpdate||t.colorsNeedUpdate||t.tangentsNeedUpdate||r){$t(n,e,K.DYNAMIC_DRAW,!t.dynamic,s)}}t.verticesNeedUpdate=false;t.morphTargetsNeedUpdate=false;t.elementsNeedUpdate=false;t.uvsNeedUpdate=false;t.normalsNeedUpdate=false;t.colorsNeedUpdate=false;t.tangentsNeedUpdate=false;t.buffersNeedUpdate=false;s.attributes&&hn(s)}else if(e instanceof i.Line){s=It(e,t);r=s.attributes&&cn(s);if(t.verticesNeedUpdate||t.colorsNeedUpdate||t.lineDistancesNeedUpdate||r){Vt(t,K.DYNAMIC_DRAW)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;t.lineDistancesNeedUpdate=false;s.attributes&&hn(s)}else if(e instanceof i.ParticleSystem){s=It(e,t);r=s.attributes&&cn(s);if(t.verticesNeedUpdate||t.colorsNeedUpdate||e.sortParticles||r){Xt(t,K.DYNAMIC_DRAW,e)}t.verticesNeedUpdate=false;t.colorsNeedUpdate=false;s.attributes&&hn(s)}}function cn(e){for(var t in e.attributes){if(e.attributes[t].needsUpdate)return true}return false}function hn(e){for(var t in e.attributes){e.attributes[t].needsUpdate=false}}function pn(e,t){if(e instanceof i.Mesh||e instanceof i.ParticleSystem||e instanceof i.Line){dn(t.__webglObjects,e)}else if(e instanceof i.Sprite){vn(t.__webglSprites,e)}else if(e instanceof i.LensFlare){vn(t.__webglFlares,e)}else if(e instanceof i.ImmediateRenderObject||e.immediateRenderCallback){dn(t.__webglObjectsImmediate,e)}delete e.__webglActive}function dn(e,t){for(var n=e.length-1;n>=0;n--){if(e[n].object===t){e.splice(n,1)}}}function vn(e,t){for(var n=e.length-1;n>=0;n--){if(e[n]===t){e.splice(n,1)}}}function mn(e,t){e.uniforms=i.UniformsUtils.clone(t.uniforms);e.vertexShader=t.vertexShader;e.fragmentShader=t.fragmentShader}function gn(e,t,n,r,s){S=0;if(r.needsUpdate){if(r.program)Pt(r);d.initMaterial(r,t,n,s);r.needsUpdate=false}if(r.morphTargets){if(!s.__webglMorphTargetInfluences){s.__webglMorphTargetInfluences=new Float32Array(d.maxMorphTargets)}}var o=false;var u=r.program,a=u.uniforms,f=r.uniforms;if(u!==g){K.useProgram(u);g=u;o=true}if(r.id!==b){b=r.id;o=true}if(o||e!==E){K.uniformMatrix4fv(a.projectionMatrix,false,e.projectionMatrix.elements);if(e!==E)E=e}if(r.skinning){if(ut&&s.useVertexTexture){if(a.boneTexture!==null){var l=Ln();K.uniform1i(a.boneTexture,l);d.setTexture(s.boneTexture,l)}if(a.boneTextureWidth!==null){K.uniform1i(a.boneTextureWidth,s.boneTextureWidth)}if(a.boneTextureHeight!==null){K.uniform1i(a.boneTextureHeight,s.boneTextureHeight)}}else{if(a.boneGlobalMatrices!==null){K.uniformMatrix4fv(a.boneGlobalMatrices,false,s.boneMatrices)}}}if(o){if(n&&r.fog){Sn(f,n)}if(r instanceof i.MeshPhongMaterial||r instanceof i.MeshLambertMaterial||r.lights){if($){Dn(u,t);$=false}Nn(f,J)}if(r instanceof i.MeshBasicMaterial||r instanceof i.MeshLambertMaterial||r instanceof i.MeshPhongMaterial){yn(f,r)}if(r instanceof i.LineBasicMaterial){bn(f,r)}else if(r instanceof i.LineDashedMaterial){bn(f,r);wn(f,r)}else if(r instanceof i.ParticleSystemMaterial){En(f,r)}else if(r instanceof i.MeshPhongMaterial){xn(f,r)}else if(r instanceof i.MeshLambertMaterial){Tn(f,r)}else if(r instanceof i.MeshDepthMaterial){f.mNear.value=e.near;f.mFar.value=e.far;f.opacity.value=r.opacity}else if(r instanceof i.MeshNormalMaterial){f.opacity.value=r.opacity}if(s.receiveShadow&&!r._shadowPass){Cn(f,t)}An(u,r.uniformsList);if(r instanceof i.ShaderMaterial||r instanceof i.MeshPhongMaterial||r.envMap){if(a.cameraPosition!==null){X.setFromMatrixPosition(e.matrixWorld);K.uniform3f(a.cameraPosition,X.x,X.y,X.z)}}if(r instanceof i.MeshPhongMaterial||r instanceof i.MeshLambertMaterial||r instanceof i.ShaderMaterial||r.skinning){if(a.viewMatrix!==null){K.uniformMatrix4fv(a.viewMatrix,false,e.matrixWorldInverse.elements)}}}kn(a,s);if(a.modelMatrix!==null){K.uniformMatrix4fv(a.modelMatrix,false,s.matrixWorld.elements)}return u}function yn(e,t){e.opacity.value=t.opacity;if(d.gammaInput){e.diffuse.value.copyGammaToLinear(t.color)}else{e.diffuse.value=t.color}e.map.value=t.map;e.lightMap.value=t.lightMap;e.specularMap.value=t.specularMap;if(t.bumpMap){e.bumpMap.value=t.bumpMap;e.bumpScale.value=t.bumpScale}if(t.normalMap){e.normalMap.value=t.normalMap;e.normalScale.value.copy(t.normalScale)}var n;if(t.map){n=t.map}else if(t.specularMap){n=t.specularMap}else if(t.normalMap){n=t.normalMap}else if(t.bumpMap){n=t.bumpMap}if(n!==undefined){var r=n.offset;var s=n.repeat;e.offsetRepeat.value.set(r.x,r.y,s.x,s.y)}e.envMap.value=t.envMap;e.flipEnvMap.value=t.envMap instanceof i.WebGLRenderTargetCube?1:-1;if(d.gammaInput){e.reflectivity.value=t.reflectivity}else{e.reflectivity.value=t.reflectivity}e.refractionRatio.value=t.refractionRatio;e.combine.value=t.combine;e.useRefract.value=t.envMap&&t.envMap.mapping instanceof i.CubeRefractionMapping}function bn(e,t){e.diffuse.value=t.color;e.opacity.value=t.opacity}function wn(e,t){e.dashSize.value=t.dashSize;e.totalSize.value=t.dashSize+t.gapSize;e.scale.value=t.scale}function En(e,n){e.psColor.value=n.color;e.opacity.value=n.opacity;e.size.value=n.size;e.scale.value=t.height/2;e.map.value=n.map}function Sn(e,t){e.fogColor.value=t.color;if(t instanceof i.Fog){e.fogNear.value=t.near;e.fogFar.value=t.far}else if(t instanceof i.FogExp2){e.fogDensity.value=t.density}}function xn(e,t){e.shininess.value=t.shininess;if(d.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive);e.specular.value.copyGammaToLinear(t.specular)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive;e.specular.value=t.specular}if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function Tn(e,t){if(d.gammaInput){e.ambient.value.copyGammaToLinear(t.ambient);e.emissive.value.copyGammaToLinear(t.emissive)}else{e.ambient.value=t.ambient;e.emissive.value=t.emissive}if(t.wrapAround){e.wrapRGB.value.copy(t.wrapRGB)}}function Nn(e,t){e.ambientLightColor.value=t.ambient;e.directionalLightColor.value=t.directional.colors;e.directionalLightDirection.value=t.directional.positions;e.pointLightColor.value=t.point.colors;e.pointLightPosition.value=t.point.positions;e.pointLightDistance.value=t.point.distances;e.spotLightColor.value=t.spot.colors;e.spotLightPosition.value=t.spot.positions;e.spotLightDistance.value=t.spot.distances;e.spotLightDirection.value=t.spot.directions;e.spotLightAngleCos.value=t.spot.anglesCos;e.spotLightExponent.value=t.spot.exponents;e.hemisphereLightSkyColor.value=t.hemi.skyColors;e.hemisphereLightGroundColor.value=t.hemi.groundColors;e.hemisphereLightDirection.value=t.hemi.positions}function Cn(e,t){if(e.shadowMatrix){var n=0;for(var r=0,s=t.length;r<s;r++){var o=t[r];if(!o.castShadow)continue;if(o instanceof i.SpotLight||o instanceof i.DirectionalLight&&!o.shadowCascade){e.shadowMap.value[n]=o.shadowMap;e.shadowMapSize.value[n]=o.shadowMapSize;e.shadowMatrix.value[n]=o.shadowMatrix;e.shadowDarkness.value[n]=o.shadowDarkness;e.shadowBias.value[n]=o.shadowBias;n++}}}}function kn(e,t){K.uniformMatrix4fv(e.modelViewMatrix,false,t._modelViewMatrix.elements);if(e.normalMatrix){K.uniformMatrix3fv(e.normalMatrix,false,t._normalMatrix.elements)}}function Ln(){var e=S;if(e>=tt){console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+tt)}S+=1;return e}function An(e,t){var n,r,s,o,u,a,f,l,c,h,p;for(c=0,h=t.length;c<h;c++){o=e.uniforms[t[c][1]];if(!o)continue;n=t[c][0];s=n.type;r=n.value;if(s==="i"){K.uniform1i(o,r)}else if(s==="f"){K.uniform1f(o,r)}else if(s==="v2"){K.uniform2f(o,r.x,r.y)}else if(s==="v3"){K.uniform3f(o,r.x,r.y,r.z)}else if(s==="v4"){K.uniform4f(o,r.x,r.y,r.z,r.w)}else if(s==="c"){K.uniform3f(o,r.r,r.g,r.b)}else if(s==="iv1"){K.uniform1iv(o,r)}else if(s==="iv"){K.uniform3iv(o,r)}else if(s==="fv1"){K.uniform1fv(o,r)}else if(s==="fv"){K.uniform3fv(o,r)}else if(s==="v2v"){if(n._array===undefined){n._array=new Float32Array(2*r.length)}for(f=0,l=r.length;f<l;f++){p=f*2;n._array[p]=r[f].x;n._array[p+1]=r[f].y}K.uniform2fv(o,n._array)}else if(s==="v3v"){if(n._array===undefined){n._array=new Float32Array(3*r.length)}for(f=0,l=r.length;f<l;f++){p=f*3;n._array[p]=r[f].x;n._array[p+1]=r[f].y;n._array[p+2]=r[f].z}K.uniform3fv(o,n._array)}else if(s==="v4v"){if(n._array===undefined){n._array=new Float32Array(4*r.length)}for(f=0,l=r.length;f<l;f++){p=f*4;n._array[p]=r[f].x;n._array[p+1]=r[f].y;n._array[p+2]=r[f].z;n._array[p+3]=r[f].w}K.uniform4fv(o,n._array)}else if(s==="m4"){if(n._array===undefined){n._array=new Float32Array(16)}r.flattenToArray(n._array);K.uniformMatrix4fv(o,false,n._array)}else if(s==="m4v"){if(n._array===undefined){n._array=new Float32Array(16*r.length)}for(f=0,l=r.length;f<l;f++){r[f].flattenToArrayOffset(n._array,f*16)}K.uniformMatrix4fv(o,false,n._array)}else if(s==="t"){u=r;a=Ln();K.uniform1i(o,a);if(!u)continue;if(u.image instanceof Array&&u.image.length===6){Wn(u,a)}else if(u instanceof i.WebGLRenderTargetCube){Xn(u,a)}else{d.setTexture(u,a)}}else if(s==="tv"){if(n._array===undefined){n._array=[]}for(f=0,l=n.value.length;f<l;f++){n._array[f]=Ln()}K.uniform1iv(o,n._array);for(f=0,l=n.value.length;f<l;f++){u=n.value[f];a=n._array[f];if(!u)continue;d.setTexture(u,a)}}else{console.warn("THREE.WebGLRenderer: Unknown uniform type: "+s)}}}function On(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Mn(e,t,n,r){e[t]=n.r*n.r*r;e[t+1]=n.g*n.g*r;e[t+2]=n.b*n.b*r}function _n(e,t,n,r){e[t]=n.r*r;e[t+1]=n.g*r;e[t+2]=n.b*r}function Dn(e,t){var n,r,s,o,u=0,a=0,f=0,l,c,h,p,v,m,g,y=J,b=y.directional.colors,w=y.directional.positions,E=y.point.colors,S=y.point.positions,x=y.point.distances,T=y.spot.colors,N=y.spot.positions,C=y.spot.distances,k=y.spot.directions,L=y.spot.anglesCos,A=y.spot.exponents,O=y.hemi.skyColors,M=y.hemi.groundColors,_=y.hemi.positions,D=0,P=0,H=0,B=0,j=0,F=0,I=0,q=0,R=0,U=0,z=0,W=0;for(n=0,r=t.length;n<r;n++){s=t[n];if(s.onlyShadow)continue;l=s.color;p=s.intensity;g=s.distance;if(s instanceof i.AmbientLight){if(!s.visible)continue;if(d.gammaInput){u+=l.r*l.r;a+=l.g*l.g;f+=l.b*l.b}else{u+=l.r;a+=l.g;f+=l.b}}else if(s instanceof i.DirectionalLight){j+=1;if(!s.visible)continue;V.setFromMatrixPosition(s.matrixWorld);X.setFromMatrixPosition(s.target.matrixWorld);V.sub(X);V.normalize();if(V.x===0&&V.y===0&&V.z===0)continue;R=D*3;w[R]=V.x;w[R+1]=V.y;w[R+2]=V.z;if(d.gammaInput){Mn(b,R,l,p*p)}else{_n(b,R,l,p)}D+=1}else if(s instanceof i.PointLight){F+=1;if(!s.visible)continue;U=P*3;if(d.gammaInput){Mn(E,U,l,p*p)}else{_n(E,U,l,p)}X.setFromMatrixPosition(s.matrixWorld);S[U]=X.x;S[U+1]=X.y;S[U+2]=X.z;x[P]=g;P+=1}else if(s instanceof i.SpotLight){I+=1;if(!s.visible)continue;z=H*3;if(d.gammaInput){Mn(T,z,l,p*p)}else{_n(T,z,l,p)}X.setFromMatrixPosition(s.matrixWorld);N[z]=X.x;N[z+1]=X.y;N[z+2]=X.z;C[H]=g;V.copy(X);X.setFromMatrixPosition(s.target.matrixWorld);V.sub(X);V.normalize();k[z]=V.x;k[z+1]=V.y;k[z+2]=V.z;L[H]=Math.cos(s.angle);A[H]=s.exponent;H+=1}else if(s instanceof i.HemisphereLight){q+=1;if(!s.visible)continue;V.setFromMatrixPosition(s.matrixWorld);V.normalize();if(V.x===0&&V.y===0&&V.z===0)continue;W=B*3;_[W]=V.x;_[W+1]=V.y;_[W+2]=V.z;c=s.color;h=s.groundColor;if(d.gammaInput){v=p*p;Mn(O,W,c,v);Mn(M,W,h,v)}else{_n(O,W,c,p);_n(M,W,h,p)}B+=1}}for(n=D*3,r=Math.max(b.length,j*3);n<r;n++)b[n]=0;for(n=P*3,r=Math.max(E.length,F*3);n<r;n++)E[n]=0;for(n=H*3,r=Math.max(T.length,I*3);n<r;n++)T[n]=0;for(n=B*3,r=Math.max(O.length,q*3);n<r;n++)O[n]=0;for(n=B*3,r=Math.max(M.length,q*3);n<r;n++)M[n]=0;y.directional.length=D;y.point.length=P;y.spot.length=H;y.hemi.length=B;y.ambient[0]=u;y.ambient[1]=a;y.ambient[2]=f}function Pn(e){if(e!==P){K.lineWidth(e);P=e}}function Hn(e,t,n){if(M!==e){if(e){K.enable(K.POLYGON_OFFSET_FILL)}else{K.disable(K.POLYGON_OFFSET_FILL)}M=e}if(e&&(_!==t||D!==n)){K.polygonOffset(t,n);_=t;D=n}}function Bn(e){var t,n,r=[];for(var i in e){t=e[i];if(t===false)continue;n="#define "+i+" "+t;r.push(n)}return r.join("\n")}function jn(e,t,n,r,o,u,a,f){var l,c,h,p,g;var y=[];if(e){y.push(e)}else{y.push(t);y.push(n)}for(h in u){y.push(h);y.push(u[h])}for(l in a){y.push(l);y.push(a[l])}g=y.join();for(l=0,c=v.length;l<c;l++){var b=v[l];if(b.code===g){b.usedTimes++;return b.program}}var w="SHADOWMAP_TYPE_BASIC";if(a.shadowMapType===i.PCFShadowMap){w="SHADOWMAP_TYPE_PCF"}else if(a.shadowMapType===i.PCFSoftShadowMap){w="SHADOWMAP_TYPE_PCF_SOFT"}var E=Bn(u);p=K.createProgram();var S=["precision "+s+" float;","precision "+s+" int;",E,ot?"#define VERTEX_TEXTURES":"",d.gammaInput?"#define GAMMA_INPUT":"",d.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,"#define MAX_BONES "+a.maxBones,a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals?"#define USE_MORPHNORMALS":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+w:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n");var x=["precision "+s+" float;","precision "+s+" int;",a.bumpMap||a.normalMap?"#extension GL_OES_standard_derivatives : enable":"",E,"#define MAX_DIR_LIGHTS "+a.maxDirLights,"#define MAX_POINT_LIGHTS "+a.maxPointLights,"#define MAX_SPOT_LIGHTS "+a.maxSpotLights,"#define MAX_HEMI_LIGHTS "+a.maxHemiLights,"#define MAX_SHADOWS "+a.maxShadows,a.alphaTest?"#define ALPHATEST "+a.alphaTest:"",d.gammaInput?"#define GAMMA_INPUT":"",d.gammaOutput?"#define GAMMA_OUTPUT":"",a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.lightMap?"#define USE_LIGHTMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.vertexColors?"#define USE_COLOR":"",a.metal?"#define METAL":"",a.wrapAround?"#define WRAP_AROUND":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+w:"",a.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",a.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");var T=Rn("vertex",S+n);var N=Rn("fragment",x+t);K.attachShader(p,T);K.attachShader(p,N);if(f!==undefined){K.bindAttribLocation(p,0,f)}K.linkProgram(p);if(K.getProgramParameter(p,K.LINK_STATUS)===false){console.error("Could not initialise shader");console.error("gl.VALIDATE_STATUS",K.getProgramParameter(p,K.VALIDATE_STATUS));console.error("gl.getError()",K.getError())}if(K.getProgramInfoLog(p)!==""){console.error("gl.getProgramInfoLog()",K.getProgramInfoLog(p))}K.deleteShader(N);K.deleteShader(T);p.uniforms={};p.attributes={};var C,k,L,A;C=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"];if(a.useVertexTexture){C.push("boneTexture");C.push("boneTextureWidth");C.push("boneTextureHeight")}else{C.push("boneGlobalMatrices")}for(k in r){C.push(k)}Fn(p,C);C=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(A=0;A<a.maxMorphTargets;A++){C.push("morphTarget"+A)}for(A=0;A<a.maxMorphNormals;A++){C.push("morphNormal"+A)}for(L in o){C.push(L)}In(p,C);p.id=m++;v.push({program:p,code:g,usedTimes:1});d.info.memory.programs=v.length;return p}function Fn(e,t){var n,r,i;for(n=0,r=t.length;n<r;n++){i=t[n];e.uniforms[i]=K.getUniformLocation(e,i)}}function In(e,t){var n,r,i;for(n=0,r=t.length;n<r;n++){i=t[n];e.attributes[i]=K.getAttribLocation(e,i)}}function qn(e){var t=e.split("\n");for(var n=0,r=t.length;n<r;n++){t[n]=n+1+": "+t[n]}return t.join("\n")}function Rn(e,t){var n;if(e==="fragment"){n=K.createShader(K.FRAGMENT_SHADER)}else if(e==="vertex"){n=K.createShader(K.VERTEX_SHADER)}K.shaderSource(n,t);K.compileShader(n);if(!K.getShaderParameter(n,K.COMPILE_STATUS)){console.error(K.getShaderInfoLog(n));console.error(qn(t));return null}return n}function Un(e,t,n){if(n){K.texParameteri(e,K.TEXTURE_WRAP_S,Qn(t.wrapS));K.texParameteri(e,K.TEXTURE_WRAP_T,Qn(t.wrapT));K.texParameteri(e,K.TEXTURE_MAG_FILTER,Qn(t.magFilter));K.texParameteri(e,K.TEXTURE_MIN_FILTER,Qn(t.minFilter))}else{K.texParameteri(e,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE);K.texParameteri(e,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE);K.texParameteri(e,K.TEXTURE_MAG_FILTER,Kn(t.magFilter));K.texParameteri(e,K.TEXTURE_MIN_FILTER,Kn(t.minFilter))}if(Z&&t.type!==i.FloatType){if(t.anisotropy>1||t.__oldAnisotropy){K.texParameterf(e,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,st));t.__oldAnisotropy=t.anisotropy}}}function zn(e,t){if(e.width<=t&&e.height<=t){return e}var n=Math.max(e.width,e.height);var r=Math.floor(e.width*t/n);var i=Math.floor(e.height*t/n);var s=document.createElement("canvas");s.width=r;s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0,e.width,e.height,0,0,r,i);return s}function Wn(e,t){if(e.image.length===6){if(e.needsUpdate){if(!e.image.__webglTextureCube){e.addEventListener("dispose",kt);e.image.__webglTextureCube=K.createTexture();d.info.memory.textures++}K.activeTexture(K.TEXTURE0+t);K.bindTexture(K.TEXTURE_CUBE_MAP,e.image.__webglTextureCube);K.pixelStorei(K.UNPACK_FLIP_Y_WEBGL,e.flipY);var n=e instanceof i.CompressedTexture;var r=[];for(var s=0;s<6;s++){if(d.autoScaleCubemaps&&!n){r[s]=zn(e.image[s],it)}else{r[s]=e.image[s]}}var o=r[0],u=i.Math.isPowerOfTwo(o.width)&&i.Math.isPowerOfTwo(o.height),a=Qn(e.format),f=Qn(e.type);Un(K.TEXTURE_CUBE_MAP,e,u);for(var s=0;s<6;s++){if(!n){K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,a,a,f,r[s])}else{var l,c=r[s].mipmaps;for(var h=0,p=c.length;h<p;h++){l=c[h];if(e.format!==i.RGBAFormat){K.compressedTexImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+s,h,a,l.width,l.height,0,l.data)}else{K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+s,h,a,l.width,l.height,0,a,f,l.data)}}}}if(e.generateMipmaps&&u){K.generateMipmap(K.TEXTURE_CUBE_MAP)}e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{K.activeTexture(K.TEXTURE0+t);K.bindTexture(K.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}}}function Xn(e,t){K.activeTexture(K.TEXTURE0+t);K.bindTexture(K.TEXTURE_CUBE_MAP,e.__webglTexture)}function Vn(e,t,n){K.bindFramebuffer(K.FRAMEBUFFER,e);K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,n,t.__webglTexture,0)}function $n(e,t){K.bindRenderbuffer(K.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){K.renderbufferStorage(K.RENDERBUFFER,K.DEPTH_COMPONENT16,t.width,t.height);K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_ATTACHMENT,K.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){K.renderbufferStorage(K.RENDERBUFFER,K.DEPTH_STENCIL,t.width,t.height);K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_STENCIL_ATTACHMENT,K.RENDERBUFFER,e)}else{K.renderbufferStorage(K.RENDERBUFFER,K.RGBA4,t.width,t.height)}}function Jn(e){if(e instanceof i.WebGLRenderTargetCube){K.bindTexture(K.TEXTURE_CUBE_MAP,e.__webglTexture);K.generateMipmap(K.TEXTURE_CUBE_MAP);K.bindTexture(K.TEXTURE_CUBE_MAP,null)}else{K.bindTexture(K.TEXTURE_2D,e.__webglTexture);K.generateMipmap(K.TEXTURE_2D);K.bindTexture(K.TEXTURE_2D,null)}}function Kn(e){if(e===i.NearestFilter||e===i.NearestMipMapNearestFilter||e===i.NearestMipMapLinearFilter){return K.NEAREST}return K.LINEAR}function Qn(e){if(e===i.RepeatWrapping)return K.REPEAT;if(e===i.ClampToEdgeWrapping)return K.CLAMP_TO_EDGE;if(e===i.MirroredRepeatWrapping)return K.MIRRORED_REPEAT;if(e===i.NearestFilter)return K.NEAREST;if(e===i.NearestMipMapNearestFilter)return K.NEAREST_MIPMAP_NEAREST;if(e===i.NearestMipMapLinearFilter)return K.NEAREST_MIPMAP_LINEAR;if(e===i.LinearFilter)return K.LINEAR;if(e===i.LinearMipMapNearestFilter)return K.LINEAR_MIPMAP_NEAREST;if(e===i.LinearMipMapLinearFilter)return K.LINEAR_MIPMAP_LINEAR;if(e===i.UnsignedByteType)return K.UNSIGNED_BYTE;if(e===i.UnsignedShort4444Type)return K.UNSIGNED_SHORT_4_4_4_4;if(e===i.UnsignedShort5551Type)return K.UNSIGNED_SHORT_5_5_5_1;if(e===i.UnsignedShort565Type)return K.UNSIGNED_SHORT_5_6_5;if(e===i.ByteType)return K.BYTE;if(e===i.ShortType)return K.SHORT;if(e===i.UnsignedShortType)return K.UNSIGNED_SHORT;if(e===i.IntType)return K.INT;if(e===i.UnsignedIntType)return K.UNSIGNED_INT;if(e===i.FloatType)return K.FLOAT;if(e===i.AlphaFormat)return K.ALPHA;if(e===i.RGBFormat)return K.RGB;if(e===i.RGBAFormat)return K.RGBA;if(e===i.LuminanceFormat)return K.LUMINANCE;if(e===i.LuminanceAlphaFormat)return K.LUMINANCE_ALPHA;if(e===i.AddEquation)return K.FUNC_ADD;if(e===i.SubtractEquation)return K.FUNC_SUBTRACT;if(e===i.ReverseSubtractEquation)return K.FUNC_REVERSE_SUBTRACT;if(e===i.ZeroFactor)return K.ZERO;if(e===i.OneFactor)return K.ONE;if(e===i.SrcColorFactor)return K.SRC_COLOR;if(e===i.OneMinusSrcColorFactor)return K.ONE_MINUS_SRC_COLOR;if(e===i.SrcAlphaFactor)return K.SRC_ALPHA;if(e===i.OneMinusSrcAlphaFactor)return K.ONE_MINUS_SRC_ALPHA;if(e===i.DstAlphaFactor)return K.DST_ALPHA;if(e===i.OneMinusDstAlphaFactor)return K.ONE_MINUS_DST_ALPHA;if(e===i.DstColorFactor)return K.DST_COLOR;if(e===i.OneMinusDstColorFactor)return K.ONE_MINUS_DST_COLOR;if(e===i.SrcAlphaSaturateFactor)return K.SRC_ALPHA_SATURATE;if(et!==undefined){if(e===i.RGB_S3TC_DXT1_Format)return et.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT1_Format)return et.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===i.RGBA_S3TC_DXT3_Format)return et.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===i.RGBA_S3TC_DXT5_Format)return et.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Gn(e){if(ut&&e&&e.useVertexTexture){return 1024}else{var t=K.getParameter(K.MAX_VERTEX_UNIFORM_VECTORS);var n=Math.floor((t-20)/4);var r=n;if(e!==undefined&&e instanceof i.SkinnedMesh){r=Math.min(e.bones.length,r);if(r<e.bones.length){console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")}}return r}}function Yn(e){var t=0;var n=0;var r=0;var s=0;for(var o=0,u=e.length;o<u;o++){var a=e[o];if(a.onlyShadow||a.visible===false)continue;if(a instanceof i.DirectionalLight)t++;if(a instanceof i.PointLight)n++;if(a instanceof i.SpotLight)r++;if(a instanceof i.HemisphereLight)s++}return{directional:t,point:n,spot:r,hemi:s}}function Zn(e){var t=0;for(var n=0,r=e.length;n<r;n++){var s=e[n];if(!s.castShadow)continue;if(s instanceof i.SpotLight)t++;if(s instanceof i.DirectionalLight&&!s.shadowCascade)t++}return t}function er(){try{var e={alpha:u,premultipliedAlpha:a,antialias:f,stencil:l,preserveDrawingBuffer:c};K=n||t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(K===null){throw"Error creating WebGL context."}}catch(r){console.error(r)}Q=K.getExtension("OES_texture_float");G=K.getExtension("OES_texture_float_linear");Y=K.getExtension("OES_standard_derivatives");Z=K.getExtension("EXT_texture_filter_anisotropic")||K.getExtension("MOZ_EXT_texture_filter_anisotropic")||K.getExtension("WEBKIT_EXT_texture_filter_anisotropic");et=K.getExtension("WEBGL_compressed_texture_s3tc")||K.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||K.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");if(!Q){console.log("THREE.WebGLRenderer: Float textures not supported.")}if(!Y){console.log("THREE.WebGLRenderer: Standard derivatives not supported.")}if(!Z){console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.")}if(!et){console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.")}if(K.getShaderPrecisionFormat===undefined){K.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}}function tr(){K.clearColor(0,0,0,1);K.clearDepth(1);K.clearStencil(0);K.enable(K.DEPTH_TEST);K.depthFunc(K.LEQUAL);K.frontFace(K.CCW);K.cullFace(K.BACK);K.enable(K.CULL_FACE);K.enable(K.BLEND);K.blendEquation(K.FUNC_ADD);K.blendFunc(K.SRC_ALPHA,K.ONE_MINUS_SRC_ALPHA);K.viewport(H,B,j,F);K.clearColor(h.r,h.g,h.b,p)}console.log("THREE.WebGLRenderer",i.REVISION);e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),n=e.context!==undefined?e.context:null,s=e.precision!==undefined?e.precision:"highp",o={},u=e.alpha!==undefined?e.alpha:false,a=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:true,f=e.antialias!==undefined?e.antialias:false,l=e.stencil!==undefined?e.stencil:true,c=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:false,h=new i.Color(0),p=0;this.domElement=t;this.context=null;this.devicePixelRatio=e.devicePixelRatio!==undefined?e.devicePixelRatio:r.devicePixelRatio!==undefined?r.devicePixelRatio:1;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.autoUpdateObjects=true;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapAutoUpdate=true;this.shadowMapType=i.PCFShadowMap;this.shadowMapCullFace=i.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var d=this,v=[],m=0,g=null,y=null,b=-1,w=null,E=null,S=0,x=-1,T=-1,N=-1,C=-1,k=-1,L=-1,A=-1,O=-1,M=null,_=null,D=null,P=null,H=0,B=0,j=t.width,F=t.height,I=0,q=0,R=new Uint8Array(16),U=new i.Frustum,z=new i.Matrix4,W=new i.Matrix4,X=new i.Vector3,V=new i.Vector3,$=true,J={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};var K;var Q;var G;var Y;var Z;var et;er();tr();this.context=K;var tt=K.getParameter(K.MAX_TEXTURE_IMAGE_UNITS);var nt=K.getParameter(K.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var rt=K.getParameter(K.MAX_TEXTURE_SIZE);var it=K.getParameter(K.MAX_CUBE_MAP_TEXTURE_SIZE);var st=Z?K.getParameter(Z.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;var ot=nt>0;var ut=ot&&Q;var at=et?K.getParameter(K.COMPRESSED_TEXTURE_FORMATS):[];var ft=K.getShaderPrecisionFormat(K.VERTEX_SHADER,K.HIGH_FLOAT);var lt=K.getShaderPrecisionFormat(K.VERTEX_SHADER,K.MEDIUM_FLOAT);var ct=K.getShaderPrecisionFormat(K.VERTEX_SHADER,K.LOW_FLOAT);var ht=K.getShaderPrecisionFormat(K.FRAGMENT_SHADER,K.HIGH_FLOAT);var pt=K.getShaderPrecisionFormat(K.FRAGMENT_SHADER,K.MEDIUM_FLOAT);var dt=K.getShaderPrecisionFormat(K.FRAGMENT_SHADER,K.LOW_FLOAT);var vt=K.getShaderPrecisionFormat(K.VERTEX_SHADER,K.HIGH_INT);var mt=K.getShaderPrecisionFormat(K.VERTEX_SHADER,K.MEDIUM_INT);var gt=K.getShaderPrecisionFormat(K.VERTEX_SHADER,K.LOW_INT);var yt=K.getShaderPrecisionFormat(K.FRAGMENT_SHADER,K.HIGH_INT);var bt=K.getShaderPrecisionFormat(K.FRAGMENT_SHADER,K.MEDIUM_INT);var wt=K.getShaderPrecisionFormat(K.FRAGMENT_SHADER,K.LOW_INT);var Et=ft.precision>0&&ht.precision>0;var St=lt.precision>0&&pt.precision>0;if(s==="highp"&&!Et){if(St){s="mediump";console.warn("WebGLRenderer: highp not supported, using mediump")}else{s="lowp";console.warn("WebGLRenderer: highp and mediump not supported, using lowp")}}if(s==="mediump"&&!St){s="lowp";console.warn("WebGLRenderer: mediump not supported, using lowp")}this.getContext=function(){return K};this.supportsVertexTextures=function(){return ot};this.supportsFloatTextures=function(){return Q};this.supportsStandardDerivatives=function(){return Y};this.supportsCompressedTextureS3TC=function(){return et};this.getMaxAnisotropy=function(){return st};this.getPrecision=function(){return s};this.setSize=function(e,n,r){t.width=e*this.devicePixelRatio;t.height=n*this.devicePixelRatio;if(this.devicePixelRatio!==1&&r!==false){t.style.width=e+"px";t.style.height=n+"px"}this.setViewport(0,0,e,n)};this.setViewport=function(e,t,n,r){H=e*this.devicePixelRatio;B=t*this.devicePixelRatio;j=n*this.devicePixelRatio;F=r*this.devicePixelRatio;K.viewport(H,B,j,F)};this.setScissor=function(e,t,n,r){K.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)};this.enableScissorTest=function(e){e?K.enable(K.SCISSOR_TEST):K.disable(K.SCISSOR_TEST)};this.setClearColor=function(e,t){h.set(e);p=t!==undefined?t:1;K.clearColor(h.r,h.g,h.b,p)};this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(e,t)};this.getClearColor=function(){return h};this.getClearAlpha=function(){return p};this.clear=function(e,t,n){var r=0;if(e===undefined||e)r|=K.COLOR_BUFFER_BIT;if(t===undefined||t)r|=K.DEPTH_BUFFER_BIT;if(n===undefined||n)r|=K.STENCIL_BUFFER_BIT;K.clear(r)};this.clearColor=function(){K.clear(K.COLOR_BUFFER_BIT)};this.clearDepth=function(){K.clear(K.DEPTH_BUFFER_BIT)};this.clearStencil=function(){K.clear(K.STENCIL_BUFFER_BIT)};this.clearTarget=function(e,t,n,r){this.setRenderTarget(e);this.clear(t,n,r)};this.addPostPlugin=function(e){e.init(this);this.renderPluginsPost.push(e)};this.addPrePlugin=function(e){e.init(this);this.renderPluginsPre.push(e)};this.updateShadowMap=function(e,t){g=null;N=-1;A=-1;O=-1;w=-1;b=-1;$=true;x=-1;T=-1;this.shadowMapPlugin.update(e,t)};var Ct=function(e){var t=e.target;t.removeEventListener("dispose",Ct);Mt(t)};var kt=function(e){var t=e.target;t.removeEventListener("dispose",kt);_t(t);d.info.memory.textures--};var Lt=function(e){var t=e.target;t.removeEventListener("dispose",Lt);Dt(t);d.info.memory.textures--};var At=function(e){var t=e.target;t.removeEventListener("dispose",At);Pt(t)};var Ot=function(e){if(e.__webglVertexBuffer!==undefined)K.deleteBuffer(e.__webglVertexBuffer);if(e.__webglNormalBuffer!==undefined)K.deleteBuffer(e.__webglNormalBuffer);if(e.__webglTangentBuffer!==undefined)K.deleteBuffer(e.__webglTangentBuffer);if(e.__webglColorBuffer!==undefined)K.deleteBuffer(e.__webglColorBuffer);if(e.__webglUVBuffer!==undefined)K.deleteBuffer(e.__webglUVBuffer);if(e.__webglUV2Buffer!==undefined)K.deleteBuffer(e.__webglUV2Buffer);if(e.__webglSkinIndicesBuffer!==undefined)K.deleteBuffer(e.__webglSkinIndicesBuffer);if(e.__webglSkinWeightsBuffer!==undefined)K.deleteBuffer(e.__webglSkinWeightsBuffer);if(e.__webglFaceBuffer!==undefined)K.deleteBuffer(e.__webglFaceBuffer);if(e.__webglLineBuffer!==undefined)K.deleteBuffer(e.__webglLineBuffer);if(e.__webglLineDistanceBuffer!==undefined)K.deleteBuffer(e.__webglLineDistanceBuffer);if(e.__webglCustomAttributesList!==undefined){for(var t in e.__webglCustomAttributesList){K.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}}d.info.memory.geometries--};var Mt=function(e){e.__webglInit=undefined;if(e instanceof i.BufferGeometry){var t=e.attributes;for(var n in t){if(t[n].buffer!==undefined){K.deleteBuffer(t[n].buffer)}}d.info.memory.geometries--}else{if(e.geometryGroups!==undefined){for(var r in e.geometryGroups){var s=e.geometryGroups[r];if(s.numMorphTargets!==undefined){for(var o=0,u=s.numMorphTargets;o<u;o++){K.deleteBuffer(s.__webglMorphTargetsBuffers[o])}}if(s.numMorphNormals!==undefined){for(var o=0,u=s.numMorphNormals;o<u;o++){K.deleteBuffer(s.__webglMorphNormalsBuffers[o])}}Ot(s)}}else{Ot(e)}}};var _t=function(e){if(e.image&&e.image.__webglTextureCube){K.deleteTexture(e.image.__webglTextureCube)}else{if(!e.__webglInit)return;e.__webglInit=false;K.deleteTexture(e.__webglTexture)}};var Dt=function(e){if(!e||!e.__webglTexture)return;K.deleteTexture(e.__webglTexture);if(e instanceof i.WebGLRenderTargetCube){for(var t=0;t<6;t++){K.deleteFramebuffer(e.__webglFramebuffer[t]);K.deleteRenderbuffer(e.__webglRenderbuffer[t])}}else{K.deleteFramebuffer(e.__webglFramebuffer);K.deleteRenderbuffer(e.__webglRenderbuffer)}};var Pt=function(e){var t=e.program;if(t===undefined)return;e.program=undefined;var n,r,i;var s=false;for(n=0,r=v.length;n<r;n++){i=v[n];if(i.program===t){i.usedTimes--;if(i.usedTimes===0){s=true}break}}if(s===true){var o=[];for(n=0,r=v.length;n<r;n++){i=v[n];if(i.program!==t){o.push(i)}}v=o;K.deleteProgram(t);d.info.memory.programs--}};this.renderBufferImmediate=function(e,t,n){if(e.hasPositions&&!e.__webglVertexBuffer)e.__webglVertexBuffer=K.createBuffer();if(e.hasNormals&&!e.__webglNormalBuffer)e.__webglNormalBuffer=K.createBuffer();if(e.hasUvs&&!e.__webglUvBuffer)e.__webglUvBuffer=K.createBuffer();if(e.hasColors&&!e.__webglColorBuffer)e.__webglColorBuffer=K.createBuffer();if(e.hasPositions){K.bindBuffer(K.ARRAY_BUFFER,e.__webglVertexBuffer);K.bufferData(K.ARRAY_BUFFER,e.positionArray,K.DYNAMIC_DRAW);K.enableVertexAttribArray(t.attributes.position);K.vertexAttribPointer(t.attributes.position,3,K.FLOAT,false,0,0)}if(e.hasNormals){K.bindBuffer(K.ARRAY_BUFFER,e.__webglNormalBuffer);if(n.shading===i.FlatShading){var r,s,o,u,a,f,l,c,h,p,d,v,m,g,y=e.count*3;for(g=0;g<y;g+=9){m=e.normalArray;u=m[g];l=m[g+1];p=m[g+2];a=m[g+3];c=m[g+4];d=m[g+5];f=m[g+6];h=m[g+7];v=m[g+8];r=(u+a+f)/3;s=(l+c+h)/3;o=(p+d+v)/3;m[g]=r;m[g+1]=s;m[g+2]=o;m[g+3]=r;m[g+4]=s;m[g+5]=o;m[g+6]=r;m[g+7]=s;m[g+8]=o}}K.bufferData(K.ARRAY_BUFFER,e.normalArray,K.DYNAMIC_DRAW);K.enableVertexAttribArray(t.attributes.normal);K.vertexAttribPointer(t.attributes.normal,3,K.FLOAT,false,0,0)}if(e.hasUvs&&n.map){K.bindBuffer(K.ARRAY_BUFFER,e.__webglUvBuffer);K.bufferData(K.ARRAY_BUFFER,e.uvArray,K.DYNAMIC_DRAW);K.enableVertexAttribArray(t.attributes.uv);K.vertexAttribPointer(t.attributes.uv,2,K.FLOAT,false,0,0)}if(e.hasColors&&n.vertexColors!==i.NoColors){K.bindBuffer(K.ARRAY_BUFFER,e.__webglColorBuffer);K.bufferData(K.ARRAY_BUFFER,e.colorArray,K.DYNAMIC_DRAW);K.enableVertexAttribArray(t.attributes.color);K.vertexAttribPointer(t.attributes.color,3,K.FLOAT,false,0,0)}K.drawArrays(K.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,n,r,s,o){if(r.visible===false)return;var u,a,f;var l,c,h,p;var v=gn(e,t,n,r,o);var m=v.attributes;var g=s.attributes;var y=false,b=r.wireframe?1:0,E=s.id*16777215+v.id*2+b;if(E!==w){w=E;y=true}if(y){Gt()}if(o instanceof i.Mesh){var S=g["index"];if(S){var x=s.offsets;if(x.length>1)y=true;for(var T=0,N=x.length;T<N;T++){var C=x[T].index;if(y){for(c in m){h=m[c];l=g[c];if(h>=0){if(l){p=l.itemSize;K.bindBuffer(K.ARRAY_BUFFER,l.buffer);Qt(h);K.vertexAttribPointer(h,p,K.FLOAT,false,0,C*p*4)}else if(r.defaultAttributeValues){if(r.defaultAttributeValues[c].length===2){K.vertexAttrib2fv(h,r.defaultAttributeValues[c])}else if(r.defaultAttributeValues[c].length===3){K.vertexAttrib3fv(h,r.defaultAttributeValues[c])}}}}K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,S.buffer)}K.drawElements(K.TRIANGLES,x[T].count,K.UNSIGNED_SHORT,x[T].start*2);d.info.render.calls++;d.info.render.vertices+=x[T].count;d.info.render.faces+=x[T].count/3}}else{if(y){for(c in m){if(c==="index")continue;h=m[c];l=g[c];if(h>=0){if(l){p=l.itemSize;K.bindBuffer(K.ARRAY_BUFFER,l.buffer);Qt(h);K.vertexAttribPointer(h,p,K.FLOAT,false,0,0)}else if(r.defaultAttributeValues&&r.defaultAttributeValues[c]){if(r.defaultAttributeValues[c].length===2){K.vertexAttrib2fv(h,r.defaultAttributeValues[c])}else if(r.defaultAttributeValues[c].length===3){K.vertexAttrib3fv(h,r.defaultAttributeValues[c])}}}}}var k=s.attributes["position"];K.drawArrays(K.TRIANGLES,0,k.array.length/3);d.info.render.calls++;d.info.render.vertices+=k.array.length/3;d.info.render.faces+=k.array.length/3/3}}else if(o instanceof i.ParticleSystem){if(y){for(c in m){h=m[c];l=g[c];if(h>=0){if(l){p=l.itemSize;K.bindBuffer(K.ARRAY_BUFFER,l.buffer);Qt(h);K.vertexAttribPointer(h,p,K.FLOAT,false,0,0)}else if(r.defaultAttributeValues&&r.defaultAttributeValues[c]){if(r.defaultAttributeValues[c].length===2){K.vertexAttrib2fv(h,r.defaultAttributeValues[c])}else if(r.defaultAttributeValues[c].length===3){K.vertexAttrib3fv(h,r.defaultAttributeValues[c])}}}}}var k=g["position"];K.drawArrays(K.POINTS,0,k.array.length/3);d.info.render.calls++;d.info.render.points+=k.array.length/3}else if(o instanceof i.Line){var L=o.type===i.LineStrip?K.LINE_STRIP:K.LINES;Pn(r.linewidth);var S=g["index"];if(S){var x=s.offsets;if(x.length>1)y=true;for(var T=0,N=x.length;T<N;T++){var C=x[T].index;if(y){Jt(r,m,g,C);K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,S.buffer)}K.drawElements(K.LINES,x[T].count,K.UNSIGNED_SHORT,x[T].start*2);d.info.render.calls++;d.info.render.vertices+=x[T].count}}else{if(y){Jt(r,m,g,0)}var k=g["position"];K.drawArrays(L,0,k.array.length/3);d.info.render.calls++;d.info.render.points+=k.array.length}}};this.renderBuffer=function(e,t,n,r,s,o){if(r.visible===false)return;var u,a,f,l,c;var h=gn(e,t,n,r,o);var p=h.attributes;var v=false,m=r.wireframe?1:0,g=s.id*16777215+h.id*2+m;if(g!==w){w=g;v=true}if(v){Gt()}if(!r.morphTargets&&p.position>=0){if(v){K.bindBuffer(K.ARRAY_BUFFER,s.__webglVertexBuffer);Qt(p.position);K.vertexAttribPointer(p.position,3,K.FLOAT,false,0,0)}}else{if(o.morphTargetBase){Yt(r,s,o)}}if(v){if(s.__webglCustomAttributesList){for(l=0,c=s.__webglCustomAttributesList.length;l<c;l++){f=s.__webglCustomAttributesList[l];if(p[f.buffer.belongsToAttribute]>=0){K.bindBuffer(K.ARRAY_BUFFER,f.buffer);Qt(p[f.buffer.belongsToAttribute]);K.vertexAttribPointer(p[f.buffer.belongsToAttribute],f.size,K.FLOAT,false,0,0)}}}if(p.color>=0){if(o.geometry.colors.length>0||o.geometry.faces.length>0){K.bindBuffer(K.ARRAY_BUFFER,s.__webglColorBuffer);Qt(p.color);K.vertexAttribPointer(p.color,3,K.FLOAT,false,0,0)}else if(r.defaultAttributeValues){K.vertexAttrib3fv(p.color,r.defaultAttributeValues.color)}}if(p.normal>=0){K.bindBuffer(K.ARRAY_BUFFER,s.__webglNormalBuffer);Qt(p.normal);K.vertexAttribPointer(p.normal,3,K.FLOAT,false,0,0)}if(p.tangent>=0){K.bindBuffer(K.ARRAY_BUFFER,s.__webglTangentBuffer);Qt(p.tangent);K.vertexAttribPointer(p.tangent,4,K.FLOAT,false,0,0)}if(p.uv>=0){if(o.geometry.faceVertexUvs[0]){K.bindBuffer(K.ARRAY_BUFFER,s.__webglUVBuffer);Qt(p.uv);K.vertexAttribPointer(p.uv,2,K.FLOAT,false,0,0)}else if(r.defaultAttributeValues){K.vertexAttrib2fv(p.uv,r.defaultAttributeValues.uv)}}if(p.uv2>=0){if(o.geometry.faceVertexUvs[1]){K.bindBuffer(K.ARRAY_BUFFER,s.__webglUV2Buffer);Qt(p.uv2);K.vertexAttribPointer(p.uv2,2,K.FLOAT,false,0,0)}else if(r.defaultAttributeValues){K.vertexAttrib2fv(p.uv2,r.defaultAttributeValues.uv2)}}if(r.skinning&&p.skinIndex>=0&&p.skinWeight>=0){K.bindBuffer(K.ARRAY_BUFFER,s.__webglSkinIndicesBuffer);Qt(p.skinIndex);K.vertexAttribPointer(p.skinIndex,4,K.FLOAT,false,0,0);K.bindBuffer(K.ARRAY_BUFFER,s.__webglSkinWeightsBuffer);Qt(p.skinWeight);K.vertexAttribPointer(p.skinWeight,4,K.FLOAT,false,0,0)}if(p.lineDistance>=0){K.bindBuffer(K.ARRAY_BUFFER,s.__webglLineDistanceBuffer);Qt(p.lineDistance);K.vertexAttribPointer(p.lineDistance,1,K.FLOAT,false,0,0)}}if(o instanceof i.Mesh){if(r.wireframe){Pn(r.wireframeLinewidth);if(v)K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,s.__webglLineBuffer);K.drawElements(K.LINES,s.__webglLineCount,K.UNSIGNED_SHORT,0)}else{if(v)K.bindBuffer(K.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer);K.drawElements(K.TRIANGLES,s.__webglFaceCount,K.UNSIGNED_SHORT,0)}d.info.render.calls++;d.info.render.vertices+=s.__webglFaceCount;d.info.render.faces+=s.__webglFaceCount/3}else if(o instanceof i.Line){var y=o.type===i.LineStrip?K.LINE_STRIP:K.LINES;Pn(r.linewidth);K.drawArrays(y,0,s.__webglLineCount);d.info.render.calls++}else if(o instanceof i.ParticleSystem){K.drawArrays(K.POINTS,0,s.__webglParticleCount);d.info.render.calls++;d.info.render.points+=s.__webglParticleCount}};this.render=function(e,t,n,r){if(t instanceof i.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var s,o,u,a,f,l=e.__lights,c=e.fog;b=-1;$=true;if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===undefined)t.updateMatrixWorld();t.matrixWorldInverse.getInverse(t.matrixWorld);z.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);U.setFromMatrix(z);if(this.autoUpdateObjects)this.initWebGLObjects(e);tn(this.renderPluginsPre,e,t);d.info.render.calls=0;d.info.render.vertices=0;d.info.render.faces=0;d.info.render.points=0;this.setRenderTarget(n);if(this.autoClear||r){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}f=e.__webglObjects;for(s=0,o=f.length;s<o;s++){u=f[s];a=u.object;u.id=s;u.render=false;if(a.visible){if(!(a instanceof i.Mesh||a instanceof i.ParticleSystem)||!a.frustumCulled||U.intersectsObject(a)){On(a,t);on(u);u.render=true;if(this.sortObjects===true){if(a.renderDepth!==null){u.z=a.renderDepth}else{X.setFromMatrixPosition(a.matrixWorld);X.applyProjection(z);u.z=X.z}}}}}if(this.sortObjects){f.sort(Zt)}f=e.__webglObjectsImmediate;for(s=0,o=f.length;s<o;s++){u=f[s];a=u.object;if(a.visible){On(a,t);sn(u)}}if(e.overrideMaterial){var h=e.overrideMaterial;this.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst);this.setDepthTest(h.depthTest);this.setDepthWrite(h.depthWrite);Hn(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits);nn(e.__webglObjects,false,"",t,l,c,true,h);rn(e.__webglObjectsImmediate,"",t,l,c,false,h)}else{var h=null;this.setBlending(i.NoBlending);nn(e.__webglObjects,true,"opaque",t,l,c,false,h);rn(e.__webglObjectsImmediate,"opaque",t,l,c,false,h);nn(e.__webglObjects,false,"transparent",t,l,c,true,h);rn(e.__webglObjectsImmediate,"transparent",t,l,c,true,h)}tn(this.renderPluginsPost,e,t);if(n&&n.generateMipmaps&&n.minFilter!==i.NearestFilter&&n.minFilter!==i.LinearFilter){Jn(n)}this.setDepthTest(true);this.setDepthWrite(true)};this.renderImmediateObject=function(e,t,n,r,i){var s=gn(e,t,n,r,i);w=-1;d.setMaterialFaces(r);if(i.immediateRenderCallback){i.immediateRenderCallback(s,K,U)}else{i.render(function(e){d.renderBufferImmediate(e,s,r)})}};this.initWebGLObjects=function(e){if(!e.__webglObjects){e.__webglObjects=[];e.__webglObjectsImmediate=[];e.__webglSprites=[];e.__webglFlares=[]}while(e.__objectsAdded.length){un(e.__objectsAdded[0],e);e.__objectsAdded.splice(0,1)}while(e.__objectsRemoved.length){pn(e.__objectsRemoved[0],e);e.__objectsRemoved.splice(0,1)}for(var t=0,n=e.__webglObjects.length;t<n;t++){var r=e.__webglObjects[t].object;if(r.__webglInit===undefined){if(r.__webglActive!==undefined){pn(r,e)}un(r,e)}ln(r)}};this.initMaterial=function(e,t,n,r){e.addEventListener("dispose",At);var s,o,u,a,f,l,c,h,p;if(e instanceof i.MeshDepthMaterial){p="depth"}else if(e instanceof i.MeshNormalMaterial){p="normal"}else if(e instanceof i.MeshBasicMaterial){p="basic"}else if(e instanceof i.MeshLambertMaterial){p="lambert"}else if(e instanceof i.MeshPhongMaterial){p="phong"}else if(e instanceof i.LineBasicMaterial){p="basic"}else if(e instanceof i.LineDashedMaterial){p="dashed"}else if(e instanceof i.ParticleSystemMaterial){p="particle_basic"}if(p){mn(e,i.ShaderLib[p])}l=Yn(t);h=Zn(t);c=Gn(r);f={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof i.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:c,useVertexTexture:ut&&r&&r.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:l.directional,maxPointLights:l.point,maxSpotLights:l.spot,maxHemiLights:l.hemi,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow&&h>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===i.DoubleSide,flipSided:e.side===i.BackSide};e.program=jn(p,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,f,e.index0AttributeName);var d=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var v,m="morphTarget";for(a=0;a<this.maxMorphTargets;a++){v=m+a;if(d[v]>=0){e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;var v,m="morphNormal";for(a=0;a<this.maxMorphNormals;a++){v=m+a;if(d[v]>=0){e.numSupportedMorphNormals++}}}e.uniformsList=[];for(s in e.uniforms){e.uniformsList.push([e.uniforms[s],s])}};this.setFaceCulling=function(e,t){if(e===i.CullFaceNone){K.disable(K.CULL_FACE)}else{if(t===i.FrontFaceDirectionCW){K.frontFace(K.CW)}else{K.frontFace(K.CCW)}if(e===i.CullFaceBack){K.cullFace(K.BACK)}else if(e===i.CullFaceFront){K.cullFace(K.FRONT)}else{K.cullFace(K.FRONT_AND_BACK)}K.enable(K.CULL_FACE)}};this.setMaterialFaces=function(e){var t=e.side===i.DoubleSide;var n=e.side===i.BackSide;if(x!==t){if(t){K.disable(K.CULL_FACE)}else{K.enable(K.CULL_FACE)}x=t}if(T!==n){if(n){K.frontFace(K.CW)}else{K.frontFace(K.CCW)}T=n}};this.setDepthTest=function(e){if(A!==e){if(e){K.enable(K.DEPTH_TEST)}else{K.disable(K.DEPTH_TEST)}A=e}};this.setDepthWrite=function(e){if(O!==e){K.depthMask(e);O=e}};this.setBlending=function(e,t,n,r){if(e!==N){if(e===i.NoBlending){K.disable(K.BLEND)}else if(e===i.AdditiveBlending){K.enable(K.BLEND);K.blendEquation(K.FUNC_ADD);K.blendFunc(K.SRC_ALPHA,K.ONE)}else if(e===i.SubtractiveBlending){K.enable(K.BLEND);K.blendEquation(K.FUNC_ADD);K.blendFunc(K.ZERO,K.ONE_MINUS_SRC_COLOR)}else if(e===i.MultiplyBlending){K.enable(K.BLEND);K.blendEquation(K.FUNC_ADD);K.blendFunc(K.ZERO,K.SRC_COLOR)}else if(e===i.CustomBlending){K.enable(K.BLEND)}else{K.enable(K.BLEND);K.blendEquationSeparate(K.FUNC_ADD,K.FUNC_ADD);K.blendFuncSeparate(K.SRC_ALPHA,K.ONE_MINUS_SRC_ALPHA,K.ONE,K.ONE_MINUS_SRC_ALPHA)}N=e}if(e===i.CustomBlending){if(t!==C){K.blendEquation(Qn(t));C=t}if(n!==k||r!==L){K.blendFunc(Qn(n),Qn(r));k=n;L=r}}else{C=null;k=null;L=null}};this.setTexture=function(e,t){if(e.needsUpdate){if(!e.__webglInit){e.__webglInit=true;e.addEventListener("dispose",kt);e.__webglTexture=K.createTexture();d.info.memory.textures++}K.activeTexture(K.TEXTURE0+t);K.bindTexture(K.TEXTURE_2D,e.__webglTexture);K.pixelStorei(K.UNPACK_FLIP_Y_WEBGL,e.flipY);K.pixelStorei(K.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);K.pixelStorei(K.UNPACK_ALIGNMENT,e.unpackAlignment);var n=e.image,r=i.Math.isPowerOfTwo(n.width)&&i.Math.isPowerOfTwo(n.height),s=Qn(e.format),o=Qn(e.type);Un(K.TEXTURE_2D,e,r);var u,a=e.mipmaps;if(e instanceof i.DataTexture){if(a.length>0&&r){for(var f=0,l=a.length;f<l;f++){u=a[f];K.texImage2D(K.TEXTURE_2D,f,s,u.width,u.height,0,s,o,u.data)}e.generateMipmaps=false}else{K.texImage2D(K.TEXTURE_2D,0,s,n.width,n.height,0,s,o,n.data)}}else if(e instanceof i.CompressedTexture){for(var f=0,l=a.length;f<l;f++){u=a[f];if(e.format!==i.RGBAFormat){K.compressedTexImage2D(K.TEXTURE_2D,f,s,u.width,u.height,0,u.data)}else{K.texImage2D(K.TEXTURE_2D,f,s,u.width,u.height,0,s,o,u.data)}}}else{if(a.length>0&&r){for(var f=0,l=a.length;f<l;f++){u=a[f];K.texImage2D(K.TEXTURE_2D,f,s,s,o,u)}e.generateMipmaps=false}else{K.texImage2D(K.TEXTURE_2D,0,s,s,o,e.image)}}if(e.generateMipmaps&&r)K.generateMipmap(K.TEXTURE_2D);e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{K.activeTexture(K.TEXTURE0+t);K.bindTexture(K.TEXTURE_2D,e.__webglTexture)}};this.setRenderTarget=function(e){var t=e instanceof i.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){if(e.depthBuffer===undefined)e.depthBuffer=true;if(e.stencilBuffer===undefined)e.stencilBuffer=true;e.addEventListener("dispose",Lt);e.__webglTexture=K.createTexture();d.info.memory.textures++;var n=i.Math.isPowerOfTwo(e.width)&&i.Math.isPowerOfTwo(e.height),r=Qn(e.format),s=Qn(e.type);if(t){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];K.bindTexture(K.TEXTURE_CUBE_MAP,e.__webglTexture);Un(K.TEXTURE_CUBE_MAP,e,n);for(var o=0;o<6;o++){e.__webglFramebuffer[o]=K.createFramebuffer();e.__webglRenderbuffer[o]=K.createRenderbuffer();K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r,e.width,e.height,0,r,s,null);Vn(e.__webglFramebuffer[o],e,K.TEXTURE_CUBE_MAP_POSITIVE_X+o);$n(e.__webglRenderbuffer[o],e)}if(n)K.generateMipmap(K.TEXTURE_CUBE_MAP)}else{e.__webglFramebuffer=K.createFramebuffer();if(e.shareDepthFrom){e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer}else{e.__webglRenderbuffer=K.createRenderbuffer()}K.bindTexture(K.TEXTURE_2D,e.__webglTexture);Un(K.TEXTURE_2D,e,n);K.texImage2D(K.TEXTURE_2D,0,r,e.width,e.height,0,r,s,null);Vn(e.__webglFramebuffer,e,K.TEXTURE_2D);if(e.shareDepthFrom){if(e.depthBuffer&&!e.stencilBuffer){K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_ATTACHMENT,K.RENDERBUFFER,e.__webglRenderbuffer)}else if(e.depthBuffer&&e.stencilBuffer){K.framebufferRenderbuffer(K.FRAMEBUFFER,K.DEPTH_STENCIL_ATTACHMENT,K.RENDERBUFFER,e.__webglRenderbuffer)}}else{$n(e.__webglRenderbuffer,e)}if(n)K.generateMipmap(K.TEXTURE_2D)}if(t){K.bindTexture(K.TEXTURE_CUBE_MAP,null)}else{K.bindTexture(K.TEXTURE_2D,null)}K.bindRenderbuffer(K.RENDERBUFFER,null);K.bindFramebuffer(K.FRAMEBUFFER,null)}var u,a,f,l,c;if(e){if(t){u=e.__webglFramebuffer[e.activeCubeFace]}else{u=e.__webglFramebuffer}a=e.width;f=e.height;l=0;c=0}else{u=null;a=j;f=F;l=H;c=B}if(u!==y){K.bindFramebuffer(K.FRAMEBUFFER,u);K.viewport(l,c,a,f);y=u}I=a;q=f};this.shadowMapPlugin=new i.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new i.SpritePlugin);this.addPostPlugin(new i.LensFlarePlugin)};i.WebGLRenderTarget=function(e,t,n){this.width=e;this.height=t;n=n||{};this.wrapS=n.wrapS!==undefined?n.wrapS:i.ClampToEdgeWrapping;this.wrapT=n.wrapT!==undefined?n.wrapT:i.ClampToEdgeWrapping;this.magFilter=n.magFilter!==undefined?n.magFilter:i.LinearFilter;this.minFilter=n.minFilter!==undefined?n.minFilter:i.LinearMipMapLinearFilter;this.anisotropy=n.anisotropy!==undefined?n.anisotropy:1;this.offset=new i.Vector2(0,0);this.repeat=new i.Vector2(1,1);this.format=n.format!==undefined?n.format:i.RGBAFormat;this.type=n.type!==undefined?n.type:i.UnsignedByteType;this.depthBuffer=n.depthBuffer!==undefined?n.depthBuffer:true;this.stencilBuffer=n.stencilBuffer!==undefined?n.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=null};i.WebGLRenderTarget.prototype={constructor:i.WebGLRenderTarget,clone:function(){var e=new i.WebGLRenderTarget(this.width,this.height);e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.anisotropy=this.anisotropy;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.format=this.format;e.type=this.type;e.depthBuffer=this.depthBuffer;e.stencilBuffer=this.stencilBuffer;e.generateMipmaps=this.generateMipmaps;e.shareDepthFrom=this.shareDepthFrom;return e},dispose:function(){this.dispatchEvent({type:"dispose"})}};i.EventDispatcher.prototype.apply(i.WebGLRenderTarget.prototype);i.WebGLRenderTargetCube=function(e,t,n){i.WebGLRenderTarget.call(this,e,t,n);this.activeCubeFace=0};i.WebGLRenderTargetCube.prototype=Object.create(i.WebGLRenderTarget.prototype);i.RenderableVertex=function(){this.position=new i.Vector3;this.positionWorld=new i.Vector3;this.positionScreen=new i.Vector4;this.visible=true};i.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld);this.positionScreen.copy(e.positionScreen)};i.RenderableFace=function(){this.id=0;this.v1=new i.RenderableVertex;this.v2=new i.RenderableVertex;this.v3=new i.RenderableVertex;this.centroidModel=new i.Vector3;this.normalModel=new i.Vector3;this.vertexNormalsModel=[new i.Vector3,new i.Vector3,new i.Vector3];this.vertexNormalsLength=0;this.color=null;this.material=null;this.uvs=[[]];this.z=0};i.RenderableObject=function(){this.id=0;this.object=null;this.z=0};i.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new i.Vector2;this.material=null};i.RenderableLine=function(){this.id=0;this.v1=new i.RenderableVertex;this.v2=new i.RenderableVertex;this.vertexColors=[new i.Color,new i.Color];this.material=null;this.z=0};i.GeometryUtils={merge:function(e,t,n){var r,s,o=e.vertices.length,u=e.faceVertexUvs[0].length,a=t instanceof i.Mesh?t.geometry:t,f=e.vertices,l=a.vertices,c=e.faces,h=a.faces,p=e.faceVertexUvs[0],d=a.faceVertexUvs[0];if(n===undefined)n=0;if(t instanceof i.Mesh){t.matrixAutoUpdate&&t.updateMatrix();r=t.matrix;s=(new i.Matrix3).getNormalMatrix(r)}for(var v=0,m=l.length;v<m;v++){var g=l[v];var y=g.clone();if(r)y.applyMatrix4(r);f.push(y)}for(v=0,m=h.length;v<m;v++){var b=h[v],w,E,S,x=b.vertexNormals,T=b.vertexColors;w=new i.Face3(b.a+o,b.b+o,b.c+o);w.normal.copy(b.normal);if(s){w.normal.applyMatrix3(s).normalize()}for(var N=0,C=x.length;N<C;N++){E=x[N].clone();if(s){E.applyMatrix3(s).normalize()}w.vertexNormals.push(E)}w.color.copy(b.color);for(var N=0,C=T.length;N<C;N++){S=T[N];w.vertexColors.push(S.clone())}w.materialIndex=b.materialIndex+n;w.centroid.copy(b.centroid);if(r){w.centroid.applyMatrix4(r)}c.push(w)}for(v=0,m=d.length;v<m;v++){var k=d[v],L=[];for(var N=0,C=k.length;N<C;N++){L.push(new i.Vector2(k[N].x,k[N].y))}p.push(L)}},randomPointInTriangle:function(){var e=new i.Vector3;return function(t,n,r){var s=new i.Vector3;var o=i.Math.random16();var u=i.Math.random16();if(o+u>1){o=1-o;u=1-u}var a=1-o-u;s.copy(t);s.multiplyScalar(o);e.copy(n);e.multiplyScalar(u);s.add(e);e.copy(r);e.multiplyScalar(a);s.add(e);return s}}(),randomPointInFace:function(e,t,n){var r,s,o,u;r=t.vertices[e.a];s=t.vertices[e.b];o=t.vertices[e.c];return i.GeometryUtils.randomPointInTriangle(r,s,o)},randomPointsInGeometry:function(e,t){function d(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);if(f[i]>e){return t(n,i-1)}else if(f[i]<e){return t(i+1,r)}else{return i}}var n=t(0,f.length-1);return n}var n,r,s=e.faces,o=e.vertices,u=s.length,a=0,f=[],l,c,h,p;for(r=0;r<u;r++){n=s[r];l=o[n.a];c=o[n.b];h=o[n.c];n._area=i.GeometryUtils.triangleArea(l,c,h);a+=n._area;f[r]=a}var v,m,g=[];var y={};for(r=0;r<t;r++){v=i.Math.random16()*a;m=d(v);g[r]=i.GeometryUtils.randomPointInFace(s[m],e,true);if(!y[m]){y[m]=1}else{y[m]+=1}}return g},triangleArea:function(){var e=new i.Vector3;var t=new i.Vector3;return function(n,r,i){e.subVectors(r,n);t.subVectors(i,n);e.cross(t);return.5*e.length()}}(),center:function(e){e.computeBoundingBox();var t=e.boundingBox;var n=new i.Vector3;n.addVectors(t.min,t.max);n.multiplyScalar(-.5);e.applyMatrix((new i.Matrix4).makeTranslation(n.x,n.y,n.z));e.computeBoundingBox();return n},triangulateQuads:function(e){var t,n,r,i;var s=[];var o=[];for(t=0,n=e.faceVertexUvs.length;t<n;t++){o[t]=[]}for(t=0,n=e.faces.length;t<n;t++){var u=e.faces[t];s.push(u);for(r=0,i=e.faceVertexUvs.length;r<i;r++){o[r].push(e.faceVertexUvs[r][t])}}e.faces=s;e.faceVertexUvs=o;e.computeCentroids();e.computeFaceNormals();e.computeVertexNormals();if(e.hasTangents)e.computeTangents()}};i.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,n,r){var s=new i.ImageLoader;s.crossOrigin=this.crossOrigin;var o=new i.Texture(undefined,t);var u=s.load(e,function(){o.needsUpdate=true;if(n)n(o)});o.image=u;o.sourceFile=e;return o},loadCompressedTexture:function(e,t,n,r){var s=new i.CompressedTexture;s.mapping=t;var o=new XMLHttpRequest;o.onload=function(){var e=o.response;var t=i.ImageUtils.parseDDS(e,true);s.format=t.format;s.mipmaps=t.mipmaps;s.image.width=t.width;s.image.height=t.height;s.generateMipmaps=false;s.needsUpdate=true;if(n)n(s)};o.onerror=r;o.open("GET",e,true);o.responseType="arraybuffer";o.send(null);return s},loadTextureCube:function(e,t,n,r){var s=[];s.loadCount=0;var o=new i.Texture;o.image=s;if(t!==undefined)o.mapping=t;o.flipY=false;for(var u=0,a=e.length;u<a;++u){var f=new Image;s[u]=f;f.onload=function(){s.loadCount+=1;if(s.loadCount===6){o.needsUpdate=true;if(n)n(o)}};f.onerror=r;f.crossOrigin=this.crossOrigin;f.src=e[u]}return o},loadCompressedTextureCube:function(e,t,n,r){var s=[];s.loadCount=0;var o=new i.CompressedTexture;o.image=s;if(t!==undefined)o.mapping=t;o.flipY=false;o.generateMipmaps=false;var u=function(e,t){return function(){var r=e.response;var u=i.ImageUtils.parseDDS(r,true);t.format=u.format;t.mipmaps=u.mipmaps;t.width=u.width;t.height=u.height;s.loadCount+=1;if(s.loadCount===6){o.format=u.format;o.needsUpdate=true;if(n)n(o)}}};if(e instanceof Array){for(var a=0,f=e.length;a<f;++a){var l={};s[a]=l;var c=new XMLHttpRequest;c.onload=u(c,l);c.onerror=r;var h=e[a];c.open("GET",h,true);c.responseType="arraybuffer";c.send(null)}}else{var h=e;var c=new XMLHttpRequest;c.onload=function(){var e=c.response;var t=i.ImageUtils.parseDDS(e,true);if(t.isCubemap){var r=t.mipmaps.length/t.mipmapCount;for(var u=0;u<r;u++){s[u]={mipmaps:[]};for(var a=0;a<t.mipmapCount;a++){s[u].mipmaps.push(t.mipmaps[u*t.mipmapCount+a]);s[u].format=t.format;s[u].width=t.width;s[u].height=t.height}}o.format=t.format;o.needsUpdate=true;if(n)n(o)}};c.onerror=r;c.open("GET",h,true);c.responseType="arraybuffer";c.send(null)}return o},loadDDSTexture:function(e,t,n,r){var s=[];s.loadCount=0;var o=new i.CompressedTexture;o.image=s;if(t!==undefined)o.mapping=t;o.flipY=false;o.generateMipmaps=false;{var u=new XMLHttpRequest;u.onload=function(){var e=u.response;var t=i.ImageUtils.parseDDS(e,true);if(t.isCubemap){var r=t.mipmaps.length/t.mipmapCount;for(var a=0;a<r;a++){s[a]={mipmaps:[]};for(var f=0;f<t.mipmapCount;f++){s[a].mipmaps.push(t.mipmaps[a*t.mipmapCount+f]);s[a].format=t.format;s[a].width=t.width;s[a].height=t.height}}}else{o.image.width=t.width;o.image.height=t.height;o.mipmaps=t.mipmaps}o.format=t.format;o.needsUpdate=true;if(n)n(o)};u.onerror=r;u.open("GET",e,true);u.responseType="arraybuffer";u.send(null)}return o},parseDDS:function(e,t){function O(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function M(e){return String.fromCharCode(e&255,e>>8&255,e>>16&255,e>>24&255)}function _(e,t,n,r){var i=n*r*4;var s=new Uint8Array(e,t,i);var o=new Uint8Array(i);var u=0;var a=0;for(var f=0;f<r;f++){for(var l=0;l<n;l++){var c=s[a];a++;var h=s[a];a++;var p=s[a];a++;var d=s[a];a++;o[u]=p;u++;o[u]=h;u++;o[u]=c;u++;o[u]=d;u++}}return o}var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};var r=542327876;var s=1,o=2,u=4,a=8,f=4096,l=131072,c=524288,h=8388608;var p=8,d=4194304,v=4096;var m=512,g=1024,y=2048,b=4096,w=8192,E=16384,S=32768,x=2097152;var T=1,N=2,C=4,k=64,L=512,A=131072;var D=O("DXT1");var P=O("DXT3");var H=O("DXT5");var B=31;var j=0;var F=1;var I=2;var q=3;var R=4;var U=7;var z=20;var W=21;var X=22;var V=23;var $=24;var J=25;var K=26;var Q=27;var G=28;var Y=29;var Z=30;var et=new Int32Array(e,0,B);if(et[j]!==r){console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header");return n}if(!et[z]&C){console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code");return n}var tt;var nt=et[W];var rt=false;switch(nt){case D:tt=8;n.format=i.RGB_S3TC_DXT1_Format;break;case P:tt=16;n.format=i.RGBA_S3TC_DXT3_Format;break;case H:tt=16;n.format=i.RGBA_S3TC_DXT5_Format;break;default:if(et[X]==32&&et[V]&16711680&&et[$]&65280&&et[J]&255&&et[K]&4278190080){rt=true;tt=64;n.format=i.RGBAFormat}else{console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",M(nt));return n}}n.mipmapCount=1;if(et[I]&l&&t!==false){n.mipmapCount=Math.max(1,et[U])}n.isCubemap=et[G]&m?true:false;n.width=et[R];n.height=et[q];var it=et[F]+4;var st=n.width;var ot=n.height;var ut=n.isCubemap?6:1;for(var at=0;at<ut;at++){for(var ft=0;ft<n.mipmapCount;ft++){if(rt){var lt=_(e,it,st,ot);var ct=lt.length}else{var ct=Math.max(4,st)/4*Math.max(4,ot)/4*tt;var lt=new Uint8Array(e,it,ct)}var ht={data:lt,width:st,height:ot};n.mipmaps.push(ht);it+=ct;st=Math.max(st*.5,1);ot=Math.max(ot*.5,1)}st=n.width;ot=n.height}return n},getNormalMap:function(e,t){var n=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]};var r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]};var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=t|1;var s=e.width;var o=e.height;var u=document.createElement("canvas");u.width=s;u.height=o;var a=u.getContext("2d");a.drawImage(e,0,0);var f=a.getImageData(0,0,s,o).data;var l=a.createImageData(s,o);var c=l.data;for(var h=0;h<s;h++){for(var p=0;p<o;p++){var d=p-1<0?0:p-1;var v=p+1>o-1?o-1:p+1;var m=h-1<0?0:h-1;var g=h+1>s-1?s-1:h+1;var y=[];var b=[0,0,f[(p*s+h)*4]/255*t];y.push([-1,0,f[(p*s+m)*4]/255*t]);y.push([-1,-1,f[(d*s+m)*4]/255*t]);y.push([0,-1,f[(d*s+h)*4]/255*t]);y.push([1,-1,f[(d*s+g)*4]/255*t]);y.push([1,0,f[(p*s+g)*4]/255*t]);y.push([1,1,f[(v*s+g)*4]/255*t]);y.push([0,1,f[(v*s+h)*4]/255*t]);y.push([-1,1,f[(v*s+m)*4]/255*t]);var w=[];var E=y.length;for(var S=0;S<E;S++){var x=y[S];var T=y[(S+1)%E];x=r(x,b);T=r(T,b);w.push(i(n(x,T)))}var N=[0,0,0];for(var S=0;S<w.length;S++){N[0]+=w[S][0];N[1]+=w[S][1];N[2]+=w[S][2]}N[0]/=w.length;N[1]/=w.length;N[2]/=w.length;var C=(p*s+h)*4;c[C]=(N[0]+1)/2*255|0;c[C+1]=(N[1]+1)/2*255|0;c[C+2]=N[2]*255|0;c[C+3]=255}}a.putImageData(l,0,0);return u},generateDataTexture:function(e,t,n){var r=e*t;var s=new Uint8Array(3*r);var o=Math.floor(n.r*255);var u=Math.floor(n.g*255);var a=Math.floor(n.b*255);for(var f=0;f<r;f++){s[f*3]=o;s[f*3+1]=u;s[f*3+2]=a}var l=new i.DataTexture(s,e,t,i.RGBFormat);l.needsUpdate=true;return l}};i.SceneUtils={createMultiMaterialObject:function(e,t){var n=new i.Object3D;for(var r=0,s=t.length;r<s;r++){n.add(new i.Mesh(e,t[r]))}return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld);t.remove(e);n.add(e)},attach:function(e,t,n){var r=new i.Matrix4;r.getInverse(n.matrixWorld);e.applyMatrix(r);t.remove(e);n.add(e)}};i.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();var n=this;n.faces[t]=n.faces[t]||{};n.faces[t][e.cssFontWeight]=n.faces[t][e.cssFontWeight]||{};n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;var r=n.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t=[],n=[];var r,s,o=this.getFace(),u=this.size/o.resolution,a=0,f=String(e).split(""),l=f.length;var c=[];for(r=0;r<l;r++){var h=new i.Path;var p=this.extractGlyphPoints(f[r],o,u,a,h);a+=p.offset;c.push(p.path)}var d=a/2;return{paths:c,offset:d}},extractGlyphPoints:function(e,t,n,r,s){var o=[];var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C=t.glyphs[e]||t.glyphs["?"];if(!C)return;if(C.o){l=C._cachedOutline||(C._cachedOutline=C.o.split(" "));h=l.length;p=n;d=n;for(u=0;u<h;){c=l[u++];switch(c){case"m":v=l[u++]*p+r;m=l[u++]*d;s.moveTo(v,m);break;case"l":v=l[u++]*p+r;m=l[u++]*d;s.lineTo(v,m);break;case"q":g=l[u++]*p+r;y=l[u++]*d;E=l[u++]*p+r;S=l[u++]*d;s.quadraticCurveTo(E,S,g,y);N=o[o.length-1];if(N){b=N.x;w=N.y;for(a=1,f=this.divisions;a<=f;a++){var k=a/f;var L=i.Shape.Utils.b2(k,b,E,g);var A=i.Shape.Utils.b2(k,w,S,y)}}break;case"b":g=l[u++]*p+r;y=l[u++]*d;E=l[u++]*p+r;S=l[u++]*-d;x=l[u++]*p+r;T=l[u++]*-d;s.bezierCurveTo(g,y,E,S,x,T);N=o[o.length-1];if(N){b=N.x;w=N.y;for(a=1,f=this.divisions;a<=f;a++){var k=a/f;var L=i.Shape.Utils.b3(k,b,E,x,g);var A=i.Shape.Utils.b3(k,w,S,T,y)}}break}}}return{offset:C.ha*n,path:s}}};i.FontUtils.generateShapes=function(e,t){t=t||{};var n=t.size!==undefined?t.size:100;var r=t.curveSegments!==undefined?t.curveSegments:4;var s=t.font!==undefined?t.font:"helvetiker";var o=t.weight!==undefined?t.weight:"normal";var u=t.style!==undefined?t.style:"normal";i.FontUtils.size=n;i.FontUtils.divisions=r;i.FontUtils.face=s;i.FontUtils.weight=o;i.FontUtils.style=u;var a=i.FontUtils.drawText(e);var f=a.paths;var l=[];for(var c=0,h=f.length;c<h;c++){Array.prototype.push.apply(l,f[c].toShapes())}return l};(function(e){var t=1e-10;var n=function(e,t){var n=e.length;if(n<3)return null;var s=[],o=[],u=[];var a,f,l;if(r(e)>0){for(f=0;f<n;f++)o[f]=f}else{for(f=0;f<n;f++)o[f]=n-1-f}var c=n;var h=2*c;for(f=c-1;c>2;){if(h--<=0){console.log("Warning, unable to triangulate polygon!");if(t)return u;return s}a=f;if(c<=a)a=0;f=a+1;if(c<=f)f=0;l=f+1;if(c<=l)l=0;if(i(e,a,f,l,c,o)){var p,d,v,m,g;p=o[a];d=o[f];v=o[l];s.push([e[p],e[d],e[v]]);u.push([o[a],o[f],o[l]]);for(m=f,g=f+1;g<c;m++,g++){o[m]=o[g]}c--;h=2*c}}if(t)return u;return s};var r=function(e){var t=e.length;var n=0;for(var r=t-1,i=0;i<t;r=i++){n+=e[r].x*e[i].y-e[i].x*e[r].y}return n*.5};var i=function(e,n,r,i,s,o){var u;var a,f,l,c;var h,p,d,v;a=e[o[n]].x;f=e[o[n]].y;l=e[o[r]].x;c=e[o[r]].y;h=e[o[i]].x;p=e[o[i]].y;if(t>(l-a)*(p-f)-(c-f)*(h-a))return false;var m,g,y,b,w,E;var S,x,T,N,C,k;var L,A,O;m=h-l;g=p-c;y=a-h;b=f-p;w=l-a;E=c-f;for(u=0;u<s;u++){d=e[o[u]].x;v=e[o[u]].y;if(d===a&&v===f||d===l&&v===c||d===h&&v===p)continue;S=d-a;x=v-f;T=d-l;N=v-c;C=d-h;k=v-p;O=m*N-g*T;L=w*x-E*S;A=y*k-b*C;if(O>=-t&&A>=-t&&L>=-t)return false}return true};e.Triangulate=n;e.Triangulate.area=r;return e})(i.FontUtils);r._typeface_js={faces:i.FontUtils.faces,loadFace:i.FontUtils.loadFace};i.typeface_js=r._typeface_js;i.Curve=function(){};i.Curve.prototype.getPoint=function(e){console.log("Warning, getPoint() not implemented!");return null};i.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)};i.Curve.prototype.getPoints=function(e){if(!e)e=5;var t,n=[];for(t=0;t<=e;t++){n.push(this.getPoint(t/e))}return n};i.Curve.prototype.getSpacedPoints=function(e){if(!e)e=5;var t,n=[];for(t=0;t<=e;t++){n.push(this.getPointAt(t/e))}return n};i.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]};i.Curve.prototype.getLengths=function(e){if(!e)e=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var t=[];var n,r=this.getPoint(0);var i,s=0;t.push(0);for(i=1;i<=e;i++){n=this.getPoint(i/e);s+=n.distanceTo(r);t.push(s);r=n}this.cacheArcLengths=t;return t};i.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};i.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths();var r=0,i=n.length;var s;if(t){s=t}else{s=e*n[i-1]}var o=0,u=i-1,a;while(o<=u){r=Math.floor(o+(u-o)/2);a=n[r]-s;if(a<0){o=r+1;continue}else if(a>0){u=r-1;continue}else{u=r;break}}r=u;if(n[r]==s){var f=r/(i-1);return f}var l=n[r];var c=n[r+1];var h=c-l;var p=(s-l)/h;var f=(r+p)/(i-1);return f};i.Curve.prototype.getTangent=function(e){var t=1e-4;var n=e-t;var r=e+t;if(n<0)n=0;if(r>1)r=1;var i=this.getPoint(n);var s=this.getPoint(r);var o=s.clone().sub(i);return o.normalize()};i.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)};i.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){var s=6*e*e-6*e;var o=3*e*e-4*e+1;var u=-6*e*e+6*e;var a=3*e*e-2*e;return s+o+u+a},interpolate:function(e,t,n,r,i){var s=(n-e)*.5;var o=(r-t)*.5;var u=i*i;var a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t}};i.Curve.create=function(e,t){e.prototype=Object.create(i.Curve.prototype);e.prototype.getPoint=t;return e};i.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};i.CurvePath.prototype=Object.create(i.Curve.prototype);i.CurvePath.prototype.add=function(e){this.curves.push(e)};i.CurvePath.prototype.checkConnection=function(){};i.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0);var t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){this.curves.push(new i.LineCurve(t,e))}};i.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength();var n=this.getCurveLengths();var r=0,i,s;while(r<n.length){if(n[r]>=t){i=n[r]-t;s=this.curves[r];var o=1-i/s.getLength();return s.getPointAt(o);break}r++}return null};i.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};i.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var e=[],t=0;var n,r=this.curves.length;for(n=0;n<r;n++){t+=this.curves[n].getLength();e.push(t)}this.cacheLengths=e;return e};i.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints();var t,n,r;var s,o,u;t=n=Number.NEGATIVE_INFINITY;s=o=Number.POSITIVE_INFINITY;var a,f,l,c;var h=e[0]instanceof i.Vector3;c=h?new i.Vector3:new i.Vector2;for(f=0,l=e.length;f<l;f++){a=e[f];if(a.x>t)t=a.x;else if(a.x<s)s=a.x;if(a.y>n)n=a.y;else if(a.y<o)o=a.y;if(h){if(a.z>r)r=a.z;else if(a.z<u)u=a.z}c.add(a)}var p={minX:s,minY:o,maxX:t,maxY:n,centroid:c.divideScalar(l)};if(h){p.maxZ=r;p.minZ=u}return p};i.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,true);return this.createGeometry(t)};i.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,true);return this.createGeometry(t)};i.CurvePath.prototype.createGeometry=function(e){var t=new i.Geometry;for(var n=0;n<e.length;n++){t.vertices.push(new i.Vector3(e[n].x,e[n].y,e[n].z||0))}return t};i.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)};i.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e);var r,i;if(!t){t=this.bends}for(r=0,i=t.length;r<i;r++){n=this.getWrapPoints(n,t[r])}return n};i.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e);var r,i;if(!t){t=this.bends}for(r=0,i=t.length;r<i;r++){n=this.getWrapPoints(n,t[r])}return n};i.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox();var r,i,s,o,u,a;for(r=0,i=e.length;r<i;r++){s=e[r];o=s.x;u=s.y;a=o/n.maxX;a=t.getUtoTmapping(a,o);var f=t.getPoint(a);var l=t.getTangent(a);l.set(-l.y,l.x).multiplyScalar(u);s.x=f.x+l.x;s.y=f.y+l.y}return e};i.Gyroscope=function(){i.Object3D.call(this)};i.Gyroscope.prototype=Object.create(i.Object3D.prototype);i.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject);this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,n=this.children.length;t<n;t++){this.children[t].updateMatrixWorld(e)}};i.Gyroscope.prototype.translationWorld=new i.Vector3;i.Gyroscope.prototype.translationObject=new i.Vector3;i.Gyroscope.prototype.quaternionWorld=new i.Quaternion;i.Gyroscope.prototype.quaternionObject=new i.Quaternion;i.Gyroscope.prototype.scaleWorld=new i.Vector3;i.Gyroscope.prototype.scaleObject=new i.Vector3;i.Path=function(e){i.CurvePath.call(this);this.actions=[];if(e){this.fromPoints(e)}};i.Path.prototype=Object.create(i.CurvePath.prototype);i.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};i.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++){this.lineTo(e[t].x,e[t].y)}};i.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:i.PathActions.MOVE_TO,args:n})};i.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments);var r=this.actions[this.actions.length-1].args;var s=r[r.length-2];var o=r[r.length-1];var u=new i.LineCurve(new i.Vector2(s,o),new i.Vector2(e,t));this.curves.push(u);this.actions.push({action:i.PathActions.LINE_TO,args:n})};i.Path.prototype.quadraticCurveTo=function(e,t,n,r){var s=Array.prototype.slice.call(arguments);var o=this.actions[this.actions.length-1].args;var u=o[o.length-2];var a=o[o.length-1];var f=new i.QuadraticBezierCurve(new i.Vector2(u,a),new i.Vector2(e,t),new i.Vector2(n,r));this.curves.push(f);this.actions.push({action:i.PathActions.QUADRATIC_CURVE_TO,args:s})};i.Path.prototype.bezierCurveTo=function(e,t,n,r,s,o){var u=Array.prototype.slice.call(arguments);var a=this.actions[this.actions.length-1].args;var f=a[a.length-2];var l=a[a.length-1];var c=new i.CubicBezierCurve(new i.Vector2(f,l),new i.Vector2(e,t),new i.Vector2(n,r),new i.Vector2(s,o));this.curves.push(c);this.actions.push({action:i.PathActions.BEZIER_CURVE_TO,args:u})};i.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments);var n=this.actions[this.actions.length-1].args;var r=n[n.length-2];var s=n[n.length-1];var o=[new i.Vector2(r,s)];Array.prototype.push.apply(o,e);var u=new i.SplineCurve(o);this.curves.push(u);this.actions.push({action:i.PathActions.CSPLINE_THRU,args:t})};i.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args;var u=o[o.length-2];var a=o[o.length-1];this.absarc(e+u,t+a,n,r,i,s)};i.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)};i.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args;var a=u[u.length-2];var f=u[u.length-1];this.absellipse(e+a,t+f,n,r,i,s,o)};i.Path.prototype.absellipse=function(e,t,n,r,s,o,u){var a=Array.prototype.slice.call(arguments);var f=new i.EllipseCurve(e,t,n,r,s,o,u);this.curves.push(f);var l=f.getPoint(1);a.push(l.x);a.push(l.y);this.actions.push({action:i.PathActions.ELLIPSE,args:a})};i.Path.prototype.getSpacedPoints=function(e,t){if(!e)e=40;var n=[];for(var r=0;r<e;r++){n.push(this.getPoint(r/e))}return n};i.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(e,t)}e=e||12;var n=[];var r,s,o,u,a;var f,l,c,h,p,d,v,m,g,y,b,w,E;for(r=0,s=this.actions.length;r<s;r++){o=this.actions[r];u=o.action;a=o.args;switch(u){case i.PathActions.MOVE_TO:n.push(new i.Vector2(a[0],a[1]));break;case i.PathActions.LINE_TO:n.push(new i.Vector2(a[0],a[1]));break;case i.PathActions.QUADRATIC_CURVE_TO:f=a[2];l=a[3];p=a[0];d=a[1];if(n.length>0){g=n[n.length-1];v=g.x;m=g.y}else{g=this.actions[r-1].args;v=g[g.length-2];m=g[g.length-1]}for(y=1;y<=e;y++){b=y/e;w=i.Shape.Utils.b2(b,v,p,f);E=i.Shape.Utils.b2(b,m,d,l);n.push(new i.Vector2(w,E))}break;case i.PathActions.BEZIER_CURVE_TO:f=a[4];l=a[5];p=a[0];d=a[1];c=a[2];h=a[3];if(n.length>0){g=n[n.length-1];v=g.x;m=g.y}else{g=this.actions[r-1].args;v=g[g.length-2];m=g[g.length-1]}for(y=1;y<=e;y++){b=y/e;w=i.Shape.Utils.b3(b,v,p,c,f);E=i.Shape.Utils.b3(b,m,d,h,l);n.push(new i.Vector2(w,E))}break;case i.PathActions.CSPLINE_THRU:g=this.actions[r-1].args;var S=new i.Vector2(g[g.length-2],g[g.length-1]);var x=[S];var T=e*a[0].length;x=x.concat(a[0]);var N=new i.SplineCurve(x);for(y=1;y<=T;y++){n.push(N.getPointAt(y/T))}break;case i.PathActions.ARC:var C=a[0],k=a[1],L=a[2],A=a[3],O=a[4],M=!!a[5];var _=O-A;var D;var P=e*2;for(y=1;y<=P;y++){b=y/P;if(!M){b=1-b}D=A+b*_;w=C+L*Math.cos(D);E=k+L*Math.sin(D);n.push(new i.Vector2(w,E))}break;case i.PathActions.ELLIPSE:var C=a[0],k=a[1],H=a[2],B=a[3],A=a[4],O=a[5],M=!!a[6];var _=O-A;var D;var P=e*2;for(y=1;y<=P;y++){b=y/P;if(!M){b=1-b}D=A+b*_;w=C+H*Math.cos(D);E=k+B*Math.sin(D);n.push(new i.Vector2(w,E))}break}}var j=n[n.length-1];var F=1e-10;if(Math.abs(j.x-n[0].x)<F&&Math.abs(j.y-n[0].y)<F)n.splice(n.length-1,1);if(t){n.push(n[0])}return n};i.Path.prototype.toShapes=function(e){function t(e,t){var n=1e-10;var r=t.length;var i=false;for(var s=r-1,o=0;o<r;s=o++){var u=t[s];var a=t[o];var f=a.x-u.x;var l=a.y-u.y;if(Math.abs(l)>n){if(l<0){u=t[o];f=-f;a=t[s];l=-l}if(e.y<u.y||e.y>a.y)continue;if(e.y==u.y){if(e.x==u.x)return true}else{var c=l*(e.x-u.x)-f*(e.y-u.y);if(c==0)return true;if(c<0)continue;i=!i}}else{if(e.y!=u.y)continue;if(a.x<=e.x&&e.x<=u.x||u.x<=e.x&&e.x<=a.x)return true}}return i}var n,r,s,o,u;var a=[],f=new i.Path;for(n=0,r=this.actions.length;n<r;n++){s=this.actions[n];u=s.args;o=s.action;if(o==i.PathActions.MOVE_TO){if(f.actions.length!=0){a.push(f);f=new i.Path}}f[o].apply(f,u)}if(f.actions.length!=0){a.push(f)}if(a.length==0)return[];var l,c,h,p=[];if(a.length==1){c=a[0];h=new i.Shape;h.actions=c.actions;h.curves=c.curves;p.push(h);return p}var d=!i.Shape.Utils.isClockWise(a[0].getPoints());d=e?!d:d;var v=[];var m=[];var g=[];var y=0;var b;m[y]=undefined;g[y]=[];for(n=0,r=a.length;n<r;n++){c=a[n];b=c.getPoints();l=i.Shape.Utils.isClockWise(b);l=e?!l:l;if(l){if(!d&&m[y])y++;m[y]={s:new i.Shape,p:b};m[y].s.actions=c.actions;m[y].s.curves=c.curves;if(d)y++;g[y]=[]}else{g[y].push({h:c,p:b[0]})}}if(m.length>1){var w=false;var E=[];for(var S=0,x=m.length;S<x;S++){v[S]=[]}for(var S=0,x=m.length;S<x;S++){var T=m[S];var N=g[S];for(var C=0;C<N.length;C++){var k=N[C];var L=true;for(var A=0;A<m.length;A++){if(t(k.p,m[A].p)){if(S!=A)E.push({froms:S,tos:A,hole:C});if(L){L=false;v[A].push(k)}else{w=true}}}if(L){v[S].push(k)}}}if(E.length>0){if(!w)g=v}}var O,M,_;for(n=0,r=m.length;n<r;n++){h=m[n].s;p.push(h);O=g[n];for(M=0,_=O.length;M<_;M++){h.holes.push(O[M].h)}}return p};i.Shape=function(){i.Path.apply(this,arguments);this.holes=[]};i.Shape.prototype=Object.create(i.Path.prototype);i.Shape.prototype.extrude=function(e){var t=new i.ExtrudeGeometry(this,e);return t};i.Shape.prototype.makeGeometry=function(e){var t=new i.ShapeGeometry(this,e);return t};i.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++){r[t]=this.holes[t].getTransformedPoints(e,this.bends)}return r};i.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++){r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends)}return r};i.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}};i.Shape.prototype.extractPoints=function(e){if(this.useSpacedPoints){return this.extractAllSpacedPoints(e)}return this.extractAllPoints(e)};i.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}};i.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){if(e.x!=t.x){if(e.x<t.x){return e.x<=n.x&&n.x<=t.x}else{return t.x<=n.x&&n.x<=e.x}}else{if(e.y<t.y){return e.y<=n.y&&n.y<=t.y}else{return t.y<=n.y&&n.y<=e.y}}}function r(e,t,r,i,s){var o=1e-10;var u=t.x-e.x,a=t.y-e.y;var f=i.x-r.x,l=i.y-r.y;var c=e.x-r.x;var h=e.y-r.y;var p=a*f-u*l;var d=a*c-u*h;if(Math.abs(p)>o){var v;if(p>0){if(d<0||d>p)return[];v=l*c-f*h;if(v<0||v>p)return[]}else{if(d>0||d<p)return[];v=l*c-f*h;if(v>0||v<p)return[]}if(v==0){if(s&&(d==0||d==p))return[];return[e]}if(v==p){if(s&&(d==0||d==p))return[];return[t]}if(d==0)return[r];if(d==p)return[i];var m=v/p;return[{x:e.x+m*u,y:e.y+m*a}]}else{if(d!=0||l*c!=f*h)return[];var g=u==0&&a==0;var y=f==0&&l==0;if(g&&y){if(e.x!=r.x||e.y!=r.y)return[];return[e]}if(g){if(!n(r,i,e))return[];return[e]}if(y){if(!n(e,t,r))return[];return[r]}var b,w,E,S;var x,T,N,C;if(u!=0){if(e.x<t.x){b=e;E=e.x;w=t;S=t.x}else{b=t;E=t.x;w=e;S=e.x}if(r.x<i.x){x=r;N=r.x;T=i;C=i.x}else{x=i;N=i.x;T=r;C=r.x}}else{if(e.y<t.y){b=e;E=e.y;w=t;S=t.y}else{b=t;E=t.y;w=e;S=e.y}if(r.y<i.y){x=r;N=r.y;T=i;C=i.y}else{x=i;N=i.y;T=r;C=r.y}}if(E<=N){if(S<N)return[];if(S==N){if(s)return[];return[x]}if(S<=C)return[x,w];return[x,T]}else{if(E>C)return[];if(E==C){if(s)return[];return[b]}if(S<=C)return[b,w];return[b,T]}}}function s(e,t,n,r){var i=1e-10;var s=t.x-e.x,o=t.y-e.y;var u=n.x-e.x,a=n.y-e.y;var f=r.x-e.x,l=r.y-e.y;var c=s*a-o*u;var h=s*l-o*f;if(Math.abs(c)>i){var p=f*a-l*u;if(c>0){return h>=0&&p>=0}else{return h>=0||p>=0}}else{return h>0}}function o(e,t){function o(e,t){var r=n.length-1;var o=e-1;if(o<0)o=r;var u=e+1;if(u>r)u=0;var a=s(n[e],n[o],n[u],i[t]);if(!a){return false}var f=i.length-1;var l=t-1;if(l<0)l=f;var c=t+1;if(c>f)c=0;a=s(i[t],i[l],i[c],n[e]);if(!a){return false}return true}function u(e,t){var i,s,o;for(i=0;i<n.length;i++){s=i+1;s%=n.length;o=r(e,t,n[i],n[s],true);if(o.length>0)return true}return false}function f(e,n){var i,s,o,u,f;for(i=0;i<a.length;i++){s=t[a[i]];for(o=0;o<s.length;o++){u=o+1;u%=s.length;f=r(e,n,s[o],s[u],true);if(f.length>0)return true}}return false}var n=e.concat();var i;var a=[];var l,c,h,p,d,v,m=[],g,y,b,w;for(var E=0,S=t.length;E<S;E++){a.push(E)}var x=a.length*2;while(a.length>0){x--;if(x<0){console.log("Infinite Loop! Holes left:"+a.length+", Probably Hole outside Shape!");break}for(c=0;c<n.length;c++){h=n[c];l=-1;for(var E=0;E<a.length;E++){d=a[E];v=h.x+":"+h.y+":"+d;if(m[v]!==undefined)continue;i=t[d];for(var T=0;T<i.length;T++){p=i[T];if(!o(c,T))continue;if(u(h,p))continue;if(f(h,p))continue;l=T;a.splice(E,1);g=n.slice(0,c+1);y=n.slice(c);b=i.slice(l);w=i.slice(0,l+1);n=g.concat(b).concat(w).concat(y);break}if(l>=0)break;m[v]=true}if(l>=0)break}}return n}var u,a,f,l,c,h,p={};var d=e.concat();for(var v=0,m=t.length;v<m;v++){Array.prototype.push.apply(d,t[v])}for(u=0,a=d.length;u<a;u++){c=d[u].x+":"+d[u].y;if(p[c]!==undefined){console.log("Duplicate point",c)}p[c]=u}var g=o(e,t);var y=i.FontUtils.Triangulate(g,false);for(u=0,a=y.length;u<a;u++){l=y[u];for(f=0;f<3;f++){c=l[f].x+":"+l[f].y;h=p[c];if(h!==undefined){l[f]=h}}}return y.concat()},isClockWise:function(e){return i.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){var n=1-e;return 3*n*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}};i.LineCurve=function(e,t){this.v1=e;this.v2=t};i.LineCurve.prototype=Object.create(i.Curve.prototype);i.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);t.multiplyScalar(e).add(this.v1);return t};i.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};i.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()};i.QuadraticBezierCurve=function(e,t,n){this.v0=e;this.v1=t;this.v2=n};i.QuadraticBezierCurve.prototype=Object.create(i.Curve.prototype);i.QuadraticBezierCurve.prototype.getPoint=function(e){var t,n;t=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);n=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return new i.Vector2(t,n)};i.QuadraticBezierCurve.prototype.getTangent=function(e){var t,n;t=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);n=i.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var r=new i.Vector2(t,n);r.normalize();return r};i.CubicBezierCurve=function(e,t,n,r){this.v0=e;this.v1=t;this.v2=n;this.v3=r};i.CubicBezierCurve.prototype=Object.create(i.Curve.prototype);i.CubicBezierCurve.prototype.getPoint=function(e){var t,n;t=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);n=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new i.Vector2(t,n)};i.CubicBezierCurve.prototype.getTangent=function(e){var t,n;t=i.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);n=i.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new i.Vector2(t,n);r.normalize();return r};i.SplineCurve=function(e){this.points=e==undefined?[]:e};i.SplineCurve.prototype=Object.create(i.Curve.prototype);i.SplineCurve.prototype.getPoint=function(e){var t=new i.Vector2;var n=[];var r=this.points,s,o,u;s=(r.length-1)*e;o=Math.floor(s);u=s-o;n[0]=o==0?o:o-1;n[1]=o;n[2]=o>r.length-2?r.length-1:o+1;n[3]=o>r.length-3?r.length-1:o+2;t.x=i.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,u);t.y=i.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,u);return t};i.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e;this.aY=t;this.xRadius=n;this.yRadius=r;this.aStartAngle=i;this.aEndAngle=s;this.aClockwise=o};i.EllipseCurve.prototype=Object.create(i.Curve.prototype);i.EllipseCurve.prototype.getPoint=function(e){var t;var n=this.aEndAngle-this.aStartAngle;if(n<0)n+=Math.PI*2;if(n>Math.PI*2)n-=Math.PI*2;if(this.aClockwise===true){t=this.aEndAngle+(1-e)*(Math.PI*2-n)}else{t=this.aStartAngle+e*n}var r=this.aX+this.xRadius*Math.cos(t);var s=this.aY+this.yRadius*Math.sin(t);return new i.Vector2(r,s)};i.ArcCurve=function(e,t,n,r,s,o){i.EllipseCurve.call(this,e,t,n,n,r,s,o)};i.ArcCurve.prototype=Object.create(i.EllipseCurve.prototype);i.LineCurve3=i.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new i.Vector3;t.subVectors(this.v2,this.v1);t.multiplyScalar(e);t.add(this.v1);return t});i.QuadraticBezierCurve3=i.Curve.create(function(e,t,n){this.v0=e;this.v1=t;this.v2=n},function(e){var t,n,r;t=i.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);n=i.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);r=i.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return new i.Vector3(t,n,r)});i.CubicBezierCurve3=i.Curve.create(function(e,t,n,r){this.v0=e;this.v1=t;this.v2=n;this.v3=r},function(e){var t,n,r;t=i.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);n=i.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);r=i.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new i.Vector3(t,n,r)});i.SplineCurve3=i.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=new i.Vector3;var n=[];var r=this.points,s,o,u;s=(r.length-1)*e;o=Math.floor(s);u=s-o;n[0]=o==0?o:o-1;n[1]=o;n[2]=o>r.length-2?r.length-1:o+1;n[3]=o>r.length-3?r.length-1:o+2;var a=r[n[0]],f=r[n[1]],l=r[n[2]],c=r[n[3]];t.x=i.Curve.Utils.interpolate(a.x,f.x,l.x,c.x,u);t.y=i.Curve.Utils.interpolate(a.y,f.y,l.y,c.y,u);t.z=i.Curve.Utils.interpolate(a.z,f.z,l.z,c.z,u);return t});i.ClosedSplineCurve3=i.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=new i.Vector3;var n=[];var r=this.points,s,o,u;s=(r.length-0)*e;o=Math.floor(s);u=s-o;o+=o>0?0:(Math.floor(Math.abs(o)/r.length)+1)*r.length;n[0]=(o-1)%r.length;n[1]=o%r.length;n[2]=(o+1)%r.length;n[3]=(o+2)%r.length;t.x=i.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,u);t.y=i.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,u);t.z=i.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,u);return t});i.AnimationHandler=function(){var e=[];var t={};var n={};n.update=function(t){for(var n=0;n<e.length;n++)e[n].update(t)};n.addToUpdate=function(t){if(e.indexOf(t)===-1)e.push(t)};n.removeFromUpdate=function(t){var n=e.indexOf(t);if(n!==-1)e.splice(n,1)};n.add=function(e){if(t[e.name]!==undefined)console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting.");t[e.name]=e;s(e)};n.get=function(e){if(typeof e==="string"){if(t[e]){return t[e]}else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+e);return null}}else{}};n.parse=function(e){var t=[];if(e instanceof i.SkinnedMesh){for(var n=0;n<e.bones.length;n++){t.push(e.bones[n])}}else{r(e,t)}return t};var r=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)r(e.children[n],t)};var s=function(e){if(e.initialized===true)return;for(var t=0;t<e.hierarchy.length;t++){for(var n=0;n<e.hierarchy[t].keys.length;n++){if(e.hierarchy[t].keys[n].time<0)e.hierarchy[t].keys[n].time=0;if(e.hierarchy[t].keys[n].rot!==undefined&&!(e.hierarchy[t].keys[n].rot instanceof i.Quaternion)){var r=e.hierarchy[t].keys[n].rot;e.hierarchy[t].keys[n].rot=new i.Quaternion(r[0],r[1],r[2],r[3])}}if(e.hierarchy[t].keys.length&&e.hierarchy[t].keys[0].morphTargets!==undefined){var s={};for(var n=0;n<e.hierarchy[t].keys.length;n++){for(var o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++){var u=e.hierarchy[t].keys[n].morphTargets[o];s[u]=-1}}e.hierarchy[t].usedMorphTargets=s;for(var n=0;n<e.hierarchy[t].keys.length;n++){var a={};for(var u in s){for(var o=0;o<e.hierarchy[t].keys[n].morphTargets.length;o++){if(e.hierarchy[t].keys[n].morphTargets[o]===u){a[u]=e.hierarchy[t].keys[n].morphTargetsInfluences[o];break}}if(o===e.hierarchy[t].keys[n].morphTargets.length){a[u]=0}}e.hierarchy[t].keys[n].morphTargetsInfluences=a}}for(var n=1;n<e.hierarchy[t].keys.length;n++){if(e.hierarchy[t].keys[n].time===e.hierarchy[t].keys[n-1].time){e.hierarchy[t].keys.splice(n,1);n--}}for(var n=0;n<e.hierarchy[t].keys.length;n++){e.hierarchy[t].keys[n].index=n}}e.initialized=true};n.LINEAR=0;n.CATMULLROM=1;n.CATMULLROM_FORWARD=2;return n}();i.Animation=function(e,t){this.root=e;this.data=i.AnimationHandler.get(t);this.hierarchy=i.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.isPaused=true;this.loop=true;this.interpolationType=i.AnimationHandler.LINEAR};i.Animation.prototype.play=function(e){this.currentTime=e!==undefined?e:0;if(this.isPlaying===false){this.isPlaying=true;this.reset();this.update(0)}this.isPaused=false;i.AnimationHandler.addToUpdate(this)};i.Animation.prototype.pause=function(){if(this.isPaused===true){i.AnimationHandler.addToUpdate(this)}else{i.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};i.Animation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;i.AnimationHandler.removeFromUpdate(this)};i.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];n.matrixAutoUpdate=true;if(n.animationCache===undefined){n.animationCache={};n.animationCache.prevKey={pos:0,rot:0,scl:0};n.animationCache.nextKey={pos:0,rot:0,scl:0};n.animationCache.originalMatrix=n instanceof i.Bone?n.skinMatrix:n.matrix}var r=n.animationCache.prevKey;var s=n.animationCache.nextKey;r.pos=this.data.hierarchy[e].keys[0];r.rot=this.data.hierarchy[e].keys[0];r.scl=this.data.hierarchy[e].keys[0];s.pos=this.getNextKeyWith("pos",e,1);s.rot=this.getNextKeyWith("rot",e,1);s.scl=this.getNextKeyWith("scl",e,1)}};i.Animation.prototype.update=function(){var e=[];var t=new i.Vector3;var n=function(e,t){var n=[],i=[],s,o,u,a,f,l,c,h,p;s=(e.length-1)*t;o=Math.floor(s);u=s-o;n[0]=o===0?o:o-1;n[1]=o;n[2]=o>e.length-2?o:o+1;n[3]=o>e.length-3?o:o+2;l=e[n[0]];c=e[n[1]];h=e[n[2]];p=e[n[3]];a=u*u;f=u*a;i[0]=r(l[0],c[0],h[0],p[0],u,a,f);i[1]=r(l[1],c[1],h[1],p[1],u,a,f);i[2]=r(l[2],c[2],h[2],p[2],u,a,f);return i};var r=function(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t};return function(r){if(this.isPlaying===false)return;this.currentTime+=r*this.timeScale;var s;var o=["pos","rot","scl"];var u=this.data.length;if(this.loop===true&&this.currentTime>u){this.currentTime%=u;this.reset()}else if(this.loop===false&&this.currentTime>u){this.stop();return}this.currentTime=Math.min(this.currentTime,u);for(var a=0,f=this.hierarchy.length;a<f;a++){var l=this.hierarchy[a];var c=l.animationCache;for(var h=0;h<3;h++){var p=o[h];var d=c.prevKey[p];var v=c.nextKey[p];if(v.time<=this.currentTime){d=this.data.hierarchy[a].keys[0];v=this.getNextKeyWith(p,a,1);while(v.time<this.currentTime&&v.index>d.index){d=v;v=this.getNextKeyWith(p,a,v.index+1)}c.prevKey[p]=d;c.nextKey[p]=v}l.matrixAutoUpdate=true;l.matrixWorldNeedsUpdate=true;var m=(this.currentTime-d.time)/(v.time-d.time);var g=d[p];var y=v[p];if(m<0)m=0;if(m>1)m=1;if(p==="pos"){s=l.position;if(this.interpolationType===i.AnimationHandler.LINEAR){s.x=g[0]+(y[0]-g[0])*m;s.y=g[1]+(y[1]-g[1])*m;s.z=g[2]+(y[2]-g[2])*m}else if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",a,d.index-1)["pos"];e[1]=g;e[2]=y;e[3]=this.getNextKeyWith("pos",a,v.index+1)["pos"];m=m*.33+.33;var b=n(e,m);s.x=b[0];s.y=b[1];s.z=b[2];if(this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){var w=n(e,m*1.01);t.set(w[0],w[1],w[2]);t.sub(s);t.y=0;t.normalize();var E=Math.atan2(t.x,t.z);l.rotation.set(0,E,0)}}}else if(p==="rot"){i.Quaternion.slerp(g,y,l.quaternion,m)}else if(p==="scl"){s=l.scale;s.x=g[0]+(y[0]-g[0])*m;s.y=g[1]+(y[1]-g[1])*m;s.z=g[2]+(y[2]-g[2])*m}}}}}();i.Animation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){n=n<r.length-1?n:r.length-1}else{n=n%r.length}for(;n<r.length;n++){if(r[n][e]!==undefined){return r[n]}}return this.data.hierarchy[t].keys[0]};i.Animation.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;if(this.interpolationType===i.AnimationHandler.CATMULLROM||this.interpolationType===i.AnimationHandler.CATMULLROM_FORWARD){n=n>0?n:0}else{n=n>=0?n:n+r.length}for(;n>=0;n--){if(r[n][e]!==undefined){return r[n]}}return this.data.hierarchy[t].keys[r.length-1]};i.KeyFrameAnimation=function(e,t){this.root=e;this.data=i.AnimationHandler.get(t);this.hierarchy=i.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var n=0,r=this.hierarchy.length;n<r;n++){var s=this.data.hierarchy[n].keys,o=this.data.hierarchy[n].sids,u=this.hierarchy[n];if(s.length&&o){for(var a=0;a<o.length;a++){var f=o[a],l=this.getNextKeyWith(f,n,0);if(l){l.apply(f)}}u.matrixAutoUpdate=false;this.data.hierarchy[n].node.updateMatrix();u.matrixWorldNeedsUpdate=true}}};i.KeyFrameAnimation.prototype.play=function(e){this.currentTime=e!==undefined?e:0;if(this.isPlaying===false){this.isPlaying=true;var t,n=this.hierarchy.length,r,s;for(t=0;t<n;t++){r=this.hierarchy[t];s=this.data.hierarchy[t];if(s.animationCache===undefined){s.animationCache={};s.animationCache.prevKey=null;s.animationCache.nextKey=null;s.animationCache.originalMatrix=r instanceof i.Bone?r.skinMatrix:r.matrix}var o=this.data.hierarchy[t].keys;if(o.length){s.animationCache.prevKey=o[0];s.animationCache.nextKey=o[1];this.startTime=Math.min(o[0].time,this.startTime);this.endTime=Math.max(o[o.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;i.AnimationHandler.addToUpdate(this)};i.KeyFrameAnimation.prototype.pause=function(){if(this.isPaused){i.AnimationHandler.addToUpdate(this)}else{i.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};i.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;i.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e];var n=this.data.hierarchy[e];if(n.animationCache!==undefined){var r=n.animationCache.originalMatrix;if(t instanceof i.Bone){r.copy(t.skinMatrix);t.skinMatrix=r}else{r.copy(t.matrix);t.matrix=r}delete n.animationCache}}};i.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying===false)return;this.currentTime+=e*this.timeScale;var t=this.data.length;if(this.loop===true&&this.currentTime>t){this.currentTime%=t}this.currentTime=Math.min(this.currentTime,t);for(var n=0,r=this.hierarchy.length;n<r;n++){var i=this.hierarchy[n];var s=this.data.hierarchy[n];var o=s.keys,u=s.animationCache;if(o.length){var a=u.prevKey;var f=u.nextKey;if(f.time<=this.currentTime){while(f.time<this.currentTime&&f.index>a.index){a=f;f=o[a.index+1]}u.prevKey=a;u.nextKey=f}if(f.time>=this.currentTime){a.interpolate(f,this.currentTime)}else{a.interpolate(f,f.time)}this.data.hierarchy[n].node.updateMatrix();i.matrixWorldNeedsUpdate=true}}};i.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;n=n%r.length;for(;n<r.length;n++){if(r[n].hasTarget(e)){return r[n]}}return r[0]};i.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;n=n>=0?n:n+r.length;for(;n>=0;n--){if(r[n].hasTarget(e)){return r[n]}}return r[r.length-1]};i.MorphAnimation=function(e){this.mesh=e;this.frames=e.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.isPlaying=false};i.MorphAnimation.prototype={play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(){var e=0;var t=0;return function(n){if(this.isPlaying===false)return;this.currentTime+=n;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var r=this.duration/this.frames;var i=Math.floor(this.currentTime/r);if(i!=t){this.mesh.morphTargetInfluences[e]=0;this.mesh.morphTargetInfluences[t]=1;this.mesh.morphTargetInfluences[i]=0;e=t;t=i}this.mesh.morphTargetInfluences[i]=this.currentTime%r/r;this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[i]}}()};i.CubeCamera=function(e,t,n){i.Object3D.call(this);var r=90,s=1;var o=new i.PerspectiveCamera(r,s,e,t);o.up.set(0,-1,0);o.lookAt(new i.Vector3(1,0,0));this.add(o);var u=new i.PerspectiveCamera(r,s,e,t);u.up.set(0,-1,0);u.lookAt(new i.Vector3(-1,0,0));this.add(u);var a=new i.PerspectiveCamera(r,s,e,t);a.up.set(0,0,1);a.lookAt(new i.Vector3(0,1,0));this.add(a);var f=new i.PerspectiveCamera(r,s,e,t);f.up.set(0,0,-1);f.lookAt(new i.Vector3(0,-1,0));this.add(f);var l=new i.PerspectiveCamera(r,s,e,t);l.up.set(0,-1,0);l.lookAt(new i.Vector3(0,0,1));this.add(l);var c=new i.PerspectiveCamera(r,s,e,t);c.up.set(0,-1,0);c.lookAt(new i.Vector3(0,0,-1));this.add(c);this.renderTarget=new i.WebGLRenderTargetCube(n,n,{format:i.RGBFormat,magFilter:i.LinearFilter,minFilter:i.LinearFilter});this.updateCubeMap=function(e,t){var n=this.renderTarget;var r=n.generateMipmaps;n.generateMipmaps=false;n.activeCubeFace=0;e.render(t,o,n);n.activeCubeFace=1;e.render(t,u,n);n.activeCubeFace=2;e.render(t,a,n);n.activeCubeFace=3;e.render(t,f,n);n.activeCubeFace=4;e.render(t,l,n);n.generateMipmaps=r;n.activeCubeFace=5;e.render(t,c,n)}};i.CubeCamera.prototype=Object.create(i.Object3D.prototype);i.CombinedCamera=function(e,t,n,r,s,o,u){i.Camera.call(this);this.fov=n;this.left=-e/2;this.right=e/2;this.top=t/2;this.bottom=-t/2;this.cameraO=new i.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,u);this.cameraP=new i.PerspectiveCamera(n,e/t,r,s);this.zoom=1;this.toPerspective();var a=e/t};i.CombinedCamera.prototype=Object.create(i.Camera.prototype);i.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false};i.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov;var t=this.cameraP.aspect;var n=this.cameraP.near;var r=this.cameraP.far;var i=(n+r)/2;var s=Math.tan(e/2)*i;var o=2*s;var u=o*t;var a=u/2;s/=this.zoom;a/=this.zoom;this.cameraO.left=-a;this.cameraO.right=a;this.cameraO.top=s;this.cameraO.bottom=-s;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true};i.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t;this.left=-e/2;this.right=e/2;this.top=t/2;this.bottom=-t/2};i.CombinedCamera.prototype.setFov=function(e){this.fov=e;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};i.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPerspectiveMode){this.toPerspective()}else{this.toPerspective();this.toOrthographic()}};i.CombinedCamera.prototype.setLens=function(e,t){if(t===undefined)t=24;var n=2*i.Math.radToDeg(Math.atan(t/(e*2)));this.setFov(n);return n};i.CombinedCamera.prototype.setZoom=function(e){this.zoom=e;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};i.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};i.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};i.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};i.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};i.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};i.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};i.BoxGeometry=function(e,t,n,r,s,o){function c(e,t,n,r,s,o,a,f){var l,c,h,p=u.widthSegments,d=u.heightSegments,v=s/2,m=o/2,g=u.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x"){l="z"}else if(e==="x"&&t==="z"||e==="z"&&t==="x"){l="y";d=u.depthSegments}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){l="x";p=u.depthSegments}var y=p+1,b=d+1,w=s/p,E=o/d,S=new i.Vector3;S[l]=a>0?1:-1;for(h=0;h<b;h++){for(c=0;c<y;c++){var x=new i.Vector3;x[e]=(c*w-v)*n;x[t]=(h*E-m)*r;x[l]=a;u.vertices.push(x)}}for(h=0;h<d;h++){for(c=0;c<p;c++){var T=c+y*h;var N=c+y*(h+1);var C=c+1+y*(h+1);var k=c+1+y*h;var L=new i.Vector2(c/p,1-h/d);var A=new i.Vector2(c/p,1-(h+1)/d);var O=new i.Vector2((c+1)/p,1-(h+1)/d);var M=new i.Vector2((c+1)/p,1-h/d);var _=new i.Face3(T+g,N+g,k+g);_.normal.copy(S);_.vertexNormals.push(S.clone(),S.clone(),S.clone());_.materialIndex=f;u.faces.push(_);u.faceVertexUvs[0].push([L,A,M]);_=new i.Face3(N+g,C+g,k+g);_.normal.copy(S);_.vertexNormals.push(S.clone(),S.clone(),S.clone());_.materialIndex=f;u.faces.push(_);u.faceVertexUvs[0].push([A.clone(),O,M.clone()])}}}i.Geometry.call(this);var u=this;this.width=e;this.height=t;this.depth=n;this.widthSegments=r||1;this.heightSegments=s||1;this.depthSegments=o||1;var a=this.width/2;var f=this.height/2;var l=this.depth/2;c("z","y",-1,-1,this.depth,this.height,a,0);c("z","y",1,-1,this.depth,this.height,-a,1);c("x","z",1,1,this.width,this.depth,f,2);c("x","z",1,-1,this.width,this.depth,-f,3);c("x","y",1,-1,this.width,this.height,l,4);c("x","y",-1,-1,this.width,this.height,-l,5);this.computeCentroids();this.mergeVertices()};i.BoxGeometry.prototype=Object.create(i.Geometry.prototype);i.CircleGeometry=function(e,t,n,r){i.Geometry.call(this);this.radius=e=e||50;this.segments=t=t!==undefined?Math.max(3,t):8;this.thetaStart=n=n!==undefined?n:0;this.thetaLength=r=r!==undefined?r:Math.PI*2;var s,o=[],u=new i.Vector3,a=new i.Vector2(.5,.5);this.vertices.push(u);o.push(a);for(s=0;s<=t;s++){var f=new i.Vector3;var l=n+s/t*r;f.x=e*Math.cos(l);f.y=e*Math.sin(l);this.vertices.push(f);o.push(new i.Vector2((f.x/e+1)/2,(f.y/e+1)/2))}var c=new i.Vector3(0,0,1);for(s=1;s<=t;s++){var h=s;var p=s+1;var d=0;this.faces.push(new i.Face3(h,p,d,[c.clone(),c.clone(),c.clone()]));this.faceVertexUvs[0].push([o[s].clone(),o[s+1].clone(),a.clone()])}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.CircleGeometry.prototype=Object.create(i.Geometry.prototype);i.CubeGeometry=i.BoxGeometry;i.CylinderGeometry=function(e,t,n,r,s,o){i.Geometry.call(this);this.radiusTop=e=e!==undefined?e:20;this.radiusBottom=t=t!==undefined?t:20;this.height=n=n!==undefined?n:100;this.radialSegments=r=r||8;this.heightSegments=s=s||1;this.openEnded=o=o!==undefined?o:false;var u=n/2;var a,f,l=[],c=[];for(f=0;f<=s;f++){var h=[];var p=[];var d=f/s;var v=d*(t-e)+e;for(a=0;a<=r;a++){var m=a/r;var g=new i.Vector3;g.x=v*Math.sin(m*Math.PI*2);g.y=-d*n+u;g.z=v*Math.cos(m*Math.PI*2);this.vertices.push(g);h.push(this.vertices.length-1);p.push(new i.Vector2(m,1-d))}l.push(h);c.push(p)}var y=(t-e)/n;var b,w;for(a=0;a<r;a++){if(e!==0){b=this.vertices[l[0][a]].clone();w=this.vertices[l[0][a+1]].clone()}else{b=this.vertices[l[1][a]].clone();w=this.vertices[l[1][a+1]].clone()}b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*y).normalize();w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*y).normalize();for(f=0;f<s;f++){var E=l[f][a];var S=l[f+1][a];var x=l[f+1][a+1];var T=l[f][a+1];var N=b.clone();var C=b.clone();var k=w.clone();var L=w.clone();var A=c[f][a].clone();var O=c[f+1][a].clone();var M=c[f+1][a+1].clone();var _=c[f][a+1].clone();this.faces.push(new i.Face3(E,S,T,[N,C,L]));this.faceVertexUvs[0].push([A,O,_]);this.faces.push(new i.Face3(S,x,T,[C.clone(),k,L.clone()]));this.faceVertexUvs[0].push([O.clone(),M,_.clone()])}}if(o===false&&e>0){this.vertices.push(new i.Vector3(0,u,0));for(a=0;a<r;a++){var E=l[0][a];var S=l[0][a+1];var x=this.vertices.length-1;var N=new i.Vector3(0,1,0);var C=new i.Vector3(0,1,0);var k=new i.Vector3(0,1,0);var A=c[0][a].clone();var O=c[0][a+1].clone();var M=new i.Vector2(O.x,0);this.faces.push(new i.Face3(E,S,x,[N,C,k]));this.faceVertexUvs[0].push([A,O,M])}}if(o===false&&t>0){this.vertices.push(new i.Vector3(0,-u,0));for(a=0;a<r;a++){var E=l[f][a+1];var S=l[f][a];var x=this.vertices.length-1;var N=new i.Vector3(0,-1,0);var C=new i.Vector3(0,-1,0);var k=new i.Vector3(0,-1,0);var A=c[f][a+1].clone();var O=c[f][a].clone();var M=new i.Vector2(O.x,1);this.faces.push(new i.Face3(E,S,x,[N,C,k]));this.faceVertexUvs[0].push([A,O,M])}}this.computeCentroids();this.computeFaceNormals()};i.CylinderGeometry.prototype=Object.create(i.Geometry.prototype);i.ExtrudeGeometry=function(e,t){if(typeof e==="undefined"){e=[];return}i.Geometry.call(this);e=e instanceof Array?e:[e];this.shapebb=e[e.length-1].getBoundingBox();this.addShapeList(e,t);this.computeCentroids();this.computeFaceNormals()};i.ExtrudeGeometry.prototype=Object.create(i.Geometry.prototype);i.ExtrudeGeometry.prototype.addShapeList=function(e,t){var n=e.length;for(var r=0;r<n;r++){var i=e[r];this.addShape(i,t)}};i.ExtrudeGeometry.prototype.addShape=function(e,t){function D(e,t,n){if(!t)console.log("die");return t.clone().multiplyScalar(n).add(e)}function X(e,t,n){var r=1e-10;var s=i.Math.sign;var o,u,a=1;var f=e.x-t.x,l=e.y-t.y;var c=n.x-e.x,h=n.y-e.y;var p=f*f+l*l;var d=f*h-l*c;if(Math.abs(d)>r){var v=Math.sqrt(p);var m=Math.sqrt(c*c+h*h);var g=t.x-l/v;var y=t.y+f/v;var b=n.x-h/m;var w=n.y+c/m;var E=((b-g)*h-(w-y)*c)/(f*h-l*c);o=g+f*E-e.x;u=y+l*E-e.y;var S=o*o+u*u;if(S<=2){return new i.Vector2(o,u)}else{a=Math.sqrt(S/2)}}else{var x=false;if(f>r){if(c>r){x=true}}else{if(f<-r){if(c<-r){x=true}}else{if(s(l)==s(h)){x=true}}}if(x){o=-l;u=f;a=Math.sqrt(p)}else{o=f;u=l;a=Math.sqrt(p/2)}}return new i.Vector2(o/a,u/a)}function it(){if(u){var e=0;var t=I*e;for($=0;$<R;$++){q=M[$];at(q[2]+t,q[1]+t,q[0]+t,true)}e=f+o*2;t=I*e;for($=0;$<R;$++){q=M[$];at(q[0]+t,q[1]+t,q[2]+t,false)}}else{for($=0;$<R;$++){q=M[$];at(q[2],q[1],q[0],true)}for($=0;$<R;$++){q=M[$];at(q[0]+I*f,q[1]+I*f,q[2]+I*f,false)}}}function st(){var e=0;ot(_,e);e+=_.length;for(S=0,x=A.length;S<x;S++){E=A[S];ot(E,e);e+=E.length}}function ot(e,t){var n,r;$=e.length;while(--$>=0){n=$;r=$-1;if(r<0)r=e.length-1;var i=0,s=f+o*2;for(i=0;i<s;i++){var u=I*i;var a=I*(i+1);var l=t+n+u,c=t+r+u,h=t+r+a,p=t+n+a;ft(l,c,h,p,e,i,s,n,r)}}}function ut(e,t,n){T.vertices.push(new i.Vector3(e,t,n))}function at(n,r,s,o){n+=C;r+=C;s+=C;T.faces.push(new i.Face3(n,r,s,null,null,p));var u=o?v.generateBottomUV(T,e,t,n,r,s):v.generateTopUV(T,e,t,n,r,s);T.faceVertexUvs[0].push(u)}function ft(n,r,s,o,u,a,f,l,c){n+=C;r+=C;s+=C;o+=C;T.faces.push(new i.Face3(n,r,o,null,null,d));T.faces.push(new i.Face3(r,s,o,null,null,d));var h=v.generateSideWallUV(T,e,u,t,n,r,s,o,a,f,l,c);T.faceVertexUvs[0].push([h[0],h[1],h[3]]);T.faceVertexUvs[0].push([h[1],h[2],h[3]])}var n=t.amount!==undefined?t.amount:100;var r=t.bevelThickness!==undefined?t.bevelThickness:6;var s=t.bevelSize!==undefined?t.bevelSize:r-2;var o=t.bevelSegments!==undefined?t.bevelSegments:3;var u=t.bevelEnabled!==undefined?t.bevelEnabled:true;var a=t.curveSegments!==undefined?t.curveSegments:12;var f=t.steps!==undefined?t.steps:1;var l=t.extrudePath;var c,h=false;var p=t.material;var d=t.extrudeMaterial;var v=t.UVGenerator!==undefined?t.UVGenerator:i.ExtrudeGeometry.WorldUVGenerator;var m=this.shapebb;var g,y,b,w;if(l){c=l.getSpacedPoints(f);h=true;u=false;g=t.frames!==undefined?t.frames:new i.TubeGeometry.FrenetFrames(l,f,false);y=new i.Vector3;b=new i.Vector3;w=new i.Vector3}if(!u){o=0;r=0;s=0}var E,S,x;var T=this;var N=[];var C=this.vertices.length;var k=e.extractPoints(a);var L=k.shape;var A=k.holes;var O=!i.Shape.Utils.isClockWise(L);if(O){L=L.reverse();for(S=0,x=A.length;S<x;S++){E=A[S];if(i.Shape.Utils.isClockWise(E)){A[S]=E.reverse()}}O=false}var M=i.Shape.Utils.triangulateShape(L,A);var _=L;for(S=0,x=A.length;S<x;S++){E=A[S];L=L.concat(E)}var P,H,B,j,F,I=L.length,q,R=M.length,U,z=_.length;var W=180/Math.PI;var V=[];for(var $=0,J=_.length,K=J-1,Q=$+1;$<J;$++,K++,Q++){if(K===J)K=0;if(Q===J)Q=0;var G=_[$];var Y=_[K];var Z=_[Q];V[$]=X(_[$],_[K],_[Q])}var et=[],tt,nt=V.concat();for(S=0,x=A.length;S<x;S++){E=A[S];tt=[];for($=0,J=E.length,K=J-1,Q=$+1;$<J;$++,K++,Q++){if(K===J)K=0;if(Q===J)Q=0;tt[$]=X(E[$],E[K],E[Q])}et.push(tt);nt=nt.concat(tt)}for(P=0;P<o;P++){B=P/o;j=r*(1-B);H=s*Math.sin(B*Math.PI/2);for($=0,J=_.length;$<J;$++){F=D(_[$],V[$],H);ut(F.x,F.y,-j)}for(S=0,x=A.length;S<x;S++){E=A[S];tt=et[S];for($=0,J=E.length;$<J;$++){F=D(E[$],tt[$],H);ut(F.x,F.y,-j)}}}H=s;for($=0;$<I;$++){F=u?D(L[$],nt[$],H):L[$];if(!h){ut(F.x,F.y,0)}else{b.copy(g.normals[0]).multiplyScalar(F.x);y.copy(g.binormals[0]).multiplyScalar(F.y);w.copy(c[0]).add(b).add(y);ut(w.x,w.y,w.z)}}var rt;for(rt=1;rt<=f;rt++){for($=0;$<I;$++){F=u?D(L[$],nt[$],H):L[$];if(!h){ut(F.x,F.y,n/f*rt)}else{b.copy(g.normals[rt]).multiplyScalar(F.x);y.copy(g.binormals[rt]).multiplyScalar(F.y);w.copy(c[rt]).add(b).add(y);ut(w.x,w.y,w.z)}}}for(P=o-1;P>=0;P--){B=P/o;j=r*(1-B);H=s*Math.sin(B*Math.PI/2);for($=0,J=_.length;$<J;$++){F=D(_[$],V[$],H);ut(F.x,F.y,n+j)}for(S=0,x=A.length;S<x;S++){E=A[S];tt=et[S];for($=0,J=E.length;$<J;$++){F=D(E[$],tt[$],H);if(!h){ut(F.x,F.y,n+j)}else{ut(F.x,F.y+c[f-1].y,c[f-1].x+j)}}}}it();st()};i.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r,s,o){var u=e.vertices[r].x,a=e.vertices[r].y,f=e.vertices[s].x,l=e.vertices[s].y,c=e.vertices[o].x,h=e.vertices[o].y;return[new i.Vector2(u,a),new i.Vector2(f,l),new i.Vector2(c,h)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(e,t,n,r,s,o,u,a,f,l,c,h){var p=e.vertices[s].x,d=e.vertices[s].y,v=e.vertices[s].z,m=e.vertices[o].x,g=e.vertices[o].y,y=e.vertices[o].z,b=e.vertices[u].x,w=e.vertices[u].y,E=e.vertices[u].z,S=e.vertices[a].x,x=e.vertices[a].y,T=e.vertices[a].z;if(Math.abs(d-g)<.01){return[new i.Vector2(p,1-v),new i.Vector2(m,1-y),new i.Vector2(b,1-E),new i.Vector2(S,1-T)]}else{return[new i.Vector2(d,1-v),new i.Vector2(g,1-y),new i.Vector2(w,1-E),new i.Vector2(x,1-T)]}}};i.ExtrudeGeometry.__v1=new i.Vector2;i.ExtrudeGeometry.__v2=new i.Vector2;i.ExtrudeGeometry.__v3=new i.Vector2;i.ExtrudeGeometry.__v4=new i.Vector2;i.ExtrudeGeometry.__v5=new i.Vector2;i.ExtrudeGeometry.__v6=new i.Vector2;i.ShapeGeometry=function(e,t){i.Geometry.call(this);if(e instanceof Array===false)e=[e];this.shapebb=e[e.length-1].getBoundingBox();this.addShapeList(e,t);this.computeCentroids();this.computeFaceNormals()};i.ShapeGeometry.prototype=Object.create(i.Geometry.prototype);i.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++){this.addShape(e[n],t)}return this};i.ShapeGeometry.prototype.addShape=function(e,t){if(t===undefined)t={};var n=t.curveSegments!==undefined?t.curveSegments:12;var r=t.material;var s=t.UVGenerator===undefined?i.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;var o=this.shapebb;var u,a,f,l;var c=this.vertices.length;var h=e.extractPoints(n);var p=h.shape;var d=h.holes;var v=!i.Shape.Utils.isClockWise(p);if(v){p=p.reverse();for(u=0,a=d.length;u<a;u++){f=d[u];if(i.Shape.Utils.isClockWise(f)){d[u]=f.reverse()}}v=false}var m=i.Shape.Utils.triangulateShape(p,d);var g=p;for(u=0,a=d.length;u<a;u++){f=d[u];p=p.concat(f)}var y,b=p.length;var w,E=m.length;var S,x=g.length;for(u=0;u<b;u++){y=p[u];this.vertices.push(new i.Vector3(y.x,y.y,0))}for(u=0;u<E;u++){w=m[u];var T=w[0]+c;var N=w[1]+c;var C=w[2]+c;this.faces.push(new i.Face3(T,N,C,null,null,r));this.faceVertexUvs[0].push(s.generateBottomUV(this,e,t,T,N,C))}};i.LatheGeometry=function(e,t,n,r){i.Geometry.call(this);t=t||12;n=n||0;r=r||2*Math.PI;var s=1/(e.length-1);var o=1/t;for(var u=0,a=t;u<=a;u++){var f=n+u*o*r;var l=Math.cos(f),c=Math.sin(f);for(var h=0,p=e.length;h<p;h++){var d=e[h];var v=new i.Vector3;v.x=l*d.x-c*d.y;v.y=c*d.x+l*d.y;v.z=d.z;this.vertices.push(v)}}var m=e.length;for(var u=0,a=t;u<a;u++){for(var h=0,p=e.length-1;h<p;h++){var g=h+m*u;var y=g;var b=g+m;var l=g+1+m;var w=g+1;var E=u*o;var S=h*s;var x=E+o;var T=S+s;this.faces.push(new i.Face3(y,b,w));this.faceVertexUvs[0].push([new i.Vector2(E,S),new i.Vector2(x,S),new i.Vector2(E,T)]);this.faces.push(new i.Face3(b,l,w));this.faceVertexUvs[0].push([new i.Vector2(x,S),new i.Vector2(x,T),new i.Vector2(E,T)])}}this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};i.LatheGeometry.prototype=Object.create(i.Geometry.prototype);i.PlaneGeometry=function(e,t,n,r){i.Geometry.call(this);this.width=e;this.height=t;this.widthSegments=n||1;this.heightSegments=r||1;var s,o;var u=e/2;var a=t/2;var f=this.widthSegments;var l=this.heightSegments;var c=f+1;var h=l+1;var p=this.width/f;var d=this.height/l;var v=new i.Vector3(0,0,1);for(o=0;o<h;o++){for(s=0;s<c;s++){var m=s*p-u;var g=o*d-a;this.vertices.push(new i.Vector3(m,-g,0))}}for(o=0;o<l;o++){for(s=0;s<f;s++){var y=s+c*o;var b=s+c*(o+1);var w=s+1+c*(o+1);var E=s+1+c*o;var S=new i.Vector2(s/f,1-o/l);var x=new i.Vector2(s/f,1-(o+1)/l);var T=new i.Vector2((s+1)/f,1-(o+1)/l);var N=new i.Vector2((s+1)/f,1-o/l);var C=new i.Face3(y,b,E);C.normal.copy(v);C.vertexNormals.push(v.clone(),v.clone(),v.clone());this.faces.push(C);this.faceVertexUvs[0].push([S,x,N]);C=new i.Face3(b,w,E);C.normal.copy(v);C.vertexNormals.push(v.clone(),v.clone(),v.clone());this.faces.push(C);this.faceVertexUvs[0].push([x.clone(),T,N.clone()])}}this.computeCentroids()};i.PlaneGeometry.prototype=Object.create(i.Geometry.prototype);i.RingGeometry=function(e,t,n,r,s,o){i.Geometry.call(this);e=e||0;t=t||50;s=s!==undefined?s:0;o=o!==undefined?o:Math.PI*2;n=n!==undefined?Math.max(3,n):8;r=r!==undefined?Math.max(3,r):8;var u,a,f=[],l=e,c=(t-e)/r;for(u=0;u<=r;u++){for(a=0;a<=n;a++){var h=new i.Vector3;var p=s+a/n*o;h.x=l*Math.cos(p);h.y=l*Math.sin(p);this.vertices.push(h);f.push(new i.Vector2((h.x/t+1)/2,(h.y/t+1)/2))}l+=c}var d=new i.Vector3(0,0,1);for(u=0;u<r;u++){var v=u*n;for(a=0;a<=n;a++){var p=a+v;var m=p+u;var g=p+n+u;var y=p+n+1+u;this.faces.push(new i.Face3(m,g,y,[d.clone(),d.clone(),d.clone()]));this.faceVertexUvs[0].push([f[m].clone(),f[g].clone(),f[y].clone()]);m=p+u;g=p+n+1+u;y=p+1+u;this.faces.push(new i.Face3(m,g,y,[d.clone(),d.clone(),d.clone()]));this.faceVertexUvs[0].push([f[m].clone(),f[g].clone(),f[y].clone()])}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,l)};i.RingGeometry.prototype=Object.create(i.Geometry.prototype);i.SphereGeometry=function(e,t,n,r,s,o,u){i.Geometry.call(this);this.radius=e=e||50;this.widthSegments=t=Math.max(3,Math.floor(t)||8);this.heightSegments=n=Math.max(2,Math.floor(n)||6);this.phiStart=r=r!==undefined?r:0;this.phiLength=s=s!==undefined?s:Math.PI*2;this.thetaStart=o=o!==undefined?o:0;this.thetaLength=u=u!==undefined?u:Math.PI;var a,f,l=[],c=[];for(f=0;f<=n;f++){var h=[];var p=[];for(a=0;a<=t;a++){var d=a/t;var v=f/n;var m=new i.Vector3;m.x=-e*Math.cos(r+d*s)*Math.sin(o+v*u);m.y=e*Math.cos(o+v*u);m.z=e*Math.sin(r+d*s)*Math.sin(o+v*u);this.vertices.push(m);h.push(this.vertices.length-1);p.push(new i.Vector2(d,1-v))}l.push(h);c.push(p)}for(f=0;f<this.heightSegments;f++){for(a=0;a<this.widthSegments;a++){var g=l[f][a+1];var y=l[f][a];var b=l[f+1][a];var w=l[f+1][a+1];var E=this.vertices[g].clone().normalize();var S=this.vertices[y].clone().normalize();var x=this.vertices[b].clone().normalize();var T=this.vertices[w].clone().normalize();var N=c[f][a+1].clone();var C=c[f][a].clone();var k=c[f+1][a].clone();var L=c[f+1][a+1].clone();if(Math.abs(this.vertices[g].y)===this.radius){N.x=(N.x+C.x)/2;this.faces.push(new i.Face3(g,b,w,[E,x,T]));this.faceVertexUvs[0].push([N,k,L])}else if(Math.abs(this.vertices[b].y)===this.radius){k.x=(k.x+L.x)/2;this.faces.push(new i.Face3(g,y,b,[E,S,x]));this.faceVertexUvs[0].push([N,C,k])}else{this.faces.push(new i.Face3(g,y,w,[E,S,T]));this.faceVertexUvs[0].push([N,C,L]);this.faces.push(new i.Face3(y,b,w,[S.clone(),x,T.clone()]));this.faceVertexUvs[0].push([C.clone(),k,L.clone()])}}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,e)};i.SphereGeometry.prototype=Object.create(i.Geometry.prototype);i.TextGeometry=function(e,t){t=t||{};var n=i.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50;if(t.bevelThickness===undefined)t.bevelThickness=10;if(t.bevelSize===undefined)t.bevelSize=8;if(t.bevelEnabled===undefined)t.bevelEnabled=false;i.ExtrudeGeometry.call(this,n,t)};i.TextGeometry.prototype=Object.create(i.ExtrudeGeometry.prototype);i.TorusGeometry=function(e,t,n,r,s){i.Geometry.call(this);var o=this;this.radius=e||100;this.tube=t||40;this.radialSegments=n||8;this.tubularSegments=r||6;this.arc=s||Math.PI*2;var u=new i.Vector3,a=[],f=[];for(var l=0;l<=this.radialSegments;l++){for(var c=0;c<=this.tubularSegments;c++){var h=c/this.tubularSegments*this.arc;var p=l/this.radialSegments*Math.PI*2;u.x=this.radius*Math.cos(h);u.y=this.radius*Math.sin(h);var d=new i.Vector3;d.x=(this.radius+this.tube*Math.cos(p))*Math.cos(h);d.y=(this.radius+this.tube*Math.cos(p))*Math.sin(h);d.z=this.tube*Math.sin(p);this.vertices.push(d);a.push(new i.Vector2(c/this.tubularSegments,l/this.radialSegments));f.push(d.clone().sub(u).normalize())}}for(var l=1;l<=this.radialSegments;l++){for(var c=1;c<=this.tubularSegments;c++){var v=(this.tubularSegments+1)*l+c-1;var m=(this.tubularSegments+1)*(l-1)+c-1;var g=(this.tubularSegments+1)*(l-1)+c;var y=(this.tubularSegments+1)*l+c;var b=new i.Face3(v,m,y,[f[v].clone(),f[m].clone(),f[y].clone()]);this.faces.push(b);this.faceVertexUvs[0].push([a[v].clone(),a[m].clone(),a[y].clone()]);b=new i.Face3(m,g,y,[f[m].clone(),f[g].clone(),f[y].clone()]);this.faces.push(b);this.faceVertexUvs[0].push([a[m].clone(),a[g].clone(),a[y].clone()])}}this.computeCentroids();this.computeFaceNormals()};i.TorusGeometry.prototype=Object.create(i.Geometry.prototype);i.TorusKnotGeometry=function(e,t,n,r,s,o,u){function M(e,t,n,r,s){var o=Math.cos(e);var u=Math.sin(e);var a=t/n*e;var f=Math.cos(a);var l=r*(2+f)*.5*o;var c=r*(2+f)*u*.5;var h=s*r*Math.sin(a)*.5;return new i.Vector3(l,c,h)}i.Geometry.call(this);var a=this;this.radius=e||100;this.tube=t||40;this.radialSegments=n||64;this.tubularSegments=r||8;this.p=s||2;this.q=o||3;this.heightScale=u||1;this.grid=new Array(this.radialSegments);var f=new i.Vector3;var l=new i.Vector3;var c=new i.Vector3;for(var h=0;h<this.radialSegments;++h){this.grid[h]=new Array(this.tubularSegments);var p=h/this.radialSegments*2*this.p*Math.PI;var d=M(p,this.q,this.p,this.radius,this.heightScale);var v=M(p+.01,this.q,this.p,this.radius,this.heightScale);f.subVectors(v,d);l.addVectors(v,d);c.crossVectors(f,l);l.crossVectors(c,f);c.normalize();l.normalize();for(var m=0;m<this.tubularSegments;++m){var g=m/this.tubularSegments*2*Math.PI;var y=-this.tube*Math.cos(g);var b=this.tube*Math.sin(g);var w=new i.Vector3;w.x=d.x+y*l.x+b*c.x;w.y=d.y+y*l.y+b*c.y;w.z=d.z+y*l.z+b*c.z;this.grid[h][m]=a.vertices.push(w)-1}}for(var h=0;h<this.radialSegments;++h){for(var m=0;m<this.tubularSegments;++m){var E=(h+1)%this.radialSegments;var S=(m+1)%this.tubularSegments;var x=this.grid[h][m];var T=this.grid[E][m];var N=this.grid[E][S];var C=this.grid[h][S];var k=new i.Vector2(h/this.radialSegments,m/this.tubularSegments);var L=new i.Vector2((h+1)/this.radialSegments,m/this.tubularSegments);var A=new i.Vector2((h+1)/this.radialSegments,(m+1)/this.tubularSegments);var O=new i.Vector2(h/this.radialSegments,(m+1)/this.tubularSegments);this.faces.push(new i.Face3(x,T,C));this.faceVertexUvs[0].push([k,L,O]);this.faces.push(new i.Face3(T,N,C));this.faceVertexUvs[0].push([L.clone(),A,O.clone()])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};i.TorusKnotGeometry.prototype=Object.create(i.Geometry.prototype);i.TubeGeometry=function(e,t,n,r,s){function I(e,t,n){return o.vertices.push(new i.Vector3(e,t,n))-1}i.Geometry.call(this);this.path=e;this.segments=t||64;this.radius=n||1;this.radialSegments=r||8;this.closed=s||false;this.grid=[];var o=this,u,a,f,l=this.segments+1,c,h,p,d,v,m,g,y,b,w,E,S=new i.Vector3,x,T,N,C,k,L,A,O,M,_,D,P;var H=new i.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),B=H.tangents,j=H.normals,F=H.binormals;this.tangents=B;this.normals=j;this.binormals=F;for(x=0;x<l;x++){this.grid[x]=[];g=x/(l-1);E=e.getPointAt(g);u=B[x];a=j[x];f=F[x];for(T=0;T<this.radialSegments;T++){y=T/this.radialSegments*2*Math.PI;b=-this.radius*Math.cos(y);w=this.radius*Math.sin(y);S.copy(E);S.x+=b*a.x+w*f.x;S.y+=b*a.y+w*f.y;S.z+=b*a.z+w*f.z;this.grid[x][T]=I(S.x,S.y,S.z)}}for(x=0;x<this.segments;x++){for(T=0;T<this.radialSegments;T++){N=this.closed?(x+1)%this.segments:x+1;C=(T+1)%this.radialSegments;k=this.grid[x][T];L=this.grid[N][T];A=this.grid[N][C];O=this.grid[x][C];M=new i.Vector2(x/this.segments,T/this.radialSegments);_=new i.Vector2((x+1)/this.segments,T/this.radialSegments);D=new i.Vector2((x+1)/this.segments,(T+1)/this.radialSegments);P=new i.Vector2(x/this.segments,(T+1)/this.radialSegments);this.faces.push(new i.Face3(k,L,O));this.faceVertexUvs[0].push([M,_,P]);this.faces.push(new i.Face3(L,A,O));this.faceVertexUvs[0].push([_.clone(),D,P.clone()])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};i.TubeGeometry.prototype=Object.create(i.Geometry.prototype);i.TubeGeometry.FrenetFrames=function(e,t,n){function S(e){a[0]=new i.Vector3;f[0]=new i.Vector3;if(e===undefined)e=new i.Vector3(0,0,1);a[0].crossVectors(e,u[0]).normalize();f[0].crossVectors(u[0],a[0]).normalize()}function x(){var t=e.getTangentAt(d);a[0]=(new i.Vector3).subVectors(t,u[0]).normalize();f[0]=(new i.Vector3).crossVectors(u[0],a[0]);a[0].crossVectors(f[0],u[0]).normalize();f[0].crossVectors(u[0],a[0]).normalize()}function T(){a[0]=new i.Vector3;f[0]=new i.Vector3;v=Number.MAX_VALUE;m=Math.abs(u[0].x);g=Math.abs(u[0].y);y=Math.abs(u[0].z);if(m<=v){v=m;s.set(1,0,0)}if(g<=v){v=g;s.set(0,1,0)}if(y<=v){s.set(0,0,1)}l.crossVectors(u[0],s).normalize();a[0].crossVectors(u[0],l);f[0].crossVectors(u[0],a[0])}var r=new i.Vector3,s=new i.Vector3,o=new i.Vector3,u=[],a=[],f=[],l=new i.Vector3,c=new i.Matrix4,h=t+1,p,d=1e-4,v,m,g,y,b,w,E;this.tangents=u;this.normals=a;this.binormals=f;for(b=0;b<h;b++){w=b/(h-1);u[b]=e.getTangentAt(w);u[b].normalize()}T();for(b=1;b<h;b++){a[b]=a[b-1].clone();f[b]=f[b-1].clone();l.crossVectors(u[b-1],u[b]);if(l.length()>d){l.normalize();p=Math.acos(i.Math.clamp(u[b-1].dot(u[b]),-1,1));a[b].applyMatrix4(c.makeRotationAxis(l,p))}f[b].crossVectors(u[b],a[b])}if(n){p=Math.acos(i.Math.clamp(a[0].dot(a[h-1]),-1,1));p/=h-1;if(u[0].dot(l.crossVectors(a[0],a[h-1]))>0){p=-p}for(b=1;b<h;b++){a[b].applyMatrix4(c.makeRotationAxis(u[b],p*b));f[b].crossVectors(u[b],a[b])}}};i.PolyhedronGeometry=function(e,t,n,r){function w(e){var t=e.normalize().clone();t.index=s.vertices.push(t)-1;var n=x(e)/2/Math.PI+.5;var r=T(e)/Math.PI+.5;t.uv=new i.Vector2(n,1-r);return t}function E(e,t,n){var r=new i.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);r.centroid.add(e).add(t).add(n).divideScalar(3);s.faces.push(r);var o=x(r.centroid);s.faceVertexUvs[0].push([N(e.uv,e,o),N(t.uv,t,o),N(n.uv,n,o)])}function S(e,t){var n=Math.pow(2,t);var r=Math.pow(4,t);var i=w(s.vertices[e.a]);var o=w(s.vertices[e.b]);var u=w(s.vertices[e.c]);var a=[];for(var f=0;f<=n;f++){a[f]=[];var l=w(i.clone().lerp(u,f/n));var c=w(o.clone().lerp(u,f/n));var h=n-f;for(var p=0;p<=h;p++){if(p==0&&f==n){a[f][p]=l}else{a[f][p]=w(l.clone().lerp(c,p/h))}}}for(var f=0;f<n;f++){for(var p=0;p<2*(n-f)-1;p++){var d=Math.floor(p/2);if(p%2==0){E(a[f][d+1],a[f+1][d],a[f][d])}else{E(a[f][d+1],a[f+1][d+1],a[f+1][d])}}}}function x(e){return Math.atan2(e.z,-e.x)}function T(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function N(e,t,n){if(n<0&&e.x===1)e=new i.Vector2(e.x-1,e.y);if(t.x===0&&t.z===0)e=new i.Vector2(n/2/Math.PI+.5,e.y);return e.clone()}i.Geometry.call(this);n=n||1;r=r||0;var s=this;for(var o=0,u=e.length;o<u;o++){w(new i.Vector3(e[o][0],e[o][1],e[o][2]))}var a=[],f=this.vertices;var l=[];for(var o=0,u=t.length;o<u;o++){var c=f[t[o][0]];var h=f[t[o][1]];var p=f[t[o][2]];l[o]=new i.Face3(c.index,h.index,p.index,[c.clone(),h.clone(),p.clone()])}for(var o=0,u=l.length;o<u;o++){S(l[o],r)}for(var o=0,u=this.faceVertexUvs[0].length;o<u;o++){var d=this.faceVertexUvs[0][o];var v=d[0].x;var m=d[1].x;var g=d[2].x;var y=Math.max(v,Math.max(m,g));var b=Math.min(v,Math.min(m,g));if(y>.9&&b<.1){if(v<.2)d[0].x+=1;if(m<.2)d[1].x+=1;if(g<.2)d[2].x+=1}}for(var o=0,u=this.vertices.length;o<u;o++){this.vertices[o].multiplyScalar(n)}this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new i.Sphere(new i.Vector3,n)};i.PolyhedronGeometry.prototype=Object.create(i.Geometry.prototype);i.IcosahedronGeometry=function(e,t){this.radius=e;this.detail=t;var n=(1+Math.sqrt(5))/2;var r=[[-1,n,0],[1,n,0],[-1,-n,0],[1,-n,0],[0,-1,n],[0,1,n],[0,-1,-n],[0,1,-n],[n,0,-1],[n,0,1],[-n,0,-1],[-n,0,1]];var s=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];i.PolyhedronGeometry.call(this,r,s,e,t)};i.IcosahedronGeometry.prototype=Object.create(i.Geometry.prototype);i.OctahedronGeometry=function(e,t){var n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];var r=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];i.PolyhedronGeometry.call(this,n,r,e,t)};i.OctahedronGeometry.prototype=Object.create(i.Geometry.prototype);i.TetrahedronGeometry=function(e,t){var n=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]];var r=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];i.PolyhedronGeometry.call(this,n,r,e,t)};i.TetrahedronGeometry.prototype=Object.create(i.Geometry.prototype);i.ParametricGeometry=function(e,t,n){i.Geometry.call(this);var r=this.vertices;var s=this.faces;var o=this.faceVertexUvs[0];var u,a,f,l;var c,h;var p=n+1;var d=t+1;for(u=0;u<=n;u++){h=u/n;for(f=0;f<=t;f++){c=f/t;l=e(c,h);r.push(l)}}var v,m,g,y;var b,w,E,S;for(u=0;u<n;u++){for(f=0;f<t;f++){v=u*d+f;m=u*d+f+1;g=(u+1)*d+f+1;y=(u+1)*d+f;b=new i.Vector2(f/t,u/n);w=new i.Vector2((f+1)/t,u/n);E=new i.Vector2((f+1)/t,(u+1)/n);S=new i.Vector2(f/t,(u+1)/n);s.push(new i.Face3(v,m,y));o.push([b,w,S]);s.push(new i.Face3(m,g,y));o.push([w.clone(),E,S.clone()])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};i.ParametricGeometry.prototype=Object.create(i.Geometry.prototype);i.AxisHelper=function(e){e=e||1;var t=new i.Geometry;t.vertices.push(new i.Vector3,new i.Vector3(e,0,0),new i.Vector3,new i.Vector3(0,e,0),new i.Vector3,new i.Vector3(0,0,e));t.colors.push(new i.Color(16711680),new i.Color(16755200),new i.Color(65280),new i.Color(11206400),new i.Color(255),new i.Color(43775));var n=new i.LineBasicMaterial({vertexColors:i.VertexColors});i.Line.call(this,t,n,i.LinePieces)};i.AxisHelper.prototype=Object.create(i.Line.prototype);i.ArrowHelper=function(e,t,n,r,s,o){i.Object3D.call(this);if(r===undefined)r=16776960;if(n===undefined)n=1;if(s===undefined)s=.2*n;if(o===undefined)o=.2*s;this.position=t;var u=new i.Geometry;u.vertices.push(new i.Vector3(0,0,0));u.vertices.push(new i.Vector3(0,1,0));this.line=new i.Line(u,new i.LineBasicMaterial({color:r}));this.line.matrixAutoUpdate=false;this.add(this.line);var a=new i.CylinderGeometry(0,.5,1,5,1);a.applyMatrix((new i.Matrix4).makeTranslation(0,-.5,0));this.cone=new i.Mesh(a,new i.MeshBasicMaterial({color:r}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(e);this.setLength(n,s,o)};i.ArrowHelper.prototype=Object.create(i.Object3D.prototype);i.ArrowHelper.prototype.setDirection=function(){var e=new i.Vector3;var t;return function(n){if(n.y>.99999){this.quaternion.set(0,0,0,1)}else if(n.y<-.99999){this.quaternion.set(1,0,0,0)}else{e.set(n.z,0,-n.x).normalize();t=Math.acos(n.y);this.quaternion.setFromAxisAngle(e,t)}}}();i.ArrowHelper.prototype.setLength=function(e,t,n){if(t===undefined)t=.2*e;if(n===undefined)n=.2*t;this.line.scale.set(1,e,1);this.line.updateMatrix();this.cone.scale.set(n,t,n);this.cone.position.y=e;this.cone.updateMatrix()};i.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e);this.cone.material.color.setHex(e)};i.BoxHelper=function(e){var t=[new i.Vector3(1,1,1),new i.Vector3(-1,1,1),new i.Vector3(-1,-1,1),new i.Vector3(1,-1,1),new i.Vector3(1,1,-1),new i.Vector3(-1,1,-1),new i.Vector3(-1,-1,-1),new i.Vector3(1,-1,-1)];this.vertices=t;var n=new i.Geometry;n.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]);i.Line.call(this,n,new i.LineBasicMaterial({color:16776960}),i.LinePieces);if(e!==undefined){this.update(e)}};i.BoxHelper.prototype=Object.create(i.Line.prototype);i.BoxHelper.prototype.update=function(e){var t=e.geometry;if(t.boundingBox===null){t.computeBoundingBox()}var n=t.boundingBox.min;var r=t.boundingBox.max;var i=this.vertices;i[0].set(r.x,r.y,r.z);i[1].set(n.x,r.y,r.z);i[2].set(n.x,n.y,r.z);i[3].set(r.x,n.y,r.z);i[4].set(r.x,r.y,n.z);i[5].set(n.x,r.y,n.z);i[6].set(n.x,n.y,n.z);i[7].set(r.x,n.y,n.z);this.geometry.computeBoundingSphere();this.geometry.verticesNeedUpdate=true;this.matrixAutoUpdate=false;this.matrixWorld=e.matrixWorld};i.BoundingBoxHelper=function(e,t){var n=t!==undefined?t:8947848;this.object=e;this.box=new i.Box3;i.Mesh.call(this,new i.BoxGeometry(1,1,1),new i.MeshBasicMaterial({color:n,wireframe:true}))};i.BoundingBoxHelper.prototype=Object.create(i.Mesh.prototype);i.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};i.CameraHelper=function(e){function l(e,t,n){c(e,n);c(t,n)}function c(e,n){t.vertices.push(new i.Vector3);t.colors.push(new i.Color(n));if(r[e]===undefined){r[e]=[]}r[e].push(t.vertices.length-1)}var t=new i.Geometry;var n=new i.LineBasicMaterial({color:16777215,vertexColors:i.FaceColors});var r={};var s=16755200;var o=16711680;var u=43775;var a=16777215;var f=3355443;l("n1","n2",s);l("n2","n4",s);l("n4","n3",s);l("n3","n1",s);l("f1","f2",s);l("f2","f4",s);l("f4","f3",s);l("f3","f1",s);l("n1","f1",s);l("n2","f2",s);l("n3","f3",s);l("n4","f4",s);l("p","n1",o);l("p","n2",o);l("p","n3",o);l("p","n4",o);l("u1","u2",u);l("u2","u3",u);l("u3","u1",u);l("c","t",a);l("p","c",f);l("cn1","cn2",f);l("cn3","cn4",f);l("cf1","cf2",f);l("cf3","cf4",f);i.Line.call(this,t,n,i.LinePieces);this.camera=e;this.matrixWorld=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=r;this.update()};i.CameraHelper.prototype=Object.create(i.Line.prototype);i.CameraHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Camera;var n=new i.Projector;return function(){function o(i,s,o,u){e.set(s,o,u);n.unprojectVector(e,t);var a=r.pointMap[i];if(a!==undefined){for(var f=0,l=a.length;f<l;f++){r.geometry.vertices[a[f]].copy(e)}}}var r=this;var i=1,s=1;t.projectionMatrix.copy(this.camera.projectionMatrix);o("c",0,0,-1);o("t",0,0,1);o("n1",-i,-s,-1);o("n2",i,-s,-1);o("n3",-i,s,-1);o("n4",i,s,-1);o("f1",-i,-s,1);o("f2",i,-s,1);o("f3",-i,s,1);o("f4",i,s,1);o("u1",i*.7,s*1.1,-1);o("u2",-i*.7,s*1.1,-1);o("u3",0,s*2,-1);o("cf1",-i,0,1);o("cf2",i,0,1);o("cf3",0,-s,1);o("cf4",0,s,1);o("cn1",-i,0,-1);o("cn2",i,0,-1);o("cn3",0,-s,-1);o("cn4",0,s,-1);this.geometry.verticesNeedUpdate=true}}();i.DirectionalLightHelper=function(e,t){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrixWorld=e.matrixWorld;this.matrixAutoUpdate=false;t=t||1;var n=new i.PlaneGeometry(t,t);var r=new i.MeshBasicMaterial({wireframe:true,fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new i.Mesh(n,r);this.add(this.lightPlane);n=new i.Geometry;n.vertices.push(new i.Vector3);n.vertices.push(new i.Vector3);r=new i.LineBasicMaterial({fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new i.Line(n,r);this.add(this.targetLine);this.update()};i.DirectionalLightHelper.prototype=Object.create(i.Object3D.prototype);i.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};i.DirectionalLightHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;var n=new i.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);n.subVectors(t,e);this.lightPlane.lookAt(n);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(n);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();i.EdgesHelper=function(e,t){var n=t!==undefined?t:16777215;var r=[0,0],s={};var o=function(e,t){return e-t};var u=["a","b","c"];var a=new i.BufferGeometry;var f=e.geometry.clone();f.mergeVertices();f.computeFaceNormals();var l=f.vertices;var c=f.faces;var h=0;for(var p=0,d=c.length;p<d;p++){var v=c[p];for(var m=0;m<3;m++){r[0]=v[u[m]];r[1]=v[u[(m+1)%3]];r.sort(o);var g=r.toString();if(s[g]===undefined){s[g]={vert1:r[0],vert2:r[1],face1:p,face2:undefined};h++}else{s[g].face2=p}}}a.addAttribute("position",Float32Array,2*h,3);var y=a.attributes.position.array;var b=0;for(var g in s){var w=s[g];if(w.face2===undefined||c[w.face1].normal.dot(c[w.face2].normal)<.9999){var E=l[w.vert1];y[b++]=E.x;y[b++]=E.y;y[b++]=E.z;E=l[w.vert2];y[b++]=E.x;y[b++]=E.y;y[b++]=E.z}}i.Line.call(this,a,new i.LineBasicMaterial({color:n}),i.LinePieces);this.matrixAutoUpdate=false;this.matrixWorld=e.matrixWorld};i.EdgesHelper.prototype=Object.create(i.Line.prototype);i.FaceNormalsHelper=function(e,t,n,r){this.object=e;this.size=t!==undefined?t:1;var s=n!==undefined?n:16776960;var o=r!==undefined?r:1;var u=new i.Geometry;var a=this.object.geometry.faces;for(var f=0,l=a.length;f<l;f++){u.vertices.push(new i.Vector3);u.vertices.push(new i.Vector3)}i.Line.call(this,u,new i.LineBasicMaterial({color:s,linewidth:o}),i.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new i.Matrix3;this.update()};i.FaceNormalsHelper.prototype=Object.create(i.Line.prototype);i.FaceNormalsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var n=this.geometry.vertices;var r=this.object.geometry.faces;var i=this.object.matrixWorld;for(var s=0,o=r.length;s<o;s++){var u=r[s];t.copy(u.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var a=2*s;n[a].copy(u.centroid).applyMatrix4(i);n[a+1].addVectors(n[a],t)}this.geometry.verticesNeedUpdate=true;return this}}();i.GridHelper=function(e,t){var n=new i.Geometry;var r=new i.LineBasicMaterial({vertexColors:i.VertexColors});this.color1=new i.Color(4473924);this.color2=new i.Color(8947848);for(var s=-e;s<=e;s+=t){n.vertices.push(new i.Vector3(-e,0,s),new i.Vector3(e,0,s),new i.Vector3(s,0,-e),new i.Vector3(s,0,e));var o=s===0?this.color1:this.color2;n.colors.push(o,o,o,o)}i.Line.call(this,n,r,i.LinePieces)};i.GridHelper.prototype=Object.create(i.Line.prototype);i.GridHelper.prototype.setColors=function(e,t){this.color1.set(e);this.color2.set(t);this.geometry.colorsNeedUpdate=true};i.HemisphereLightHelper=function(e,t,n,r){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrixWorld=e.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new i.Color,new i.Color];var s=new i.SphereGeometry(t,4,2);s.applyMatrix((new i.Matrix4).makeRotationX(-Math.PI/2));for(var o=0,u=8;o<u;o++){s.faces[o].color=this.colors[o<4?0:1]}var a=new i.MeshBasicMaterial({vertexColors:i.FaceColors,wireframe:true});this.lightSphere=new i.Mesh(s,a);this.add(this.lightSphere);this.update()};i.HemisphereLightHelper.prototype=Object.create(i.Object3D.prototype);i.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};i.HemisphereLightHelper.prototype.update=function(){var e=new i.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();i.PointLightHelper=function(e,t){this.light=e;this.light.updateMatrixWorld();var n=new i.SphereGeometry(t,4,2);var r=new i.MeshBasicMaterial({wireframe:true,fog:false});r.color.copy(this.light.color).multiplyScalar(this.light.intensity);i.Mesh.call(this,n,r);this.matrixWorld=this.light.matrixWorld;this.matrixAutoUpdate=false};i.PointLightHelper.prototype=Object.create(i.Mesh.prototype);i.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};i.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};i.SpotLightHelper=function(e){i.Object3D.call(this);this.light=e;this.light.updateMatrixWorld();this.matrixWorld=e.matrixWorld;this.matrixAutoUpdate=false;var t=new i.CylinderGeometry(0,1,1,8,1,true);t.applyMatrix((new i.Matrix4).makeTranslation(0,-.5,0));t.applyMatrix((new i.Matrix4).makeRotationX(-Math.PI/2));var n=new i.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new i.Mesh(t,n);this.add(this.cone);this.update()};i.SpotLightHelper.prototype=Object.create(i.Object3D.prototype);i.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};i.SpotLightHelper.prototype.update=function(){var e=new i.Vector3;var t=new i.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4;var r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n);e.setFromMatrixPosition(this.light.matrixWorld);t.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(t.sub(e));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();i.VertexNormalsHelper=function(e,t,n,r){this.object=e;this.size=t!==undefined?t:1;var s=n!==undefined?n:16711680;var o=r!==undefined?r:1;var u=new i.Geometry;var a=e.geometry.vertices;var f=e.geometry.faces;for(var l=0,c=f.length;l<c;l++){var h=f[l];for(var p=0,d=h.vertexNormals.length;p<d;p++){u.vertices.push(new i.Vector3);u.vertices.push(new i.Vector3)}}i.Line.call(this,u,new i.LineBasicMaterial({color:s,linewidth:o}),i.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new i.Matrix3;this.update()};i.VertexNormalsHelper.prototype=Object.create(i.Line.prototype);i.VertexNormalsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var r=this.geometry.vertices;var i=this.object.geometry.vertices;var s=this.object.geometry.faces;var o=this.object.matrixWorld;var u=0;for(var a=0,f=s.length;a<f;a++){var l=s[a];for(var c=0,h=l.vertexNormals.length;c<h;c++){var p=l[n[c]];var d=i[p];var v=l.vertexNormals[c];r[u].copy(d).applyMatrix4(o);t.copy(v).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);t.add(r[u]);u=u+1;r[u].copy(t);u=u+1}}this.geometry.verticesNeedUpdate=true;return this}}();i.VertexTangentsHelper=function(e,t,n,r){this.object=e;this.size=t!==undefined?t:1;var s=n!==undefined?n:255;var o=r!==undefined?r:1;var u=new i.Geometry;var a=e.geometry.vertices;var f=e.geometry.faces;for(var l=0,c=f.length;l<c;l++){var h=f[l];for(var p=0,d=h.vertexTangents.length;p<d;p++){u.vertices.push(new i.Vector3);u.vertices.push(new i.Vector3)}}i.Line.call(this,u,new i.LineBasicMaterial({color:s,linewidth:o}),i.LinePieces);this.matrixAutoUpdate=false;this.update()};i.VertexTangentsHelper.prototype=Object.create(i.Line.prototype);i.VertexTangentsHelper.prototype.update=function(e){var t=new i.Vector3;return function(e){var n=["a","b","c","d"];this.object.updateMatrixWorld(true);var r=this.geometry.vertices;var i=this.object.geometry.vertices;var s=this.object.geometry.faces;var o=this.object.matrixWorld;var u=0;for(var a=0,f=s.length;a<f;a++){var l=s[a];for(var c=0,h=l.vertexTangents.length;c<h;c++){var p=l[n[c]];var d=i[p];var v=l.vertexTangents[c];r[u].copy(d).applyMatrix4(o);t.copy(v).transformDirection(o).multiplyScalar(this.size);t.add(r[u]);u=u+1;r[u].copy(t);u=u+1}}this.geometry.verticesNeedUpdate=true;return this}}();i.WireframeHelper=function(e,t){var n=t!==undefined?t:16777215;var r=[0,0],s={};var o=function(e,t){return e-t};var u=["a","b","c"];var a=new i.BufferGeometry;if(e.geometry instanceof i.Geometry){var f=e.geometry.vertices;var l=e.geometry.faces;var c=0;var h=new Uint32Array(6*l.length);for(var p=0,d=l.length;p<d;p++){var v=l[p];for(var m=0;m<3;m++){r[0]=v[u[m]];r[1]=v[u[(m+1)%3]];r.sort(o);var g=r.toString();if(s[g]===undefined){h[2*c]=r[0];h[2*c+1]=r[1];s[g]=true;c++}}}a.addAttribute("position",Float32Array,2*c,3);var y=a.attributes.position.array;for(var p=0,d=c;p<d;p++){for(var m=0;m<2;m++){var b=f[h[2*p+m]];var w=6*p+3*m;y[w+0]=b.x;y[w+1]=b.y;y[w+2]=b.z}}}else if(e.geometry instanceof i.BufferGeometry&&e.geometry.attributes.index!==undefined){var f=e.geometry.attributes.position.array;var E=e.geometry.attributes.index.array;var S=e.geometry.offsets;var c=0;var h=new Uint32Array(2*E.length);for(var x=0,T=S.length;x<T;++x){var N=S[x].start;var C=S[x].count;var w=S[x].index;for(var p=N,k=N+C;p<k;p+=3){for(var m=0;m<3;m++){r[0]=w+E[p+m];r[1]=w+E[p+(m+1)%3];r.sort(o);var g=r.toString();if(s[g]===undefined){h[2*c]=r[0];h[2*c+1]=r[1];s[g]=true;c++}}}}a.addAttribute("position",Float32Array,2*c,3);var y=a.attributes.position.array;for(var p=0,d=c;p<d;p++){for(var m=0;m<2;m++){var w=6*p+3*m;var L=3*h[2*p+m];y[w+0]=f[L];y[w+1]=f[L+1];y[w+2]=f[L+2]}}}else if(e.geometry instanceof i.BufferGeometry){var f=e.geometry.attributes.position.array;var c=f.length/3;var A=c/3;a.addAttribute("position",Float32Array,2*c,3);var y=a.attributes.position.array;for(var p=0,d=A;p<d;p++){for(var m=0;m<3;m++){var w=18*p+6*m;var O=9*p+3*m;y[w+0]=f[O];y[w+1]=f[O+1];y[w+2]=f[O+2];var L=9*p+3*((m+1)%3);y[w+3]=f[L];y[w+4]=f[L+1];y[w+5]=f[L+2]}}}i.Line.call(this,a,new i.LineBasicMaterial({color:n}),i.LinePieces);this.matrixAutoUpdate=false;this.matrixWorld=e.matrixWorld};i.WireframeHelper.prototype=Object.create(i.Line.prototype);i.ImmediateRenderObject=function(){i.Object3D.call(this);this.render=function(e){}};i.ImmediateRenderObject.prototype=Object.create(i.Object3D.prototype);i.LensFlare=function(e,t,n,r,s){i.Object3D.call(this);this.lensFlares=[];this.positionScreen=new i.Vector3;this.customUpdateCallback=undefined;if(e!==undefined){this.add(e,t,n,r,s)}};i.LensFlare.prototype=Object.create(i.Object3D.prototype);i.LensFlare.prototype.add=function(e,t,n,r,s,o){if(t===undefined)t=-1;if(n===undefined)n=0;if(o===undefined)o=1;if(s===undefined)s=new i.Color(16777215);if(r===undefined)r=i.NormalBlending;n=Math.min(n,Math.max(0,n));this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:s,blending:r})};i.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length;var n;var r=-this.positionScreen.x*2;var i=-this.positionScreen.y*2;for(e=0;e<t;e++){n=this.lensFlares[e];n.x=this.positionScreen.x+r*n.distance;n.y=this.positionScreen.y+i*n.distance;n.wantedRotation=n.x*Math.PI*.25;n.rotation+=(n.wantedRotation-n.rotation)*.25}};i.MorphBlendMesh=function(e,t){i.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var n=this.geometry.morphTargets.length;var r="__default";var s=0;var o=n-1;var u=n/1;this.createAnimation(r,s,o,u);this.setAnimationWeight(r,1)};i.MorphBlendMesh.prototype=Object.create(i.Mesh.prototype);i.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){var i={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=i;this.animationsList.push(i)};i.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)(\d+)/;var n,r={};var i=this.geometry;for(var s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s];var a=u.name.match(t);if(a&&a.length>1){var f=a[1];var l=a[2];if(!r[f])r[f]={start:Infinity,end:-Infinity};var c=r[f];if(s<c.start)c.start=s;if(s>c.end)c.end=s;if(!n)n=f}}for(var f in r){var c=r[f];this.createAnimation(f,c.start,c.end,e)}this.firstAnimation=n};i.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];if(t){t.direction=1;t.directionBackwards=false}};i.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];if(t){t.direction=-1;t.directionBackwards=true}};i.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];if(n){n.fps=t;n.duration=(n.end-n.start)/n.fps}};i.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];if(n){n.duration=t;n.fps=(n.end-n.start)/n.duration}};i.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];if(n){n.weight=t}};i.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];if(n){n.time=t}};i.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;var n=this.animationsMap[e];if(n){t=n.time}return t};i.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;var n=this.animationsMap[e];if(n){t=n.duration}return t};i.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}else{console.warn("animation["+e+"] undefined")}};i.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];if(t){t.active=false}};i.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(!r.active)continue;var s=r.duration/r.length;r.time+=r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||r.time<0){r.direction*=-1;if(r.time>r.duration){r.time=r.duration;r.directionBackwards=true}if(r.time<0){r.time=0;r.directionBackwards=false}}}else{r.time=r.time%r.duration;if(r.time<0)r.time+=r.duration}var o=r.startFrame+i.Math.clamp(Math.floor(r.time/s),0,r.length-1);var u=r.weight;if(o!==r.currentFrame){this.morphTargetInfluences[r.lastFrame]=0;this.morphTargetInfluences[r.currentFrame]=1*u;this.morphTargetInfluences[o]=0;r.lastFrame=r.currentFrame;r.currentFrame=o}var a=r.time%s/s;if(r.directionBackwards)a=1-a;this.morphTargetInfluences[r.currentFrame]=a*u;this.morphTargetInfluences[r.lastFrame]=(1-a)*u}};i.LensFlarePlugin=function(){function s(t,n){var r=e.createProgram();var i=e.createShader(e.FRAGMENT_SHADER);var s=e.createShader(e.VERTEX_SHADER);var o="precision "+n+" float;\n";e.shaderSource(i,o+t.fragmentShader);e.shaderSource(s,o+t.vertexShader);e.compileShader(i);e.compileShader(s);e.attachShader(r,i);e.attachShader(r,s);e.linkProgram(r);return r}var e,t,n,r={};this.init=function(o){e=o.context;t=o;n=o.getPrecision();r.vertices=new Float32Array(8+8);r.faces=new Uint16Array(6);var u=0;r.vertices[u++]=-1;r.vertices[u++]=-1;r.vertices[u++]=0;r.vertices[u++]=0;r.vertices[u++]=1;r.vertices[u++]=-1;r.vertices[u++]=1;r.vertices[u++]=0;r.vertices[u++]=1;r.vertices[u++]=1;r.vertices[u++]=1;r.vertices[u++]=1;r.vertices[u++]=-1;r.vertices[u++]=1;r.vertices[u++]=0;r.vertices[u++]=1;u=0;r.faces[u++]=0;r.faces[u++]=1;r.faces[u++]=2;r.faces[u++]=0;r.faces[u++]=2;r.faces[u++]=3;r.vertexBuffer=e.createBuffer();r.elementBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer);e.bufferData(e.ARRAY_BUFFER,r.vertices,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.faces,e.STATIC_DRAW);r.tempTexture=e.createTexture();r.occlusionTexture=e.createTexture();e.bindTexture(e.TEXTURE_2D,r.tempTexture);e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);e.bindTexture(e.TEXTURE_2D,r.occlusionTexture);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST);if(e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){r.hasVertexTexture=false;r.program=s(i.ShaderFlares["lensFlare"],n)}else{r.hasVertexTexture=true;r.program=s(i.ShaderFlares["lensFlareVertexTexture"],n)}r.attributes={};r.uniforms={};r.attributes.vertex=e.getAttribLocation(r.program,"position");r.attributes.uv=e.getAttribLocation(r.program,"uv");r.uniforms.renderType=e.getUniformLocation(r.program,"renderType");r.uniforms.map=e.getUniformLocation(r.program,"map");r.uniforms.occlusionMap=e.getUniformLocation(r.program,"occlusionMap");r.uniforms.opacity=e.getUniformLocation(r.program,"opacity");r.uniforms.color=e.getUniformLocation(r.program,"color");r.uniforms.scale=e.getUniformLocation(r.program,"scale");r.uniforms.rotation=e.getUniformLocation(r.program,"rotation");r.uniforms.screenPosition=e.getUniformLocation(r.program,"screenPosition")};this.render=function(n,s,o,u){var a=n.__webglFlares,f=a.length;if(!f)return;var l=new i.Vector3;var c=u/o,h=o*.5,p=u*.5;var d=16/u,v=new i.Vector2(d*c,d);var m=new i.Vector3(1,1,0),g=new i.Vector2(1,1);var y=r.uniforms,b=r.attributes;e.useProgram(r.program);e.enableVertexAttribArray(r.attributes.vertex);e.enableVertexAttribArray(r.attributes.uv);e.uniform1i(y.occlusionMap,0);e.uniform1i(y.map,1);e.bindBuffer(e.ARRAY_BUFFER,r.vertexBuffer);e.vertexAttribPointer(b.vertex,2,e.FLOAT,false,2*8,0);e.vertexAttribPointer(b.uv,2,e.FLOAT,false,2*8,8);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementBuffer);e.disable(e.CULL_FACE);e.depthMask(false);var w,E,S,x,T;for(w=0;w<f;w++){d=16/u;v.set(d*c,d);x=a[w];l.set(x.matrixWorld.elements[12],x.matrixWorld.elements[13],x.matrixWorld.elements[14]);l.applyMatrix4(s.matrixWorldInverse);l.applyProjection(s.projectionMatrix);m.copy(l);g.x=m.x*h+h;g.y=m.y*p+p;if(r.hasVertexTexture||g.x>0&&g.x<o&&g.y>0&&g.y<u){e.activeTexture(e.TEXTURE1);e.bindTexture(e.TEXTURE_2D,r.tempTexture);e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,g.x-8,g.y-8,16,16,0);e.uniform1i(y.renderType,0);e.uniform2f(y.scale,v.x,v.y);e.uniform3f(y.screenPosition,m.x,m.y,m.z);e.disable(e.BLEND);e.enable(e.DEPTH_TEST);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,r.occlusionTexture);e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,g.x-8,g.y-8,16,16,0);e.uniform1i(y.renderType,1);e.disable(e.DEPTH_TEST);e.activeTexture(e.TEXTURE1);e.bindTexture(e.TEXTURE_2D,r.tempTexture);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);x.positionScreen.copy(m);if(x.customUpdateCallback){x.customUpdateCallback(x)}else{x.updateLensFlares()}e.uniform1i(y.renderType,2);e.enable(e.BLEND);for(E=0,S=x.lensFlares.length;E<S;E++){T=x.lensFlares[E];if(T.opacity>.001&&T.scale>.001){m.x=T.x;m.y=T.y;m.z=T.z;d=T.size*T.scale/u;v.x=d*c;v.y=d;e.uniform3f(y.screenPosition,m.x,m.y,m.z);e.uniform2f(y.scale,v.x,v.y);e.uniform1f(y.rotation,T.rotation);e.uniform1f(y.opacity,T.opacity);e.uniform3f(y.color,T.color.r,T.color.g,T.color.b);t.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst);t.setTexture(T.texture,1);e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}}}}e.enable(e.CULL_FACE);e.enable(e.DEPTH_TEST);e.depthMask(true)};};i.ShadowMapPlugin=function(){function h(e,t){var n=new i.DirectionalLight;n.isVirtual=true;n.onlyShadow=true;n.castShadow=true;n.shadowCameraNear=e.shadowCameraNear;n.shadowCameraFar=e.shadowCameraFar;n.shadowCameraLeft=e.shadowCameraLeft;n.shadowCameraRight=e.shadowCameraRight;n.shadowCameraBottom=e.shadowCameraBottom;n.shadowCameraTop=e.shadowCameraTop;n.shadowCameraVisible=e.shadowCameraVisible;n.shadowDarkness=e.shadowDarkness;n.shadowBias=e.shadowCascadeBias[t];n.shadowMapWidth=e.shadowCascadeWidth[t];n.shadowMapHeight=e.shadowCascadeHeight[t];n.pointsWorld=[];n.pointsFrustum=[];var r=n.pointsWorld,s=n.pointsFrustum;for(var o=0;o<8;o++){r[o]=new i.Vector3;s[o]=new i.Vector3}var u=e.shadowCascadeNearZ[t];var a=e.shadowCascadeFarZ[t];s[0].set(-1,-1,u);s[1].set(1,-1,u);s[2].set(-1,1,u);s[3].set(1,1,u);s[4].set(-1,-1,a);s[5].set(1,-1,a);s[6].set(-1,1,a);s[7].set(1,1,a);return n}function p(e,t){var n=e.shadowCascadeArray[t];n.position.copy(e.position);n.target.position.copy(e.target.position);n.lookAt(n.target);n.shadowCameraVisible=e.shadowCameraVisible;n.shadowDarkness=e.shadowDarkness;n.shadowBias=e.shadowCascadeBias[t];var r=e.shadowCascadeNearZ[t];var i=e.shadowCascadeFarZ[t];var s=n.pointsFrustum;s[0].z=r;s[1].z=r;s[2].z=r;s[3].z=r;s[4].z=i;s[5].z=i;s[6].z=i;s[7].z=i}function d(e,t){var n=t.shadowCamera,r=t.pointsFrustum,s=t.pointsWorld;f.set(Infinity,Infinity,Infinity);l.set(-Infinity,-Infinity,-Infinity);for(var o=0;o<8;o++){var u=s[o];u.copy(r[o]);i.ShadowMapPlugin.__projector.unprojectVector(u,e);u.applyMatrix4(n.matrixWorldInverse);if(u.x<f.x)f.x=u.x;if(u.x>l.x)l.x=u.x;if(u.y<f.y)f.y=u.y;if(u.y>l.y)l.y=u.y;if(u.z<f.z)f.z=u.z;if(u.z>l.z)l.z=u.z}n.left=f.x;n.right=l.x;n.top=l.y;n.bottom=f.y;n.updateProjectionMatrix()}function v(e){return e.material instanceof i.MeshFaceMaterial?e.material.materials[0]:e.material}var e,t,n,r,s,o,u=new i.Frustum,a=new i.Matrix4,f=new i.Vector3,l=new i.Vector3,c=new i.Vector3;this.init=function(u){e=u.context;t=u;var a=i.ShaderLib["depthRGBA"];var f=i.UniformsUtils.clone(a.uniforms);n=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f});r=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:true});s=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,skinning:true});o=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:true,skinning:true});n._shadowPass=true;r._shadowPass=true;s._shadowPass=true;o._shadowPass=true};this.render=function(e,n){if(!(t.shadowMapEnabled&&t.shadowMapAutoUpdate))return;this.update(e,n)};this.update=function(f,l){var m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M=[],_=0,D=null;e.clearColor(1,1,1,1);e.disable(e.BLEND);e.enable(e.CULL_FACE);e.frontFace(e.CCW);if(t.shadowMapCullFace===i.CullFaceFront){e.cullFace(e.FRONT)}else{e.cullFace(e.BACK)}t.setDepthTest(true);for(m=0,g=f.__lights.length;m<g;m++){A=f.__lights[m];if(!A.castShadow)continue;if(A instanceof i.DirectionalLight&&A.shadowCascade){for(w=0;w<A.shadowCascadeCount;w++){var P;if(!A.shadowCascadeArray[w]){P=h(A,w);P.originalCamera=l;var H=new i.Gyroscope;H.position=A.shadowCascadeOffset;H.add(P);H.add(P.target);l.add(H);A.shadowCascadeArray[w]=P;console.log("Created virtualLight",P)}else{P=A.shadowCascadeArray[w]}p(A,w);M[_]=P;_++}}else{M[_]=A;_++}}for(m=0,g=M.length;m<g;m++){A=M[m];if(!A.shadowMap){var B=i.LinearFilter;if(t.shadowMapType===i.PCFSoftShadowMap){B=i.NearestFilter}var j={minFilter:B,magFilter:B,format:i.RGBAFormat};A.shadowMap=new i.WebGLRenderTarget(A.shadowMapWidth,A.shadowMapHeight,j);A.shadowMapSize=new i.Vector2(A.shadowMapWidth,A.shadowMapHeight);A.shadowMatrix=new i.Matrix4}if(!A.shadowCamera){if(A instanceof i.SpotLight){A.shadowCamera=new i.PerspectiveCamera(A.shadowCameraFov,A.shadowMapWidth/A.shadowMapHeight,A.shadowCameraNear,A.shadowCameraFar)}else if(A instanceof i.DirectionalLight){A.shadowCamera=new i.OrthographicCamera(A.shadowCameraLeft,A.shadowCameraRight,A.shadowCameraTop,A.shadowCameraBottom,A.shadowCameraNear,A.shadowCameraFar)}else{console.error("Unsupported light type for shadow");continue}f.add(A.shadowCamera);if(f.autoUpdate===true)f.updateMatrixWorld()}if(A.shadowCameraVisible&&!A.cameraHelper){A.cameraHelper=new i.CameraHelper(A.shadowCamera);A.shadowCamera.add(A.cameraHelper)}if(A.isVirtual&&P.originalCamera==l){d(l,A)}E=A.shadowMap;S=A.shadowMatrix;x=A.shadowCamera;x.position.setFromMatrixPosition(A.matrixWorld);c.setFromMatrixPosition(A.target.matrixWorld);x.lookAt(c);x.updateMatrixWorld();x.matrixWorldInverse.getInverse(x.matrixWorld);if(A.cameraHelper)A.cameraHelper.visible=A.shadowCameraVisible;if(A.shadowCameraVisible)A.cameraHelper.update();S.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);S.multiply(x.projectionMatrix);S.multiply(x.matrixWorldInverse);a.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse);u.setFromMatrix(a);t.setRenderTarget(E);t.clear();O=f.__webglObjects;for(y=0,b=O.length;y<b;y++){k=O[y];L=k.object;k.render=false;if(L.visible&&L.castShadow){if(!(L instanceof i.Mesh||L instanceof i.ParticleSystem)||!L.frustumCulled||u.intersectsObject(L)){L._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,L.matrixWorld);k.render=true}}}var F,I,q;for(y=0,b=O.length;y<b;y++){k=O[y];if(k.render){L=k.object;N=k.buffer;F=v(L);I=L.geometry.morphTargets!==undefined&&L.geometry.morphTargets.length>0&&F.morphTargets;q=L instanceof i.SkinnedMesh&&F.skinning;if(L.customDepthMaterial){C=L.customDepthMaterial}else if(q){C=I?o:s}else if(I){C=r}else{C=n}if(N instanceof i.BufferGeometry){t.renderBufferDirect(x,f.__lights,D,C,N,L)}else{t.renderBuffer(x,f.__lights,D,C,N,L)}}}O=f.__webglObjectsImmediate;for(y=0,b=O.length;y<b;y++){k=O[y];L=k.object;if(L.visible&&L.castShadow){L._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,L.matrixWorld);t.renderImmediateObject(x,f.__lights,D,n,L)}}}var R=t.getClearColor(),U=t.getClearAlpha();e.clearColor(R.r,R.g,R.b,U);e.enable(e.BLEND);if(t.shadowMapCullFace===i.CullFaceFront){e.cullFace(e.BACK)}};};i.ShadowMapPlugin.__projector=new i.Projector;i.SpritePlugin=function(){function c(){var n=e.createProgram();var r=e.createShader(e.VERTEX_SHADER);var i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));e.shaderSource(i,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));e.compileShader(r);e.compileShader(i);e.attachShader(n,r);e.attachShader(n,i);e.linkProgram(n);return n}function h(e,t){if(e.z!==t.z){return t.z-e.z}else{return t.id-e.id}}var e,t,n;var r,s,o,u;var a,f,l;this.init=function(h){e=h.context;t=h;r=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);s=new Uint16Array([0,1,2,0,2,3]);o=e.createBuffer();u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o);e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,u);e.bufferData(e.ELEMENT_ARRAY_BUFFER,s,e.STATIC_DRAW);a=c();f={position:e.getAttribLocation(a,"position"),uv:e.getAttribLocation(a,"uv")};l={uvOffset:e.getUniformLocation(a,"uvOffset"),uvScale:e.getUniformLocation(a,"uvScale"),rotation:e.getUniformLocation(a,"rotation"),scale:e.getUniformLocation(a,"scale"),color:e.getUniformLocation(a,"color"),map:e.getUniformLocation(a,"map"),opacity:e.getUniformLocation(a,"opacity"),modelViewMatrix:e.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(a,"projectionMatrix"),fogType:e.getUniformLocation(a,"fogType"),fogDensity:e.getUniformLocation(a,"fogDensity"),fogNear:e.getUniformLocation(a,"fogNear"),fogFar:e.getUniformLocation(a,"fogFar"),fogColor:e.getUniformLocation(a,"fogColor"),alphaTest:e.getUniformLocation(a,"alphaTest")};var p=document.createElement("canvas");p.width=8;p.height=8;var d=p.getContext("2d");d.fillStyle="#ffffff";d.fillRect(0,0,p.width,p.height);n=new i.Texture(p);n.needsUpdate=true};this.render=function(r,s,c,p){var d=r.__webglSprites,v=d.length;if(!v)return;e.useProgram(a);e.enableVertexAttribArray(f.position);e.enableVertexAttribArray(f.uv);e.disable(e.CULL_FACE);e.enable(e.BLEND);e.bindBuffer(e.ARRAY_BUFFER,o);e.vertexAttribPointer(f.position,2,e.FLOAT,false,2*8,0);e.vertexAttribPointer(f.uv,2,e.FLOAT,false,2*8,8);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,u);e.uniformMatrix4fv(l.projectionMatrix,false,s.projectionMatrix.elements);e.activeTexture(e.TEXTURE0);e.uniform1i(l.map,0);var m=0;var g=0;var y=r.fog;if(y){e.uniform3f(l.fogColor,y.color.r,y.color.g,y.color.b);if(y instanceof i.Fog){e.uniform1f(l.fogNear,y.near);e.uniform1f(l.fogFar,y.far);e.uniform1i(l.fogType,1);m=1;g=1}else if(y instanceof i.FogExp2){e.uniform1f(l.fogDensity,y.density);e.uniform1i(l.fogType,2);m=2;g=2}}else{e.uniform1i(l.fogType,0);m=0;g=0}var b,w,E,S,x=[];for(b=0;b<v;b++){w=d[b];E=w.material;if(w.visible===false)continue;w._modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,w.matrixWorld);w.z=-w._modelViewMatrix.elements[14]}d.sort(h);for(b=0;b<v;b++){w=d[b];if(w.visible===false)continue;E=w.material;e.uniform1f(l.alphaTest,E.alphaTest);e.uniformMatrix4fv(l.modelViewMatrix,false,w._modelViewMatrix.elements);x[0]=w.scale.x;x[1]=w.scale.y;if(r.fog&&E.fog){S=g}else{S=0}if(m!==S){e.uniform1i(l.fogType,S);m=S}if(E.map!==null){e.uniform2f(l.uvOffset,E.map.offset.x,E.map.offset.y);e.uniform2f(l.uvScale,E.map.repeat.x,E.map.repeat.y)}else{e.uniform2f(l.uvOffset,0,0);e.uniform2f(l.uvScale,1,1)}e.uniform1f(l.opacity,E.opacity);e.uniform3f(l.color,E.color.r,E.color.g,E.color.b);e.uniform1f(l.rotation,E.rotation);e.uniform2fv(l.scale,x);t.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst);t.setDepthTest(E.depthTest);t.setDepthWrite(E.depthWrite);if(E.map&&E.map.image&&E.map.image.width){t.setTexture(E.map,0)}else{t.setTexture(n,0)}e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}e.enable(e.CULL_FACE)};};i.DepthPassPlugin=function(){function f(e){return e.material instanceof i.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=false;this.renderTarget=null;var e,t,n,r,s,o,u=new i.Frustum,a=new i.Matrix4;this.init=function(u){e=u.context;t=u;var a=i.ShaderLib["depthRGBA"];var f=i.UniformsUtils.clone(a.uniforms);n=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f});r=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:true});s=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,skinning:true});o=new i.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:f,morphTargets:true,skinning:true});n._shadowPass=true;r._shadowPass=true;s._shadowPass=true;o._shadowPass=true};this.render=function(e,t){if(!this.enabled)return;this.update(e,t)};this.update=function(l,c){var h,p,d,v,m,g,y,b,w,E,S,x,T=null;e.clearColor(1,1,1,1);e.disable(e.BLEND);t.setDepthTest(true);if(l.autoUpdate===true)l.updateMatrixWorld();c.matrixWorldInverse.getInverse(c.matrixWorld);a.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);u.setFromMatrix(a);t.setRenderTarget(this.renderTarget);t.clear();x=l.__webglObjects;for(d=0,v=x.length;d<v;d++){w=x[d];E=w.object;w.render=false;if(E.visible){if(!(E instanceof i.Mesh||E instanceof i.ParticleSystem)||!E.frustumCulled||u.intersectsObject(E)){E._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,E.matrixWorld);w.render=true}}}var N,C,k;for(d=0,v=x.length;d<v;d++){w=x[d];if(w.render){E=w.object;y=w.buffer;if(E instanceof i.ParticleSystem&&!E.customDepthMaterial)continue;N=f(E);if(N)t.setMaterialFaces(E.material);C=E.geometry.morphTargets.length>0&&N.morphTargets;k=E instanceof i.SkinnedMesh&&N.skinning;if(E.customDepthMaterial){b=E.customDepthMaterial}else if(k){b=C?o:s}else if(C){b=r}else{b=n}if(y instanceof i.BufferGeometry){t.renderBufferDirect(c,l.__lights,T,b,y,E)}else{t.renderBuffer(c,l.__lights,T,b,y,E)}}}x=l.__webglObjectsImmediate;for(d=0,v=x.length;d<v;d++){w=x[d];E=w.object;if(E.visible){E._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,E.matrixWorld);t.renderImmediateObject(c,l.__lights,T,n,E)}}var L=t.getClearColor(),A=t.getClearAlpha();e.clearColor(L.r,L.g,L.b,A);e.enable(e.BLEND)};};i.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}};if(typeof n!=="undefined"){if(typeof t!=="undefined"&&t.exports){n=t.exports=i}n.THREE=i}else{this["THREE"]=i}},{}]},{},[25])
